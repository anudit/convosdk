(function () {
	'use strict';

	(()=>{var Xt=Object.create;var ut=Object.defineProperty;var Yt=Object.getOwnPropertyDescriptor;var qt=Object.getOwnPropertyNames;var Zt=Object.getPrototypeOf,te=Object.prototype.hasOwnProperty;var ft=(D,l)=>()=>(l||D((l={exports:{}}).exports,l),l.exports),ee=(D,l)=>{for(var f in l)ut(D,f,{get:l[f],enumerable:!0});},At=(D,l,f,v)=>{if(l&&typeof l=="object"||typeof l=="function")for(let i of qt(l))!te.call(D,i)&&i!==f&&ut(D,i,{get:()=>l[i],enumerable:!(v=Yt(l,i))||v.enumerable});return D};var ct=(D,l,f)=>(f=D!=null?Xt(Zt(D)):{},At(l||!D||!D.__esModule?ut(f,"default",{value:D,enumerable:!0}):f,D)),ne=D=>At(ut({},"__esModule",{value:!0}),D);var Ut=ft(q=>{var st=Symbol.for("react.element"),re=Symbol.for("react.portal"),ie=Symbol.for("react.fragment"),oe=Symbol.for("react.strict_mode"),ae=Symbol.for("react.profiler"),se=Symbol.for("react.provider"),ue=Symbol.for("react.context"),fe=Symbol.for("react.forward_ref"),ce=Symbol.for("react.suspense"),le=Symbol.for("react.memo"),de=Symbol.for("react.lazy"),Tt=Symbol.iterator;function he(D){return D===null||typeof D!="object"?null:(D=Tt&&D[Tt]||D["@@iterator"],typeof D=="function"?D:null)}var It={isMounted:function(){return !1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},xt=Object.assign,Pt={};function ot(D,l,f){this.props=D,this.context=l,this.refs=Pt,this.updater=f||It;}ot.prototype.isReactComponent={};ot.prototype.setState=function(D,l){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,l,"setState");};ot.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate");};function wt(){}wt.prototype=ot.prototype;function yt(D,l,f){this.props=D,this.context=l,this.refs=Pt,this.updater=f||It;}var Ct=yt.prototype=new wt;Ct.constructor=yt;xt(Ct,ot.prototype);Ct.isPureReactComponent=!0;var Et=Array.isArray,bt=Object.prototype.hasOwnProperty,Rt={current:null},Dt={key:!0,ref:!0,__self:!0,__source:!0};function Lt(D,l,f){var v,i={},P=null,O=null;if(l!=null)for(v in l.ref!==void 0&&(O=l.ref),l.key!==void 0&&(P=""+l.key),l)bt.call(l,v)&&!Dt.hasOwnProperty(v)&&(i[v]=l[v]);var R=arguments.length-2;if(R===1)i.children=f;else if(1<R){for(var E=Array(R),w=0;w<R;w++)E[w]=arguments[w+2];i.children=E;}if(D&&D.defaultProps)for(v in R=D.defaultProps,R)i[v]===void 0&&(i[v]=R[v]);return {$$typeof:st,type:D,key:P,ref:O,props:i,_owner:Rt.current}}function pe(D,l){return {$$typeof:st,type:D.type,key:l,ref:D.ref,props:D.props,_owner:D._owner}}function Ot(D){return typeof D=="object"&&D!==null&&D.$$typeof===st}function ge(D){var l={"=":"=0",":":"=2"};return "$"+D.replace(/[=:]/g,function(f){return l[f]})}var Mt=/\/+/g;function mt(D,l){return typeof D=="object"&&D!==null&&D.key!=null?ge(""+D.key):l.toString(36)}function dt(D,l,f,v,i){var P=typeof D;(P==="undefined"||P==="boolean")&&(D=null);var O=!1;if(D===null)O=!0;else switch(P){case"string":case"number":O=!0;break;case"object":switch(D.$$typeof){case st:case re:O=!0;}}if(O)return O=D,i=i(O),D=v===""?"."+mt(O,0):v,Et(i)?(f="",D!=null&&(f=D.replace(Mt,"$&/")+"/"),dt(i,l,f,"",function(w){return w})):i!=null&&(Ot(i)&&(i=pe(i,f+(!i.key||O&&O.key===i.key?"":(""+i.key).replace(Mt,"$&/")+"/")+D)),l.push(i)),1;if(O=0,v=v===""?".":v+":",Et(D))for(var R=0;R<D.length;R++){P=D[R];var E=v+mt(P,R);O+=dt(P,l,f,E,i);}else if(E=he(D),typeof E=="function")for(D=E.call(D),R=0;!(P=D.next()).done;)P=P.value,E=v+mt(P,R++),O+=dt(P,l,f,E,i);else if(P==="object")throw l=String(D),Error("Objects are not valid as a React child (found: "+(l==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":l)+"). If you meant to render a collection of children, use an array instead.");return O}function lt(D,l,f){if(D==null)return D;var v=[],i=0;return dt(D,v,"","",function(P){return l.call(f,P,i++)}),v}function ve(D){if(D._status===-1){var l=D._result;l=l(),l.then(function(f){(D._status===0||D._status===-1)&&(D._status=1,D._result=f);},function(f){(D._status===0||D._status===-1)&&(D._status=2,D._result=f);}),D._status===-1&&(D._status=0,D._result=l);}if(D._status===1)return D._result.default;throw D._result}var rt={current:null},ht={transition:null},me={ReactCurrentDispatcher:rt,ReactCurrentBatchConfig:ht,ReactCurrentOwner:Rt};q.Children={map:lt,forEach:function(D,l,f){lt(D,function(){l.apply(this,arguments);},f);},count:function(D){var l=0;return lt(D,function(){l++;}),l},toArray:function(D){return lt(D,function(l){return l})||[]},only:function(D){if(!Ot(D))throw Error("React.Children.only expected to receive a single React element child.");return D}};q.Component=ot;q.Fragment=ie;q.Profiler=ae;q.PureComponent=yt;q.StrictMode=oe;q.Suspense=ce;q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=me;q.cloneElement=function(D,l,f){if(D==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+D+".");var v=xt({},D.props),i=D.key,P=D.ref,O=D._owner;if(l!=null){if(l.ref!==void 0&&(P=l.ref,O=Rt.current),l.key!==void 0&&(i=""+l.key),D.type&&D.type.defaultProps)var R=D.type.defaultProps;for(E in l)bt.call(l,E)&&!Dt.hasOwnProperty(E)&&(v[E]=l[E]===void 0&&R!==void 0?R[E]:l[E]);}var E=arguments.length-2;if(E===1)v.children=f;else if(1<E){R=Array(E);for(var w=0;w<E;w++)R[w]=arguments[w+2];v.children=R;}return {$$typeof:st,type:D.type,key:i,ref:P,props:v,_owner:O}};q.createContext=function(D){return D={$$typeof:ue,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},D.Provider={$$typeof:se,_context:D},D.Consumer=D};q.createElement=Lt;q.createFactory=function(D){var l=Lt.bind(null,D);return l.type=D,l};q.createRef=function(){return {current:null}};q.forwardRef=function(D){return {$$typeof:fe,render:D}};q.isValidElement=Ot;q.lazy=function(D){return {$$typeof:de,_payload:{_status:-1,_result:D},_init:ve}};q.memo=function(D,l){return {$$typeof:le,type:D,compare:l===void 0?null:l}};q.startTransition=function(D){var l=ht.transition;ht.transition={};try{D();}finally{ht.transition=l;}};q.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};q.useCallback=function(D,l){return rt.current.useCallback(D,l)};q.useContext=function(D){return rt.current.useContext(D)};q.useDebugValue=function(){};q.useDeferredValue=function(D){return rt.current.useDeferredValue(D)};q.useEffect=function(D,l){return rt.current.useEffect(D,l)};q.useId=function(){return rt.current.useId()};q.useImperativeHandle=function(D,l,f){return rt.current.useImperativeHandle(D,l,f)};q.useInsertionEffect=function(D,l){return rt.current.useInsertionEffect(D,l)};q.useLayoutEffect=function(D,l){return rt.current.useLayoutEffect(D,l)};q.useMemo=function(D,l){return rt.current.useMemo(D,l)};q.useReducer=function(D,l,f){return rt.current.useReducer(D,l,f)};q.useRef=function(D){return rt.current.useRef(D)};q.useState=function(D){return rt.current.useState(D)};q.useSyncExternalStore=function(D,l,f){return rt.current.useSyncExternalStore(D,l,f)};q.useTransition=function(){return rt.current.useTransition()};q.version="18.2.0";});var pt=ft((Te,Nt)=>{Nt.exports=Ut();});var Bt=ft((gt,St)=>{(function(l,f){typeof gt=="object"&&typeof St=="object"?St.exports=f():typeof define=="function"&&define.amd?define([],f):typeof gt=="object"?gt.Ably=f():l.Ably=f();})(window,function(){return function(D){var l={};function f(v){if(l[v])return l[v].exports;var i=l[v]={i:v,l:!1,exports:{}};return D[v].call(i.exports,i,i.exports,f),i.l=!0,i.exports}return f.m=D,f.c=l,f.d=function(v,i,P){f.o(v,i)||Object.defineProperty(v,i,{enumerable:!0,get:P});},f.r=function(v){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(v,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(v,"__esModule",{value:!0});},f.t=function(v,i){if(i&1&&(v=f(v)),i&8||i&4&&typeof v=="object"&&v&&v.__esModule)return v;var P=Object.create(null);if(f.r(P),Object.defineProperty(P,"default",{enumerable:!0,value:v}),i&2&&typeof v!="string")for(var O in v)f.d(P,O,function(R){return v[R]}.bind(null,O));return P},f.n=function(v){var i=v&&v.__esModule?function(){return v.default}:function(){return v};return f.d(i,"a",i),i},f.o=function(v,i){return Object.prototype.hasOwnProperty.call(v,i)},f.p="",f(f.s=42)}([function(D,l,f){(function(v){l.__esModule=!0;var i=f(1),P=i.__importDefault(f(3)),O=v||window,R;(function(r){r[r.None=0]="None",r[r.Error=1]="Error",r[r.Major=2]="Major",r[r.Minor=3]="Minor",r[r.Micro=4]="Micro";})(R||(R={}));function E(r,p){return (""+r).padStart(p?3:2,"0")}function w(r){return P.default.Config.logTimestamps?function(p){var T=new Date;r(E(T.getHours())+":"+E(T.getMinutes())+":"+E(T.getSeconds())+"."+E(T.getMilliseconds(),1)+" "+p);}:r}var y=function(){var r,p,T,m;return typeof Window>"u"&&typeof WorkerGlobalScope>"u"||typeof((p=(r=O==null?void 0:O.console)===null||r===void 0?void 0:r.log)===null||p===void 0?void 0:p.apply)=="function"?(T=function(){for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];console.log.apply(console,u);},m=console.warn?function(){for(var u=[],c=0;c<arguments.length;c++)u[c]=arguments[c];console.warn.apply(console,u);}:T):O!=null&&O.console.log?T=m=function(){Function.prototype.apply.call(console.log,console,arguments);}:T=m=function(){},[T,m].map(w)},C=function(){function r(){r.logLevel=r.LOG_DEFAULT;}return r.initLogHandlers=function(){var p=y(),T=p[0],m=p[1];this.logHandler=T,this.logErrorHandler=m;},r.logLevel=R.Error,r.LOG_NONE=R.None,r.LOG_ERROR=R.Error,r.LOG_MAJOR=R.Major,r.LOG_MINOR=R.Minor,r.LOG_MICRO=R.Micro,r.LOG_DEFAULT=R.Error,r.LOG_DEBUG=R.Micro,r.logAction=function(p,T,m){r.shouldLog(p)&&(p===R.Error?r.logErrorHandler:r.logHandler)("Ably: "+T+": "+m);},r.deprecated=function(p,T){r.deprecatedWithMsg(p,"Please use '"+T+"' instead.");},r.deprecatedWithMsg=function(p,T){r.shouldLog(R.Error)&&r.logErrorHandler("Ably: Deprecation warning - '"+p+"' is deprecated and will be removed from a future version. "+T);},r.shouldLog=function(p){return p<=r.logLevel},r.setLog=function(p,T){p!==void 0&&(r.logLevel=p),T!==void 0&&(r.logHandler=r.logErrorHandler=T);},r}();l.default=C;}).call(this,f(10));},function(D,l,f){f.r(l),f.d(l,"__extends",function(){return i}),f.d(l,"__assign",function(){return P}),f.d(l,"__rest",function(){return O}),f.d(l,"__decorate",function(){return R}),f.d(l,"__param",function(){return E}),f.d(l,"__metadata",function(){return w}),f.d(l,"__awaiter",function(){return y}),f.d(l,"__generator",function(){return C}),f.d(l,"__createBinding",function(){return r}),f.d(l,"__exportStar",function(){return p}),f.d(l,"__values",function(){return T}),f.d(l,"__read",function(){return m}),f.d(l,"__spread",function(){return u}),f.d(l,"__spreadArrays",function(){return c}),f.d(l,"__spreadArray",function(){return h}),f.d(l,"__await",function(){return e}),f.d(l,"__asyncGenerator",function(){return a}),f.d(l,"__asyncDelegator",function(){return n}),f.d(l,"__asyncValues",function(){return o}),f.d(l,"__makeTemplateObject",function(){return t}),f.d(l,"__importStar",function(){return g}),f.d(l,"__importDefault",function(){return M}),f.d(l,"__classPrivateFieldGet",function(){return U}),f.d(l,"__classPrivateFieldSet",function(){return b});var v=function(x,d){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,B){A.__proto__=B;}||function(A,B){for(var N in B)Object.prototype.hasOwnProperty.call(B,N)&&(A[N]=B[N]);},v(x,d)};function i(x,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");v(x,d);function A(){this.constructor=x;}x.prototype=d===null?Object.create(d):(A.prototype=d.prototype,new A);}var P=function(){return P=Object.assign||function(d){for(var A,B=1,N=arguments.length;B<N;B++){A=arguments[B];for(var j in A)Object.prototype.hasOwnProperty.call(A,j)&&(d[j]=A[j]);}return d},P.apply(this,arguments)};function O(x,d){var A={};for(var B in x)Object.prototype.hasOwnProperty.call(x,B)&&d.indexOf(B)<0&&(A[B]=x[B]);if(x!=null&&typeof Object.getOwnPropertySymbols=="function")for(var N=0,B=Object.getOwnPropertySymbols(x);N<B.length;N++)d.indexOf(B[N])<0&&Object.prototype.propertyIsEnumerable.call(x,B[N])&&(A[B[N]]=x[B[N]]);return A}function R(x,d,A,B){var N=arguments.length,j=N<3?d:B===null?B=Object.getOwnPropertyDescriptor(d,A):B,F;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate(x,d,A,B);else for(var I=x.length-1;I>=0;I--)(F=x[I])&&(j=(N<3?F(j):N>3?F(d,A,j):F(d,A))||j);return N>3&&j&&Object.defineProperty(d,A,j),j}function E(x,d){return function(A,B){d(A,B,x);}}function w(x,d){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(x,d)}function y(x,d,A,B){function N(j){return j instanceof A?j:new A(function(F){F(j);})}return new(A||(A=Promise))(function(j,F){function I(G){try{S(B.next(G));}catch(W){F(W);}}function L(G){try{S(B.throw(G));}catch(W){F(W);}}function S(G){G.done?j(G.value):N(G.value).then(I,L);}S((B=B.apply(x,d||[])).next());})}function C(x,d){var A={label:0,sent:function(){if(j[0]&1)throw j[1];return j[1]},trys:[],ops:[]},B,N,j,F;return F={next:I(0),throw:I(1),return:I(2)},typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function I(S){return function(G){return L([S,G])}}function L(S){if(B)throw new TypeError("Generator is already executing.");for(;A;)try{if(B=1,N&&(j=S[0]&2?N.return:S[0]?N.throw||((j=N.return)&&j.call(N),0):N.next)&&!(j=j.call(N,S[1])).done)return j;switch(N=0,j&&(S=[S[0]&2,j.value]),S[0]){case 0:case 1:j=S;break;case 4:return A.label++,{value:S[1],done:!1};case 5:A.label++,N=S[1],S=[0];continue;case 7:S=A.ops.pop(),A.trys.pop();continue;default:if(j=A.trys,!(j=j.length>0&&j[j.length-1])&&(S[0]===6||S[0]===2)){A=0;continue}if(S[0]===3&&(!j||S[1]>j[0]&&S[1]<j[3])){A.label=S[1];break}if(S[0]===6&&A.label<j[1]){A.label=j[1],j=S;break}if(j&&A.label<j[2]){A.label=j[2],A.ops.push(S);break}j[2]&&A.ops.pop(),A.trys.pop();continue}S=d.call(x,A);}catch(G){S=[6,G],N=0;}finally{B=j=0;}if(S[0]&5)throw S[1];return {value:S[0]?S[1]:void 0,done:!0}}}var r=Object.create?function(x,d,A,B){B===void 0&&(B=A),Object.defineProperty(x,B,{enumerable:!0,get:function(){return d[A]}});}:function(x,d,A,B){B===void 0&&(B=A),x[B]=d[A];};function p(x,d){for(var A in x)A!=="default"&&!Object.prototype.hasOwnProperty.call(d,A)&&r(d,x,A);}function T(x){var d=typeof Symbol=="function"&&Symbol.iterator,A=d&&x[d],B=0;if(A)return A.call(x);if(x&&typeof x.length=="number")return {next:function(){return x&&B>=x.length&&(x=void 0),{value:x&&x[B++],done:!x}}};throw new TypeError(d?"Object is not iterable.":"Symbol.iterator is not defined.")}function m(x,d){var A=typeof Symbol=="function"&&x[Symbol.iterator];if(!A)return x;var B=A.call(x),N,j=[],F;try{for(;(d===void 0||d-- >0)&&!(N=B.next()).done;)j.push(N.value);}catch(I){F={error:I};}finally{try{N&&!N.done&&(A=B.return)&&A.call(B);}finally{if(F)throw F.error}}return j}function u(){for(var x=[],d=0;d<arguments.length;d++)x=x.concat(m(arguments[d]));return x}function c(){for(var x=0,d=0,A=arguments.length;d<A;d++)x+=arguments[d].length;for(var B=Array(x),N=0,d=0;d<A;d++)for(var j=arguments[d],F=0,I=j.length;F<I;F++,N++)B[N]=j[F];return B}function h(x,d,A){if(A||arguments.length===2)for(var B=0,N=d.length,j;B<N;B++)(j||!(B in d))&&(j||(j=Array.prototype.slice.call(d,0,B)),j[B]=d[B]);return x.concat(j||Array.prototype.slice.call(d))}function e(x){return this instanceof e?(this.v=x,this):new e(x)}function a(x,d,A){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var B=A.apply(x,d||[]),N,j=[];return N={},F("next"),F("throw"),F("return"),N[Symbol.asyncIterator]=function(){return this},N;function F(H){B[H]&&(N[H]=function(z){return new Promise(function(Q,J){j.push([H,z,Q,J])>1||I(H,z);})});}function I(H,z){try{L(B[H](z));}catch(Q){W(j[0][3],Q);}}function L(H){H.value instanceof e?Promise.resolve(H.value.v).then(S,G):W(j[0][2],H);}function S(H){I("next",H);}function G(H){I("throw",H);}function W(H,z){H(z),j.shift(),j.length&&I(j[0][0],j[0][1]);}}function n(x){var d,A;return d={},B("next"),B("throw",function(N){throw N}),B("return"),d[Symbol.iterator]=function(){return this},d;function B(N,j){d[N]=x[N]?function(F){return (A=!A)?{value:e(x[N](F)),done:N==="return"}:j?j(F):F}:j;}}function o(x){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=x[Symbol.asyncIterator],A;return d?d.call(x):(x=typeof T=="function"?T(x):x[Symbol.iterator](),A={},B("next"),B("throw"),B("return"),A[Symbol.asyncIterator]=function(){return this},A);function B(j){A[j]=x[j]&&function(F){return new Promise(function(I,L){F=x[j](F),N(I,L,F.done,F.value);})};}function N(j,F,I,L){Promise.resolve(L).then(function(S){j({value:S,done:I});},F);}}function t(x,d){return Object.defineProperty?Object.defineProperty(x,"raw",{value:d}):x.raw=d,x}var s=Object.create?function(x,d){Object.defineProperty(x,"default",{enumerable:!0,value:d});}:function(x,d){x.default=d;};function g(x){if(x&&x.__esModule)return x;var d={};if(x!=null)for(var A in x)A!=="default"&&Object.prototype.hasOwnProperty.call(x,A)&&r(d,x,A);return s(d,x),d}function M(x){return x&&x.__esModule?x:{default:x}}function U(x,d,A,B){if(A==="a"&&!B)throw new TypeError("Private accessor was defined without a getter");if(typeof d=="function"?x!==d||!B:!d.has(x))throw new TypeError("Cannot read private member from an object whose class did not declare it");return A==="m"?B:A==="a"?B.call(x):B?B.value:d.get(x)}function b(x,d,A,B,N){if(B==="m")throw new TypeError("Private method is not writable");if(B==="a"&&!N)throw new TypeError("Private accessor was defined without a setter");if(typeof d=="function"?x!==d||!N:!d.has(x))throw new TypeError("Cannot write private member to an object whose class did not declare it");return B==="a"?N.call(x,A):N?N.value=A:d.set(x,A),A}},function(D,l,f){l.__esModule=!0,l.allToUpperCase=l.allToLowerCase=l.encodeBody=l.decodeBody=l.Format=l.promisify=l.trim=l.arrChooseN=l.randomHexString=l.randomString=l.cheapRandStr=l.dataSizeBytes=l.inspectBody=l.inspectError=l.isErrorInfo=l.now=l.parseQueryString=l.toQueryString=l.arrPopRandomElement=l.defaultPostHeaders=l.defaultGetHeaders=l.allSame=l.arrEvery=l.arrFilter=l.arrMap=l.safeArrForEach=l.arrForEach=l.forInOwnNonNullProperties=l.valuesArray=l.keysArray=l.arrWithoutValue=l.arrDeleteValue=l.arrIn=l.arrIndexOf=l.arrSubtract=l.arrIntersectOb=l.arrIntersect=l.intersect=l.containsValue=l.inherits=l.prototypicalClone=l.shallowClone=l.isEmptyArg=l.isOnlyPropIn=l.isEmpty=l.isObject=l.ensureArray=l.isArray=l.copy=l.mixin=void 0;var v=f(1),i=v.__importDefault(f(3)),P=v.__importDefault(f(8));function O(_){return Math.floor(Math.random()*_.length)}function R(_){for(var V=[],k=1;k<arguments.length;k++)V[k-1]=arguments[k];for(var K=0;K<V.length;K++){var Y=V[K];if(!Y)break;var et=Object.prototype.hasOwnProperty;for(var it in Y)(!et||et.call(Y,it))&&(_[it]=Y[it]);}return _}l.mixin=R;function E(_){return R({},_)}l.copy=E,l.isArray=Array.isArray||function(_){return Object.prototype.toString.call(_)=="[object Array]"};function w(_){return p(_)?[]:l.isArray(_)?_:[_]}l.ensureArray=w;function y(_){return Object.prototype.toString.call(_)=="[object Object]"}l.isObject=y;function C(_){for(var V in _)return !1;return !0}l.isEmpty=C;function r(_,V){for(var k in _)if(k!==V)return !1;return !0}l.isOnlyPropIn=r;function p(_){return _==null}l.isEmptyArg=p;function T(_){var V=new Object;for(var k in _)V[k]=_[k];return V}l.shallowClone=T;function m(_,V){var k=function(){function Y(){}return Y}();k.prototype=_;var K=new k;return V&&R(K,V),K}l.prototypicalClone=m;var u=function(_,V){if(i.default.Config.inherits){i.default.Config.inherits(_,V);return}_.super_=V,_.prototype=m(V.prototype,{constructor:_});};l.inherits=u;function c(_,V){for(var k in _)if(_[k]==V)return !0;return !1}l.containsValue=c;function h(_,V){return l.isArray(V)?e(_,V):a(_,V)}l.intersect=h;function e(_,V){for(var k=[],K=0;K<_.length;K++){var Y=_[K];l.arrIndexOf(V,Y)!=-1&&k.push(Y);}return k}l.arrIntersect=e;function a(_,V){for(var k=[],K=0;K<_.length;K++){var Y=_[K];Y in V&&k.push(Y);}return k}l.arrIntersectOb=a;function n(_,V){for(var k=[],K=0;K<_.length;K++){var Y=_[K];l.arrIndexOf(V,Y)==-1&&k.push(Y);}return k}l.arrSubtract=n,l.arrIndexOf=Array.prototype.indexOf?function(_,V,k){return _.indexOf(V,k)}:function(_,V,k){k=k||0;for(var K=_.length;k<K;k++)if(_[k]===V)return k;return -1};function o(_,V){return l.arrIndexOf(_,V)!==-1}l.arrIn=o;function t(_,V){var k=l.arrIndexOf(_,V),K=k!=-1;return K&&_.splice(k,1),K}l.arrDeleteValue=t;function s(_,V){var k=_.slice();return t(k,V),k}l.arrWithoutValue=s;function g(_,V){var k=[];for(var K in _)V&&!Object.prototype.hasOwnProperty.call(_,K)||k.push(K);return k}l.keysArray=g;function M(_,V){var k=[];for(var K in _)V&&!Object.prototype.hasOwnProperty.call(_,K)||k.push(_[K]);return k}l.valuesArray=M;function U(_,V){for(var k in _)Object.prototype.hasOwnProperty.call(_,k)&&_[k]&&V(k);}l.forInOwnNonNullProperties=U,l.arrForEach=Array.prototype.forEach?function(_,V){_.forEach(V);}:function(_,V){for(var k=_.length,K=0;K<k;K++)V(_[K],K,_);};function b(_,V){return l.arrForEach(_.slice(),V)}l.safeArrForEach=b,l.arrMap=Array.prototype.map?function(_,V){return _.map(V)}:function(_,V){for(var k=[],K=_.length,Y=0;Y<K;Y++)k.push(V(_[Y],Y,_));return k},l.arrFilter=Array.prototype.filter?function(_,V){return _.filter(V)}:function(_,V){for(var k=[],K=_.length,Y=0;Y<K;Y++)V(_[Y])&&k.push(_[Y]);return k},l.arrEvery=Array.prototype.every?function(_,V){return _.every(V)}:function(_,V){for(var k=_.length,K=0;K<k;K++)if(!V(_[K],K,_))return !1;return !0};function x(_,V){if(_.length===0)return !0;var k=_[0][V];return l.arrEvery(_,function(K){return K[V]===k})}l.allSame=x;var d={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function A(_){var V=d[_||X.json];return {accept:V,"X-Ably-Version":P.default.apiVersion,"Ably-Agent":P.default.agent}}l.defaultGetHeaders=A;function B(_){var V,k=V=d[_||X.json];return {accept:k,"content-type":V,"X-Ably-Version":P.default.apiVersion,"Ably-Agent":P.default.agent}}l.defaultPostHeaders=B;function N(_){return _.splice(O(_),1)[0]}l.arrPopRandomElement=N;function j(_){var V=[];if(_)for(var k in _)V.push(encodeURIComponent(k)+"="+encodeURIComponent(_[k]));return V.length?"?"+V.join("&"):""}l.toQueryString=j;function F(_){for(var V,k=/([^?&=]+)=?([^&]*)/g,K={};V=k.exec(_);)K[decodeURIComponent(V[1])]=decodeURIComponent(V[2]);return K}l.parseQueryString=F,l.now=Date.now||function(){return new Date().getTime()};function I(_){return _.constructor.name=="ErrorInfo"}l.isErrorInfo=I;function L(_){var V,k;return _ instanceof Error||((k=(V=_)===null||V===void 0?void 0:V.constructor)===null||k===void 0?void 0:k.name)==="ErrorInfo"?i.default.Config.inspect(_):_.toString()}l.inspectError=L;function S(_){return i.default.BufferUtils.isBuffer(_)?_.toString():typeof _=="string"?_:i.default.Config.inspect(_)}l.inspectBody=S;function G(_){if(i.default.BufferUtils.isBuffer(_))return i.default.BufferUtils.byteLength(_);if(typeof _=="string")return i.default.Config.stringByteSize(_);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof _)}l.dataSizeBytes=G;function W(){return String(Math.random()).substr(2)}l.cheapRandStr=W;var H=function(_){if(i.default.Config.getRandomValues&&typeof Uint8Array<"u"){var V=new Uint8Array(_);return i.default.Config.getRandomValues(V),i.default.BufferUtils.base64Encode(V)}for(var k=i.default.BufferUtils.base64CharSet,K=Math.round(_*4/3),Y="",et=0;et<K;et++)Y+=k[O(k)];return Y};l.randomString=H;var z=function(_){if(i.default.Config.getRandomValues&&typeof Uint8Array<"u"){var V=new Uint8Array(_);return i.default.Config.getRandomValues(V),i.default.BufferUtils.hexEncode(V)}for(var k=i.default.BufferUtils.hexCharSet,K=_*2,Y="",et=0;et<K;et++)Y+=k[O(k)];return Y};l.randomHexString=z;function Q(_,V){for(var k=Math.min(V,_.length),K=_.slice(),Y=[],et=0;et<k;et++)Y.push(N(K));return Y}l.arrChooseN=Q,l.trim=String.prototype.trim?function(_){return _.trim()}:function(_){return _.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function J(_,V,k){return new Promise(function(K,Y){_[V].apply(_,v.__spreadArray(v.__spreadArray([],k),[function(et,it){et?Y(et):K(it);}]));})}l.promisify=J;var X;(function(_){_.msgpack="msgpack",_.json="json";})(X=l.Format||(l.Format={}));function tt(_,V){return V=="msgpack"?i.default.Config.msgpack.decode(_):JSON.parse(String(_))}l.decodeBody=tt;function Z(_,V){return V=="msgpack"?i.default.Config.msgpack.encode(_,!0):JSON.stringify(_)}l.encodeBody=Z;function $(_){return _.map(function(V){return V&&V.toLowerCase()})}l.allToLowerCase=$;function nt(_){return _.map(function(V){return V&&V.toUpperCase()})}l.allToUpperCase=nt;},function(D,l,f){l.__esModule=!0;var v=function(){function i(){}return i}();l.default=v;},function(D,l,f){(function(v,i){D.exports=i(f(6));})(this,function(v){return function(){if(typeof ArrayBuffer=="function"){var i=v,P=i.lib,O=P.WordArray,R=O.init,E=O.init=function(w){if(w instanceof ArrayBuffer&&(w=new Uint8Array(w)),(w instanceof Int8Array||typeof Uint8ClampedArray<"u"&&w instanceof Uint8ClampedArray||w instanceof Int16Array||w instanceof Uint16Array||w instanceof Int32Array||w instanceof Uint32Array||w instanceof Float32Array||w instanceof Float64Array)&&(w=new Uint8Array(w.buffer,w.byteOffset,w.byteLength)),w instanceof Uint8Array){for(var y=w.byteLength,C=[],r=0;r<y;r++)C[r>>>2]|=w[r]<<24-r%4*8;R.call(this,C,y);}else R.apply(this,arguments);};E.prototype=O;}}(),v.lib.WordArray});},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importDefault(f(3)),P=v.__importStar(f(2)),O=function(){function R(E,w,y,C){this.message=E,this.code=w,this.statusCode=y,this.cause=C;}return R.prototype.toString=function(){var E="["+this.constructor.name;return this.message&&(E+=": "+this.message),this.statusCode&&(E+="; statusCode="+this.statusCode),this.code&&(E+="; code="+this.code),this.cause&&(E+="; cause="+P.inspectError(this.cause)),this.href&&!(this.message&&this.message.indexOf("help.ably.io")>-1)&&(E+="; see "+this.href+" "),E+="]",E},R.fromValues=function(E){var w=E,y=w.message,C=w.code,r=w.statusCode;if(typeof y!="string"||typeof C!="number"||typeof r!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+i.default.Config.inspect(E));var p=Object.assign(new R(y,C,r),E);return p.code&&!p.href&&(p.href="https://help.ably.io/error/"+p.code),p},R}();l.default=O;},function(D,l,f){(function(v){(function(i,P){D.exports=P();})(this,function(){var i=i||function(P,O){var R;if(typeof window<"u"&&window.crypto&&(R=window.crypto),!R&&typeof window<"u"&&window.msCrypto&&(R=window.msCrypto),!R&&typeof v<"u"&&v.crypto&&(R=v.crypto),!R)try{R=f(45);}catch{}var E=function(){if(R){if(typeof R.getRandomValues=="function")try{return R.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof R.randomBytes=="function")try{return R.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},w=Object.create||function(){function n(){}return function(o){var t;return n.prototype=o,t=new n,n.prototype=null,t}}(),y={},C=y.lib={},r=C.Base=function(){return {extend:function(n){var o=w(this);return n&&o.mixIn(n),(!o.hasOwnProperty("init")||this.init===o.init)&&(o.init=function(){o.$super.init.apply(this,arguments);}),o.init.prototype=o,o.$super=this,o},create:function(){var n=this.extend();return n.init.apply(n,arguments),n},init:function(){},mixIn:function(n){for(var o in n)n.hasOwnProperty(o)&&(this[o]=n[o]);n.hasOwnProperty("toString")&&(this.toString=n.toString);},clone:function(){return this.init.prototype.extend(this)}}}(),p=C.WordArray=r.extend({init:function(n,o){n=this.words=n||[],o!=O?this.sigBytes=o:this.sigBytes=n.length*4;},toString:function(n){return (n||m).stringify(this)},concat:function(n){var o=this.words,t=n.words,s=this.sigBytes,g=n.sigBytes;if(this.clamp(),s%4)for(var M=0;M<g;M++){var U=t[M>>>2]>>>24-M%4*8&255;o[s+M>>>2]|=U<<24-(s+M)%4*8;}else for(var M=0;M<g;M+=4)o[s+M>>>2]=t[M>>>2];return this.sigBytes+=g,this},clamp:function(){var n=this.words,o=this.sigBytes;n[o>>>2]&=4294967295<<32-o%4*8,n.length=P.ceil(o/4);},clone:function(){var n=r.clone.call(this);return n.words=this.words.slice(0),n},random:function(n){for(var o=[],t=0;t<n;t+=4)o.push(E());return new p.init(o,n)}}),T=y.enc={},m=T.Hex={stringify:function(n){for(var o=n.words,t=n.sigBytes,s=[],g=0;g<t;g++){var M=o[g>>>2]>>>24-g%4*8&255;s.push((M>>>4).toString(16)),s.push((M&15).toString(16));}return s.join("")},parse:function(n){for(var o=n.length,t=[],s=0;s<o;s+=2)t[s>>>3]|=parseInt(n.substr(s,2),16)<<24-s%8*4;return new p.init(t,o/2)}},u=T.Latin1={stringify:function(n){for(var o=n.words,t=n.sigBytes,s=[],g=0;g<t;g++){var M=o[g>>>2]>>>24-g%4*8&255;s.push(String.fromCharCode(M));}return s.join("")},parse:function(n){for(var o=n.length,t=[],s=0;s<o;s++)t[s>>>2]|=(n.charCodeAt(s)&255)<<24-s%4*8;return new p.init(t,o)}},c=T.Utf8={stringify:function(n){try{return decodeURIComponent(escape(u.stringify(n)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(n){return u.parse(unescape(encodeURIComponent(n)))}},h=C.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new p.init,this._nDataBytes=0;},_append:function(n){typeof n=="string"&&(n=c.parse(n)),this._data.concat(n),this._nDataBytes+=n.sigBytes;},_process:function(n){var o,t=this._data,s=t.words,g=t.sigBytes,M=this.blockSize,U=M*4,b=g/U;n?b=P.ceil(b):b=P.max((b|0)-this._minBufferSize,0);var x=b*M,d=P.min(x*4,g);if(x){for(var A=0;A<x;A+=M)this._doProcessBlock(s,A);o=s.splice(0,x),t.sigBytes-=d;}return new p.init(o,d)},clone:function(){var n=r.clone.call(this);return n._data=this._data.clone(),n},_minBufferSize:0});C.Hasher=h.extend({cfg:r.extend(),init:function(n){this.cfg=this.cfg.extend(n),this.reset();},reset:function(){h.reset.call(this),this._doReset();},update:function(n){return this._append(n),this._process(),this},finalize:function(n){n&&this._append(n);var o=this._doFinalize();return o},blockSize:512/32,_createHelper:function(n){return function(o,t){return new n.init(t).finalize(o)}},_createHmacHelper:function(n){return function(o,t){return new a.HMAC.init(n,t).finalize(o)}}});var a=y.algo={};return y}(Math);return i});}).call(this,f(10));},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=v.__importDefault(f(0)),O=v.__importDefault(f(3));function R(y,C,r){try{C.apply(y,r);}catch(p){P.default.logAction(P.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+p+"; stack = "+(p&&p.stack));}}function E(y,C,r){for(var p,T,m,u=0;u<y.length;u++)if(p=y[u],r&&(p=p[r]),i.isArray(p)){for(;(T=i.arrIndexOf(p,C))!==-1;)p.splice(T,1);r&&p.length===0&&delete y[u][r];}else if(i.isObject(p))for(m in p)Object.prototype.hasOwnProperty.call(p,m)&&i.isArray(p[m])&&E([p],C,m);}var w=function(){function y(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);}return y.prototype.on=function(){for(var C=this,r=[],p=0;p<arguments.length;p++)r[p]=arguments[p];if(r.length===1){var T=r[0];if(typeof T=="function")this.any.push(T);else throw new Error("EventListener.on(): Invalid arguments: "+O.default.Config.inspect(r))}if(r.length===2){var m=r[0],u=r[1];if(typeof u!="function")throw new Error("EventListener.on(): Invalid arguments: "+O.default.Config.inspect(r));if(i.isEmptyArg(m))this.any.push(u);else if(i.isArray(m))m.forEach(function(h){C.on(h,u);});else {if(typeof m!="string")throw new Error("EventListener.on(): Invalid arguments: "+O.default.Config.inspect(r));var c=this.events[m]||(this.events[m]=[]);c.push(u);}}},y.prototype.off=function(){for(var C,r=this,p=[],T=0;T<arguments.length;T++)p[T]=arguments[T];if(p.length==0||i.isEmptyArg(p[0])&&i.isEmptyArg(p[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var m=p[0],u=p[1],c=null,h=null;if(p.length===1||!u)typeof m=="function"?c=m:h=m;else {if(typeof u!="function")throw new Error("EventEmitter.off(): invalid arguments:"+O.default.Config.inspect(p));C=[m,u],h=C[0],c=C[1];}if(c&&i.isEmptyArg(h)){E([this.any,this.events,this.anyOnce,this.eventsOnce],c);return}if(i.isArray(h)){h.forEach(function(e){r.off(e,c);});return}if(typeof h!="string")throw new Error("EventEmitter.off(): invalid arguments:"+O.default.Config.inspect(p));c?E([this.events,this.eventsOnce],c,h):(delete this.events[h],delete this.eventsOnce[h]);},y.prototype.listeners=function(C){if(C){var r=this.events[C]||[];return this.eventsOnce[C]&&Array.prototype.push.apply(r,this.eventsOnce[C]),r.length?r:null}return this.any.length?this.any:null},y.prototype.emit=function(C){for(var r=[],p=1;p<arguments.length;p++)r[p-1]=arguments[p];var T={event:C},m=[];this.anyOnce.length&&(Array.prototype.push.apply(m,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(m,this.any);var u=this.eventsOnce[C];u&&(Array.prototype.push.apply(m,u),delete this.eventsOnce[C]);var c=this.events[C];c&&Array.prototype.push.apply(m,c),i.arrForEach(m,function(h){R(T,h,r);});},y.prototype.once=function(){for(var C=this,r=[],p=0;p<arguments.length;p++)r[p]=arguments[p];var T=r.length;if((T===0||T===1&&typeof r[0]!="function")&&O.default.Config.Promise){var m=r[0];if(typeof m!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+O.default.Config.inspect(r));return new O.default.Config.Promise(function(n){C.once(m,n);})}var u=r[0],c=r[1];if(r.length===1&&typeof u=="function")this.anyOnce.push(u);else if(i.isEmptyArg(u)){if(typeof c!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+O.default.Config.inspect(r));this.anyOnce.push(c);}else if(i.isArray(u)){var h=this,e=function(){var n=Array.prototype.slice.call(arguments);if(i.arrForEach(u,function(o){h.off(o,e);}),typeof c!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+O.default.Config.inspect(r));c.apply(this,n);};i.arrForEach(u,function(n){h.on(n,e);});}else {if(typeof u!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+O.default.Config.inspect(r));var a=this.eventsOnce[u]||(this.eventsOnce[u]=[]);if(c){if(typeof c!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+O.default.Config.inspect(r));a.push(c);}}},y.prototype.whenState=function(C,r,p){for(var T=this,m=[],u=3;u<arguments.length;u++)m[u-3]=arguments[u];var c={event:C};if(typeof C!="string"||typeof r!="string")throw "whenState requires a valid event String argument";if(typeof p!="function"&&O.default.Config.Promise)return new O.default.Config.Promise(function(h){y.prototype.whenState.apply(T,[C,r,h].concat(m));});C===r?R(c,p,m):this.once(C,p);},y}();l.default=w;},function(D,l,f){l.__esModule=!0,l.getDefaults=l.normaliseOptions=l.objectifyOptions=l.getHosts=l.getFallbackHosts=l.environmentFallbackHosts=l.getHttpScheme=l.getPort=l.getHost=void 0;var v=f(1),i=v.__importDefault(f(3)),P=v.__importStar(f(2)),O=v.__importDefault(f(0)),R=v.__importDefault(f(5)),E=f(43),w="ably-js/"+E.version,y={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:E.version,apiVersion:"1.2",agent:w,getHost:C,getPort:r,getHttpScheme:p,environmentFallbackHosts:T,getFallbackHosts:m,getHosts:u,checkHost:c,objectifyOptions:a,normaliseOptions:n};function C(t,s,g){return g?s=s==t.restHost&&t.realtimeHost||s||t.realtimeHost:s=s||t.restHost,s}l.getHost=C;function r(t,s){return s||t.tls?t.tlsPort:t.port}l.getPort=r;function p(t){return t.tls?"https://":"http://"}l.getHttpScheme=p;function T(t){return [t+"-a-fallback.ably-realtime.com",t+"-b-fallback.ably-realtime.com",t+"-c-fallback.ably-realtime.com",t+"-d-fallback.ably-realtime.com",t+"-e-fallback.ably-realtime.com"]}l.environmentFallbackHosts=T;function m(t){var s=t.fallbackHosts,g=typeof t.httpMaxRetryCount<"u"?t.httpMaxRetryCount:y.httpMaxRetryCount;return s?P.arrChooseN(s,g):[]}l.getFallbackHosts=m;function u(t){return [t.restHost].concat(m(t))}l.getHosts=u;function c(t){if(typeof t!="string")throw new R.default("host must be a string; was a "+typeof t,4e4,400);if(!t.length)throw new R.default("host must not be zero-length",4e4,400)}function h(t,s,g){return t.realtimeHost?t.realtimeHost:t.restHost?(O.default.logAction(O.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+t.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+t.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),t.restHost):s?y.REALTIME_HOST:g+"-"+y.REALTIME_HOST}function e(t){var s={};for(var g in y.TIMEOUTS)s[g]=t[g]||y.TIMEOUTS[g];return s}function a(t){return typeof t=="string"?t.indexOf(":")==-1?{token:t}:{key:t}:t}l.objectifyOptions=a;function n(t){if(t.host&&(O.default.deprecated("host","restHost"),t.restHost=t.host),t.wsHost&&(O.default.deprecated("wsHost","realtimeHost"),t.realtimeHost=t.wsHost),t.queueEvents&&(O.default.deprecated("queueEvents","queueMessages"),t.queueMessages=t.queueEvents),t.fallbackHostsUseDefault){if(t.fallbackHosts){var s="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw O.default.logAction(O.default.LOG_ERROR,"Defaults.normaliseOptions",s),new R.default(s,4e4,400)}if(t.port||t.tlsPort){var s="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw O.default.logAction(O.default.LOG_ERROR,"Defaults.normaliseOptions",s),new R.default(s,4e4,400)}t.environment?O.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):O.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),t.fallbackHosts=y.FALLBACK_HOSTS;}t.recover===!0&&(O.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),t.recover=function(B,N){N(!0);}),typeof t.recover=="function"&&t.closeOnUnload===!0&&(O.default.logAction(O.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),t.recover=void 0),"closeOnUnload"in t||(t.closeOnUnload=!t.recover),t.transports&&P.arrIn(t.transports,"xhr")&&(O.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),P.arrDeleteValue(t.transports,"xhr"),t.transports.push("xhr_streaming")),"queueMessages"in t||(t.queueMessages=!0);var g=t.environment&&String(t.environment).toLowerCase()||y.ENVIRONMENT,M=!g||g==="production";!t.fallbackHosts&&!t.restHost&&!t.realtimeHost&&!t.port&&!t.tlsPort&&(t.fallbackHosts=M?y.FALLBACK_HOSTS:T(g));var U=t.restHost||(M?y.REST_HOST:g+"-"+y.REST_HOST),b=h(t,M,g);P.arrForEach((t.fallbackHosts||[]).concat(U,b),c),t.port=t.port||y.PORT,t.tlsPort=t.tlsPort||y.TLS_PORT,"tls"in t||(t.tls=!0);var x=e(t);if("useBinaryProtocol"in t?t.useBinaryProtocol=i.default.Config.supportsBinary&&t.useBinaryProtocol:t.useBinaryProtocol=i.default.Config.preferBinary,t.clientId){var d=t.headers=t.headers||{};d["X-Ably-ClientId"]=i.default.BufferUtils.base64Encode(i.default.BufferUtils.utf8Encode(t.clientId));}if("idempotentRestPublishing"in t||(t.idempotentRestPublishing=!0),t.promises&&!i.default.Config.Promise&&(O.default.logAction(O.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),t.promises=!1),t.agents)for(var A in t.agents)y.agent+=" "+A+"/"+t.agents[A];return v.__assign(v.__assign({},t),{useBinaryProtocol:"useBinaryProtocol"in t?i.default.Config.supportsBinary&&t.useBinaryProtocol:i.default.Config.preferBinary,realtimeHost:b,restHost:U,maxMessageSize:t.maxMessageSize||y.maxMessageSize,timeouts:x})}l.normaliseOptions=n,l.default=y;function o(t){return Object.assign(y,t)}l.getDefaults=o;},function(D,l,f){(function(v){l.__esModule=!0;var i=f(1),P=i.__importDefault(f(41)),O=v||window;typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function R(){var C=O.location;return !O.WebSocket||!C||!C.origin||C.origin.indexOf("http")>-1}var E=O.navigator&&O.navigator.userAgent.toString(),w=O.location&&O.location.href,y={agent:"browser",logTimestamps:!0,userAgent:E,currentUrl:w,noUpgrade:E&&!!E.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:O.WebSocket,xhrSupported:O.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document<"u",allowComet:R(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:P.default,supportsBinary:!!O.TextDecoder,preferBinary:!1,ArrayBuffer:O.ArrayBuffer,atob:O.atob,nextTick:typeof O.setImmediate<"u"?O.setImmediate.bind(O):function(C){setTimeout(C,0);},addEventListener:O.addEventListener,inspect:JSON.stringify,stringByteSize:function(C){return O.TextDecoder&&new O.TextEncoder().encode(C).length||C.length},TextEncoder:O.TextEncoder,TextDecoder:O.TextDecoder,Promise:O.Promise,getRandomValues:function(C){if(C!==void 0)return function(r,p){C.getRandomValues(r),p&&p(null);}}(O.crypto||msCrypto)};l.default=y;}).call(this,f(10));},function(D,l){var f;f=function(){return this}();try{f=f||new Function("return this")();}catch{typeof window=="object"&&(f=window);}D.exports=f;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importDefault(f(3)),P=v.__importDefault(f(0)),O=v.__importDefault(f(5)),R=v.__importStar(f(2));function E(r){return !r||!r.channelOptions?{channelOptions:r,plugins:{},baseEncodedPreviousPayload:void 0}:r}function w(r){if(r&&r.cipher&&!r.cipher.channelCipher){if(!i.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var p=i.default.Crypto.getCipher(r.cipher);return {cipher:p.cipherParams,channelCipher:p.cipher}}return r}function y(r){var p=0;return r.name&&(p+=r.name.length),r.clientId&&(p+=r.clientId.length),r.extras&&(p+=JSON.stringify(r.extras).length),r.data&&(p+=R.dataSizeBytes(r.data)),p}var C=function(){function r(){}return r.prototype.toJSON=function(){var p=this.encoding,T=this.data;return T&&i.default.BufferUtils.isBuffer(T)&&(arguments.length>0?(p=p?p+"/base64":"base64",T=i.default.BufferUtils.base64Encode(T)):T=i.default.BufferUtils.toBuffer(T)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:p,data:T}},r.prototype.toString=function(){var p="[Message";return this.name&&(p+="; name="+this.name),this.id&&(p+="; id="+this.id),this.timestamp&&(p+="; timestamp="+this.timestamp),this.clientId&&(p+="; clientId="+this.clientId),this.connectionId&&(p+="; connectionId="+this.connectionId),this.encoding&&(p+="; encoding="+this.encoding),this.extras&&(p+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?p+="; data="+this.data:i.default.BufferUtils.isBuffer(this.data)?p+="; data (buffer)="+i.default.BufferUtils.base64Encode(this.data):p+="; data (json)="+JSON.stringify(this.data)),this.extras&&(p+="; extras="+JSON.stringify(this.extras)),p+="]",p},r.encrypt=function(p,T,m){var u=p.data,c=p.encoding,h=T.channelCipher;c=c?c+"/":"",i.default.BufferUtils.isBuffer(u)||(u=i.default.BufferUtils.utf8Encode(String(u)),c=c+"utf-8/"),h.encrypt(u,function(e,a){if(e){m(e);return}p.data=a,p.encoding=c+"cipher+"+h.algorithm,m(null,p);});},r.encode=function(p,T,m){var u=p.data,c=typeof u=="string"||i.default.BufferUtils.isBuffer(u)||u===null||u===void 0;if(!c)if(R.isObject(u)||R.isArray(u))p.data=JSON.stringify(u),p.encoding=p.encoding?p.encoding+"/json":"json";else throw new O.default("Data type is unsupported",40013,400);T!=null&&T.cipher?r.encrypt(p,T,m):m(null,p);},r.encodeArray=function(p,T,m){for(var u=0,c=0;c<p.length;c++)r.encode(p[c],T,function(h){if(h){m(h);return}u++,u==p.length&&m(null,p);});},r.decode=function(p,T){var m=E(T),u=p.data,c=p.encoding;if(c){var h=c.split("/"),e=void 0,a=h.length,n=p.data,o="";try{for(;(e=a)>0;){var t=h[--a].match(/([-\w]+)(\+([\w-]+))?/);if(!t)break;switch(o=t[1],o){case"base64":n=i.default.BufferUtils.base64Decode(String(n)),e==h.length&&(u=n);continue;case"utf-8":n=i.default.BufferUtils.utf8Decode(n);continue;case"json":n=JSON.parse(n);continue;case"cipher":if(m.channelOptions!=null&&m.channelOptions.cipher&&m.channelOptions.channelCipher){var s=t[3],g=m.channelOptions.channelCipher;if(s!=g.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");n=g.decrypt(n);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!m.plugins||!m.plugins.vcdiff)throw new O.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new O.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var M=m.baseEncodedPreviousPayload;typeof M=="string"&&(M=i.default.BufferUtils.utf8Encode(M)),M=i.default.BufferUtils.toBuffer(M),n=i.default.BufferUtils.toBuffer(n),n=i.default.BufferUtils.typedArrayToBuffer(m.plugins.vcdiff.decode(n,M)),u=n;}catch(b){throw new O.default("Vcdiff delta decode failed with "+b,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(b){var U=b;throw new O.default("Error processing the "+o+" encoding, decoder returned \u2018"+U.message+"\u2019",U.code||40013,400)}finally{p.encoding=e<=0?null:h.slice(0,e).join("/"),p.data=n;}}m.baseEncodedPreviousPayload=u;},r.fromResponseBody=function(p,T,m){m&&(p=R.decodeBody(p,m));for(var u=0;u<p.length;u++){var c=p[u]=r.fromValues(p[u]);try{r.decode(c,T);}catch(h){P.default.logAction(P.default.LOG_ERROR,"Message.fromResponseBody()",h.toString());}}return p},r.fromValues=function(p){return Object.assign(new r,p)},r.fromValuesArray=function(p){for(var T=p.length,m=new Array(T),u=0;u<T;u++)m[u]=r.fromValues(p[u]);return m},r.fromEncoded=function(p,T){var m=r.fromValues(p),u=w(T);try{r.decode(m,u);}catch(c){P.default.logAction(P.default.LOG_ERROR,"Message.fromEncoded()",c.toString());}return m},r.fromEncodedArray=function(p,T){return w(T),p.map(function(m){return r.fromEncoded(m,T)})},r.getMessagesSize=function(p){for(var T,m=0,u=0;u<p.length;u++)T=p[u],m+=T.size||(T.size=y(T));return m},r.serialize=R.encodeBody,r}();l.default=C;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=v.__importDefault(f(5)),O=v.__importDefault(f(11)),R=v.__importDefault(f(15)),E={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},w=[];Object.keys(E).forEach(function(m){w[E[m]]=m;});var y={HAS_PRESENCE:1<<0,HAS_BACKLOG:1<<1,RESUMED:1<<2,TRANSIENT:1<<4,ATTACH_RESUME:1<<5,PRESENCE:1<<16,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},C=Object.keys(y);y.MODE_ALL=y.PRESENCE|y.PUBLISH|y.SUBSCRIBE|y.PRESENCE_SUBSCRIBE;function r(m){var u=[];if(m)for(var c=0;c<m.length;c++)u.push(m[c].toString());return "[ "+u.join(", ")+" ]"}var p="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),T=function(){function m(){var u=this;this.hasFlag=function(c){return (u.flags&y[c])>0};}return m.prototype.setFlag=function(u){return this.flags=this.flags|y[u]},m.prototype.getMode=function(){return this.flags&&this.flags&y.MODE_ALL},m.prototype.encodeModesToFlags=function(u){var c=this;u.forEach(function(h){return c.setFlag(h)});},m.prototype.decodeModesFromFlags=function(){var u=this,c=[];return m.channelModes.forEach(function(h){u.hasFlag(h)&&c.push(h);}),c.length>0?c:void 0},m.fromValues=function(u){return Object.assign(new m,u)},m.Action=E,m.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],m.ActionName=w,m.serialize=i.encodeBody,m.deserialize=function(u,c){var h=i.decodeBody(u,c);return m.fromDeserialized(h)},m.fromDeserialized=function(u){var c=u.error;c&&(u.error=P.default.fromValues(c));var h=u.messages;if(h)for(var e=0;e<h.length;e++)h[e]=O.default.fromValues(h[e]);var a=u.presence;if(a)for(var e=0;e<a.length;e++)a[e]=R.default.fromValues(a[e],!0);return Object.assign(new m,u)},m.stringify=function(u){var c="[ProtocolMessage";u.action!==void 0&&(c+="; action="+m.ActionName[u.action]||!1);for(var h,e=0;e<p.length;e++)h=p[e],u[h]!==void 0&&(c+="; "+h+"="+u[h]);if(u.messages&&(c+="; messages="+r(O.default.fromValuesArray(u.messages))),u.presence&&(c+="; presence="+r(R.default.fromValuesArray(u.presence))),u.error&&(c+="; error="+P.default.fromValues(u.error).toString()),u.auth&&u.auth.accessToken&&(c+="; token="+u.auth.accessToken),u.flags&&(c+="; flags="+C.filter(u.hasFlag).join(",")),u.params){var a="";i.forInOwnNonNullProperties(u.params,function(n){a.length>0&&(a+="; "),a+=n+"="+u.params[n];}),a.length>0&&(c+="; params=["+a+"]");}return c+="]",c},m.isDuplicate=function(u,c){if(u&&c&&(u.action===E.MESSAGE||u.action===E.PRESENCE)&&u.action===c.action&&u.channel===c.channel&&u.id===c.id){if(u.action===E.PRESENCE)return !0;if(u.messages.length===c.messages.length){for(var h=0;h<u.messages.length;h++){var e=u.messages[h],a=c.messages[h];if((e.extras&&e.extras.delta&&e.extras.delta.format)!==(a.extras&&a.extras.delta&&a.extras.delta.format))return !1}return !0}}return !1},m}();l.default=T;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=v.__importDefault(f(12)),O=v.__importDefault(f(37)),R=v.__importDefault(f(0)),E=v.__importDefault(f(8)),w=v.__importDefault(f(20)),y=v.__importDefault(f(17)),C=v.__importDefault(f(5)),r=v.__importDefault(f(21)),p=v.__importDefault(f(3));function T(c){var h=[80015,80017,80030];return c.code?y.default.isTokenErr(c)?!1:i.arrIn(h,c.code)?!0:c.code>=4e4&&c.code<5e4:!1}function m(c){return T(c)?[P.default.fromValues({action:P.default.Action.ERROR,error:c})]:[P.default.fromValues({action:P.default.Action.DISCONNECTED,error:c})]}var u=function(c){v.__extends(h,c);function h(e,a,n){var o=c.call(this,e,a,n,!0)||this;return o.onAuthUpdated=function(t){o.authParams={access_token:t.token};},o.stream="stream"in n?n.stream:!0,o.sendRequest=null,o.recvRequest=null,o.pendingCallback=null,o.pendingItems=null,o}return h.prototype.connect=function(){var e=this;R.default.logAction(R.default.LOG_MINOR,"CometTransport.connect()","starting"),O.default.prototype.connect.call(this);var a=this.params,n=a.options,o=E.default.getHost(n,a.host),t=E.default.getPort(n),s=n.tls?"https://":"http://";this.baseUri=s+o+":"+t+"/comet/";var g=this.baseUri+"connect";R.default.logAction(R.default.LOG_MINOR,"CometTransport.connect()","uri: "+g),this.auth.getAuthParams(function(M,U){if(M){e.disconnect(M);return}if(!e.isDisposed){e.authParams=U;var b=e.params.getConnectParams(U);"stream"in b&&(e.stream=b.stream),R.default.logAction(R.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+i.toQueryString(b));var x=!1,d=e.recvRequest=e.createRequest(g,null,b,null,e.stream?r.default.REQ_RECV_STREAM:r.default.REQ_RECV);d.on("data",function(A){!e.recvRequest||(x||(x=!0,e.emit("preconnect")),e.onData(A));}),d.on("complete",function(A){if(e.recvRequest||(A=A||new C.default("Request cancelled",80003,400)),e.recvRequest=null,!x&&!A&&(x=!0,e.emit("preconnect")),e.onActivity(),A){A.code?e.onData(m(A)):e.disconnect(A);return}p.default.Config.nextTick(function(){e.recv();});}),d.exec();}});},h.prototype.requestClose=function(){R.default.logAction(R.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0);},h.prototype.requestDisconnect=function(){R.default.logAction(R.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1);},h.prototype._requestCloseOrDisconnect=function(e){var a=this,n=e?this.closeUri:this.disconnectUri;if(n){var o=this.createRequest(n,null,this.authParams,null,r.default.REQ_SEND);o.on("complete",function(t){t&&(R.default.logAction(R.default.LOG_ERROR,"CometTransport.request"+(e?"Close()":"Disconnect()"),"request returned err = "+i.inspectError(t)),a.finish("disconnected",t));}),o.exec();}},h.prototype.dispose=function(){var e=this;R.default.logAction(R.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(R.default.logAction(R.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",w.default.disconnected),p.default.Config.nextTick(function(){e.emit("disposed");}));},h.prototype.onConnect=function(e){if(!this.isDisposed){var a=e.connectionKey;O.default.prototype.onConnect.call(this,e);var n=this.baseUri+a;R.default.logAction(R.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+n+"; connectionKey = "+e.connectionKey),this.sendUri=n+"/send",this.recvUri=n+"/recv",this.closeUri=n+"/close",this.disconnectUri=n+"/disconnect";}},h.prototype.send=function(e){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(e);return}var a=this.pendingItems||[];a.push(e),this.pendingItems=null,this.sendItems(a);},h.prototype.sendAnyPending=function(){var e=this.pendingItems;!e||(this.pendingItems=null,this.sendItems(e));},h.prototype.sendItems=function(e){var a=this,n=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(e),r.default.REQ_SEND);n.on("complete",function(o,t){if(o&&R.default.logAction(R.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+i.inspectError(o)),a.sendRequest=null,o){o.code?a.onData(m(o)):a.disconnect(o);return}t&&a.onData(t),a.pendingItems&&p.default.Config.nextTick(function(){a.sendRequest||a.sendAnyPending();});}),n.exec();},h.prototype.recv=function(){var e=this;if(!this.recvRequest&&!!this.isConnected){var a=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?r.default.REQ_RECV_STREAM:r.default.REQ_RECV_POLL);a.on("data",function(n){e.onData(n);}),a.on("complete",function(n){if(e.recvRequest=null,e.onActivity(),n){n.code?e.onData(m(n)):e.disconnect(n);return}p.default.Config.nextTick(function(){e.recv();});}),a.exec();}},h.prototype.onData=function(e){try{var a=this.decodeResponse(e);if(a&&a.length)for(var n=0;n<a.length;n++)this.onProtocolMessage(P.default.fromDeserialized(a[n]));}catch(o){R.default.logAction(R.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+o.stack);}},h.prototype.encodeRequest=function(e){return JSON.stringify(e)},h.prototype.decodeResponse=function(e){return typeof e=="string"?JSON.parse(e):e},h}(O.default);l.default=u;},function(D,l,f){(function(v,i){D.exports=i(f(6));})(this,function(v){return function(){var i=v,P=i.lib,O=P.WordArray,R=i.enc;R.Base64={stringify:function(y){var C=y.words,r=y.sigBytes,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";y.clamp();for(var T=[],m=0;m<r;m+=3)for(var u=C[m>>>2]>>>24-m%4*8&255,c=C[m+1>>>2]>>>24-(m+1)%4*8&255,h=C[m+2>>>2]>>>24-(m+2)%4*8&255,e=u<<16|c<<8|h,a=0;a<4&&m+a*.75<r;a++)T.push(p.charAt(e>>>6*(3-a)&63));var n=p.charAt(64);if(n)for(;T.length%4;)T.push(n);return T.join("")},parse:function(y){var C=y.length,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p=this._reverseMap;if(!p){p=this._reverseMap=[];for(var T=0;T<r.length;T++)p[r.charCodeAt(T)]=T;}var m=r.charAt(64);if(m){var u=y.indexOf(m);u!==-1&&(C=u);}return w(y,C,p)}};function w(y,C,r){for(var p=[],T=0,m=0;m<C;m++)if(m%4){var u=r[y.charCodeAt(m-1)]<<m%4*2,c=r[y.charCodeAt(m)]>>>6-m%4*2,h=u|c;p[T>>>2]|=h<<24-T%4*8,T++;}return O.create(p,T)}}(),v.enc.Base64});},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importDefault(f(0)),P=v.__importDefault(f(3)),O=v.__importDefault(f(11)),R=v.__importStar(f(2));function E(y){return w.Actions.indexOf(y)}var w=function(){function y(){}return y.prototype.isSynthesized=function(){return !this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},y.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var C=this.id.split(":");return {connectionId:C[0],msgSerial:parseInt(C[1],10),index:parseInt(C[2],10)}},y.prototype.toJSON=function(){var C=this.data,r=this.encoding;return C&&P.default.BufferUtils.isBuffer(C)&&(arguments.length>0?(r=r?r+"/base64":"base64",C=P.default.BufferUtils.base64Encode(C)):C=P.default.BufferUtils.toBuffer(C)),{clientId:this.clientId,action:E(this.action),data:C,encoding:r}},y.prototype.toString=function(){var C="[PresenceMessage";return C+="; action="+this.action,this.id&&(C+="; id="+this.id),this.timestamp&&(C+="; timestamp="+this.timestamp),this.clientId&&(C+="; clientId="+this.clientId),this.connectionId&&(C+="; connectionId="+this.connectionId),this.encoding&&(C+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?C+="; data="+this.data:P.default.BufferUtils.isBuffer(this.data)?C+="; data (buffer)="+P.default.BufferUtils.base64Encode(this.data):C+="; data (json)="+JSON.stringify(this.data)),C+="]",C},y.fromResponseBody=function(C,r,p){var T=[];p&&(C=R.decodeBody(C,p));for(var m=0;m<C.length;m++){var u=T[m]=y.fromValues(C[m],!0);try{y.decode(u,r);}catch(c){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",c.toString());}}return T},y.fromValues=function(C,r){return r&&(C.action=y.Actions[C.action]),Object.assign(new y,C)},y.fromValuesArray=function(C){for(var r=C.length,p=new Array(r),T=0;T<r;T++)p[T]=y.fromValues(C[T]);return p},y.fromEncoded=function(C,r){var p=y.fromValues(C,!0);try{y.decode(p,r);}catch(T){i.default.logAction(i.default.LOG_ERROR,"PresenceMessage.fromEncoded()",T.toString());}return p},y.fromEncodedArray=function(C,r){return C.map(function(p){return y.fromEncoded(p,r)})},y.Actions=["absent","present","enter","leave","update"],y.encode=O.default.encode,y.decode=O.default.decode,y.getMessagesSize=O.default.getMessagesSize,y}();l.default=w;},function(D,l,f){(function(v){l.__esModule=!0;var i=f(1),P=i.__importStar(f(2)),O=i.__importDefault(f(7)),R=i.__importDefault(f(5)),E=i.__importDefault(f(0)),w=i.__importDefault(f(8)),y=i.__importDefault(f(21)),C=i.__importDefault(f(3));function r(s,g){return P.arrIn(P.allToLowerCase(P.keysArray(g)),"x-ably-errorcode")}function p(s,g){if(r(s,g))return s.error&&R.default.fromValues(s.error)}var T=function(){},m=0,u={},c=typeof v<"u"&&v.XDomainRequest;function h(){var s=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return s&&Number(s[1])}function e(){var s;return c&&(s=h())&&s===10}function a(s,g){return s.getResponseHeader&&s.getResponseHeader(g)}function n(s){return s.getResponseHeader&&(s.getResponseHeader("transfer-encoding")||!s.getResponseHeader("content-length"))}function o(s){for(var g=P.trim(s.getAllResponseHeaders()).split(`\r
`),M={},U=0;U<g.length;U++){var b=g[U].split(":").map(P.trim);M[b[0].toLowerCase()]=b[1];}return M}var t=function(s){i.__extends(g,s);function g(M,U,b,x,d,A,B){var N=s.call(this)||this;return b=b||{},b.rnd=P.cheapRandStr(),e()&&!b.envelope&&(b.envelope="json"),N.uri=M+P.toQueryString(b),N.headers=U||{},N.body=x,N.method=B?B.toUpperCase():P.isEmptyArg(x)?"GET":"POST",N.requestMode=d,N.timeouts=A,N.timedOut=!1,N.requestComplete=!1,N.id=String(++m),u[N.id]=N,N}return g.createRequest=function(M,U,b,x,d,A,B){var N=A||w.default.TIMEOUTS;return new g(M,U,P.copy(b),x,d,N,B)},g.prototype.complete=function(M,U,b,x,d){this.requestComplete||(this.requestComplete=!0,!M&&U&&this.emit("data",U),this.emit("complete",M,U,b,x,d),this.dispose());},g.prototype.abort=function(){this.dispose();},g.prototype.exec=function(){var M=this,U=this.headers,b=this.requestMode==y.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,x=this.timer=setTimeout(function(){M.timedOut=!0,A.abort();},b),d=this.method,A=this.xhr=new XMLHttpRequest,B=U.accept,N=this.body,j="text";if(B?B.indexOf("application/x-msgpack")===0&&(j="arraybuffer"):U.accept="application/json",N){var F=U["content-type"]||(U["content-type"]="application/json");F.indexOf("application/json")>-1&&typeof N!="string"&&(N=JSON.stringify(N));}A.open(d,this.uri,!0),A.responseType=j,"authorization"in U&&(A.withCredentials=!0);for(var I in U)A.setRequestHeader(I,U[I]);var L=function($,nt,_,V){var k,K=nt+" (event type: "+$.type+")";!((k=M==null?void 0:M.xhr)===null||k===void 0)&&k.statusText&&(K+=", current statusText is "+M.xhr.statusText),E.default.logAction(E.default.LOG_ERROR,"Request.on"+$.type+"()",K),M.complete(new R.default(K,_,V));};A.onerror=function($){L($,"XHR error occurred",null,400);},A.onabort=function($){M.timedOut?L($,"Request aborted due to request timeout expiring",null,408):L($,"Request cancelled",null,400);},A.ontimeout=function($){L($,"Request timed out",null,408);};var S,G,W,H=0,z=!1,Q=function(){if(clearTimeout(x),W=G<400,G==204){M.complete(null,null,null,null,G);return}S=M.requestMode==y.default.REQ_RECV_STREAM&&W&&n(A);},J=function(){var $;try{var nt=a(A,"content-type"),_=nt?nt.indexOf("application/json")>=0:A.responseType=="text";if(_){var V=A.responseType==="arraybuffer"?C.default.BufferUtils.utf8Decode(A.response):String(A.responseText);V.length?$=JSON.parse(V):$=V,z=!0;}else $=A.response;$.response!==void 0?(G=$.statusCode,W=G<400,U=$.headers,$=$.response):U=o(A);}catch(K){M.complete(new R.default("Malformed response body from server: "+K.message,null,400));return}if(W||P.isArray($)){M.complete(null,$,U,z,G);return}var k=p($,U);k||(k=new R.default("Error response received from server: "+G+" body was: "+C.default.Config.inspect($),null,G)),M.complete(k,$,U,z,G);};function X(){for(var $=A.responseText,nt=$.length-1,_,V;H<nt&&(_=$.indexOf(`
`,H))>-1;)V=$.slice(H,_),H=_+1,tt(V);}var tt=function($){try{$=JSON.parse($);}catch(nt){M.complete(new R.default("Malformed response body from server: "+nt.message,null,400));return}M.emit("data",$);},Z=function(){X(),M.streamComplete=!0,C.default.Config.nextTick(function(){M.complete();});};A.onreadystatechange=function(){var $=A.readyState;$<3||A.status!==0&&(G===void 0&&(G=A.status,G===1223&&(G=204),Q()),$==3&&S?X():$==4&&(S?Z():J()));},A.send(N);},g.prototype.dispose=function(){var M=this.xhr;if(M){M.onreadystatechange=M.onerror=M.onabort=M.ontimeout=T,this.xhr=null;var U=this.timer;U&&(clearTimeout(U),this.timer=null),this.requestComplete||M.abort();}delete u[this.id];},g}(O.default);l.default=t;}).call(this,f(10));},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importDefault(f(0)),P=v.__importStar(f(2)),O=v.__importDefault(f(23)),R=v.__importDefault(f(5)),E=v.__importDefault(f(44)),w=f(14),y=f(32),C=v.__importDefault(f(18)),r=v.__importDefault(f(3)),p=Math.pow(2,17);function T(){}function m(){return ("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function u(b){return !!b.connection}function c(b){return P.isErrorInfo(b)?(b.code||(b.statusCode===403?b.code=40300:(b.code=40170,b.statusCode=401)),b):new R.default(P.inspectError(b),b.code||40170,b.statusCode||401)}var h=function(b){return r.default.Config.createHmac?Buffer.from(b,"ascii").toString("base64"):w.stringify(y.parse(b))},e=function(b,x){if(r.default.Config.createHmac){var d=r.default.Config.createHmac("SHA256",x);return d.update(b),d.digest("base64")}return w.stringify(E.default(b,x))};function a(b){if(!b)return "";typeof b=="string"&&(b=JSON.parse(b));var x={},d=P.keysArray(b,!0);if(!d)return "";d.sort();for(var A=0;A<d.length;A++)x[d[A]]=b[d[A]].sort();return JSON.stringify(x)}function n(b){if(b.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(b.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(b.key)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(b.tokenDetails)i.default.logAction(i.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else {var x="authOptions must include valid authentication parameters";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",x),new Error(x)}}function o(b){return "useTokenAuth"in b&&!b.useTokenAuth}function t(b){return b.useTokenAuth||!o(b)&&(b.authCallback||b.authUrl||b.token||b.tokenDetails)}function s(b){return !b.key&&!b.authCallback&&!b.authUrl}var g=0;function M(){return g++}var U=function(){function b(x,d){if(this.authOptions={},this.client=x,this.tokenParams=d.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,t(d)){if(d.key&&!e){var A="client-side token request signing not supported";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",A),new Error(A)}s(d)&&i.default.logAction(i.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(d.defaultTokenParams,d),n(this.authOptions);}else {if(!d.key){var A="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw i.default.logAction(i.default.LOG_ERROR,"Auth()",A),new R.default(A,40160,401)}i.default.logAction(i.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(d);}}return b.prototype.authorize=function(x,d,A){var B=this,N;if(typeof x=="function"&&!A?(A=x,N=x=null):typeof d=="function"&&!A?(A=d,N=null):N=d,!A&&this.client.options.promises)return P.promisify(this,"authorize",arguments);if(N&&N.key&&this.authOptions.key!==N.key)throw new R.default("Unable to update auth options with incompatible key",40102,401);N&&"force"in N&&(i.default.logAction(i.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),P.isOnlyPropIn(N,"force")&&(N=null)),this._forceNewToken(x,N,function(j,F){if(j){B.client.connection&&B.client.connection.connectionManager.actOnErrorFromAuthorize(j),A==null||A(j);return}u(B.client)?B.client.connection.connectionManager.onAuthUpdated(F,A||T):A==null||A(null,F);});},b.prototype.authorise=function(x,d,A){i.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(x,d,A);},b.prototype._forceNewToken=function(x,d,A){var B=this;this.tokenDetails=null,this._saveTokenOptions(x,d),n(this.authOptions),this._ensureValidAuthCredentials(!0,function(N,j){delete B.tokenParams.timestamp,delete B.authOptions.queryTime,A(N,j);});},b.prototype.requestToken=function(x,d,A){var B=this;if(typeof x=="function"&&!A?(A=x,d=x=null):typeof d=="function"&&!A&&(A=d,d=null),!A&&this.client.options.promises)return P.promisify(this,"requestToken",arguments);d=d||this.authOptions,x=x||P.copy(this.tokenParams);var N=A||T,j,F=this.client;if(d.authCallback)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),j=d.authCallback;else if(d.authUrl)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),j=function(H,z){var Q=P.mixin({accept:"application/json, text/plain"},d.authHeaders),J=d.authMethod&&d.authMethod.toLowerCase()==="post",X,tt=d.authUrl.indexOf("?");tt>-1&&(X=P.parseQueryString(d.authUrl.slice(tt)),d.authUrl=d.authUrl.slice(0,tt),J||(d.authParams=P.mixin(X,d.authParams)));var Z=P.mixin({},d.authParams||{},H),$=function(V,k,K,Y){var et;if(V?i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+P.inspectError(V)):(et=K["content-type"],i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+et+"; body: "+P.inspectBody(k))),V||Y)return z(V,k);if(r.default.BufferUtils.isBuffer(k)&&(k=k.toString()),!et){z(new R.default("authUrl response is missing a content-type header",40170,401));return}var it=et.indexOf("application/json")>-1,Jt=et.indexOf("text/plain")>-1||et.indexOf("application/jwt")>-1;if(!it&&!Jt){z(new R.default("authUrl responded with unacceptable content-type "+et+", should be either text/plain, application/jwt or application/json",40170,401));return}if(it){if(k.length>p){z(new R.default("authUrl response exceeded max permitted length",40170,401));return}try{k=JSON.parse(k);}catch($t){z(new R.default("Unexpected error processing authURL response; err = "+$t.message,40170,401));return}}z(null,k,et);};if(i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+d.authUrl+"; Params: "+JSON.stringify(Z)+"; method: "+(J?"POST":"GET")),J){var nt=Q||{};nt["content-type"]="application/x-www-form-urlencoded";var _=P.toQueryString(Z).slice(1);B.client.http.doUri(C.default.Post,F,d.authUrl,nt,_,X,$);}else B.client.http.doUri(C.default.Get,F,d.authUrl,Q||{},null,Z,$);};else if(d.key)i.default.logAction(i.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),j=function(H,z){B.createTokenRequest(H,d,z);};else {var I="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";i.default.logAction(i.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),N(new R.default(I,40171,403));return}"capability"in x&&(x.capability=a(x.capability));var L=function(H,z){var Q=H.keyName,J="/keys/"+Q+"/requestToken",X=function(Z){return F.baseUri(Z)+J},tt=P.defaultPostHeaders();d.requestHeaders&&P.mixin(tt,d.requestHeaders),i.default.logAction(i.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+J+"; Token params: "+JSON.stringify(H)),B.client.http.do(C.default.Post,F,X,tt,JSON.stringify(H),null,z);},S=!1,G=this.client.options.timeouts.realtimeRequestTimeout,W=setTimeout(function(){S=!0;var H="Token request callback timed out after "+G/1e3+" seconds";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",H),N(new R.default(H,40170,401));},G);j(x,function(H,z,Q){if(!S){if(clearTimeout(W),H){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+P.inspectError(H)),N(c(H));return}if(typeof z=="string"){z.length===0?N(new R.default("Token string is empty",40170,401)):z.length>p?N(new R.default("Token string exceeded max permitted length (was "+z.length+" bytes)",40170,401)):z==="undefined"||z==="null"?N(new R.default("Token string was literal null/undefined",40170,401)):z[0]==="{"&&!(Q&&Q.indexOf("application/jwt")>-1)?N(new R.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):N(null,{token:z});return}if(typeof z!="object"){var J="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof z;i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",J),N(new R.default(J,40170,401));return}var X=JSON.stringify(z).length;if(X>p&&!d.suppressMaxLengthCheck){N(new R.default("Token request/details object exceeded max permitted stringified size (was "+X+" bytes)",40170,401));return}if("issued"in z){N(null,z);return}if(!("keyName"in z)){var J="Expected token request callback to call back with a token string, token request object, or token details object";i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()",J),N(new R.default(J,40170,401));return}L(z,function(tt,Z,$,nt){if(tt){i.default.logAction(i.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+P.inspectError(tt)),N(c(tt));return}nt||(Z=JSON.parse(Z)),i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","token received"),N(null,Z);});}});},b.prototype.createTokenRequest=function(x,d,A){var B=this;if(typeof x=="function"&&!A?(A=x,d=x=null):typeof d=="function"&&!A&&(A=d,d=null),!A&&this.client.options.promises)return P.promisify(this,"createTokenRequest",arguments);d=d||this.authOptions,x=x||P.copy(this.tokenParams);var N=d.key;if(!N){A(new R.default("No key specified",40101,403));return}var j=N.split(":"),F=j[0],I=j[1];if(!I){A(new R.default("Invalid key specified",40101,403));return}if(x.clientId===""){A(new R.default("clientId can\u2019t be an empty string",40012,400));return}"capability"in x&&(x.capability=a(x.capability));var L=P.mixin({keyName:F},x),S=x.clientId||"",G=x.ttl||"",W=x.capability||"";(function(H){if(L.timestamp){H();return}B.getTimestamp(d&&d.queryTime,function(z,Q){if(z){A(z);return}L.timestamp=Q,H();});})(function(){var H=L.nonce||(L.nonce=m()),z=L.timestamp,Q=L.keyName+`
`+G+`
`+W+`
`+S+`
`+z+`
`+H+`
`;L.mac=L.mac||e(Q,I),i.default.logAction(i.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),A(null,L);});},b.prototype.getAuthParams=function(x){this.method=="basic"?x(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(d,A){if(d){x(d);return}if(!A)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");x(null,{access_token:A.token});});},b.prototype.getAuthHeaders=function(x){this.method=="basic"?x(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(d,A){if(d){x(d);return}if(!A)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");x(null,{authorization:"Bearer "+h(A.token)});});},b.prototype.getTimestamp=function(x,d){!this.isTimeOffsetSet()&&(x||this.authOptions.queryTime)?this.client.time(d):d(null,this.getTimestampUsingOffset());},b.prototype.getTimestampUsingOffset=function(){return P.now()+(this.client.serverTimeOffset||0)},b.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},b.prototype._saveBasicOptions=function(x){this.method="basic",this.key=x.key,this.basicKey=h(x.key),this.authOptions=x||{},"clientId"in x&&this._userSetClientId(x.clientId);},b.prototype._saveTokenOptions=function(x,d){this.method="token",x&&(this.tokenParams=x),d&&(d.token&&(d.tokenDetails=typeof d.token=="string"?{token:d.token}:d.token),d.tokenDetails&&(this.tokenDetails=d.tokenDetails),"clientId"in d&&this._userSetClientId(d.clientId),this.authOptions=d);},b.prototype._ensureValidAuthCredentials=function(x,d){var A=this,B=this.tokenDetails;if(B){if(this._tokenClientIdMismatch(B.clientId)){d(new R.default("Mismatch between clientId in token ("+B.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!B.expires||B.expires>=this.getTimestampUsingOffset()){i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+B.expires),d(null,B);return}i.default.logAction(i.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null;}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=O.default.create())).push(d),!(this.currentTokenRequestId!==null&&!x)){var N=this.currentTokenRequestId=M();this.requestToken(this.tokenParams,this.authOptions,function(j,F){if(A.currentTokenRequestId>N){i.default.logAction(i.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}A.currentTokenRequestId=null;var I=A.waitingForTokenRequest||T;if(A.waitingForTokenRequest=null,j){I(j);return}I(null,A.tokenDetails=F);});}},b.prototype._userSetClientId=function(x){if(typeof x=="string"||x===null){if(x==="*")throw new R.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var d=this._uncheckedSetClientId(x);if(d)throw d}else throw new R.default("clientId must be either a string or null",40012,400)},b.prototype._uncheckedSetClientId=function(x){if(this._tokenClientIdMismatch(x)){var d="Unexpected clientId mismatch: client has "+this.clientId+", requested "+x,A=new R.default(d,40102,401);return i.default.logAction(i.default.LOG_ERROR,"Auth._uncheckedSetClientId()",d),A}else return this.clientId=this.tokenParams.clientId=x,null},b.prototype._tokenClientIdMismatch=function(x){return !!(this.clientId&&this.clientId!=="*"&&x&&x!=="*"&&this.clientId!==x)},b.isTokenErr=function(x){return x.code&&x.code>=40140&&x.code<40150},b}();l.default=U;},function(D,l,f){l.__esModule=!0;var v;((function(i){i.Get="get",i.Delete="delete",i.Post="post",i.Put="put",i.Patch="patch";}))(v||(v={})),l.default=v;},function(D,l,f){l.__esModule=!0,l.HttpPaginatedResponse=l.PaginatedResult=void 0;var v=f(1),i=v.__importStar(f(2)),P=v.__importDefault(f(0)),O=v.__importDefault(f(25));function R(p){var T=p.match(/^\.\/(\w+)\?(.*)$/);return T&&T[2]&&i.parseQueryString(T[2])}function E(p){typeof p=="string"&&(p=p.split(","));for(var T={},m=0;m<p.length;m++){var u=p[m].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(u){var c=R(u[1]);c&&(T[u[2]]=c);}}return T}function w(p,T,m){return !(m&&(T||typeof p.code=="number"))}var y=function(){function p(T,m,u,c,h,e){this.rest=T,this.path=m,this.headers=u,this.envelope=c??null,this.bodyHandler=h,this.useHttpPaginatedResponse=e||!1;}return p.prototype.get=function(T,m){var u=this;O.default.get(this.rest,this.path,this.headers,T,this.envelope,function(c,h,e,a,n){u.handlePage(c,h,e,a,n,m);});},p.prototype.delete=function(T,m){var u=this;O.default.delete(this.rest,this.path,this.headers,T,this.envelope,function(c,h,e,a,n){u.handlePage(c,h,e,a,n,m);});},p.prototype.post=function(T,m,u){var c=this;O.default.post(this.rest,this.path,m,this.headers,T,this.envelope,function(h,e,a,n,o){u&&c.handlePage(h,e,a,n,o,u);});},p.prototype.put=function(T,m,u){var c=this;O.default.put(this.rest,this.path,m,this.headers,T,this.envelope,function(h,e,a,n,o){u&&c.handlePage(h,e,a,n,o,u);});},p.prototype.patch=function(T,m,u){var c=this;O.default.patch(this.rest,this.path,m,this.headers,T,this.envelope,function(h,e,a,n,o){u&&c.handlePage(h,e,a,n,o,u);});},p.prototype.handlePage=function(T,m,u,c,h,e){if(T&&w(T,m,this.useHttpPaginatedResponse)){P.default.logAction(P.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+i.inspectError(T)),e==null||e(T);return}var a,n,o;try{a=this.bodyHandler(m,u||{},c);}catch(t){e==null||e(T||t);return}u&&(n=u.Link||u.link)&&(o=E(n)),this.useHttpPaginatedResponse?e(null,new r(this,a,u||{},h,o,T)):e(null,new C(this,a,o));},p}(),C=function(){function p(T,m,u){var c=this;this.resource=T,this.items=m;var h=this;u&&("first"in u&&(this.first=function(e){if(!e&&h.resource.rest.options.promises)return i.promisify(h,"first",[]);h.get(u.first,e);}),"current"in u&&(this.current=function(e){if(!e&&h.resource.rest.options.promises)return i.promisify(h,"current",[]);h.get(u.current,e);}),this.next=function(e){if(!e&&h.resource.rest.options.promises)return i.promisify(h,"next",[]);"next"in u?h.get(u.next,e):e(null);},this.hasNext=function(){return "next"in u},this.isLast=function(){var e;return !(!((e=c.hasNext)===null||e===void 0)&&e.call(c))});}return p.prototype.get=function(T,m){var u=this.resource;O.default.get(u.rest,u.path,u.headers,T,u.envelope,function(c,h,e,a,n){u.handlePage(c,h,e,a,n,m);});},p}();l.PaginatedResult=C;var r=function(p){v.__extends(T,p);function T(m,u,c,h,e,a){var n=p.call(this,m,u,e)||this;return n.statusCode=h,n.success=h<300&&h>=200,n.headers=c,n.errorCode=a&&a.code,n.errorMessage=a&&a.message,n}return T.prototype.toJSON=function(){return {items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},T}(C);l.HttpPaginatedResponse=r,l.default=y;},function(D,l,f){l.__esModule=!0,l.isRetriable=void 0;var v=f(1),i=v.__importDefault(f(5)),P={disconnected:i.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:i.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:i.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:i.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:i.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:i.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:i.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};function O(R){if(!R.statusCode||!R.code||R.statusCode>=500)return !0;var E=!1;return Object.values(P).forEach(function(w){w.code&&w.code==R.code&&(E=!0);}),E}l.isRetriable=O,l.default=P;},function(D,l,f){l.__esModule=!0;var v;((function(i){i[i.REQ_SEND=0]="REQ_SEND",i[i.REQ_RECV=1]="REQ_RECV",i[i.REQ_RECV_POLL=2]="REQ_RECV_POLL",i[i.REQ_RECV_STREAM=3]="REQ_RECV_STREAM";}))(v||(v={})),l.default=v;},function(D,l,f){(function(v,i){D.exports=i(f(6),f(4),f(59),f(14),f(40),f(31),f(24),f(27),f(28),f(60),f(61));})(this,function(v){return v});},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importDefault(f(0)),P=function(){function O(R){this.members=R||[];}return O.prototype.call=function(){for(var R=[],E=0;E<arguments.length;E++)R[E]=arguments[E];for(var w=0,y=this.members;w<y.length;w++){var C=y[w];if(C)try{C.apply(void 0,R);}catch(r){i.default.logAction(i.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+r+"; stack = "+r.stack);}}},O.prototype.push=function(){for(var R,E=[],w=0;w<arguments.length;w++)E[w]=arguments[w];(R=this.members).push.apply(R,E);},O.create=function(R){var E=new O(R);return Object.assign(function(){for(var w=[],y=0;y<arguments.length;y++)w[y]=arguments[y];return E.call.apply(E,w)},{push:function(w){return E.push(w)}})},O}();l.default=P;},function(D,l,f){(function(v,i){D.exports=i(f(6));})(this,function(v){(function(){var i=v,P=i.lib,O=P.Base,R=i.enc,E=R.Utf8,w=i.algo;w.HMAC=O.extend({init:function(C,r){C=this._hasher=new C.init,typeof r=="string"&&(r=E.parse(r));var p=C.blockSize,T=p*4;r.sigBytes>T&&(r=C.finalize(r)),r.clamp();for(var m=this._oKey=r.clone(),u=this._iKey=r.clone(),c=m.words,h=u.words,e=0;e<p;e++)c[e]^=1549556828,h[e]^=909522486;m.sigBytes=u.sigBytes=T,this.reset();},reset:function(){var C=this._hasher;C.reset(),C.update(this._iKey);},update:function(C){return this._hasher.update(C),this},finalize:function(C){var r=this._hasher,p=r.finalize(C);r.reset();var T=r.finalize(this._oKey.clone().concat(p));return T}});})();});},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importDefault(f(3)),P=v.__importStar(f(2)),O=v.__importDefault(f(0)),R=v.__importDefault(f(17)),E=v.__importDefault(f(18)),w=v.__importDefault(f(5));function y(u,c,h,e,a){u.http.supportsAuthHeaders?u.auth.getAuthHeaders(function(n,o){n?e(n):a(P.mixin(o,c),h);}):u.auth.getAuthParams(function(n,o){n?e(n):a(c,P.mixin(o,h));});}function C(u,c){return function(h,e,a,n,o){if(h&&!e){u(h);return}if(!n)try{e=P.decodeBody(e,c);}catch(b){u(b);return}if(!e){u(new w.default("unenvelope(): Response body is missing",null));return}var t=e,s=t.statusCode,g=t.response,M=t.headers;if(s===void 0){u(h,e,a,!0,o);return}if(s<200||s>=300){var U=g&&g.error||h;U||(U=new Error("Error in unenveloping "+e),U.statusCode=s),u(U,g,M,!0,s);return}u(h,g,M,!0,s);}}function r(u){var c=[];if(u)for(var h in u)c.push(h+"="+u[h]);return c.join("&")}function p(u,c){return u+(c?"?":"")+r(c)}function T(u,c,h,e){return function(a,n,o,t,s){a?O.default.logAction(O.default.LOG_MICRO,"Resource."+c+"()","Received Error; "+p(h,e)+"; Error: "+P.inspectError(a)):O.default.logAction(O.default.LOG_MICRO,"Resource."+c+"()","Received; "+p(h,e)+"; Headers: "+r(o)+"; StatusCode: "+s+"; Body: "+(i.default.BufferUtils.isBuffer(n)?n.toString():n)),u&&u(a,n,o,t,s);}}var m=function(){function u(){}return u.get=function(c,h,e,a,n,o){u.do(E.default.Get,c,h,null,e,a,n,o);},u.delete=function(c,h,e,a,n,o){u.do(E.default.Delete,c,h,null,e,a,n,o);},u.post=function(c,h,e,a,n,o,t){u.do(E.default.Post,c,h,e,a,n,o,t);},u.patch=function(c,h,e,a,n,o,t){u.do(E.default.Patch,c,h,e,a,n,o,t);},u.put=function(c,h,e,a,n,o,t){u.do(E.default.Put,c,h,e,a,n,o,t);},u.do=function(c,h,e,a,n,o,t,s){O.default.shouldLog(O.default.LOG_MICRO)&&(s=T(s,c,e,o)),t&&(s=s&&C(s,t),(o=o||{}).envelope=t);function g(M,U){var b;if(O.default.shouldLog(O.default.LOG_MICRO)&&O.default.logAction(O.default.LOG_MICRO,"Resource."+c+"()","Sending; "+p(e,U)),O.default.shouldLog(O.default.LOG_MICRO)){var x=a;if(((b=M["content-type"])===null||b===void 0?void 0:b.indexOf("msgpack"))>0)try{x=i.default.Config.msgpack.decode(a);}catch(d){O.default.logAction(O.default.LOG_MICRO,"Resource."+c+"()","Sending MsgPack Decoding Error: "+P.inspectError(d));}O.default.logAction(O.default.LOG_MICRO,"Resource."+c+"()","Sending; "+p(e,U)+"; Body: "+x);}h.http.do(c,h,e,M,a,U,function(d,A,B,N,j){if(d&&R.default.isTokenErr(d)){h.auth.authorize(null,null,function(F){if(F){s(F);return}y(h,B,U,s,g);});return}s(d,A,B,N,j);});}y(h,n,o,s,g);},u}();l.default=m;},function(D,l,f){(function(v){l.__esModule=!0,l.TransportParams=void 0;var i=f(1),P=i.__importDefault(f(12)),O=i.__importStar(f(2)),R=i.__importStar(f(52)),E=i.__importDefault(f(8)),w=i.__importDefault(f(3)),y=i.__importDefault(f(7)),C=i.__importDefault(f(35)),r=i.__importDefault(f(0)),p=i.__importDefault(f(36)),T=i.__importStar(f(20)),m=i.__importDefault(f(5)),u=i.__importDefault(f(17)),c=i.__importDefault(f(11)),h=i.__importDefault(f(23)),e=i.__importDefault(f(53)),a=i.__importDefault(f(54)),n=function(){var j;return typeof w.default.WebStorage<"u"&&((j=w.default.WebStorage)===null||j===void 0?void 0:j.localSupported)},o=function(){var j;return typeof w.default.WebStorage<"u"&&((j=w.default.WebStorage)===null||j===void 0?void 0:j.sessionSupported)},t=P.default.Action,s=function(){},g="ably-transport-preference",M="ably-connection-recovery";function U(){var j,F;return o()&&((F=(j=w.default.WebStorage)===null||j===void 0?void 0:j.getSession)===null||F===void 0?void 0:F.call(j,M))}function b(j){var F,I;return o()&&((I=(F=w.default.WebStorage)===null||F===void 0?void 0:F.setSession)===null||I===void 0?void 0:I.call(F,M,j))}function x(){var j,F;return o()&&((F=(j=w.default.WebStorage)===null||j===void 0?void 0:j.removeSession)===null||F===void 0?void 0:F.call(j,M))}function d(j,F){return O.arrIndexOf(w.default.Defaults.transportPreferenceOrder,j.shortName)>O.arrIndexOf(w.default.Defaults.transportPreferenceOrder,F.shortName)}function A(j,F,I){var L;if(j.channel!==F.channel||(L=j.action)!==t.PRESENCE&&L!==t.MESSAGE||L!==F.action)return !1;var S=L===t.PRESENCE?"presence":"messages",G=j[S].concat(F[S]),W=c.default.getMessagesSize(G);return W>I||!O.allSame(G,"clientId")||!O.arrEvery(G,function(H){return !H.id})?!1:(j[S]=G,!0)}var B=function(){function j(F,I,L,S){this.options=F,this.host=I,this.mode=L,this.connectionKey=S,this.format=F.useBinaryProtocol?O.Format.msgpack:O.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0;}return j.prototype.getConnectParams=function(F){var I=F?O.copy(F):{},L=this.options;switch(this.mode){case"upgrade":I.upgrade=this.connectionKey;break;case"resume":I.resume=this.connectionKey,this.timeSerial!==void 0?I.timeSerial=this.timeSerial:this.connectionSerial!==void 0&&(I.connectionSerial=this.connectionSerial);break;case"recover":{var S=L.recover.split(":");if(S){I.recover=S[0];var G=S[1];isNaN(Number(G))?I.timeSerial=G:I.connectionSerial=G;}break}}return L.clientId!==void 0&&(I.clientId=L.clientId),L.echoMessages===!1&&(I.echo="false"),this.format!==void 0&&(I.format=this.format),this.stream!==void 0&&(I.stream=this.stream),this.heartbeats!==void 0&&(I.heartbeats=this.heartbeats),I.v=E.default.apiVersion,I.agent=encodeURIComponent(E.default.agent),L.transportParams!==void 0&&O.mixin(I,L.transportParams),I},j.prototype.toString=function(){var F="[mode="+this.mode;return this.host&&(F+=",host="+this.host),this.connectionKey&&(F+=",connectionKey="+this.connectionKey),this.connectionSerial!==void 0&&(F+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(F+=",timeSerial="+this.timeSerial),this.format&&(F+=",format="+this.format),F+="]",F},j}();l.TransportParams=B;var N=function(j){i.__extends(F,j);function F(I,L){var S=j.call(this)||this;F.initTransports(),S.realtime=I,S.options=L;var G=L.timeouts,W=G.preferenceConnectTimeout+G.realtimeRequestTimeout;if(S.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:W,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:G.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:G.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:G.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},S.state=S.states.initialized,S.errorReason=null,S.queuedMessages=new C.default,S.msgSerial=0,S.connectionDetails=void 0,S.connectionId=void 0,S.connectionKey=void 0,S.timeSerial=void 0,S.connectionSerial=void 0,S.connectionStateTtl=G.connectionStateTtl,S.maxIdleInterval=null,S.transports=O.intersect(L.transports||E.default.defaultTransports,F.supportedTransports),S.baseTransport=O.intersect(E.default.baseTransportOrder,S.transports)[0],S.upgradeTransports=O.intersect(S.transports,E.default.upgradeTransports),S.transportPreference=null,S.httpHosts=E.default.getHosts(L),S.activeProtocol=null,S.proposedTransports=[],S.pendingTransports=[],S.host=null,S.lastAutoReconnectAttempt=null,S.lastActivity=null,S.mostRecentMsg=null,S.forceFallbackHost=!1,S.connectCounter=0,r.default.logAction(r.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),r.default.logAction(r.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(L.transports||E.default.defaultTransports)+"]"),r.default.logAction(r.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+S.transports+"]"),r.default.logAction(r.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+S.httpHosts+"]"),!S.transports.length){var H="no requested transports available";throw r.default.logAction(r.default.LOG_ERROR,"realtime.ConnectionManager()",H),new Error(H)}var z=w.default.Config.addEventListener;return z&&(o()&&typeof L.recover=="function"&&z("beforeunload",S.persistConnection.bind(S)),L.closeOnUnload===!0&&z("beforeunload",function(){r.default.logAction(r.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),S.requestState({state:"closing"});}),z("online",function(){(S.state==S.states.disconnected||S.state==S.states.suspended)&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager caught browser \u2018online\u2019 event","reattempting connection"),S.requestState({state:"connecting"}));}),z("offline",function(){S.state==S.states.connected&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager caught browser \u2018offline\u2019 event","disconnecting active transport"),S.disconnectAllTransports());})),S}return F.initTransports=function(){e.default(F),O.arrForEach(w.default.Transports,function(I){I(F);});},F.prototype.createTransportParams=function(I,L){var S=new B(this.options,I,L,this.connectionKey);return this.timeSerial?S.timeSerial=String(this.timeSerial):this.connectionSerial!==void 0&&(S.connectionSerial=this.connectionSerial),S},F.prototype.getTransportParams=function(I){var L=this,S=function(G){if(L.connectionKey){G("resume");return}if(typeof L.options.recover=="string"){G("recover");return}var W=L.options.recover,H=U();if(H&&typeof W=="function"){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),W(H,function(z){z?(L.options.recover=H.recoveryKey,G("recover")):G("clean");});return}G("clean");};S(function(G){var W=L.createTransportParams(null,G);if(G==="recover"){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+L.options.recover);var H=L.options.recover.split(":");H&&H[2]&&(L.msgSerial=Number(H[2]));}else r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+W.toString());I(W);});},F.prototype.tryATransport=function(I,L,S){var G=this,W,H;r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+L),(H=(W=F.supportedTransports[L]).tryConnect)===null||H===void 0||H.call(W,this,this.realtime.auth,I,function(z,Q){var J=G.state;if(J==G.states.closing||J==G.states.closed||J==G.states.failed){Q&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+J.state+" while we were attempting the transport; closing "+Q),Q.close()),S(!0);return}if(z){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+L+" "+z.event+", err: "+z.error.toString()),u.default.isTokenErr(z.error)&&!(G.errorReason&&u.default.isTokenErr(G.errorReason))?(G.errorReason=z.error,G.realtime.auth._forceNewToken(null,null,function(X){if(X){G.actOnErrorFromAuthorize(X);return}G.tryATransport(I,L,S);})):z.event==="failed"?(G.notifyState({state:"failed",error:z.error}),S(!0)):z.event==="disconnected"&&(T.isRetriable(z.error)?S(!1):(G.notifyState({state:G.states.connecting.failState,error:z.error}),S(!0)));return}r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+L+"; setting pending"),G.setTransportPending(Q,I),S(null,Q);});},F.prototype.setTransportPending=function(I,L){var S=this,G=L.mode;r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+I+"; mode = "+G),O.arrDeleteValue(this.proposedTransports,I),this.pendingTransports.push(I);var W=w.default.Defaults.transportPreferenceOrder[w.default.Defaults.transportPreferenceOrder.length-1];I.once("connected",function(z,Q,J,X){G=="upgrade"&&S.activeProtocol?I.shortName!==W&&O.arrIn(S.getUpgradePossibilities(),W)?setTimeout(function(){S.scheduleTransportActivation(z,I,Q,J,X);},S.options.timeouts.parallelUpgradeDelay):S.scheduleTransportActivation(z,I,Q,J,X):(S.activateTransport(z,I,Q,J,X),w.default.Config.nextTick(function(){S.connectImpl(L);})),G==="recover"&&S.options.recover&&(S.options.recover=null,S.unpersistConnection());});var H=this;I.on(["disconnected","closed","failed"],function(z){H.deactivateTransport(I,this.event,z);}),this.emit("transport.pending",I);},F.prototype.scheduleTransportActivation=function(I,L,S,G,W){var H=this,z=this.activeProtocol&&this.activeProtocol.getTransport(),Q=function(){L.disconnect(),O.arrDeleteValue(H.pendingTransports,L);};if(this.state!==this.states.connected&&this.state!==this.states.connecting){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+L.shortName),Q();return}if(z&&!d(L,z)){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+L.shortName+" is no better than current active transport "+z.shortName+" - abandoning upgrade"),Q();return}r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+L),this.realtime.channels.onceNopending(function(J){var X;if(J){r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+L+"; err = "+J);return}if(!L.isConnected){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+L.shortName+"is no longer connected; abandoning upgrade"),Q();return}if(H.state===H.states.connected)r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),H.state=H.states.synchronizing,X=H.activeProtocol;else if(H.state!==H.states.connecting){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+H.state.state+(H.state===H.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+L.shortName),Q();return}var tt=S!==H.connectionId,Z=tt?W:H;tt&&r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(H.timeSerial||H.connectionSerial)+" to "+(Z.timeSerial||Z.connectionSerial)+"; upgrade error was "+I),r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+L),H.sync(L,Z,function($,nt,_){if($){H.state===H.states.synchronizing&&(r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+L+"; err = "+$),H.disconnectAllTransports());return}var V=function(){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+L),H.activateTransport(I,L,nt,G,_),H.state===H.states.synchronizing?(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+L),H.state=H.states.connected):r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+H.state.state+", so leaving unchanged"),H.state.sendEvents&&H.sendQueuedMessages();};X?X.onceIdle(V):V();});});},F.prototype.activateTransport=function(I,L,S,G,W){var H=this;r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+L),I&&r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+I),S&&r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+S),G&&r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(G)),W&&r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(W.timeSerial||W.connectionSerial)),this.persistTransportPreference(L);var z=this.state,Q=this.states.connected.state;if(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+z.state),z.state==this.states.closing.state||z.state==this.states.closed.state||z.state==this.states.failed.state)return r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),L.disconnect(),!1;if(O.arrDeleteValue(this.pendingTransports,L),!L.isConnected)return r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+L+" since it appears to no longer be connected"),!1;var J=this.activeProtocol;this.activeProtocol=new R.default(L),this.host=L.params.host;var X=G.connectionKey;if(X&&this.connectionKey!=X&&this.setConnection(S,G,W,!!I),this.onConnectionDetailsUpdate(G,L),w.default.Config.nextTick(function(){L.on("connected",function(Z,$,nt){H.onConnectionDetailsUpdate(nt,L),H.emit("update",new p.default(Q,Q,null,Z));});}),z.state===this.states.connected.state?I&&(this.errorReason=this.realtime.connection.errorReason=I,this.emit("update",new p.default(Q,Q,null,I))):(this.notifyState({state:"connected",error:I}),this.errorReason=this.realtime.connection.errorReason=I||null),this.emit("transport.active",L),J)if(J.messageQueue.count()>0&&r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+J.transport.shortName+", new one is "+L.shortName+") finishing with "+J.messageQueue.count()+" messages still pending"),J.transport===L){var tt="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+L.shortName+"; stack = "+new Error().stack;r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.activateTransport()",tt);}else J.finish();return O.safeArrForEach(this.pendingTransports,function(Z){if(Z===L){var $="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+L.shortName+"; stack = "+new Error().stack;r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.activateTransport()",$),O.arrDeleteValue(H.pendingTransports,L);}else Z.disconnect();}),O.safeArrForEach(this.proposedTransports,function(Z){Z===L?(r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+L.shortName+"; stack = "+new Error().stack),O.arrDeleteValue(H.proposedTransports,L)):Z.dispose();}),!0},F.prototype.deactivateTransport=function(I,L,S){var G=this.activeProtocol,W=G&&G.getTransport()===I,H=O.arrDeleteValue(this.pendingTransports,I),z=O.arrDeleteValue(this.proposedTransports,I),Q=this.noTransportsScheduledForActivation();if(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+I),r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+L+(W?"; was active":H?"; was pending":z?"; was proposed":"")+(Q?"":"; another transport is scheduled for activation")),S&&S.message&&r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+S.message),W&&(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(G.getPendingMessages()),w.default.Config.nextTick(function(){G.clearPendingMessages();}),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",I),W&&Q||W&&L==="failed"||L==="closed"||G===null&&H&&this.pendingTransports.length===0){if(L==="disconnected"&&S&&S.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:L,error:S,retryImmediately:!0});return}var J=L==="failed"&&u.default.isTokenErr(S)?"disconnected":L;this.notifyState({state:J,error:S});return}W&&L==="disconnected"&&this.state!==this.states.synchronizing&&(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:S}));},F.prototype.noTransportsScheduledForActivation=function(){return O.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(I){return !I.isConnected})},F.prototype.sync=function(I,L,S){var G=setTimeout(function(){I.off("sync"),S(new m.default("Timeout waiting for sync response",5e4,500));},this.options.timeouts.realtimeRequestTimeout),W=P.default.fromValues({action:t.SYNC,connectionKey:this.connectionKey});L.timeSerial?W.timeSerial=L.timeSerial:L.connectionSerial!==void 0&&(W.connectionSerial=L.connectionSerial),I.send(W),I.once("sync",function(H,z){clearTimeout(G),S(null,H,z);});},F.prototype.setConnection=function(I,L,S,G){var W=this,H=this.connectionId,z=H&&H!==I,Q=!H&&G;(z||Q)&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==I?(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),w.default.Config.nextTick(function(){W.realtime.channels.reattach();})):this.options.checkChannelsOnResume&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout(function(){W.realtime.channels.checkAttachedMsgIndicators(I);},3e4)),this.realtime.connection.id=this.connectionId=I,this.realtime.connection.key=this.connectionKey=L.connectionKey;var J=z||!H;this.setConnectionSerial(S,J);},F.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection();},F.prototype.setConnectionSerial=function(I,L){var S=I.timeSerial,G=I.connectionSerial;if(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+G+"; timeSerial = "+S+"; force = "+L+"; previous = "+this.connectionSerial),S!==void 0){if(S<=this.timeSerial&&!L)return r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+S+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.timeSerial=this.timeSerial=S,this.setRecoveryKey();return}if(G!==void 0){if(G<=this.connectionSerial&&!L)return r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+G+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=G,this.setRecoveryKey();}},F.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey();},F.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial;},F.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null;},F.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var I=O.now()-this.lastActivity;I>this.connectionStateTtl+this.maxIdleInterval&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+I+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended",this.states.connecting.queueEvents=!1);}},F.prototype.persistConnection=function(){if(o()){var I=this.realtime.connection.recoveryKey;I&&b({recoveryKey:I,disconnectedAt:O.now(),location:v.location,clientId:this.realtime.auth.clientId});}},F.prototype.unpersistConnection=function(){x();},F.prototype.getError=function(){return this.errorReason||this.getStateError()},F.prototype.getStateError=function(){return T.default[this.state.state]},F.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},F.prototype.enactStateChange=function(I){var L=I.current==="failed"?r.default.LOG_ERROR:r.default.LOG_MAJOR;r.default.logAction(L,"Connection state",I.current+(I.reason?"; reason: "+I.reason:"")),r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+I.current+"; reason = "+(I.reason&&I.reason.message));var S=this.state=this.states[I.current];I.reason&&(this.errorReason=I.reason,this.realtime.connection.errorReason=I.reason),(S.terminal||S.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",I);},F.prototype.startTransitionTimer=function(I){var L=this;r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+I.state),this.transitionTimer&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){L.transitionTimer&&(L.transitionTimer=null,r.default.logAction(r.default.LOG_MINOR,"ConnectionManager "+I.state+" timer expired","requesting new state: "+I.failState),L.notifyState({state:I.failState}));},I.retryDelay);},F.prototype.cancelTransitionTimer=function(){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null);},F.prototype.startSuspendTimer=function(){var I=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){I.suspendTimer&&(I.suspendTimer=null,r.default.logAction(r.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),I.states.connecting.failState="suspended",I.states.connecting.queueEvents=!1,I.notifyState({state:"suspended"}));},this.connectionStateTtl));},F.prototype.checkSuspendTimer=function(I){I!=="disconnected"&&I!=="suspended"&&I!=="connecting"&&this.cancelSuspendTimer();},F.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.states.connecting.queueEvents=!0,this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null);},F.prototype.startRetryTimer=function(I){var L=this;this.retryTimer=setTimeout(function(){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),L.retryTimer=null,L.requestState({state:"connecting"});},I);},F.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null);},F.prototype.notifyState=function(I){var L=this,S=I.state,G=S==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||I.retryImmediately||this.state===this.states.connecting&&I.error&&u.default.isTokenErr(I.error)&&!(this.errorReason&&u.default.isTokenErr(this.errorReason)));if(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+S+(G?"; will retry connection immediately":"")),S!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(I.state),!this.state.terminal)){var W=this.states[I.state],H=new p.default(this.state.state,W.state,W.retryDelay,I.error||T.default[W.state]);if(G){var z=function(){L.state===L.states.disconnected&&(L.lastAutoReconnectAttempt=O.now(),L.requestState({state:"connecting"}));},Q=this.lastAutoReconnectAttempt&&O.now()-this.lastAutoReconnectAttempt+1;Q&&Q<1e3?(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+Q+"ms ago, waiting another "+(1e3-Q)+"ms before trying again"),setTimeout(z,1e3-Q)):w.default.Config.nextTick(z);}else (S==="disconnected"||S==="suspended")&&this.startRetryTimer(W.retryDelay);(S==="disconnected"&&!G||S==="suspended"||W.terminal)&&w.default.Config.nextTick(function(){L.disconnectAllTransports();}),S=="connected"&&!this.activeProtocol&&r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(H),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(S,H.reason),this.failQueuedMessages(H.reason));}},F.prototype.requestState=function(I){var L=this,S=I.state;if(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+S+"; current state: "+this.state.state),S!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(S),!(S=="connecting"&&this.state.state=="connected")&&!(S=="closing"&&this.state.state=="closed"))){var G=this.states[S],W=new p.default(this.state.state,G.state,null,I.error||T.default[G.state]);this.enactStateChange(W),S=="connecting"&&w.default.Config.nextTick(function(){L.startConnect();}),S=="closing"&&this.closeImpl();}},F.prototype.startConnect=function(){var I=this;if(this.state!==this.states.connecting){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var L=this.realtime.auth,S=++this.connectCounter,G=function(){I.checkConnectionStateFreshness(),I.getTransportParams(function(H){S===I.connectCounter&&I.connectImpl(H,S);});};if(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),L.method==="basic")G();else {var W=function(H){S===I.connectCounter&&(H?I.actOnErrorFromAuthorize(H):G());};this.errorReason&&u.default.isTokenErr(this.errorReason)?L._forceNewToken(null,null,W):L._ensureValidAuthCredentials(!1,W);}},F.prototype.connectImpl=function(I,L){var S=this.state.state;S!==this.states.connecting.state&&S!==this.states.connected.state?r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+S):this.pendingTransports.length?r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):S==this.states.connected.state?this.upgradeIfNeeded(I):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(I):this.connectBase(I,L);},F.prototype.connectPreference=function(I){var L=this,S=this.getTransportPreference(),G=!1;O.arrIn(this.transports,S)||(this.unpersistTransportPreference(),this.connectImpl(I)),r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+S);var W=setTimeout(function(){G=!0,L.state.state!==L.states.connected.state&&(r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+S+" failed; clearing preference and trying from scratch"),L.disconnectAllTransports(),L.unpersistTransportPreference()),L.connectImpl(I);},this.options.timeouts.preferenceConnectTimeout);I.host=this.httpHosts[0],this.tryATransport(I,S,function(H,z){clearTimeout(W),G&&z?(z.off(),z.disconnect(),O.arrDeleteValue(L.pendingTransports,z)):!z&&!H&&(L.unpersistTransportPreference(),L.connectImpl(I));});},F.prototype.connectBase=function(I,L){var S=this,G=function(J){S.notifyState({state:S.states.connecting.failState,error:J});},W=this.httpHosts.slice(),H=function(J,X){L===S.connectCounter&&!X&&!J&&Q();};r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var z=W.shift();if(!z){G(new m.default("Unable to connect (no available host)",80003,404));return}I.host=z;var Q=function(){if(!W.length){G(new m.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!S.realtime.http.checkConnectivity){G(new m.default("Internal error: Http.checkConnectivity not set",null,500));return}S.realtime.http.checkConnectivity(function(J,X){if(L===S.connectCounter){if(J){G(J);return}if(!X){G(new m.default("Unable to connect (network unreachable)",80003,404));return}I.host=O.arrPopRandomElement(W),S.tryATransport(I,S.baseTransport,H);}});};if(this.forceFallbackHost&&W.length){this.forceFallbackHost=!1,Q();return}this.tryATransport(I,this.baseTransport,H);},F.prototype.getUpgradePossibilities=function(){var I=this.activeProtocol.getTransport().shortName,L=O.arrIndexOf(this.upgradeTransports,I);return this.upgradeTransports.slice(L+1)},F.prototype.upgradeIfNeeded=function(I){var L=this,S=this.getUpgradePossibilities();r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+w.default.Config.inspect(S)),S.length&&O.arrForEach(S,function(G){var W=L.createTransportParams(I.host,"upgrade");L.tryATransport(W,G,s);});},F.prototype.closeImpl=function(){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),O.safeArrForEach(this.pendingTransports,function(I){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+I),I&&I.close();}),O.safeArrForEach(this.proposedTransports,function(I){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+I),I&&I.dispose();}),this.activeProtocol&&(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"});},F.prototype.onAuthUpdated=function(I,L){var S=this,G;switch(this.state.state){case"connected":{if(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var W=this.activeProtocol.getTransport().params;w.default.Config.nextTick(function(){S.state.state==="connected"&&S.upgradeIfNeeded(W);});}var H=(G=this.activeProtocol)===null||G===void 0?void 0:G.getTransport();H&&H.onAuthUpdated&&H.onAuthUpdated(I);var z=P.default.fromValues({action:t.AUTH,auth:{accessToken:I.token}});this.send(z);var Q=function(){S.off(J),L(null,I);},J=function(tt){tt.current==="failed"&&(S.off(Q),S.off(J),L(tt.reason||S.getStateError()));};this.once("connectiondetails",Q),this.on("connectionstate",J);break}case"connecting":r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var X=function(tt){switch(tt.current){case"connected":S.off(X),L(null,I);break;case"failed":case"closed":case"suspended":S.off(X),L(tt.reason||S.getStateError());break;}};this.on("connectionstate",X),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"});}}},F.prototype.disconnectAllTransports=function(I){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(I?" except the active transport":"")),this.connectCounter++,O.safeArrForEach(this.pendingTransports,function(L){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+L),L&&L.disconnect();}),this.pendingTransports=[],O.safeArrForEach(this.proposedTransports,function(L){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+L),L&&L.dispose();}),this.proposedTransports=[],this.activeProtocol&&!I&&(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect());},F.prototype.send=function(I,L,S){S=S||s;var G=this.state;if(G.sendEvents){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new R.PendingMessage(I,S));return}var W=L&&G.queueEvents||G.forceQueueEvents;if(!W){var H="rejecting event, queueEvent was "+L+", state was "+G.state;r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.send()",H),S(this.errorReason||new m.default(H,9e4,400));return}r.default.shouldLog(r.default.LOG_MICRO)&&r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+P.default.stringify(I)),this.queue(I,S);},F.prototype.sendImpl=function(I){var L=I.message;I.ackRequired&&!I.sendAttempted&&(L.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(I);}catch(S){r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+S.stack);}},F.prototype.queue=function(I,L){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var S=this.queuedMessages.last(),G=this.options.maxMessageSize;S&&!S.sendAttempted&&A(S.message,I,G)?(S.merged||(S.callback=h.default.create([S.callback]),S.merged=!0),S.callback.push(L)):this.queuedMessages.push(new R.PendingMessage(I,L));},F.prototype.sendQueuedMessages=function(){r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var I;I=this.queuedMessages.shift();)this.sendImpl(I);},F.prototype.queuePendingMessages=function(I){I&&I.length&&(r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+I.length+" pending messages"),this.queuedMessages.prepend(I));},F.prototype.failQueuedMessages=function(I){var L=this.queuedMessages.count();L>0&&(r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+L+" queued messages, err = "+O.inspectError(I)),this.queuedMessages.completeAllMessages(I));},F.prototype.onChannelMessage=function(I,L){var S=this.activeProtocol&&L===this.activeProtocol.getTransport(),G=O.arrIn(this.pendingTransports,L)&&this.state==this.states.synchronizing,W=I.action===t.MESSAGE||I.action===t.PRESENCE;if(S||G){if(W){var H=this.setConnectionSerial(I);if(H)return;if(P.default.isDuplicate(I,this.mostRecentMsg)){r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+I.id);return}this.mostRecentMsg=I;}this.realtime.channels.onChannelMessage(I);}else O.arrIndexOf([t.ACK,t.NACK,t.ERROR],I.action)>-1?this.realtime.channels.onChannelMessage(I):r.default.logAction(r.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(I)+"on defunct transport; discarding");},F.prototype.ping=function(I,L){var S=this;if(I){r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+I);var G=function(){I.off("heartbeat",z),L(new m.default("Timeout waiting for heartbeat response",5e4,500));},W=O.now(),H=O.cheapRandStr(),z=function(Z){if(Z===H){I.off("heartbeat",z),clearTimeout(Q);var $=O.now()-W;L(null,$);}},Q=setTimeout(G,this.options.timeouts.realtimeRequestTimeout);I.on("heartbeat",z),I.ping(H);return}if(this.state.state!=="connected"){L(new m.default("Unable to ping service; not connected",4e4,400));return}var J=!1,X=function(Z,$){S.off("transport.active",tt),J||(J=!0,L(Z,$));},tt=function(){J||(J=!0,w.default.Config.nextTick(function(){S.ping(null,L);}));};this.on("transport.active",tt),this.ping(this.activeProtocol.getTransport(),X);},F.prototype.abort=function(I){this.activeProtocol.getTransport().fail(I);},F.prototype.registerProposedTransport=function(I){this.proposedTransports.push(I);},F.prototype.getTransportPreference=function(){var I,L;return this.transportPreference||n()&&((L=(I=w.default.WebStorage)===null||I===void 0?void 0:I.get)===null||L===void 0?void 0:L.call(I,g))},F.prototype.persistTransportPreference=function(I){var L,S;O.arrIn(E.default.upgradeTransports,I.shortName)&&(this.transportPreference=I.shortName,n()&&((S=(L=w.default.WebStorage)===null||L===void 0?void 0:L.set)===null||S===void 0||S.call(L,g,I.shortName)));},F.prototype.unpersistTransportPreference=function(){var I,L;this.transportPreference=null,n()&&((L=(I=w.default.WebStorage)===null||I===void 0?void 0:I.remove)===null||L===void 0||L.call(I,g));},F.prototype.actOnErrorFromAuthorize=function(I){if(I.code===40171)this.notifyState({state:"failed",error:I});else if(I.statusCode===a.default.Forbidden){var L="Client configured authentication provider returned 403; failing the connection";r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",L),this.notifyState({state:"failed",error:new m.default(L,80019,403,I)});}else {var L="Client configured authentication provider request failed";r.default.logAction(r.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",L),this.notifyState({state:this.state.failState,error:new m.default(L,80019,401,I)});}},F.prototype.onConnectionDetailsUpdate=function(I,L){if(!!I){this.connectionDetails=I,I.maxMessageSize&&(this.options.maxMessageSize=I.maxMessageSize);var S=I.clientId;if(S){var G=this.realtime.auth._uncheckedSetClientId(S);if(G){r.default.logAction(r.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",G.message),L.fail(G);return}}var W=I.connectionStateTtl;W&&(this.connectionStateTtl=W),this.maxIdleInterval=I.maxIdleInterval,this.emit("connectiondetails",I);}},F.supportedTransports={},F}(y.default);l.default=N;}).call(this,f(10));},function(D,l,f){(function(v,i){D.exports=i(f(6),f(40),f(24));})(this,function(v){return function(){var i=v,P=i.lib,O=P.Base,R=P.WordArray,E=i.algo,w=E.MD5,y=E.EvpKDF=O.extend({cfg:O.extend({keySize:128/32,hasher:w,iterations:1}),init:function(C){this.cfg=this.cfg.extend(C);},compute:function(C,r){for(var p,T=this.cfg,m=T.hasher.create(),u=R.create(),c=u.words,h=T.keySize,e=T.iterations;c.length<h;){p&&m.update(p),p=m.update(C).finalize(r),m.reset();for(var a=1;a<e;a++)p=m.finalize(p),m.reset();u.concat(p);}return u.sigBytes=h*4,u}});i.EvpKDF=function(C,r,p){return y.create(p).compute(C,r)};}(),v.EvpKDF});},function(D,l,f){(function(v,i){D.exports=i(f(6),f(27));})(this,function(v){v.lib.Cipher||function(i){var P=v,O=P.lib,R=O.Base,E=O.WordArray,w=O.BufferedBlockAlgorithm,y=P.enc;y.Utf8;var r=y.Base64,p=P.algo,T=p.EvpKDF,m=O.Cipher=w.extend({cfg:R.extend(),createEncryptor:function(d,A){return this.create(this._ENC_XFORM_MODE,d,A)},createDecryptor:function(d,A){return this.create(this._DEC_XFORM_MODE,d,A)},init:function(d,A,B){this.cfg=this.cfg.extend(B),this._xformMode=d,this._key=A,this.reset();},reset:function(){w.reset.call(this),this._doReset();},process:function(d){return this._append(d),this._process()},finalize:function(d){d&&this._append(d);var A=this._doFinalize();return A},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function d(A){return typeof A=="string"?x:M}return function(A){return {encrypt:function(B,N,j){return d(N).encrypt(A,B,N,j)},decrypt:function(B,N,j){return d(N).decrypt(A,B,N,j)}}}}()});O.StreamCipher=m.extend({_doFinalize:function(){var d=this._process(!0);return d},blockSize:1});var c=P.mode={},h=O.BlockCipherMode=R.extend({createEncryptor:function(d,A){return this.Encryptor.create(d,A)},createDecryptor:function(d,A){return this.Decryptor.create(d,A)},init:function(d,A){this._cipher=d,this._iv=A;}}),e=c.CBC=function(){var d=h.extend();d.Encryptor=d.extend({processBlock:function(B,N){var j=this._cipher,F=j.blockSize;A.call(this,B,N,F),j.encryptBlock(B,N),this._prevBlock=B.slice(N,N+F);}}),d.Decryptor=d.extend({processBlock:function(B,N){var j=this._cipher,F=j.blockSize,I=B.slice(N,N+F);j.decryptBlock(B,N),A.call(this,B,N,F),this._prevBlock=I;}});function A(B,N,j){var F,I=this._iv;I?(F=I,this._iv=i):F=this._prevBlock;for(var L=0;L<j;L++)B[N+L]^=F[L];}return d}(),a=P.pad={},n=a.Pkcs7={pad:function(d,A){for(var B=A*4,N=B-d.sigBytes%B,j=N<<24|N<<16|N<<8|N,F=[],I=0;I<N;I+=4)F.push(j);var L=E.create(F,N);d.concat(L);},unpad:function(d){var A=d.words[d.sigBytes-1>>>2]&255;d.sigBytes-=A;}};O.BlockCipher=m.extend({cfg:m.cfg.extend({mode:e,padding:n}),reset:function(){var d;m.reset.call(this);var A=this.cfg,B=A.iv,N=A.mode;this._xformMode==this._ENC_XFORM_MODE?d=N.createEncryptor:(d=N.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==d?this._mode.init(this,B&&B.words):(this._mode=d.call(N,this,B&&B.words),this._mode.__creator=d);},_doProcessBlock:function(d,A){this._mode.processBlock(d,A);},_doFinalize:function(){var d,A=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(A.pad(this._data,this.blockSize),d=this._process(!0)):(d=this._process(!0),A.unpad(d)),d},blockSize:128/32});var t=O.CipherParams=R.extend({init:function(d){this.mixIn(d);},toString:function(d){return (d||this.formatter).stringify(this)}}),s=P.format={},g=s.OpenSSL={stringify:function(d){var A,B=d.ciphertext,N=d.salt;return N?A=E.create([1398893684,1701076831]).concat(N).concat(B):A=B,A.toString(r)},parse:function(d){var A,B=r.parse(d),N=B.words;return N[0]==1398893684&&N[1]==1701076831&&(A=E.create(N.slice(2,4)),N.splice(0,4),B.sigBytes-=16),t.create({ciphertext:B,salt:A})}},M=O.SerializableCipher=R.extend({cfg:R.extend({format:g}),encrypt:function(d,A,B,N){N=this.cfg.extend(N);var j=d.createEncryptor(B,N),F=j.finalize(A),I=j.cfg;return t.create({ciphertext:F,key:B,iv:I.iv,algorithm:d,mode:I.mode,padding:I.padding,blockSize:d.blockSize,formatter:N.format})},decrypt:function(d,A,B,N){N=this.cfg.extend(N),A=this._parse(A,N.format);var j=d.createDecryptor(B,N).finalize(A.ciphertext);return j},_parse:function(d,A){return typeof d=="string"?A.parse(d,this):d}}),U=P.kdf={},b=U.OpenSSL={execute:function(d,A,B,N){N||(N=E.random(64/8));var j=T.create({keySize:A+B}).compute(d,N),F=E.create(j.words.slice(A),B*4);return j.sigBytes=A*4,t.create({key:j,iv:F,salt:N})}},x=O.PasswordBasedCipher=M.extend({cfg:M.cfg.extend({kdf:b}),encrypt:function(d,A,B,N){N=this.cfg.extend(N);var j=N.kdf.execute(B,d.keySize,d.ivSize);N.iv=j.iv;var F=M.encrypt.call(this,d,A,j.key,N);return F.mixIn(j),F},decrypt:function(d,A,B,N){N=this.cfg.extend(N),A=this._parse(A,N.format);var j=N.kdf.execute(B,d.keySize,d.ivSize,A.salt);N.iv=j.iv;var F=M.decrypt.call(this,d,A,j.key,N);return F}});}();});},function(D,l,f){(function(v){l.__esModule=!0,l.Request=l.createRequest=void 0;var i=f(1),P=i.__importStar(f(2)),O=i.__importDefault(f(13)),R=i.__importDefault(f(3)),E=i.__importDefault(f(7)),w=i.__importDefault(f(5)),y=i.__importDefault(f(8)),C=i.__importDefault(f(0)),r=i.__importDefault(f(21)),p=v||window,T=function(){},m=p._ablyjs_jsonp={};m._=function(o){return m["_"+o]||T};var u=1,c="jsonp";function h(o,t,s,g,M,U,b){return U=U||y.default.TIMEOUTS,new a(void 0,o,t,P.copy(s),g,M,U,b)}l.createRequest=h;var e=function(o){i.__extends(t,o);function t(s,g,M){var U=o.call(this,s,g,M)||this;return U.shortName=c,M.stream=!1,U}return t.isAvailable=function(){return R.default.Config.jsonpSupported&&R.default.Config.allowComet},t.tryConnect=function(s,g,M,U){var b=new t(s,g,M),x=function(d){U({event:this.event,error:d});};b.on(["failed","disconnected"],x),b.on("preconnect",function(){C.default.logAction(C.default.LOG_MINOR,"JSONPTransport.tryConnect()","viable transport "+b),b.off(["failed","disconnected"],x),U(null,b);}),b.connect();},t.prototype.toString=function(){return "JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},t.prototype.createRequest=function(s,g,M,U,b,x,d){return x=(this===null||this===void 0?void 0:this.timeouts)||x||y.default.TIMEOUTS,h(s,g,M,U,b,x,d)},t}(O.default),a=function(o){i.__extends(t,o);function t(s,g,M,U,b,x,d,A){var B=o.call(this)||this;return s===void 0&&(s=u++),B.id=s,B.uri=g,B.params=U||{},B.params.rnd=P.cheapRandStr(),M&&(M["X-Ably-Version"]&&(B.params.v=M["X-Ably-Version"]),M["X-Ably-Lib"]&&(B.params.lib=M["X-Ably-Lib"])),B.body=b,B.method=A,B.requestMode=x,B.timeouts=d,B.requestComplete=!1,B}return t.prototype.exec=function(){var s=this,g=this.id,M=this.body,U=this.method,b=this.uri,x=this.params;x.callback="_ablyjs_jsonp._("+g+")",x.envelope="jsonp",M&&(x.body=M),U&&U!=="get"&&(x.method=U);var d=this.script=document.createElement("script"),A=b+P.toQueryString(x);d.src=A,d.src.split("/").slice(-1)[0]!==A.split("/").slice(-1)[0]&&C.default.logAction(C.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),d.async=!0,d.type="text/javascript",d.charset="UTF-8",d.onerror=function(j){s.complete(new w.default("JSONP script error (event: "+R.default.Config.inspect(j)+")",null,400));},m["_"+g]=function(j){if(j.statusCode){var F=j.response;if(j.statusCode==204)s.complete(null,null,null,j.statusCode);else if(!F)s.complete(new w.default("Invalid server response: no envelope detected",null,500));else if(j.statusCode<400||P.isArray(F))s.complete(null,F,j.headers,j.statusCode);else {var I=F.error||new w.default("Error response received from server",null,j.statusCode);s.complete(I);}}else s.complete(null,j);};var B=this.requestMode==r.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),B);var N=document.getElementsByTagName("head")[0];N.insertBefore(d,N.firstChild);},t.prototype.complete=function(s,g,M,U){if(M=M||{},!this.requestComplete){this.requestComplete=!0;var b=void 0;g&&(b=typeof g=="string"?"text/plain":"application/json",M["content-type"]=b,this.emit("data",g)),this.emit("complete",s,g,M,!0,U),this.dispose();}},t.prototype.abort=function(){this.dispose();},t.prototype.dispose=function(){var s=this.timer;s&&(clearTimeout(s),this.timer=null);var g=this.script;g.parentNode&&g.parentNode.removeChild(g),delete m[this.id],this.emit("disposed");},t}(E.default);l.Request=a;function n(o){return p.JSONPTransport=e,e.isAvailable()&&(o.supportedTransports[c]=e),e}l.default=n;}).call(this,f(10));},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=v.__importDefault(f(0)),O=v.__importDefault(f(8)),R=v.__importDefault(f(17)),E=v.__importDefault(f(46)),w=v.__importDefault(f(19)),y=v.__importDefault(f(33)),C=v.__importDefault(f(5)),r=v.__importDefault(f(49)),p=v.__importDefault(f(18)),T=v.__importDefault(f(3)),m=function(){},u=function(){function h(e){if(!e){var a="no options provided";throw P.default.logAction(P.default.LOG_ERROR,"Rest()",a),new Error(a)}var n=O.default.objectifyOptions(e);n.log&&P.default.setLog(n.log.level,n.log.handler),P.default.logAction(P.default.LOG_MICRO,"Rest()","initialized with clientOptions "+T.default.Config.inspect(e));var o=this.options=O.default.normaliseOptions(n);if(o.key){var t=o.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!t){var a="invalid key parameter";throw P.default.logAction(P.default.LOG_ERROR,"Rest()",a),new C.default(a,40400,404)}o.keyName=t[1],o.keySecret=t[2];}if("clientId"in o)if(typeof o.clientId=="string"||o.clientId===null){if(o.clientId==="*")throw new C.default('Can\u2019t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new C.default("clientId must be either a string or null",40012,400);P.default.logAction(P.default.LOG_MINOR,"Rest()","started; version = "+O.default.version),this.baseUri=this.authority=function(s){return O.default.getHttpScheme(o)+s+":"+O.default.getPort(o,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new T.default.Http,this.auth=new R.default(this,o),this.channels=new c(this),this.push=new E.default(this);}return h.prototype.stats=function(e,a){if(a===void 0)if(typeof e=="function")a=e,e=null;else {if(this.options.promises)return i.promisify(this,"stats",arguments);a=m;}var n=i.defaultGetHeaders(),o=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,t=this.http.supportsLinkHeaders?void 0:o;this.options.headers&&i.mixin(n,this.options.headers),new w.default(this,"/stats",n,t,function(s,g,M){for(var U=M?s:JSON.parse(s),b=0;b<U.length;b++)U[b]=r.default.fromValues(U[b]);return U}).get(e,a);},h.prototype.time=function(e,a){var n=this;if(a===void 0){if(typeof e=="function")a=e,e=null;else if(this.options.promises)return i.promisify(this,"time",arguments)}var o=a||m,t=i.defaultGetHeaders();this.options.headers&&i.mixin(t,this.options.headers);var s=function(g){return n.authority(g)+"/time"};this.http.do(p.default.Get,this,s,t,null,e,function(g,M,U,b){if(g){o(g);return}b||(M=JSON.parse(M));var x=M[0];if(!x){o(new C.default("Internal error (unexpected result type from GET /time)",5e4,500));return}n.serverTimeOffset=x-i.now(),o(null,x);});},h.prototype.request=function(e,a,n,o,t,s){var g=this.options.useBinaryProtocol,M=g?T.default.Config.msgpack.encode:JSON.stringify,U=g?T.default.Config.msgpack.decode:JSON.parse,b=g?i.Format.msgpack:i.Format.json,x=this.http.supportsLinkHeaders?void 0:b;n=n||{};var d=e.toLowerCase(),A=d=="get"?i.defaultGetHeaders(b):i.defaultPostHeaders(b);if(s===void 0){if(this.options.promises)return i.promisify(this,"request",arguments);s=m;}typeof o!="string"&&(o=M(o)),this.options.headers&&i.mixin(A,this.options.headers),t&&i.mixin(A,t);var B=new w.default(this,a,A,x,function(N,j,F){return i.ensureArray(F?N:U(N))},!0);if(!i.arrIn(T.default.Http.methods,d))throw new C.default("Unsupported method "+d,40500,405);i.arrIn(T.default.Http.methodsWithBody,d)?B[d](n,o,s):B[d](n,s);},h.prototype.setLog=function(e){P.default.setLog(e.level,e.handler);},h.Promise=function(e){return e=O.default.objectifyOptions(e),e.promises=!0,new h(e)},h.Callbacks=h,h.Platform=T.default,h}(),c=function(){function h(e){this.rest=e,this.all={};}return h.prototype.get=function(e,a){e=String(e);var n=this.all[e];return n?a&&n.setOptions(a):this.all[e]=n=new y.default(this.rest,e,a),n},h.prototype.release=function(e){delete this.all[String(e)];},h}();l.default=u;},function(D,l,f){(function(v,i){D.exports=i(f(6));})(this,function(v){return function(i){var P=v,O=P.lib,R=O.WordArray,E=O.Hasher,w=P.algo,y=[],C=[];(function(){function T(h){for(var e=i.sqrt(h),a=2;a<=e;a++)if(!(h%a))return !1;return !0}function m(h){return (h-(h|0))*4294967296|0}for(var u=2,c=0;c<64;)T(u)&&(c<8&&(y[c]=m(i.pow(u,1/2))),C[c]=m(i.pow(u,1/3)),c++),u++;})();var r=[],p=w.SHA256=E.extend({_doReset:function(){this._hash=new R.init(y.slice(0));},_doProcessBlock:function(T,m){for(var u=this._hash.words,c=u[0],h=u[1],e=u[2],a=u[3],n=u[4],o=u[5],t=u[6],s=u[7],g=0;g<64;g++){if(g<16)r[g]=T[m+g]|0;else {var M=r[g-15],U=(M<<25|M>>>7)^(M<<14|M>>>18)^M>>>3,b=r[g-2],x=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;r[g]=U+r[g-7]+x+r[g-16];}var d=n&o^~n&t,A=c&h^c&e^h&e,B=(c<<30|c>>>2)^(c<<19|c>>>13)^(c<<10|c>>>22),N=(n<<26|n>>>6)^(n<<21|n>>>11)^(n<<7|n>>>25),j=s+N+d+C[g]+r[g],F=B+A;s=t,t=o,o=n,n=a+j|0,a=e,e=h,h=c,c=j+F|0;}u[0]=u[0]+c|0,u[1]=u[1]+h|0,u[2]=u[2]+e|0,u[3]=u[3]+a|0,u[4]=u[4]+n|0,u[5]=u[5]+o|0,u[6]=u[6]+t|0,u[7]=u[7]+s|0;},_doFinalize:function(){var T=this._data,m=T.words,u=this._nDataBytes*8,c=T.sigBytes*8;return m[c>>>5]|=128<<24-c%32,m[(c+64>>>9<<4)+14]=i.floor(u/4294967296),m[(c+64>>>9<<4)+15]=u,T.sigBytes=m.length*4,this._process(),this._hash},clone:function(){var T=E.clone.call(this);return T._hash=this._hash.clone(),T}});P.SHA256=E._createHelper(p),P.HmacSHA256=E._createHmacHelper(p);}(Math),v.SHA256});},function(D,l,f){(function(v,i){D.exports=i(f(6));})(this,function(v){return v.enc.Utf8});},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=v.__importDefault(f(7)),O=v.__importDefault(f(0)),R=v.__importDefault(f(34)),E=v.__importDefault(f(11)),w=v.__importDefault(f(5)),y=v.__importDefault(f(19)),C=v.__importDefault(f(25)),r=v.__importDefault(f(3));function p(){}var T=9;function m(h){return i.arrEvery(h,function(e){return !e.id})}function u(h){var e=h||{};if(e.cipher){if(!r.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var a=r.default.Crypto.getCipher(e.cipher);e.cipher=a.cipherParams,e.channelCipher=a.cipher;}else "cipher"in e&&(e.cipher=void 0,e.channelCipher=null);return e}var c=function(h){v.__extends(e,h);function e(a,n,o){var t=h.call(this)||this;return O.default.logAction(O.default.LOG_MINOR,"Channel()","started; name = "+n),t.rest=a,t.name=n,t.basePath="/channels/"+encodeURIComponent(n),t.presence=new R.default(t),t.channelOptions=u(o),t}return e.prototype.setOptions=function(a){this.channelOptions=u(a);},e.prototype.history=function(a,n){if(O.default.logAction(O.default.LOG_MICRO,"Channel.history()","channel = "+this.name),n===void 0)if(typeof a=="function")n=a,a=null;else {if(this.rest.options.promises)return i.promisify(this,"history",arguments);n=p;}this._history(a,n);},e.prototype._history=function(a,n){var o=this.rest,t=o.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,s=this.rest.http.supportsLinkHeaders?void 0:t,g=i.defaultGetHeaders(t);o.options.headers&&i.mixin(g,o.options.headers);var M=this.channelOptions;new y.default(o,this.basePath+"/messages",g,s,function(U,b,x){return E.default.fromResponseBody(U,M,x?void 0:t)}).get(a,n);},e.prototype.publish=function(){var a=this,n=arguments.length,o=arguments[0],t=arguments[1],s=arguments[n-1],g,M;if(typeof s!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);s=p;}if(typeof o=="string"||o===null)g=[E.default.fromValues({name:o,data:t})],M=arguments[2];else if(i.isObject(o))g=[E.default.fromValues(o)],M=arguments[1];else if(i.isArray(o))g=E.default.fromValuesArray(o),M=arguments[1];else throw new w.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof M!="object"||!M)&&(M={});var U=this.rest,b=U.options,x=b.useBinaryProtocol?i.Format.msgpack:i.Format.json,d=U.options.idempotentRestPublishing,A=i.defaultPostHeaders(x);if(b.headers&&i.mixin(A,b.headers),d&&m(g)){var B=i.randomString(T);i.arrForEach(g,function(N,j){N.id=B+":"+j.toString();});}E.default.encodeArray(g,this.channelOptions,function(N){if(N){s(N);return}var j=E.default.getMessagesSize(g),F=b.maxMessageSize;if(j>F){s(new w.default("Maximum size of messages that can be published at once exceeded ( was "+j+" bytes; limit is "+F+" bytes)",40009,400));return}a._publish(E.default.serialize(g,x),A,M,s);});},e.prototype._publish=function(a,n,o,t){C.default.post(this.rest,this.basePath+"/messages",a,n,o,null,t);},e.prototype.status=function(a){if(typeof a!="function"&&this.rest.options.promises)return i.promisify(this,"status",[]);var n=this.rest.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,o=i.defaultPostHeaders(n);C.default.get(this.rest,this.basePath,o,{},n,a||p);},e}(P.default);l.default=c;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=v.__importDefault(f(7)),O=v.__importDefault(f(0)),R=v.__importDefault(f(19)),E=v.__importDefault(f(15));function w(){}var y=function(C){v.__extends(r,C);function r(p){var T=C.call(this)||this;return T.channel=p,T.basePath=p.basePath+"/presence",T}return r.prototype.get=function(p,T){if(O.default.logAction(O.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),T===void 0)if(typeof p=="function")T=p,p=null;else {if(this.channel.rest.options.promises)return i.promisify(this,"get",arguments);T=w;}var m=this.channel.rest,u=m.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,c=this.channel.rest.http.supportsLinkHeaders?void 0:u,h=i.defaultGetHeaders(u);m.options.headers&&i.mixin(h,m.options.headers);var e=this.channel.channelOptions;new R.default(m,this.basePath,h,c,function(a,n,o){return E.default.fromResponseBody(a,e,o?void 0:u)}).get(p,T);},r.prototype.history=function(p,T){O.default.logAction(O.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(p,T);},r.prototype._history=function(p,T){if(T===void 0)if(typeof p=="function")T=p,p=null;else {if(this.channel.rest.options.promises)return i.promisify(this,"_history",arguments);T=w;}var m=this.channel.rest,u=m.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,c=this.channel.rest.http.supportsLinkHeaders?void 0:u,h=i.defaultGetHeaders(u);m.options.headers&&i.mixin(h,m.options.headers);var e=this.channel.channelOptions;new R.default(m,this.basePath+"/history",h,c,function(a,n,o){return E.default.fromResponseBody(a,e,o?void 0:u)}).get(p,T);},r}(P.default);l.default=y;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importDefault(f(7)),P=v.__importDefault(f(0)),O=function(R){v.__extends(E,R);function E(){var w=R.call(this)||this;return w.messages=[],w}return E.prototype.count=function(){return this.messages.length},E.prototype.push=function(w){this.messages.push(w);},E.prototype.shift=function(){return this.messages.shift()},E.prototype.last=function(){return this.messages[this.messages.length-1]},E.prototype.copyAll=function(){return this.messages.slice()},E.prototype.append=function(w){this.messages.push.apply(this.messages,w);},E.prototype.prepend=function(w){this.messages.unshift.apply(this.messages,w);},E.prototype.completeMessages=function(w,y,C){P.default.logAction(P.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+w+"; count = "+y),C=C||null;var r=this.messages;if(r.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var p=r[0];if(p){var T=p.message.msgSerial,m=w+y;if(m>T)for(var u=r.splice(0,m-T),c=0,h=u;c<h.length;c++){var e=h[c];e.callback(C);}r.length==0&&this.emit("idle");}},E.prototype.completeAllMessages=function(w){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,w);},E.prototype.clear=function(){P.default.logAction(P.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle");},E}(i.default);l.default=O;},function(D,l,f){l.__esModule=!0;var v=function(){function i(P,O,R,E){this.previous=P,this.current=O,R&&(this.retryIn=R),E&&(this.reason=E);}return i}();l.default=v;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importDefault(f(12)),P=v.__importStar(f(2)),O=v.__importDefault(f(7)),R=v.__importDefault(f(0)),E=v.__importDefault(f(20)),w=v.__importDefault(f(5)),y=v.__importDefault(f(3)),C=i.default.Action,r=i.default.fromValues({action:C.CLOSE}),p=i.default.fromValues({action:C.DISCONNECT}),T=function(m){v.__extends(u,m);function u(c,h,e,a){var n=m.call(this)||this;return a&&(e.format=void 0,e.heartbeats=!0),n.connectionManager=c,c.registerProposedTransport(n),n.auth=h,n.params=e,n.timeouts=e.options.timeouts,n.format=e.format,n.isConnected=!1,n.isFinished=!1,n.isDisposed=!1,n.maxIdleInterval=null,n.idleTimer=null,n.lastActivity=null,n}return u.prototype.connect=function(){},u.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",E.default.closed);},u.prototype.disconnect=function(c){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",c||E.default.disconnected);},u.prototype.fail=function(c){this.isConnected&&this.requestDisconnect(),this.finish("failed",c||E.default.failed);},u.prototype.finish=function(c,h){var e;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((e=this.idleTimer)!==null&&e!==void 0?e:void 0),this.idleTimer=null,this.emit(c,h),this.dispose());},u.prototype.onProtocolMessage=function(c){switch(R.default.shouldLog(R.default.LOG_MICRO)&&R.default.logAction(R.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+i.default.stringify(c)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),c.action){case C.HEARTBEAT:R.default.logAction(R.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",c.id);break;case C.CONNECTED:this.onConnect(c),this.emit("connected",c.error,c.connectionId,c.connectionDetails,c);break;case C.CLOSED:this.onClose(c);break;case C.DISCONNECTED:this.onDisconnect(c);break;case C.ACK:this.emit("ack",c.msgSerial,c.count);break;case C.NACK:this.emit("nack",c.msgSerial,c.count,c.error);break;case C.SYNC:if(c.connectionId!==void 0){this.emit("sync",c.connectionId,c);break}this.connectionManager.onChannelMessage(c,this);break;case C.AUTH:this.auth.authorize(function(h){h&&R.default.logAction(R.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+P.inspectError(h));});break;case C.ERROR:if(R.default.logAction(R.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+y.default.Config.inspect(c.error)+(c.channel?", channel: "+c.channel:"")),c.channel===void 0){this.onFatalError(c);break}this.connectionManager.onChannelMessage(c,this);break;default:this.connectionManager.onChannelMessage(c,this);}},u.prototype.onConnect=function(c){if(this.isConnected=!0,!c.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var h=c.connectionDetails.maxIdleInterval;h&&(this.maxIdleInterval=h+this.timeouts.realtimeRequestTimeout,this.onActivity());},u.prototype.onDisconnect=function(c){var h=c&&c.error;R.default.logAction(R.default.LOG_MINOR,"Transport.onDisconnect()","err = "+P.inspectError(h)),this.finish("disconnected",h);},u.prototype.onFatalError=function(c){var h=c&&c.error;R.default.logAction(R.default.LOG_MINOR,"Transport.onFatalError()","err = "+P.inspectError(h)),this.finish("failed",h);},u.prototype.onClose=function(c){var h=c&&c.error;R.default.logAction(R.default.LOG_MINOR,"Transport.onClose()","err = "+P.inspectError(h)),this.finish("closed",h);},u.prototype.requestClose=function(){R.default.logAction(R.default.LOG_MINOR,"Transport.requestClose()",""),this.send(r);},u.prototype.requestDisconnect=function(){R.default.logAction(R.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(p);},u.prototype.ping=function(c){var h={action:i.default.Action.HEARTBEAT};c&&(h.id=c),this.send(i.default.fromValues(h));},u.prototype.dispose=function(){R.default.logAction(R.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off();},u.prototype.onActivity=function(){!this.maxIdleInterval||(this.lastActivity=this.connectionManager.lastActivity=P.now(),this.setIdleTimer(this.maxIdleInterval+100));},u.prototype.setIdleTimer=function(c){var h=this;this.idleTimer||(this.idleTimer=setTimeout(function(){h.onIdleTimerExpire();},c));},u.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var c=P.now()-this.lastActivity,h=this.maxIdleInterval-c;if(h<=0){var e="No activity seen from realtime in "+c+"ms; assuming connection has dropped";R.default.logAction(R.default.LOG_ERROR,"Transport.onIdleTimerExpire()",e),this.disconnect(new w.default(e,80003,408));}else this.setIdleTimer(h+100);},u}(O.default);l.default=T;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importDefault(f(12)),P=v.__importDefault(f(7)),O=v.__importStar(f(2)),R=v.__importDefault(f(33)),E=v.__importDefault(f(0)),w=v.__importDefault(f(55)),y=v.__importDefault(f(11)),C=v.__importDefault(f(39)),r=v.__importDefault(f(5)),p=v.__importDefault(f(15)),T=v.__importDefault(f(20)),m=i.default.Action,u=function(){},c="statechange",h="sync";function e(n){if(n&&"params"in n&&!O.isObject(n.params))return new r.default("options.params must be an object",4e4,400);if(n&&"modes"in n){if(!O.isArray(n.modes))return new r.default("options.modes must be an array",4e4,400);for(var o=0;o<n.modes.length;o++){var t=n.modes[o];if(!t||typeof t!="string"||!O.arrIn(i.default.channelModes,String.prototype.toUpperCase.call(t)))return new r.default("Invalid channel mode: "+t,4e4,400)}}}var a=function(n){v.__extends(o,n);function o(t,s,g){var M=n.call(this,t,s,g)||this;return M.history=function(U,b){if(E.default.logAction(E.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),b===void 0)if(typeof U=="function")b=U,U=null;else {if(this.rest.options.promises)return O.promisify(this,"history",arguments);b=u;}if(U&&U.untilAttach){if(this.state!=="attached"){b(new r.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){b(new r.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete U.untilAttach,U.from_serial=this.properties.attachSerial;}R.default.prototype._history.call(this,U,b);},M.whenState=function(U,b){return P.default.prototype.whenState.call(M,U,M.state,b)},E.default.logAction(E.default.LOG_MINOR,"RealtimeChannel()","started; name = "+s),M.realtime=t,M.presence=new w.default(M),M.connectionManager=t.connection.connectionManager,M.state="initialized",M.subscriptions=new P.default,M.syncChannelSerial=void 0,M.properties={attachSerial:void 0},M.setOptions(g),M.errorReason=null,M._requestedFlags=null,M._mode=null,M._attachedMsgIndicator=!1,M._attachResume=!1,M._decodingContext={channelOptions:M.channelOptions,plugins:t.options.plugins||{},baseEncodedPreviousPayload:void 0},M._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},M._allChannelChanges=new P.default,M}return o.invalidStateError=function(t){return {statusCode:400,code:90001,message:"Channel operation failed as channel state is "+t}},o.processListenerArgs=function(t){return t=Array.prototype.slice.call(t),typeof t[0]=="function"&&t.unshift(null),t[t.length-1]==null&&t.pop(),t},o.prototype.setOptions=function(t,s){if(!s&&this.rest.options.promises)return O.promisify(this,"setOptions",arguments);var g=s||function(U){U&&E.default.logAction(E.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+U.toString());},M=e(t);if(M){g(M);return}R.default.prototype.setOptions.call(this,t),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(t)?(this.attachImpl(),this._allChannelChanges.once(function(U){switch(this.event){case"update":case"attached":g==null||g(null);return;default:g==null||g(U.reason);return}})):g();},o.prototype._shouldReattachToSetOptions=function(t){return (this.state==="attached"||this.state==="attaching")&&(t.params||t.modes)},o.prototype.publish=function(){for(var t=this,s=[],g=0;g<arguments.length;g++)s[g]=arguments[g];var M=s[0],U=s.length,b=s[U-1];if(typeof b!="function"){if(this.realtime.options.promises)return O.promisify(this,"publish",arguments);b=u,++U;}if(!this.connectionManager.activeState()){b(this.connectionManager.getError());return}if(U==2)if(O.isObject(M))M=[y.default.fromValues(M)];else if(O.isArray(M))M=y.default.fromValuesArray(M);else throw new r.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else M=[y.default.fromValues({name:s[0],data:s[1]})];var x=this.realtime.options.maxMessageSize;y.default.encodeArray(M,this.channelOptions,function(d){if(d){b(d);return}var A=y.default.getMessagesSize(M);if(A>x){b(new r.default("Maximum size of messages that can be published at once exceeded ( was "+A+" bytes; limit is "+x+" bytes)",40009,400));return}t.__publish(M,b);});},o.prototype.__publish=function(t,s){E.default.logAction(E.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+t.length);var g=this.state;switch(g){case"failed":case"suspended":s(r.default.fromValues(o.invalidStateError(g)));break;default:{E.default.logAction(E.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+g);var M=new i.default;M.action=m.MESSAGE,M.channel=this.name,M.messages=t,this.sendMessage(M,s);break}}},o.prototype.onEvent=function(t){E.default.logAction(E.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var s=this.subscriptions,g=0;g<t.length;g++){var M=t[g];s.emit(M.name,M);}},o.prototype.attach=function(t,s){var g;if(typeof t=="function"?(s=t,g=null):g=t,!s){if(this.realtime.options.promises)return O.promisify(this,"attach",arguments);s=function(M){M&&E.default.logAction(E.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+M.toString());};}if(g)E.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=g;else if(this.state==="attached"){s();return}this._attach(!1,null,s);},o.prototype._attach=function(t,s,g){g||(g=function(U){U&&E.default.logAction(E.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+U.toString());});var M=this.connectionManager;if(!M.activeState()){g(M.getError());return}(this.state!=="attaching"||t)&&this.requestState("attaching",s),this.once(function(U){switch(this.event){case"attached":g==null||g();break;case"detached":case"suspended":case"failed":g==null||g(U.reason||M.getError()||new r.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":g==null||g(new r.default("Attach request superseded by a subsequent detach request",9e4,409));break}});},o.prototype.attachImpl=function(){E.default.logAction(E.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(c,!0);var t=i.default.fromValues({action:m.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?t.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&t.encodeModesToFlags(O.allToUpperCase(this.channelOptions.modes)),this._attachResume&&t.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(t.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(t,u);},o.prototype.detach=function(t){if(!t){if(this.realtime.options.promises)return O.promisify(this,"detach",arguments);t=u;}var s=this.connectionManager;if(!s.activeState()){t(s.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),t();break;case"detached":t();break;case"failed":t(new r.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(g){switch(this.event){case"detached":t();break;case"attached":case"suspended":case"failed":t(g.reason||s.getError()||new r.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":t(new r.default("Detach request superseded by a subsequent attach request",9e4,409));break}});}},o.prototype.detachImpl=function(t){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),E.default.logAction(E.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(c,!0);var s=i.default.fromValues({action:m.DETACH,channel:this.name});this.sendMessage(s,t||u);},o.prototype.subscribe=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];var g=o.processListenerArgs(t),M=g[0],U=g[1],b=g[2];if(!b&&this.realtime.options.promises)return O.promisify(this,"subscribe",[M,U]);if(this.state==="failed"){b==null||b(r.default.fromValues(o.invalidStateError("failed")));return}return this.subscriptions.on(M,U),this.attach(b||u)},o.prototype.unsubscribe=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];var g=o.processListenerArgs(t),M=g[0],U=g[1];this.subscriptions.off(M,U);},o.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new r.default("Unable to sync to channel; not attached",4e4);}var t=this.connectionManager;if(!t.activeState())throw t.getError();var s=i.default.fromValues({action:m.SYNC,channel:this.name});this.syncChannelSerial&&(s.channelSerial=this.syncChannelSerial),t.send(s);},o.prototype.sendMessage=function(t,s){this.connectionManager.send(t,this.realtime.options.queueMessages,s);},o.prototype.sendPresence=function(t,s){var g=i.default.fromValues({action:m.PRESENCE,channel:this.name,presence:O.isArray(t)?p.default.fromValuesArray(t):[p.default.fromValues(t)]});this.sendMessage(g,s);},o.prototype.onMessage=function(t){var s,g=!1;switch(t.action){case m.ATTACHED:{this._attachedMsgIndicator=!0,this.properties.attachSerial=t.channelSerial,this._mode=t.getMode(),this.params=t.params||{};var M=t.decodeModesFromFlags();this.modes=M&&O.allToLowerCase(M)||void 0;var U=t.hasFlag("RESUMED"),b=t.hasFlag("HAS_PRESENCE");if(this.state==="attached"){this.setInProgress(c,!1),U||this.presence.onAttached(b);var x=new C.default(this.state,this.state,U,t.error);this._allChannelChanges.emit("update",x),(!U||this.channelOptions.updateOnAttached)&&this.emit("update",x);}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",t.error,U,b);break}case m.DETACHED:{var d=t.error?r.default.fromValues(t.error):new r.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",d):this.state==="attaching"?this.notifyState("suspended",d):this.requestState("attaching",d);break}case m.SYNC:if(g=!0,s=this.syncChannelSerial=t.channelSerial,!t.presence)break;case m.PRESENCE:{for(var A=t.presence,B=t.id,N=t.connectionId,j=t.timestamp,F=this.channelOptions,I=void 0,L=0;L<A.length;L++)try{I=A[L],p.default.decode(I,F),I.connectionId||(I.connectionId=N),I.timestamp||(I.timestamp=j),I.id||(I.id=B+":"+L);}catch(Q){E.default.logAction(E.default.LOG_ERROR,"RealtimeChannel.onMessage()",Q.toString());}this.presence.setPresence(A,g,s);break}case m.MESSAGE:{if(this.state!=="attached"){E.default.logAction(E.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+t.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var S=t.messages,G=S[0],W=S[S.length-1],B=t.id,N=t.connectionId,j=t.timestamp;if(G.extras&&G.extras.delta&&G.extras.delta.from!==this._lastPayload.messageId){var H='Delta message decode failure - previous message not available for message "'+t.id+'" on this channel "'+this.name+'".';E.default.logAction(E.default.LOG_ERROR,"RealtimeChannel.onMessage()",H),this._startDecodeFailureRecovery(new r.default(H,40018,400));break}for(var L=0;L<S.length;L++){var H=S[L];try{y.default.decode(H,this._decodingContext);}catch($){switch(E.default.logAction(E.default.LOG_ERROR,"RealtimeChannel.onMessage()",$.toString()),$.code){case 40018:this._startDecodeFailureRecovery($);return;case 40019:case 40021:this.notifyState("failed",$);return}}H.connectionId||(H.connectionId=N),H.timestamp||(H.timestamp=j),H.id||(H.id=B+":"+L);}this._lastPayload.messageId=W.id,this._lastPayload.protocolMessageChannelSerial=t.channelSerial,this.onEvent(S);break}case m.ERROR:{var z=t.error;z&&z.code==80016?this.checkPendingState():this.notifyState("failed",r.default.fromValues(z));break}default:E.default.logAction(E.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+t.action+")"),this.connectionManager.abort(T.default.unknownChannelErr);}},o.prototype._startDecodeFailureRecovery=function(t){var s=this;this._lastPayload.decodeFailureRecoveryInProgress||(E.default.logAction(E.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,t,function(){s._lastPayload.decodeFailureRecoveryInProgress=!1;}));},o.prototype.onAttached=function(){E.default.logAction(E.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name);},o.prototype.notifyState=function(t,s,g,M){if(E.default.logAction(E.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+t),this.clearStateTimer(),t!==this.state){this.presence.actOnChannelState(t,M,s),t==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),s&&(this.errorReason=s);var U=new C.default(this.state,t,g,s),b=t==="failed"?E.default.LOG_ERROR:E.default.LOG_MAJOR;E.default.logAction(b,'Channel state for channel "'+this.name+'"',t+(s?"; reason: "+s:"")),t==="attached"?(this.onAttached(),this.setInProgress(h,M),this.setInProgress(c,!1)):(t==="detached"||t==="failed"||t==="suspended")&&(this.setInProgress(c,!1),this.setInProgress(h,!1)),t==="attached"?this._attachResume=!0:(t==="detaching"||t==="failed")&&(this._attachResume=!1),this.state=t,this._allChannelChanges.emit(t,U),this.emit(t,U);}},o.prototype.requestState=function(t,s){E.default.logAction(E.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+t),this.notifyState(t,s),this.checkPendingState();},o.prototype.checkPendingState=function(){var t=this.connectionManager.state;if(!(t.sendEvents||t.forceQueueEvents)){E.default.logAction(E.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(E.default.logAction(E.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break;}},o.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var t=new r.default("Channel attach timed out",90007,408);this.notifyState("suspended",t);break}case"detaching":{var t=new r.default("Channel detach timed out",90007,408);this.notifyState("attached",t);break}default:this.checkPendingState();break}},o.prototype.startStateTimerIfNotRunning=function(){var t=this;this.stateTimer||(this.stateTimer=setTimeout(function(){E.default.logAction(E.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),t.stateTimer=null,t.timeoutPendingState();},this.realtime.options.timeouts.realtimeRequestTimeout));},o.prototype.clearStateTimer=function(){var t=this.stateTimer;t&&(clearTimeout(t),this.stateTimer=null);},o.prototype.startRetryTimer=function(){var t=this;this.retryTimer||(this.retryTimer=setTimeout(function(){t.state==="suspended"&&t.connectionManager.state.sendEvents&&(t.retryTimer=null,E.default.logAction(E.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),t.requestState("attaching"));},this.realtime.options.timeouts.channelRetryTimeout));},o.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null);},o.prototype.setInProgress=function(t,s){this.rest.channels.setInProgress(this,t,s);},o.prototype.getReleaseErr=function(){var t=this.state;return t==="initialized"||t==="detached"||t==="failed"?null:new r.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+t,90001,400)},o.progressOps={statechange:c,sync:h},o}(R.default);l.default=a;},function(D,l,f){l.__esModule=!0;var v=function(){function i(P,O,R,E){this.previous=P,this.current=O,O==="attached"&&(this.resumed=R),E&&(this.reason=E);}return i}();l.default=v;},function(D,l,f){(function(v,i){D.exports=i(f(6));})(this,function(v){return function(){var i=v,P=i.lib,O=P.WordArray,R=P.Hasher,E=i.algo,w=[],y=E.SHA1=R.extend({_doReset:function(){this._hash=new O.init([1732584193,4023233417,2562383102,271733878,3285377520]);},_doProcessBlock:function(C,r){for(var p=this._hash.words,T=p[0],m=p[1],u=p[2],c=p[3],h=p[4],e=0;e<80;e++){if(e<16)w[e]=C[r+e]|0;else {var a=w[e-3]^w[e-8]^w[e-14]^w[e-16];w[e]=a<<1|a>>>31;}var n=(T<<5|T>>>27)+h+w[e];e<20?n+=(m&u|~m&c)+1518500249:e<40?n+=(m^u^c)+1859775393:e<60?n+=(m&u|m&c|u&c)-1894007588:n+=(m^u^c)-899497514,h=c,c=u,u=m<<30|m>>>2,m=T,T=n;}p[0]=p[0]+T|0,p[1]=p[1]+m|0,p[2]=p[2]+u|0,p[3]=p[3]+c|0,p[4]=p[4]+h|0;},_doFinalize:function(){var C=this._data,r=C.words,p=this._nDataBytes*8,T=C.sigBytes*8;return r[T>>>5]|=128<<24-T%32,r[(T+64>>>9<<4)+14]=Math.floor(p/4294967296),r[(T+64>>>9<<4)+15]=p,C.sigBytes=r.length*4,this._process(),this._hash},clone:function(){var C=R.clone.call(this);return C._hash=this._hash.clone(),C}});i.SHA1=R._createHelper(y),i.HmacSHA1=R._createHmacHelper(y);}(),v.SHA1});},function(D,l,f){l.__esModule=!0;function v(e){if(e===void 0)return "undefined";var a,n;if(e instanceof ArrayBuffer?(n="ArrayBuffer",a=new DataView(e)):e instanceof DataView&&(n="DataView",a=e),!a)return JSON.stringify(e);for(var o=[],t=0;t<e.byteLength;t++){if(t>20){o.push("...");break}var s=a.getUint8(t).toString(16);s.length===1&&(s="0"+s),o.push(s);}return "<"+n+" "+o.join(" ")+">"}function i(e,a,n){for(var o=0,t=n.length;o<t;o++){var s=n.charCodeAt(o);if(s<128){e.setUint8(a++,s>>>0&127|0);continue}if(s<2048){e.setUint8(a++,s>>>6&31|192),e.setUint8(a++,s>>>0&63|128);continue}if(s<65536){e.setUint8(a++,s>>>12&15|224),e.setUint8(a++,s>>>6&63|128),e.setUint8(a++,s>>>0&63|128);continue}if(s<1114112){e.setUint8(a++,s>>>18&7|240),e.setUint8(a++,s>>>12&63|128),e.setUint8(a++,s>>>6&63|128),e.setUint8(a++,s>>>0&63|128);continue}throw new Error("bad codepoint "+s)}}function P(e,a,n){for(var o="",t=a,s=a+n;t<s;t++){var g=e.getUint8(t);if((g&128)===0){o+=String.fromCharCode(g);continue}if((g&224)===192){o+=String.fromCharCode((g&15)<<6|e.getUint8(++t)&63);continue}if((g&240)===224){o+=String.fromCharCode((g&15)<<12|(e.getUint8(++t)&63)<<6|(e.getUint8(++t)&63)<<0);continue}if((g&248)===240){o+=String.fromCharCode((g&7)<<18|(e.getUint8(++t)&63)<<12|(e.getUint8(++t)&63)<<6|(e.getUint8(++t)&63)<<0);continue}throw new Error("Invalid byte "+g.toString(16))}return o}function O(e){for(var a=0,n=0,o=e.length;n<o;n++){var t=e.charCodeAt(n);if(t<128){a+=1;continue}if(t<2048){a+=2;continue}if(t<65536){a+=3;continue}if(t<1114112){a+=4;continue}throw new Error("bad codepoint "+t)}return a}function R(e,a){var n=h(e,a);if(n!==0){var o=new ArrayBuffer(n),t=new DataView(o);return c(e,t,0,a),o}}var E=(1<<16)*(1<<16),w=1/E;function y(e,a){return a=a||0,e.getInt32(a)*E+e.getUint32(a+4)}function C(e,a){return a=a||0,e.getUint32(a)*E+e.getUint32(a+4)}function r(e,a,n){n<9223372036854776e3?(e.setInt32(a,Math.floor(n*w)),e.setInt32(a+4,n&-1)):(e.setUint32(a,2147483647),e.setUint32(a+4,2147483647));}function p(e,a,n){n<18446744073709552e3?(e.setUint32(a,Math.floor(n*w)),e.setInt32(a+4,n&-1)):(e.setUint32(a,4294967295),e.setUint32(a+4,4294967295));}var T=function(){function e(a,n){var o=this;this.map=function(t){for(var s={},g=0;g<t;g++){var M=o.parse();s[M]=o.parse();}return s},this.bin=function(t){var s=new ArrayBuffer(t);return new Uint8Array(s).set(new Uint8Array(o.view.buffer,o.offset,t),0),o.offset+=t,s},this.buf=this.bin,this.str=function(t){var s=P(o.view,o.offset,t);return o.offset+=t,s},this.array=function(t){for(var s=new Array(t),g=0;g<t;g++)s[g]=o.parse();return s},this.ext=function(t){return o.offset+=t,{type:o.view.getInt8(o.offset),data:o.buf(t)}},this.parse=function(){var t=o.view.getUint8(o.offset),s,g;if((t&128)===0)return o.offset++,t;if((t&240)===128)return g=t&15,o.offset++,o.map(g);if((t&240)===144)return g=t&15,o.offset++,o.array(g);if((t&224)===160)return g=t&31,o.offset++,o.str(g);if((t&224)===224)return s=o.view.getInt8(o.offset),o.offset++,s;switch(t){case 192:return o.offset++,null;case 193:o.offset++;return;case 194:return o.offset++,!1;case 195:return o.offset++,!0;case 196:return g=o.view.getUint8(o.offset+1),o.offset+=2,o.bin(g);case 197:return g=o.view.getUint16(o.offset+1),o.offset+=3,o.bin(g);case 198:return g=o.view.getUint32(o.offset+1),o.offset+=5,o.bin(g);case 199:return g=o.view.getUint8(o.offset+1),o.offset+=2,o.ext(g);case 200:return g=o.view.getUint16(o.offset+1),o.offset+=3,o.ext(g);case 201:return g=o.view.getUint32(o.offset+1),o.offset+=5,o.ext(g);case 202:return s=o.view.getFloat32(o.offset+1),o.offset+=5,s;case 203:return s=o.view.getFloat64(o.offset+1),o.offset+=9,s;case 204:return s=o.view.getUint8(o.offset+1),o.offset+=2,s;case 205:return s=o.view.getUint16(o.offset+1),o.offset+=3,s;case 206:return s=o.view.getUint32(o.offset+1),o.offset+=5,s;case 207:return s=C(o.view,o.offset+1),o.offset+=9,s;case 208:return s=o.view.getInt8(o.offset+1),o.offset+=2,s;case 209:return s=o.view.getInt16(o.offset+1),o.offset+=3,s;case 210:return s=o.view.getInt32(o.offset+1),o.offset+=5,s;case 211:return s=y(o.view,o.offset+1),o.offset+=9,s;case 212:return g=1,o.offset++,o.ext(g);case 213:return g=2,o.offset++,o.ext(g);case 214:return g=4,o.offset++,o.ext(g);case 215:return g=8,o.offset++,o.ext(g);case 216:return g=16,o.offset++,o.ext(g);case 217:return g=o.view.getUint8(o.offset+1),o.offset+=2,o.str(g);case 218:return g=o.view.getUint16(o.offset+1),o.offset+=3,o.str(g);case 219:return g=o.view.getUint32(o.offset+1),o.offset+=5,o.str(g);case 220:return g=o.view.getUint16(o.offset+1),o.offset+=3,o.array(g);case 221:return g=o.view.getUint32(o.offset+1),o.offset+=5,o.array(g);case 222:return g=o.view.getUint16(o.offset+1),o.offset+=3,o.map(g);case 223:return g=o.view.getUint32(o.offset+1),o.offset+=5,o.map(g)}throw new Error("Unknown type 0x"+t.toString(16))},this.offset=n||0,this.view=a;}return e}();function m(e){var a=new DataView(e),n=new T(a),o=n.parse();if(n.offset!==e.byteLength)throw new Error(e.byteLength-n.offset+" trailing bytes");return o}function u(e,a){return Object.keys(e).filter(function(n){var o=e[n],t=typeof o;return (!a||o!=null)&&(t!=="function"||!!o.toJSON)})}function c(e,a,n,o){var t=typeof e;if(typeof e=="string"){var s=O(e);if(s<32)return a.setUint8(n,s|160),i(a,n+1,e),1+s;if(s<256)return a.setUint8(n,217),a.setUint8(n+1,s),i(a,n+2,e),2+s;if(s<65536)return a.setUint8(n,218),a.setUint16(n+1,s),i(a,n+3,e),3+s;if(s<4294967296)return a.setUint8(n,219),a.setUint32(n+1,s),i(a,n+5,e),5+s}if(ArrayBuffer.isView&&ArrayBuffer.isView(e)&&(e=e.buffer),e instanceof ArrayBuffer){var g=e.byteLength;if(g<256)return a.setUint8(n,196),a.setUint8(n+1,g),new Uint8Array(a.buffer).set(new Uint8Array(e),n+2),2+g;if(g<65536)return a.setUint8(n,197),a.setUint16(n+1,g),new Uint8Array(a.buffer).set(new Uint8Array(e),n+3),3+g;if(g<4294967296)return a.setUint8(n,198),a.setUint32(n+1,g),new Uint8Array(a.buffer).set(new Uint8Array(e),n+5),5+g}if(typeof e=="number"){if(Math.floor(e)!==e)return a.setUint8(n,203),a.setFloat64(n+1,e),9;if(e>=0){if(e<128)return a.setUint8(n,e),1;if(e<256)return a.setUint8(n,204),a.setUint8(n+1,e),2;if(e<65536)return a.setUint8(n,205),a.setUint16(n+1,e),3;if(e<4294967296)return a.setUint8(n,206),a.setUint32(n+1,e),5;if(e<18446744073709552e3)return a.setUint8(n,207),p(a,n+1,e),9;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return a.setInt8(n,e),1;if(e>=-128)return a.setUint8(n,208),a.setInt8(n+1,e),2;if(e>=-32768)return a.setUint8(n,209),a.setInt16(n+1,e),3;if(e>=-2147483648)return a.setUint8(n,210),a.setInt32(n+1,e),5;if(e>=-9223372036854776e3)return a.setUint8(n,211),r(a,n+1,e),9;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(t==="undefined")return o?0:(a.setUint8(n,212),a.setUint8(n+1,0),a.setUint8(n+2,0),3);if(e===null)return o?0:(a.setUint8(n,192),1);if(t==="boolean")return a.setUint8(n,e?195:194),1;if(typeof e.toJSON=="function")return c(e.toJSON(),a,n,o);if(t==="object"){var M,U=0,b=void 0,x=Array.isArray(e);if(x?M=e.length:(b=u(e,o),M=b.length),M<16?(a.setUint8(n,M|(x?144:128)),U=1):M<65536?(a.setUint8(n,x?220:222),a.setUint16(n+1,M),U=3):M<4294967296&&(a.setUint8(n,x?221:223),a.setUint32(n+1,M),U=5),x)for(var d=0;d<M;d++)U+=c(e[d],a,n+U,o);else if(b)for(var d=0;d<M;d++){var A=b[d];U+=c(A,a,n+U),U+=c(e[A],a,n+U,o);}return U}if(t==="function")return 0;throw new Error("Unknown type "+t)}function h(e,a){var n=typeof e;if(n==="string"){var o=O(e);if(o<32)return 1+o;if(o<256)return 2+o;if(o<65536)return 3+o;if(o<4294967296)return 5+o}if(ArrayBuffer.isView&&ArrayBuffer.isView(e)&&(e=e.buffer),e instanceof ArrayBuffer){var t=e.byteLength;if(t<256)return 2+t;if(t<65536)return 3+t;if(t<4294967296)return 5+t}if(typeof e=="number"){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;if(e<18446744073709552e3)return 9;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;if(e>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if(n==="boolean")return 1;if(e===null)return a?0:1;if(e===void 0)return a?0:3;if(typeof e.toJSON=="function")return h(e.toJSON(),a);if(n==="object"){var s,g=0;if(Array.isArray(e)){s=e.length;for(var M=0;M<s;M++)g+=h(e[M],a);}else {var U=u(e,a);s=U.length;for(var M=0;M<s;M++){var b=U[M];g+=h(b)+h(e[b],a);}}if(s<16)return 1+g;if(s<65536)return 3+g;if(s<4294967296)return 5+g;throw new Error("Array or object too long 0x"+s.toString(16))}if(n==="function")return 0;throw new Error("Unknown type "+n)}l.default={encode:R,decode:m,inspect:v,utf8Write:i,utf8Read:P,utf8ByteCount:O};},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importDefault(f(30)),P=v.__importDefault(f(50)),O=v.__importDefault(f(3)),R=v.__importDefault(f(56)),E=v.__importDefault(f(58)),w=v.__importDefault(f(63)),y=v.__importDefault(f(9)),C=v.__importDefault(f(67)),r=v.__importDefault(f(0)),p=f(8),T=v.__importDefault(f(26)),m=v.__importDefault(f(64)),u=v.__importDefault(f(65)),c=v.__importDefault(f(41)),h=v.__importDefault(f(11)),e=v.__importDefault(f(15));O.default.Crypto=E.default,O.default.BufferUtils=R.default,O.default.Http=w.default,O.default.Config=y.default,O.default.Transports=C.default,O.default.WebStorage=m.default,i.default.Crypto=E.default,P.default.Crypto=E.default,i.default.Message=h.default,P.default.Message=h.default,i.default.PresenceMessage=e.default,P.default.PresenceMessage=e.default,P.default.ConnectionManager=T.default,r.default.initLogHandlers(),O.default.Defaults=p.getDefaults(u.default),O.default.Config.agent&&(O.default.Defaults.agent+=" "+O.default.Config.agent),O.default.Config.noUpgrade&&(O.default.Defaults.upgradeTransports=[]),l.default={Rest:i.default,Realtime:P.default,msgpack:c.default};},function(D){D.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.25","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^3.5.2","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js"}}');},function(D,l,f){(function(v,i){D.exports=i(f(6),f(31),f(24));})(this,function(v){return v.HmacSHA256});},function(D,l){},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=v.__importDefault(f(47)),O=v.__importDefault(f(25)),R=v.__importDefault(f(19)),E=v.__importDefault(f(5)),w=v.__importDefault(f(48)),y=function(){},C=function(){function m(u){this.rest=u,this.admin=new r(u);}return m}(),r=function(){function m(u){this.rest=u,this.deviceRegistrations=new p(u),this.channelSubscriptions=new T(u);}return m.prototype.publish=function(u,c,h){var e=this.rest,a=e.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,n=i.defaultPostHeaders(a),o={},t=i.mixin({recipient:u},c);if(typeof h!="function"){if(this.rest.options.promises)return i.promisify(this,"publish",arguments);h=y;}e.options.headers&&i.mixin(n,e.options.headers),e.options.pushFullWait&&i.mixin(o,{fullWait:"true"});var s=i.encodeBody(t,a);O.default.post(e,"/push/publish",s,n,o,null,function(g){return h(g)});},m}(),p=function(){function m(u){this.rest=u;}return m.prototype.save=function(u,c){var h=this.rest,e=P.default.fromValues(u),a=h.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,n=i.defaultPostHeaders(a),o={};if(typeof c!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);c=y;}h.options.headers&&i.mixin(n,h.options.headers),h.options.pushFullWait&&i.mixin(o,{fullWait:"true"});var t=i.encodeBody(e,a);O.default.put(h,"/push/deviceRegistrations/"+encodeURIComponent(u.id),t,n,o,null,function(s,g,M,U){c(s,s?void 0:P.default.fromResponseBody(g,U?void 0:a));});},m.prototype.get=function(u,c){var h=this.rest,e=h.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,a=i.defaultGetHeaders(e),n=u.id||u;if(typeof c!="function"){if(this.rest.options.promises)return i.promisify(this,"get",arguments);c=y;}if(typeof n!="string"||!n.length){c(new E.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}h.options.headers&&i.mixin(a,h.options.headers),O.default.get(h,"/push/deviceRegistrations/"+encodeURIComponent(n),a,{},null,function(o,t,s,g){c(o,o?void 0:P.default.fromResponseBody(t,g?void 0:e));});},m.prototype.list=function(u,c){var h=this.rest,e=h.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,a=this.rest.http.supportsLinkHeaders?void 0:e,n=i.defaultGetHeaders(e);if(typeof c!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);c=y;}h.options.headers&&i.mixin(n,h.options.headers),new R.default(h,"/push/deviceRegistrations",n,a,function(o,t,s){return P.default.fromResponseBody(o,s?void 0:e)}).get(u,c);},m.prototype.remove=function(u,c){var h=this.rest,e=h.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,a=i.defaultGetHeaders(e),n={},o=u.id||u;if(typeof c!="function"){if(this.rest.options.promises)return i.promisify(this,"remove",arguments);c=y;}if(typeof o!="string"||!o.length){c(new E.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}h.options.headers&&i.mixin(a,h.options.headers),h.options.pushFullWait&&i.mixin(n,{fullWait:"true"}),O.default.delete(h,"/push/deviceRegistrations/"+encodeURIComponent(o),a,n,null,function(t){return c(t)});},m.prototype.removeWhere=function(u,c){var h=this.rest,e=h.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,a=i.defaultGetHeaders(e);if(typeof c!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);c=y;}h.options.headers&&i.mixin(a,h.options.headers),h.options.pushFullWait&&i.mixin(u,{fullWait:"true"}),O.default.delete(h,"/push/deviceRegistrations",a,u,null,function(n){return c(n)});},m}(),T=function(){function m(u){this.remove=m.prototype.removeWhere,this.rest=u;}return m.prototype.save=function(u,c){var h=this.rest,e=w.default.fromValues(u),a=h.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,n=i.defaultPostHeaders(a),o={};if(typeof c!="function"){if(this.rest.options.promises)return i.promisify(this,"save",arguments);c=y;}h.options.headers&&i.mixin(n,h.options.headers),h.options.pushFullWait&&i.mixin(o,{fullWait:"true"});var t=i.encodeBody(e,a);O.default.post(h,"/push/channelSubscriptions",t,n,o,null,function(s,g,M,U){c(s,!s&&w.default.fromResponseBody(g,U?void 0:a));});},m.prototype.list=function(u,c){var h=this.rest,e=h.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,a=this.rest.http.supportsLinkHeaders?void 0:e,n=i.defaultGetHeaders(e);if(typeof c!="function"){if(this.rest.options.promises)return i.promisify(this,"list",arguments);c=y;}h.options.headers&&i.mixin(n,h.options.headers),new R.default(h,"/push/channelSubscriptions",n,a,function(o,t,s){return w.default.fromResponseBody(o,s?void 0:e)}).get(u,c);},m.prototype.removeWhere=function(u,c){var h=this.rest,e=h.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,a=i.defaultGetHeaders(e);if(typeof c!="function"){if(this.rest.options.promises)return i.promisify(this,"removeWhere",arguments);c=y;}h.options.headers&&i.mixin(a,h.options.headers),h.options.pushFullWait&&i.mixin(u,{fullWait:"true"}),O.default.delete(h,"/push/channelSubscriptions",a,u,null,function(n){return c(n)});},m.prototype.listChannels=function(u,c){var h=this.rest,e=h.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,a=this.rest.http.supportsLinkHeaders?void 0:e,n=i.defaultGetHeaders(e);if(typeof c!="function"){if(this.rest.options.promises)return i.promisify(this,"listChannels",arguments);c=y;}h.options.headers&&i.mixin(n,h.options.headers),h.options.pushFullWait&&i.mixin(u,{fullWait:"true"}),new R.default(h,"/push/channels",n,a,function(o,t,s){for(var g=!s&&e?i.decodeBody(o,e):o,M=0;M<g.length;M++)g[M]=String(g[M]);return g}).get(u,c);},m}();l.default=C;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=v.__importDefault(f(5)),O;(function(w){w.Phone="phone",w.Tablet="tablet",w.Desktop="desktop",w.TV="tv",w.Watch="watch",w.Car="car",w.Embedded="embedded",w.Other="other";})(O||(O={}));var R;(function(w){w.Android="android",w.IOS="ios",w.Browser="browser";})(R||(R={}));var E=function(){function w(){}return w.prototype.toJSON=function(){var y,C,r;return {id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(y=this.push)===null||y===void 0?void 0:y.recipient,state:(C=this.push)===null||C===void 0?void 0:C.state,error:(r=this.push)===null||r===void 0?void 0:r.error}}},w.prototype.toString=function(){var y,C,r,p,T="[DeviceDetails";return this.id&&(T+="; id="+this.id),this.platform&&(T+="; platform="+this.platform),this.formFactor&&(T+="; formFactor="+this.formFactor),this.clientId&&(T+="; clientId="+this.clientId),this.metadata&&(T+="; metadata="+this.metadata),this.deviceIdentityToken&&(T+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((y=this.push)===null||y===void 0)&&y.recipient&&(T+="; push.recipient="+JSON.stringify(this.push.recipient)),!((C=this.push)===null||C===void 0)&&C.state&&(T+="; push.state="+this.push.state),!((r=this.push)===null||r===void 0)&&r.error&&(T+="; push.error="+JSON.stringify(this.push.error)),!((p=this.push)===null||p===void 0)&&p.metadata&&(T+="; push.metadata="+this.push.metadata),T+="]",T},w.fromResponseBody=function(y,C){return C&&(y=i.decodeBody(y,C)),i.isArray(y)?w.fromValuesArray(y):w.fromValues(y)},w.fromValues=function(y){return y.error=y.error&&P.default.fromValues(y.error),Object.assign(new w,y)},w.fromValuesArray=function(y){for(var C=y.length,r=new Array(C),p=0;p<C;p++)r[p]=w.fromValues(y[p]);return r},w.toRequestBody=i.encodeBody,w}();l.default=E;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=function(){function O(){}return O.prototype.toJSON=function(){return {channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},O.prototype.toString=function(){var R="[PushChannelSubscription";return this.channel&&(R+="; channel="+this.channel),this.deviceId&&(R+="; deviceId="+this.deviceId),this.clientId&&(R+="; clientId="+this.clientId),R+="]",R},O.fromResponseBody=function(R,E){return E&&(R=i.decodeBody(R,E)),i.isArray(R)?O.fromValuesArray(R):O.fromValues(R)},O.fromValues=function(R){return Object.assign(new O,R)},O.fromValuesArray=function(R){for(var E=R.length,w=new Array(E),y=0;y<E;y++)w[y]=O.fromValues(R[y]);return w},O.toRequestBody=i.encodeBody,O}();l.default=P;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=function(){function h(e){this.count=e&&e.count||0,this.data=e&&e.data||0,this.uncompressedData=e&&e.uncompressedData||0,this.failed=e&&e.failed||0,this.refused=e&&e.refused||0;}return h}(),O=function(h){v.__extends(e,h);function e(a){var n=h.call(this,a)||this;return a&&a.category&&(n.category={},i.forInOwnNonNullProperties(a.category,function(o){n.category[o]=new P(a.category[o]);})),n}return e}(P),R=function(){function h(e){this.peak=e&&e.peak||0,this.min=e&&e.min||0,this.mean=e&&e.mean||0,this.opened=e&&e.opened||0,this.refused=e&&e.refused||0;}return h}(),E=function(){function h(e){this.succeeded=e&&e.succeeded||0,this.failed=e&&e.failed||0,this.refused=e&&e.refused||0;}return h}(),w=function(){function h(e){this.plain=new R(e&&e.plain),this.tls=new R(e&&e.tls),this.all=new R(e&&e.all);}return h}(),y=function(){function h(e){this.messages=new O(e&&e.messages),this.presence=new O(e&&e.presence),this.all=new O(e&&e.all);}return h}(),C=function(){function h(e){this.realtime=new y(e&&e.realtime),this.rest=new y(e&&e.rest),this.webhook=new y(e&&e.webhook),this.sharedQueue=new y(e&&e.sharedQueue),this.externalQueue=new y(e&&e.externalQueue),this.httpEvent=new y(e&&e.httpEvent),this.push=new y(e&&e.push),this.all=new y(e&&e.all);}return h}(),r=function(){function h(e){this.all=new y(e&&e.all),this.inbound=new C(e&&e.inbound),this.outbound=new C(e&&e.outbound);}return h}(),p=function(){function h(e){this.all=new y(e&&e.all),this.producerPaid=new r(e&&e.producerPaid),this.consumerPaid=new r(e&&e.consumerPaid);}return h}(),T=function(){function h(e){this.messages=e&&e.messages||0;var a=e&&e.notifications;this.notifications={invalid:a&&a.invalid||0,attempted:a&&a.attempted||0,successful:a&&a.successful||0,failed:a&&a.failed||0},this.directPublishes=e&&e.directPublishes||0;}return h}(),m=function(){function h(e){this.succeeded=e&&e.succeeded||0,this.skipped=e&&e.skipped||0,this.failed=e&&e.failed||0;}return h}(),u=function(){function h(e){var a=this;this.delta=void 0,e&&e.delta&&(this.delta={},i.forInOwnNonNullProperties(e.delta,function(n){a.delta[n]=new m(e.delta[n]);}));}return h}(),c=function(h){v.__extends(e,h);function e(a){var n=h.call(this,a)||this;return n.persisted=new y(a&&a.persisted),n.connections=new w(a&&a.connections),n.channels=new R(a&&a.channels),n.apiRequests=new E(a&&a.apiRequests),n.tokenRequests=new E(a&&a.tokenRequests),n.xchgProducer=new p(a&&a.xchgProducer),n.xchgConsumer=new p(a&&a.xchgConsumer),n.push=new T(a&&a.pushStats),n.processed=new u(a&&a.processed),n.inProgress=a&&a.inProgress||void 0,n.unit=a&&a.unit||void 0,n.intervalId=a&&a.intervalId||void 0,n}return e.fromValues=function(a){return new e(a)},e}(r);l.default=c;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=v.__importDefault(f(30)),O=v.__importDefault(f(7)),R=v.__importDefault(f(0)),E=v.__importDefault(f(51)),w=v.__importDefault(f(38)),y=v.__importDefault(f(8)),C=v.__importDefault(f(5)),r=v.__importDefault(f(12)),p=v.__importDefault(f(26)),T=v.__importDefault(f(3)),m=v.__importDefault(f(11)),u=function(h){v.__extends(e,h);function e(a){var n=h.call(this,a)||this;return R.default.logAction(R.default.LOG_MINOR,"Realtime()",""),n.connection=new E.default(n,n.options),n.channels=new c(n),a.autoConnect!==!1&&n.connect(),n}return e.prototype.connect=function(){R.default.logAction(R.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect();},e.prototype.close=function(){R.default.logAction(R.default.LOG_MINOR,"Realtime.close()",""),this.connection.close();},e.Promise=function(a){return a=y.default.objectifyOptions(a),a.promises=!0,new e(a)},e.Callbacks=e,e.Utils=i,e.ConnectionManager=p.default,e.Platform=T.default,e.ProtocolMessage=r.default,e.Message=m.default,e}(P.default),c=function(h){v.__extends(e,h);function e(a){var n=h.call(this)||this;return n.realtime=a,n.all={},n.inProgress={},a.connection.connectionManager.on("transport.active",function(){n.onTransportActive();}),n}return e.prototype.onChannelMessage=function(a){var n=a.channel;if(n===void 0){R.default.logAction(R.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+a.action);return}var o=this.all[n];if(!o){R.default.logAction(R.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+n);return}o.onMessage(a);},e.prototype.onTransportActive=function(){for(var a in this.all){var n=this.all[a];n.state==="attaching"||n.state==="detaching"?n.checkPendingState():n.state==="suspended"&&n.attach();}},e.prototype.reattach=function(a){for(var n in this.all){var o=this.all[n];o.state==="attached"&&o.requestState("attaching",a);}},e.prototype.resetAttachedMsgIndicators=function(){for(var a in this.all){var n=this.all[a];n.state==="attached"&&(n._attachedMsgIndicator=!1);}},e.prototype.checkAttachedMsgIndicators=function(a){for(var n in this.all){var o=this.all[n];if(o.state==="attached"&&o._attachedMsgIndicator===!1){var t="30s after a resume, found channel which has not received an attached; channelId = "+n+"; connectionId = "+a;R.default.logAction(R.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",t),o.requestState("attaching");}}},e.prototype.propogateConnectionInterruption=function(a,n){var o={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},t=["attaching","attached","detaching","suspended"],s=o[a];for(var g in this.all){var M=this.all[g];i.arrIn(t,M.state)&&M.notifyState(s,n);}},e.prototype.get=function(a,n){a=String(a);var o=this.all[a];if(!o)o=this.all[a]=new w.default(this.realtime,a,n);else if(n){if(o._shouldReattachToSetOptions(n))throw new C.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);o.setOptions(n);}return o},e.prototype.release=function(a){a=String(a);var n=this.all[a];if(!!n){var o=n.getReleaseErr();if(o)throw o;delete this.all[a],delete this.inProgress[a];}},e.prototype.setInProgress=function(a,n,o){this.inProgress[a.name]=this.inProgress[a.name]||{},this.inProgress[a.name][n]=o,!o&&this.hasNopending()&&this.emit("nopending");},e.prototype.onceNopending=function(a){if(this.hasNopending()){a();return}this.once("nopending",a);},e.prototype.hasNopending=function(){return i.arrEvery(i.valuesArray(this.inProgress,!0),function(a){return !i.containsValue(a,!0)})},e}(O.default);l.default=u;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=v.__importDefault(f(7)),O=v.__importDefault(f(26)),R=v.__importDefault(f(0)),E=v.__importDefault(f(36)),w=v.__importDefault(f(3));function y(){}var C=function(r){v.__extends(p,r);function p(T,m){var u=r.call(this)||this;return u.whenState=function(c,h){return P.default.prototype.whenState.call(u,c,u.state,h,new E.default(void 0,c))},u.ably=T,u.connectionManager=new O.default(T,m),u.state=u.connectionManager.state.state,u.key=void 0,u.id=void 0,u.serial=void 0,u.timeSerial=void 0,u.recoveryKey=void 0,u.errorReason=null,u.connectionManager.on("connectionstate",function(c){var h=u.state=c.current;w.default.Config.nextTick(function(){u.emit(h,c);});}),u.connectionManager.on("update",function(c){w.default.Config.nextTick(function(){u.emit("update",c);});}),u}return p.prototype.connect=function(){R.default.logAction(R.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"});},p.prototype.ping=function(T){if(R.default.logAction(R.default.LOG_MINOR,"Connection.ping()",""),!T){if(this.ably.options.promises)return i.promisify(this,"ping",arguments);T=y;}this.connectionManager.ping(null,T);},p.prototype.close=function(){R.default.logAction(R.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"});},p}(P.default);l.default=C;},function(D,l,f){l.__esModule=!0,l.PendingMessage=void 0;var v=f(1),i=v.__importDefault(f(12)),P=v.__importStar(f(2)),O=v.__importDefault(f(7)),R=v.__importDefault(f(0)),E=v.__importDefault(f(35)),w=v.__importDefault(f(5)),y=i.default.Action,C=function(){function p(T,m){this.message=T,this.callback=m,this.merged=!1;var u=T.action;this.sendAttempted=!1,this.ackRequired=u==y.MESSAGE||u==y.PRESENCE;}return p}();l.PendingMessage=C;var r=function(p){v.__extends(T,p);function T(m){var u=p.call(this)||this;return u.transport=m,u.messageQueue=new E.default,m.on("ack",function(c,h){u.onAck(c,h);}),m.on("nack",function(c,h,e){u.onNack(c,h,e);}),u}return T.prototype.onAck=function(m,u){R.default.logAction(R.default.LOG_MICRO,"Protocol.onAck()","serial = "+m+"; count = "+u),this.messageQueue.completeMessages(m,u);},T.prototype.onNack=function(m,u,c){R.default.logAction(R.default.LOG_ERROR,"Protocol.onNack()","serial = "+m+"; count = "+u+"; err = "+P.inspectError(c)),c||(c=new w.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(m,u,c);},T.prototype.onceIdle=function(m){var u=this.messageQueue;if(u.count()===0){m();return}u.once("idle",m);},T.prototype.send=function(m){m.ackRequired&&this.messageQueue.push(m),R.default.shouldLog(R.default.LOG_MICRO)&&R.default.logAction(R.default.LOG_MICRO,"Protocol.send()","sending msg; "+i.default.stringify(m.message)),m.sendAttempted=!0,this.transport.send(m.message);},T.prototype.getTransport=function(){return this.transport},T.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},T.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},T.prototype.finish=function(){var m=this.transport;this.onceIdle(function(){m.disconnect();});},T}(O.default);l.default=r;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importDefault(f(3)),P=v.__importStar(f(2)),O=v.__importDefault(f(37)),R=v.__importDefault(f(8)),E=v.__importDefault(f(0)),w=v.__importDefault(f(12)),y=v.__importDefault(f(5)),C="web_socket";function r(m){return !!m.on}var p=function(m){v.__extends(u,m);function u(c,h,e){var a=m.call(this,c,h,e)||this;return a.shortName=C,e.heartbeats=i.default.Config.useProtocolHeartbeats,a.wsHost=R.default.getHost(e.options,e.host,!0),a}return u.isAvailable=function(){return !!i.default.Config.WebSocket},u.tryConnect=function(c,h,e,a){var n=new u(c,h,e),o=function(t){a({event:this.event,error:t});};n.on(["failed","disconnected"],o),n.on("wsopen",function(){E.default.logAction(E.default.LOG_MINOR,"WebSocketTransport.tryConnect()","viable transport "+n),n.off(["failed","disconnected"],o),a(null,n);}),n.connect();},u.prototype.createWebSocket=function(c,h){var e=0;if(h)for(var a in h)c+=(e++?"&":"?")+a+"="+h[a];return this.uri=c,new i.default.Config.WebSocket(c)},u.prototype.toString=function(){return "WebSocketTransport; uri="+this.uri},u.prototype.connect=function(){E.default.logAction(E.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),O.default.prototype.connect.call(this);var c=this,h=this.params,e=h.options,a=e.tls?"wss://":"ws://",n=a+this.wsHost+":"+R.default.getPort(e)+"/";E.default.logAction(E.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+n),this.auth.getAuthParams(function(o,t){if(!c.isDisposed){var s="";for(var g in t)s+=" "+g+": "+t[g]+";";if(E.default.logAction(E.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+s+" err: "+o),o){c.disconnect(o);return}var M=h.getConnectParams(t);try{var U=c.wsConnection=c.createWebSocket(n,M);U.binaryType=i.default.Config.binaryType,U.onopen=function(){c.onWsOpen();},U.onclose=function(b){c.onWsClose(b);},U.onmessage=function(b){c.onWsData(b.data);},U.onerror=function(b){c.onWsError(b);},r(U)&&U.on("ping",function(){c.onActivity();});}catch(b){E.default.logAction(E.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(b.stack||b.message)),c.disconnect(b);}}});},u.prototype.send=function(c){var h=this.wsConnection;if(!h){E.default.logAction(E.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{h.send(w.default.serialize(c,this.params.format));}catch(a){var e="Exception from ws connection when trying to send: "+P.inspectError(a);E.default.logAction(E.default.LOG_ERROR,"WebSocketTransport.send()",e),this.finish("disconnected",new y.default(e,5e4,500));}},u.prototype.onWsData=function(c){E.default.logAction(E.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+c.length+"; type = "+typeof c);try{this.onProtocolMessage(w.default.deserialize(c,this.format));}catch(h){E.default.logAction(E.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+h.stack);}},u.prototype.onWsOpen=function(){E.default.logAction(E.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("wsopen");},u.prototype.onWsClose=function(c){var h,e;if(typeof c=="object"?(e=c.code,h=c.wasClean||e===1e3):(e=c,h=e==1e3),delete this.wsConnection,h){E.default.logAction(E.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var a=new y.default("Websocket closed",80003,400);this.finish("disconnected",a);}else {var n="Unclean disconnection of WebSocket ; code = "+e,a=new y.default(n,80003,400);E.default.logAction(E.default.LOG_MINOR,"WebSocketTransport.onWsClose()",n),this.finish("disconnected",a);}this.emit("disposed");},u.prototype.onWsError=function(c){var h=this;E.default.logAction(E.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+c.message),i.default.Config.nextTick(function(){h.disconnect(Error(c.message));});},u.prototype.dispose=function(){E.default.logAction(E.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var c=this.wsConnection;c&&(c.onmessage=function(){},delete this.wsConnection,i.default.Config.nextTick(function(){if(E.default.logAction(E.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!c)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");c.close();}));},u}(O.default);function T(m){return p.isAvailable()&&(m.supportedTransports[C]=p),p}l.default=T;},function(D,l,f){l.__esModule=!0,l.isSuccessCode=void 0;var v;(function(P){P[P.Success=200]="Success",P[P.NoContent=204]="NoContent",P[P.BadRequest=400]="BadRequest",P[P.Unauthorized=401]="Unauthorized",P[P.Forbidden=403]="Forbidden",P[P.RequestTimeout=408]="RequestTimeout",P[P.InternalServerError=500]="InternalServerError";})(v||(v={}));function i(P){return P>=v.Success&&P<v.BadRequest}l.isSuccessCode=i,l.default=v;},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importStar(f(2)),P=v.__importDefault(f(34)),O=v.__importDefault(f(7)),R=v.__importDefault(f(0)),E=v.__importDefault(f(15)),w=v.__importDefault(f(5)),y=v.__importDefault(f(38)),C=v.__importDefault(f(23)),r=v.__importDefault(f(39)),p=function(){};function T(n){return n.clientId+":"+n.connectionId}function m(n){return n.channel.realtime.auth.clientId}function u(n){var o=n.channel.realtime,t=o.auth.clientId;return (!t||t==="*")&&o.connection.state==="connected"}function c(n,o,t){switch(n.state){case"attached":case"suspended":t();break;case"initialized":case"detached":case"detaching":case"attaching":n.attach(function(s){s?o(s):t();});break;default:o(w.default.fromValues(y.default.invalidStateError(n.state)));}}function h(n,o){if(n.isSynthesized()||o.isSynthesized())return n.timestamp>o.timestamp;var t=n.parseId(),s=o.parseId();return t.msgSerial===s.msgSerial?t.index>s.index:t.msgSerial>s.msgSerial}var e=function(n){v.__extends(o,n);function o(t){var s=n.call(this,t)||this;return s.channel=t,s.syncComplete=!1,s.members=new a(s),s._myMembers=new a(s),s.subscriptions=new O.default,s.pendingPresence=[],s}return o.prototype.enter=function(t,s){if(u(this))throw new w.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,t,"enter",s)},o.prototype.update=function(t,s){if(u(this))throw new w.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,t,"update",s)},o.prototype.enterClient=function(t,s,g){return this._enterOrUpdateClient(t,s,"enter",g)},o.prototype.updateClient=function(t,s,g){return this._enterOrUpdateClient(t,s,"update",g)},o.prototype._enterOrUpdateClient=function(t,s,g,M){var U=this;if(!M)if(typeof s=="function")M=s,s=null;else {if(this.channel.realtime.options.promises)return i.promisify(this,"_enterOrUpdateClient",[t,s,g]);M=p;}var b=this.channel;if(!b.connectionManager.activeState()){M(b.connectionManager.getError());return}R.default.logAction(R.default.LOG_MICRO,"RealtimePresence."+g+"Client()","channel = "+b.name+", client = "+(t||"(implicit) "+m(this)));var x=E.default.fromValues({action:g,data:s});t&&(x.clientId=t),E.default.encode(x,b.channelOptions,function(d){if(d){M(d);return}switch(b.state){case"attached":b.sendPresence(x,M);break;case"initialized":case"detached":b.attach();case"attaching":U.pendingPresence.push({presence:x,callback:M});break;default:d=new w.default("Unable to "+g+" presence channel while in "+b.state+" state",90001),d.code=90001,M(d);}});},o.prototype.leave=function(t,s){if(u(this))throw new w.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,t,s)},o.prototype.leaveClient=function(t,s,g){if(!g)if(typeof s=="function")g=s,s=null;else {if(this.channel.realtime.options.promises)return i.promisify(this,"leaveClient",[t,s]);g=p;}var M=this.channel;if(!M.connectionManager.activeState()){g==null||g(M.connectionManager.getError());return}R.default.logAction(R.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+t);var U=E.default.fromValues({action:"leave",data:s});switch(t&&(U.clientId=t),M.state){case"attached":M.sendPresence(U,g);break;case"attaching":this.pendingPresence.push({presence:U,callback:g});break;case"initialized":case"failed":{var b=new w.default("Unable to leave presence channel (incompatible state)",90001);g==null||g(b);break}default:g==null||g(y.default.invalidStateError(M.state));}},o.prototype.get=function(t,s){var g=this,M=Array.prototype.slice.call(arguments);M.length==1&&typeof M[0]=="function"&&M.unshift(null),t=M[0],s=M[1];var U=!t||("waitForSync"in t?t.waitForSync:!0);if(!s){if(this.channel.realtime.options.promises)return i.promisify(this,"get",M);s=p;}function b(x){s(null,t?x.list(t):x.values());}if(this.channel.state==="suspended"){U?s(w.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):b(this.members);return}c(this.channel,s,function(){var x=g.members;U?x.waitSync(function(){b(x);}):b(x);});},o.prototype.history=function(t,s){if(R.default.logAction(R.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),s===void 0)if(typeof t=="function")s=t,t=null;else {if(this.channel.realtime.options.promises)return i.promisify(this,"history",arguments);s=p;}t&&t.untilAttach&&(this.channel.state==="attached"?(delete t.untilAttach,t.from_serial=this.channel.properties.attachSerial):s(new w.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),P.default.prototype._history.call(this,t,s);},o.prototype.setPresence=function(t,s,g){R.default.logAction(R.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+t.length+" participants; syncChannelSerial = "+g);var M,U,b=this.members,x=this._myMembers,d=[],A=this.channel.connectionManager.connectionId;s&&(this.members.startSync(),g&&(U=g.match(/^[\w-]+:(.*)$/))&&(M=U[1]));for(var B=0;B<t.length;B++){var N=E.default.fromValues(t[B]);switch(N.action){case"leave":b.remove(N)&&d.push(N),N.connectionId===A&&!N.isSynthesized()&&x.remove(N);break;case"enter":case"present":case"update":b.put(N)&&d.push(N),N.connectionId===A&&x.put(N);break}}s&&!M&&(b.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(y.default.progressOps.sync,!1),this.channel.syncChannelSerial=null);for(var B=0;B<d.length;B++){var N=d[B];this.subscriptions.emit(N.action,N);}},o.prototype.onAttached=function(t){R.default.logAction(R.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+t),t?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var s=this.pendingPresence,g=s.length;if(g){this.pendingPresence=[];var M=[],U=C.default.create();R.default.logAction(R.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+g+" queued presence messages");for(var b=0;b<g;b++){var x=s[b];M.push(x.presence),U.push(x.callback);}this.channel.sendPresence(M,U);}},o.prototype.actOnChannelState=function(t,s,g){switch(t){case"attached":this.onAttached(s);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(g);break}},o.prototype.failPendingPresence=function(t){if(this.pendingPresence.length){R.default.logAction(R.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+i.inspectError(t));for(var s=0;s<this.pendingPresence.length;s++)try{this.pendingPresence[s].callback(t);}catch{}this.pendingPresence=[];}},o.prototype._clearMyMembers=function(){this._myMembers.clear();},o.prototype._ensureMyMembersPresent=function(){var t=this,s=this.members,g=this._myMembers,M=function(x){if(x){var d="Presence auto-re-enter failed: "+x.toString(),A=new w.default(d,91004,400);R.default.logAction(R.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",d);var B=new r.default(t.channel.state,t.channel.state,!0,A);t.channel.emit("update",B);}};for(var U in g.map)if(!(U in s.map)){var b=g.map[U];R.default.logAction(R.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+b.clientId+'" into the presence set'),this._enterOrUpdateClient(b.clientId,b.data,"enter",M),delete g.map[U];}},o.prototype._synthesizeLeaves=function(t){var s=this.subscriptions;i.arrForEach(t,function(g){var M=E.default.fromValues({action:"leave",connectionId:g.connectionId,clientId:g.clientId,data:g.data,encoding:g.encoding,timestamp:i.now()});s.emit("leave",M);});},o.prototype.on=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];R.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,t);},o.prototype.off=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];R.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,t);},o.prototype.subscribe=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];var g=y.default.processListenerArgs(t),M=g[0],U=g[1],b=g[2],x=this.channel;if(!b){if(this.channel.realtime.options.promises)return i.promisify(this,"subscribe",[M,U]);b=p;}if(x.state==="failed"){b(w.default.fromValues(y.default.invalidStateError("failed")));return}this.subscriptions.on(M,U),x.attach(b);},o.prototype.unsubscribe=function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];var g=y.default.processListenerArgs(t),M=g[0],U=g[1];this.subscriptions.off(M,U);},o}(P.default),a=function(n){v.__extends(o,n);function o(t){var s=n.call(this)||this;return s.presence=t,s.map={},s.syncInProgress=!1,s.residualMembers=null,s}return o.prototype.get=function(t){return this.map[t]},o.prototype.getClient=function(t){var s=this.map,g=[];for(var M in s){var U=s[M];U.clientId==t&&U.action!="absent"&&g.push(U);}return g},o.prototype.list=function(t){var s=this.map,g=t&&t.clientId,M=t&&t.connectionId,U=[];for(var b in s){var x=s[b];x.action!=="absent"&&(g&&g!=x.clientId||M&&M!=x.connectionId||U.push(x));}return U},o.prototype.put=function(t){(t.action==="enter"||t.action==="update")&&(t=E.default.fromValues(t),t.action="present");var s=this.map,g=T(t);this.residualMembers&&delete this.residualMembers[g];var M=s[g];return M&&!h(t,M)?!1:(s[g]=t,!0)},o.prototype.values=function(){var t=this.map,s=[];for(var g in t){var M=t[g];M.action!="absent"&&s.push(M);}return s},o.prototype.remove=function(t){var s=this.map,g=T(t),M=s[g];return M&&!h(t,M)?!1:(this.syncInProgress?(t=E.default.fromValues(t),t.action="absent",s[g]=t):delete s[g],!0)},o.prototype.startSync=function(){var t=this.map,s=this.syncInProgress;R.default.logAction(R.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+s),this.syncInProgress||(this.residualMembers=i.copy(t),this.setInProgress(!0));},o.prototype.endSync=function(){var t=this.map,s=this.syncInProgress;if(R.default.logAction(R.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+s),s){for(var g in t){var M=t[g];M.action==="absent"&&delete t[g];}this.presence._synthesizeLeaves(i.valuesArray(this.residualMembers));for(var U in this.residualMembers)delete t[U];this.residualMembers=null,this.setInProgress(!1);}this.emit("sync");},o.prototype.waitSync=function(t){var s=this.syncInProgress;if(R.default.logAction(R.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+s),!s){t();return}this.once("sync",t);},o.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null;},o.prototype.setInProgress=function(t){R.default.logAction(R.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+t),this.syncInProgress=t,this.presence.syncComplete=!t;},o}(O.default);l.default=e;},function(D,l,f){l.__esModule=!0;var v=f(1),i=f(57),P=f(32),O=f(14),R=v.__importDefault(f(4)),E=v.__importDefault(f(3)),w=function(){function y(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef";}return y.prototype.isWordArray=function(C){return C!=null&&C.sigBytes!==void 0},y.prototype.isArrayBuffer=function(C){return C!=null&&C.constructor===ArrayBuffer},y.prototype.isTypedArray=function(C){return !!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(C)},y.prototype.uint8ViewToBase64=function(C){for(var r="",p=this.base64CharSet,T=C.byteLength,m=T%3,u=T-m,c,h,e,a,n,o=0;o<u;o=o+3)n=C[o]<<16|C[o+1]<<8|C[o+2],c=(n&16515072)>>18,h=(n&258048)>>12,e=(n&4032)>>6,a=n&63,r+=p[c]+p[h]+p[e]+p[a];return m==1?(n=C[u],c=(n&252)>>2,h=(n&3)<<4,r+=p[c]+p[h]+"=="):m==2&&(n=C[u]<<8|C[u+1],c=(n&64512)>>10,h=(n&1008)>>4,e=(n&15)<<2,r+=p[c]+p[h]+p[e]+"="),r},y.prototype.base64ToArrayBuffer=function(C){for(var r=atob==null?void 0:atob(C),p=r.length,T=new Uint8Array(p),m=0;m<p;m++){var u=r.charCodeAt(m);T[m]=u;}return T.buffer},y.prototype.isBuffer=function(C){return this.isArrayBuffer(C)||this.isWordArray(C)||this.isTypedArray(C)},y.prototype.toBuffer=function(C){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(C))return new Uint8Array(C);if(this.isTypedArray(C))return new Uint8Array(C.buffer);if(this.isWordArray(C)){for(var r=new ArrayBuffer(C.sigBytes),p=new Uint8Array(r),T=0;T<C.sigBytes;T++)p[T]=C.words[T>>>2]>>>24-T%4*8&255;return p}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},y.prototype.toArrayBuffer=function(C){return this.isArrayBuffer(C)?C:this.toBuffer(C).buffer},y.prototype.toWordArray=function(C){return this.isTypedArray(C)&&(C=C.buffer),this.isWordArray(C)?C:R.default.create(C)},y.prototype.base64Encode=function(C){return this.isWordArray(C)?O.stringify(C):this.uint8ViewToBase64(this.toBuffer(C))},y.prototype.base64Decode=function(C){return ArrayBuffer&&E.default.Config.atob?this.base64ToArrayBuffer(C):O.parse(C)},y.prototype.hexEncode=function(C){return i.stringify(this.toWordArray(C))},y.prototype.hexDecode=function(C){var r=i.parse(C);return ArrayBuffer?this.toArrayBuffer(r):r},y.prototype.utf8Encode=function(C){return TextEncoder?new TextEncoder().encode(C).buffer:P.parse(C)},y.prototype.utf8Decode=function(C){if(!this.isBuffer(C))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(C)?new TextDecoder().decode(C):(C=this.toWordArray(C),P.stringify(C))},y.prototype.bufferCompare=function(C,r){if(!C)return -1;if(!r)return 1;var p=this.toWordArray(C),T=this.toWordArray(r);p.clamp(),T.clamp();var m=p.sigBytes-T.sigBytes;if(m!=0)return m;for(var u=p.words,c=T.words,h=0;h<u.length;h++)if(m=u[h]-c[h],m!=0)return m;return 0},y.prototype.byteLength=function(C){return this.isArrayBuffer(C)||this.isTypedArray(C)?C.byteLength:this.isWordArray(C)?C.sigBytes:-1},y.prototype.typedArrayToBuffer=function(C){return C.buffer},y}();l.default=new w;},function(D,l,f){(function(v,i){D.exports=i(f(6));})(this,function(v){return v.enc.Hex});},function(D,l,f){f.r(l);var v=f(4),i=f.n(v),P=f(14);f.n(P);var R=f(22),E=f.n(R),w=f(3),y=f.n(w),C=f(0),r=f.n(C),p=function(){var T="aes",m=256,u="cbc",c=16,h=4,e=4294967296,a=2147483648,n;if(y.a.getRandomWordArray)n=y.a.getRandomWordArray;else if(typeof Uint32Array<"u"&&y.a.getRandomValues){var o=new Uint32Array(h);n=function(d,A){var B=d/4,N=B==h?o:new Uint32Array(B);y.a.getRandomValues(N,function(j){A(j,y.a.BufferUtils.toWordArray(N));});};}else n=function(d,A){r.a.logAction(r.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var B=d/4,N=new Array(B),j=0;j<B;j++)N[j]=Math.floor(Math.random()*e)-a;A(null,i.a.create(N));};function t(d){return d+c&-c}function s(d){if(d.algorithm==="aes"&&d.mode==="cbc"){if(d.keyLength===128||d.keyLength===256)return;throw new Error("Unsupported key length "+d.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function g(d){return d.replace("_","/").replace("-","+")}var M=[i.a.create([269488144,269488144,269488144,269488144],16),i.a.create([16777216],1),i.a.create([33685504],2),i.a.create([50529024],3),i.a.create([67372036],4),i.a.create([84215045,83886080],5),i.a.create([101058054,101056512],6),i.a.create([117901063,117901056],7),i.a.create([134744072,134744072],8),i.a.create([151587081,151587081,150994944],9),i.a.create([168430090,168430090,168427520],10),i.a.create([185273099,185273099,185273088],11),i.a.create([202116108,202116108,202116108],12),i.a.create([218959117,218959117,218959117,218103808],13),i.a.create([235802126,235802126,235802126,235798528],14),i.a.create([252645135,252645135,252645135,252645135],15),i.a.create([269488144,269488144,269488144,269488144],16)];function U(){}function b(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null;}U.CipherParams=b,U.getDefaultParams=function(d){var A;if(typeof d=="function"||typeof d=="string"){if(r.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof d=="function")U.generateRandomKey(function(N){d(null,U.getDefaultParams({key:N}));});else if(typeof arguments[1]=="function")arguments[1](null,U.getDefaultParams({key:d}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!d.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof d.key=="string"?A=Object(P.parse)(g(d.key)):A=y.a.BufferUtils.toWordArray(d.key);var B=new b;if(B.key=A,B.algorithm=d.algorithm||T,B.keyLength=A.words.length*(4*8),B.mode=d.mode||u,d.keyLength&&d.keyLength!==B.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+d.keyLength+" was specified, but the key actually has length "+B.keyLength);return s(B),B},U.generateRandomKey=function(d,A){arguments.length==1&&typeof d=="function"&&(A=d,d=void 0),n((d||m)/8,A);},U.getCipher=function(d){var A=d instanceof b?d:U.getDefaultParams(d);return {cipherParams:A,cipher:new x(A,h,d.iv)}};function x(d,A,B){this.algorithm=d.algorithm+"-"+String(d.keyLength)+"-"+d.mode,this.cjsAlgorithm=d.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=y.a.BufferUtils.toWordArray(d.key),B&&(this.iv=y.a.BufferUtils.toWordArray(B).clone()),this.blockLengthWords=A;}return x.prototype.encrypt=function(d,A){r.a.logAction(r.a.LOG_MICRO,"CBCCipher.encrypt()",""),d=y.a.BufferUtils.toWordArray(d);var B=d.sigBytes,N=t(B),j=this,F=function(){j.getIv(function(I,L){if(I){A(I);return}var S=j.encryptCipher.process(d.concat(M[N-B])),G=L.concat(S);A(null,G);});};this.encryptCipher?F():this.iv?(this.encryptCipher=E.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),F()):n(c,function(I,L){if(I){A(I);return}j.encryptCipher=E.a.algo[j.cjsAlgorithm].createEncryptor(j.key,{iv:L}),j.iv=L,F();});},x.prototype.decrypt=function(d){r.a.logAction(r.a.LOG_MICRO,"CBCCipher.decrypt()",""),d=y.a.BufferUtils.toWordArray(d);var A=this.blockLengthWords,B=d.words,N=i.a.create(B.slice(0,A)),j=i.a.create(B.slice(A)),F=E.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:N}),I=F.process(j),L=F.finalize();return F.reset(),L&&L.sigBytes&&I.concat(L),I},x.prototype.getIv=function(d){if(this.iv){var A=this.iv;this.iv=null,d(null,A);return}var B=this;n(c,function(N,j){if(N){d(N);return}d(null,B.encryptCipher.process(j));});},U}();l.default=p;},function(D,l,f){(function(v,i){D.exports=i(f(6));})(this,function(v){return function(){var i=v,P=i.lib,O=P.WordArray,R=i.enc;R.Utf16=R.Utf16BE={stringify:function(y){for(var C=y.words,r=y.sigBytes,p=[],T=0;T<r;T+=2){var m=C[T>>>2]>>>16-T%4*8&65535;p.push(String.fromCharCode(m));}return p.join("")},parse:function(y){for(var C=y.length,r=[],p=0;p<C;p++)r[p>>>1]|=y.charCodeAt(p)<<16-p%2*16;return O.create(r,C*2)}};R.Utf16LE={stringify:function(y){for(var C=y.words,r=y.sigBytes,p=[],T=0;T<r;T+=2){var m=w(C[T>>>2]>>>16-T%4*8&65535);p.push(String.fromCharCode(m));}return p.join("")},parse:function(y){for(var C=y.length,r=[],p=0;p<C;p++)r[p>>>1]|=w(y.charCodeAt(p)<<16-p%2*16);return O.create(r,C*2)}};function w(y){return y<<8&4278255360|y>>>8&16711935}}(),v.enc.Utf16});},function(D,l,f){(function(v,i){D.exports=i(f(6),f(28));})(this,function(v){return function(i){var P=v,O=P.lib,R=O.CipherParams,E=P.enc,w=E.Hex,y=P.format;y.Hex={stringify:function(r){return r.ciphertext.toString(w)},parse:function(r){var p=w.parse(r);return R.create({ciphertext:p})}};}(),v.format.Hex});},function(D,l,f){(function(v,i){D.exports=i(f(6),f(14),f(62),f(27),f(28));})(this,function(v){return function(){var i=v,P=i.lib,O=P.BlockCipher,R=i.algo,E=[],w=[],y=[],C=[],r=[],p=[],T=[],m=[],u=[],c=[];(function(){for(var a=[],n=0;n<256;n++)n<128?a[n]=n<<1:a[n]=n<<1^283;for(var o=0,t=0,n=0;n<256;n++){var s=t^t<<1^t<<2^t<<3^t<<4;s=s>>>8^s&255^99,E[o]=s,w[s]=o;var g=a[o],M=a[g],U=a[M],b=a[s]*257^s*16843008;y[o]=b<<24|b>>>8,C[o]=b<<16|b>>>16,r[o]=b<<8|b>>>24,p[o]=b;var b=U*16843009^M*65537^g*257^o*16843008;T[s]=b<<24|b>>>8,m[s]=b<<16|b>>>16,u[s]=b<<8|b>>>24,c[s]=b,o?(o=g^a[a[a[U^g]]],t^=a[a[t]]):o=t=1;}})();var h=[0,1,2,4,8,16,32,64,128,27,54],e=R.AES=O.extend({_doReset:function(){var a;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var n=this._keyPriorReset=this._key,o=n.words,t=n.sigBytes/4,s=this._nRounds=t+6,g=(s+1)*4,M=this._keySchedule=[],U=0;U<g;U++)U<t?M[U]=o[U]:(a=M[U-1],U%t?t>6&&U%t==4&&(a=E[a>>>24]<<24|E[a>>>16&255]<<16|E[a>>>8&255]<<8|E[a&255]):(a=a<<8|a>>>24,a=E[a>>>24]<<24|E[a>>>16&255]<<16|E[a>>>8&255]<<8|E[a&255],a^=h[U/t|0]<<24),M[U]=M[U-t]^a);for(var b=this._invKeySchedule=[],x=0;x<g;x++){var U=g-x;if(x%4)var a=M[U];else var a=M[U-4];x<4||U<=4?b[x]=a:b[x]=T[E[a>>>24]]^m[E[a>>>16&255]]^u[E[a>>>8&255]]^c[E[a&255]];}}},encryptBlock:function(a,n){this._doCryptBlock(a,n,this._keySchedule,y,C,r,p,E);},decryptBlock:function(a,n){var o=a[n+1];a[n+1]=a[n+3],a[n+3]=o,this._doCryptBlock(a,n,this._invKeySchedule,T,m,u,c,w);var o=a[n+1];a[n+1]=a[n+3],a[n+3]=o;},_doCryptBlock:function(a,n,o,t,s,g,M,U){for(var b=this._nRounds,x=a[n]^o[0],d=a[n+1]^o[1],A=a[n+2]^o[2],B=a[n+3]^o[3],N=4,j=1;j<b;j++){var F=t[x>>>24]^s[d>>>16&255]^g[A>>>8&255]^M[B&255]^o[N++],I=t[d>>>24]^s[A>>>16&255]^g[B>>>8&255]^M[x&255]^o[N++],L=t[A>>>24]^s[B>>>16&255]^g[x>>>8&255]^M[d&255]^o[N++],S=t[B>>>24]^s[x>>>16&255]^g[d>>>8&255]^M[A&255]^o[N++];x=F,d=I,A=L,B=S;}var F=(U[x>>>24]<<24|U[d>>>16&255]<<16|U[A>>>8&255]<<8|U[B&255])^o[N++],I=(U[d>>>24]<<24|U[A>>>16&255]<<16|U[B>>>8&255]<<8|U[x&255])^o[N++],L=(U[A>>>24]<<24|U[B>>>16&255]<<16|U[x>>>8&255]<<8|U[d&255])^o[N++],S=(U[B>>>24]<<24|U[x>>>16&255]<<16|U[d>>>8&255]<<8|U[A&255])^o[N++];a[n]=F,a[n+1]=I,a[n+2]=L,a[n+3]=S;},keySize:256/32});i.AES=O._createHelper(e);}(),v.AES});},function(D,l,f){(function(v,i){D.exports=i(f(6));})(this,function(v){return function(i){var P=v,O=P.lib,R=O.WordArray,E=O.Hasher,w=P.algo,y=[];(function(){for(var u=0;u<64;u++)y[u]=i.abs(i.sin(u+1))*4294967296|0;})();var C=w.MD5=E.extend({_doReset:function(){this._hash=new R.init([1732584193,4023233417,2562383102,271733878]);},_doProcessBlock:function(u,c){for(var h=0;h<16;h++){var e=c+h,a=u[e];u[e]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360;}var n=this._hash.words,o=u[c+0],t=u[c+1],s=u[c+2],g=u[c+3],M=u[c+4],U=u[c+5],b=u[c+6],x=u[c+7],d=u[c+8],A=u[c+9],B=u[c+10],N=u[c+11],j=u[c+12],F=u[c+13],I=u[c+14],L=u[c+15],S=n[0],G=n[1],W=n[2],H=n[3];S=r(S,G,W,H,o,7,y[0]),H=r(H,S,G,W,t,12,y[1]),W=r(W,H,S,G,s,17,y[2]),G=r(G,W,H,S,g,22,y[3]),S=r(S,G,W,H,M,7,y[4]),H=r(H,S,G,W,U,12,y[5]),W=r(W,H,S,G,b,17,y[6]),G=r(G,W,H,S,x,22,y[7]),S=r(S,G,W,H,d,7,y[8]),H=r(H,S,G,W,A,12,y[9]),W=r(W,H,S,G,B,17,y[10]),G=r(G,W,H,S,N,22,y[11]),S=r(S,G,W,H,j,7,y[12]),H=r(H,S,G,W,F,12,y[13]),W=r(W,H,S,G,I,17,y[14]),G=r(G,W,H,S,L,22,y[15]),S=p(S,G,W,H,t,5,y[16]),H=p(H,S,G,W,b,9,y[17]),W=p(W,H,S,G,N,14,y[18]),G=p(G,W,H,S,o,20,y[19]),S=p(S,G,W,H,U,5,y[20]),H=p(H,S,G,W,B,9,y[21]),W=p(W,H,S,G,L,14,y[22]),G=p(G,W,H,S,M,20,y[23]),S=p(S,G,W,H,A,5,y[24]),H=p(H,S,G,W,I,9,y[25]),W=p(W,H,S,G,g,14,y[26]),G=p(G,W,H,S,d,20,y[27]),S=p(S,G,W,H,F,5,y[28]),H=p(H,S,G,W,s,9,y[29]),W=p(W,H,S,G,x,14,y[30]),G=p(G,W,H,S,j,20,y[31]),S=T(S,G,W,H,U,4,y[32]),H=T(H,S,G,W,d,11,y[33]),W=T(W,H,S,G,N,16,y[34]),G=T(G,W,H,S,I,23,y[35]),S=T(S,G,W,H,t,4,y[36]),H=T(H,S,G,W,M,11,y[37]),W=T(W,H,S,G,x,16,y[38]),G=T(G,W,H,S,B,23,y[39]),S=T(S,G,W,H,F,4,y[40]),H=T(H,S,G,W,o,11,y[41]),W=T(W,H,S,G,g,16,y[42]),G=T(G,W,H,S,b,23,y[43]),S=T(S,G,W,H,A,4,y[44]),H=T(H,S,G,W,j,11,y[45]),W=T(W,H,S,G,L,16,y[46]),G=T(G,W,H,S,s,23,y[47]),S=m(S,G,W,H,o,6,y[48]),H=m(H,S,G,W,x,10,y[49]),W=m(W,H,S,G,I,15,y[50]),G=m(G,W,H,S,U,21,y[51]),S=m(S,G,W,H,j,6,y[52]),H=m(H,S,G,W,g,10,y[53]),W=m(W,H,S,G,B,15,y[54]),G=m(G,W,H,S,t,21,y[55]),S=m(S,G,W,H,d,6,y[56]),H=m(H,S,G,W,L,10,y[57]),W=m(W,H,S,G,b,15,y[58]),G=m(G,W,H,S,F,21,y[59]),S=m(S,G,W,H,M,6,y[60]),H=m(H,S,G,W,N,10,y[61]),W=m(W,H,S,G,s,15,y[62]),G=m(G,W,H,S,A,21,y[63]),n[0]=n[0]+S|0,n[1]=n[1]+G|0,n[2]=n[2]+W|0,n[3]=n[3]+H|0;},_doFinalize:function(){var u=this._data,c=u.words,h=this._nDataBytes*8,e=u.sigBytes*8;c[e>>>5]|=128<<24-e%32;var a=i.floor(h/4294967296),n=h;c[(e+64>>>9<<4)+15]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360,c[(e+64>>>9<<4)+14]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360,u.sigBytes=(c.length+1)*4,this._process();for(var o=this._hash,t=o.words,s=0;s<4;s++){var g=t[s];t[s]=(g<<8|g>>>24)&16711935|(g<<24|g>>>8)&4278255360;}return o},clone:function(){var u=E.clone.call(this);return u._hash=this._hash.clone(),u}});function r(u,c,h,e,a,n,o){var t=u+(c&h|~c&e)+a+o;return (t<<n|t>>>32-n)+c}function p(u,c,h,e,a,n,o){var t=u+(c&e|h&~e)+a+o;return (t<<n|t>>>32-n)+c}function T(u,c,h,e,a,n,o){var t=u+(c^h^e)+a+o;return (t<<n|t>>>32-n)+c}function m(u,c,h,e,a,n,o){var t=u+(h^(c|~e))+a+o;return (t<<n|t>>>32-n)+c}P.MD5=E._createHelper(C),P.HmacMD5=E._createHmacHelper(C);}(Math),v.MD5});},function(D,l,f){var v;l.__esModule=!0;var i=f(1),P=i.__importDefault(f(3)),O=i.__importStar(f(2)),R=i.__importDefault(f(8)),E=i.__importDefault(f(5)),w=i.__importDefault(f(18)),y=i.__importDefault(f(16)),C=i.__importDefault(f(21)),r=i.__importDefault(f(0)),p=f(29);function T(c){var h=c.statusCode;return h===408&&!c.code||h===400&&!c.code||h>=500&&h<=504}function m(c){var h=c.connection,e=h&&h.connectionManager.host;return e?[e].concat(R.default.getFallbackHosts(c.options)):R.default.getHosts(c.options)}var u=(v=function(){function c(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=m,P.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(h,e,a,n,o,t,s){var g=y.default.createRequest(a,n,o,t,C.default.REQ_SEND,e&&e.options.timeouts,h);return g.once("complete",s),g.exec(),g},this.checkConnectivity=function(h){var e=R.default.internetUpUrl;r.default.logAction(r.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+e),this.doUri(w.default.Get,null,e,null,null,null,function(a,n){var o,t=!a&&((o=n)===null||o===void 0?void 0:o.replace(/\n/,""))=="yes";r.default.logAction(r.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+t),h(null,t);});}):P.default.Config.jsonpSupported&&(this.Request=function(h,e,a,n,o,t,s){var g=p.createRequest(a,n,o,t,C.default.REQ_SEND,e&&e.options.timeouts,h);return g.once("complete",s),P.default.Config.nextTick(function(){g.exec();}),g},this.checkConnectivity=function(h){var e=this,a=R.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(h);return}this.checksInProgress=[h],r.default.logAction(r.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+a);var n=new p.Request("isTheInternetUp",a,null,null,null,C.default.REQ_SEND,R.default.TIMEOUTS);n.once("complete",function(o,t){var s=!o&&t;r.default.logAction(r.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+s);for(var g=0;g<e.checksInProgress.length;g++)e.checksInProgress[g](null,s);e.checksInProgress=null;}),P.default.Config.nextTick(function(){n.exec();});});}return c.prototype.do=function(h,e,a,n,o,t,s){var g=this,M=typeof a=="function"?a:function(d){return e.baseUri(d)+a},U=e._currentFallback;if(U)if(U.validUntil>O.now()){if(!this.Request){s==null||s(new E.default("Request invoked before assigned to",null,500));return}this.Request(h,e,M(U.host),n,t,o,function(d){for(var A=[],B=1;B<arguments.length;B++)A[B-1]=arguments[B];if(d&&T(d)){e._currentFallback=null,g.do(h,e,a,n,o,t,s);return}s==null||s.apply(void 0,i.__spreadArray([d],A));});return}else e._currentFallback=null;var b=m(e);if(b.length===1){this.doUri(h,e,M(b[0]),n,o,t,s);return}var x=function(d,A){var B=d.shift();g.doUri(h,e,M(B),n,o,t,function(N){for(var j=[],F=1;F<arguments.length;F++)j[F-1]=arguments[F];if(N&&T(N)&&d.length){x(d,!0);return}A&&(e._currentFallback={host:B,validUntil:O.now()+e.options.timeouts.fallbackRetryTimeout}),s==null||s.apply(void 0,i.__spreadArray([N],j));});};x(b);},c.prototype.doUri=function(h,e,a,n,o,t,s){if(!this.Request){s(new E.default("Request invoked before assigned to",null,500));return}this.Request(h,e,a,n,t,o,s);},c}(),v.methods=[w.default.Get,w.default.Delete,w.default.Post,w.default.Put,w.default.Patch],v.methodsWithoutBody=[w.default.Get,w.default.Delete],v.methodsWithBody=[w.default.Post,w.default.Put,w.default.Patch],v);l.default=u;},function(D,l,f){(function(v){l.__esModule=!0;var i=f(1),P=i.__importStar(f(2)),O="ablyjs-storage-test",R=function(){function E(){try{v.sessionStorage.setItem(O,O),v.sessionStorage.removeItem(O),this.sessionSupported=!0;}catch{this.sessionSupported=!1;}try{v.localStorage.setItem(O,O),v.localStorage.removeItem(O),this.localSupported=!0;}catch{this.localSupported=!1;}}return E.prototype.get=function(w){return this._get(w,!1)},E.prototype.getSession=function(w){return this._get(w,!0)},E.prototype.remove=function(w){return this._remove(w,!1)},E.prototype.removeSession=function(w){return this._remove(w,!0)},E.prototype.set=function(w,y,C){return this._set(w,y,C,!1)},E.prototype.setSession=function(w,y,C){return this._set(w,y,C,!0)},E.prototype._set=function(w,y,C,r){var p={value:y};return C&&(p.expires=P.now()+C),this.storageInterface(r).setItem(w,JSON.stringify(p))},E.prototype._get=function(w,y){if(y&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!y&&!this.localSupported)throw new Error("Local Storage not supported");var C=this.storageInterface(y).getItem(w);if(!C)return null;var r=JSON.parse(C);return r.expires&&r.expires<P.now()?(this.storageInterface(y).removeItem(w),null):r.value},E.prototype._remove=function(w,y){return this.storageInterface(y).removeItem(w)},E.prototype.storageInterface=function(w){return w?v.sessionStorage:v.localStorage},E}();l.default=new R;}).call(this,f(10));},function(D,l,f){l.__esModule=!0;var v=f(1),i=v.__importDefault(f(66)),P={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],baseTransportOrder:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],transportPreferenceOrder:[i.default.JsonP,i.default.XhrPolling,i.default.XhrStreaming,i.default.WebSocket],upgradeTransports:[i.default.XhrStreaming,i.default.WebSocket]};l.default=P;},function(D,l,f){l.__esModule=!0;var v;((function(i){i.WebSocket="web_socket",i.Comet="comet",i.XhrStreaming="xhr_streaming",i.XhrPolling="xhr_polling",i.JsonP="jsonp";}))(v||(v={})),l.default=v;},function(D,l,f){f.r(l);var v=f(29),i=f.n(v),P=f(2),O=f(0),R=f.n(O),E=f(9),w=f.n(E),y=f(13),C=f.n(y),r=f(16),p=f.n(r),T=function(e){var a="xhr_polling";function n(o,t,s){s.stream=!1,C.a.call(this,o,t,s),this.shortName=a;}return P.inherits(n,C.a),n.isAvailable=function(){return w.a.xhrSupported&&w.a.allowComet},n.tryConnect=function(o,t,s,g){var M=new n(o,t,s),U=function(b){g({event:this.event,error:b});};M.on(["failed","disconnected"],U),M.on("preconnect",function(){R.a.logAction(R.a.LOG_MINOR,"XHRPollingTransport.tryConnect()","viable transport "+M),M.off(["failed","disconnected"],U),g(null,M);}),M.connect();},n.prototype.toString=function(){return "XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},n.prototype.createRequest=function(o,t,s,g,M){return p.a.createRequest(o,t,s,g,M,this.timeouts)},typeof e<"u"&&n.isAvailable()&&(e.supportedTransports[a]=n),n},m=T,u=function(e){var a="xhr_streaming";function n(o,t,s){C.a.call(this,o,t,s),this.shortName=a;}return P.inherits(n,C.a),n.isAvailable=function(){return w.a.xhrSupported&&w.a.streamingSupported&&w.a.allowComet},n.tryConnect=function(o,t,s,g){var M=new n(o,t,s),U=function(b){g({event:this.event,error:b});};M.on(["failed","disconnected"],U),M.on("preconnect",function(){R.a.logAction(R.a.LOG_MINOR,"XHRStreamingTransport.tryConnect()","viable transport "+M),M.off(["failed","disconnected"],U),g(null,M);}),M.connect();},n.prototype.toString=function(){return "XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},n.prototype.createRequest=function(o,t,s,g,M){return p.a.createRequest(o,t,s,g,M,this.timeouts)},typeof e<"u"&&n.isAvailable()&&(e.supportedTransports[a]=n),n},c=u;l.default=[i.a,m,c];}]).default});});var _t=ft((Ee,Ft)=>{function Gt(D){return typeof D=="string"&&(D=D.indexOf(":")==-1?{token:D}:{key:D}),D.promises=!0,D}var vt=Bt(),Ht=function(D){return new vt.Rest(Gt(D))};Object.assign(Ht,vt.Rest);var jt=function(D){return new vt.Realtime(Gt(D))};Object.assign(jt,vt.Realtime);Ft.exports={Rest:Ht,Realtime:jt};});var Oe={};ee(Oe,{CommentEmbed:()=>Qt,ConvoEmbed:()=>kt,subscribe:()=>zt});var Wt=ct(pt()),Vt=ct(_t()),ye=(D,l,f)=>{let v=new Vt.default.Realtime.Promise({authUrl:`https://theconvo.space/api/getAblyAuth?apikey=${D}`}),i=v.channels.get(l),P=()=>{i.subscribe(f);},O=()=>{i.unsubscribe();};return (0, Wt.useEffect)(()=>(P(),()=>{O();})),[i,v]},zt=ye;var at=ct(pt()),Ce=({embedConfig:D,...l})=>{let[f,v]=(0, at.useState)("");return (0, at.useEffect)(()=>{let i=new URLSearchParams({...D});v(i.toString());},[l]),at.default.createElement("iframe",{src:`https://theconvo.space/embed/dt?${f}`,style:{backgroundColor:"transparent",border:"none"},width:"500px",height:"300px",...l})},kt=Ce;var Kt=ct(pt()),Re=({config:D,...l})=>Kt.default.createElement("iframe",{src:`https://theconvo.space/embed/c/${D.commentId}`,style:{backgroundColor:"transparent",border:"none"},...l}),Qt=Re;return ne(Oe);})();
	/*!
	 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
	 * 
	 * Ably JavaScript Library v1.2.25
	 * https://github.com/ably/ably-js
	 * 
	 * Released under the Apache Licence v2.0
	 */
	/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */
	/**
	 * @license React
	 * react.production.min.js
	 *
	 * Copyright (c) Facebook, Inc. and its affiliates.
	 *
	 * This source code is licensed under the MIT license found in the
	 * LICENSE file in the root directory of this source tree.
	 */

})();
