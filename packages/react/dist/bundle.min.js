!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Convo=e()}}((function(){return function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,(function(e){return o(t[a][1][e]||e)}),l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){(function(e){(function(){
/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.22
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */
var r,o;r=window,o=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=45)}([function(e,t,n){"use strict";(function(e){t.__esModule=!0;var r,o=n(1).__importDefault(n(3));function i(e,t){return(""+e).padStart(t?3:2,"0")}function a(e){return o.default.logTimestamps?function(t){var n=new Date;e(i(n.getHours())+":"+i(n.getMinutes())+":"+i(n.getSeconds())+"."+i(n.getMilliseconds(),1)+" "+t)}:e}!function(e){e[e.None=0]="None",e[e.Error=1]="Error",e[e.Major=2]="Major",e[e.Minor=3]="Minor",e[e.Micro=4]="Micro"}(r||(r={}));var s,c,u=("undefined"==typeof Window&&"undefined"==typeof WorkerGlobalScope||e.console&&e.console.log&&"function"==typeof e.console.log.apply?(s=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,e)},c=console.warn?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn.apply(console,e)}:s):s=c=e.console&&e.console.log?function(){Function.prototype.apply.call(console.log,console,arguments)}:function(){},[s,c].map(a)),l=u[0],f=u[1],d=function(){function e(){e.logLevel=e.LOG_DEFAULT}return e.logLevel=r.Error,e.logHandler=l,e.logErrorHandler=f,e.LOG_NONE=r.None,e.LOG_ERROR=r.Error,e.LOG_MAJOR=r.Major,e.LOG_MINOR=r.Minor,e.LOG_MICRO=r.Micro,e.LOG_DEFAULT=r.Error,e.LOG_DEBUG=r.Micro,e.logAction=function(t,n,o){e.shouldLog(t)&&(t===r.Error?e.logErrorHandler:e.logHandler)("Ably: "+n+": "+o)},e.deprecated=function(t,n){e.deprecatedWithMsg(t,"Please use '"+n+"' instead.")},e.deprecatedWithMsg=function(t,n){e.shouldLog(r.Error)&&e.logErrorHandler("Ably: Deprecation warning - '"+t+"' is deprecated and will be removed from a future version. "+n)},e.shouldLog=function(t){return t<=e.logLevel},e.setLog=function(t,n){void 0!==t&&(e.logLevel=t),void 0!==n&&(e.logHandler=e.logErrorHandler=n)},e}();t.default=d}).call(this,n(14))},function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",(function(){return o})),n.d(t,"__assign",(function(){return i})),n.d(t,"__rest",(function(){return a})),n.d(t,"__decorate",(function(){return s})),n.d(t,"__param",(function(){return c})),n.d(t,"__metadata",(function(){return u})),n.d(t,"__awaiter",(function(){return l})),n.d(t,"__generator",(function(){return f})),n.d(t,"__createBinding",(function(){return d})),n.d(t,"__exportStar",(function(){return p})),n.d(t,"__values",(function(){return h})),n.d(t,"__read",(function(){return g})),n.d(t,"__spread",(function(){return m})),n.d(t,"__spreadArrays",(function(){return y})),n.d(t,"__spreadArray",(function(){return v})),n.d(t,"__await",(function(){return _})),n.d(t,"__asyncGenerator",(function(){return b})),n.d(t,"__asyncDelegator",(function(){return w})),n.d(t,"__asyncValues",(function(){return O})),n.d(t,"__makeTemplateObject",(function(){return R})),n.d(t,"__importStar",(function(){return C})),n.d(t,"__importDefault",(function(){return A})),n.d(t,"__classPrivateFieldGet",(function(){return E})),n.d(t,"__classPrivateFieldSet",(function(){return k}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)};function a(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function s(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a}function c(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function l(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}function f(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var d=Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]};function p(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||d(t,e,n)}function h(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}function y(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}function v(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function _(e){return this instanceof _?(this.v=e,this):new _(e)}function b(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=o[e](t)).value instanceof _?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function c(e){s("next",e)}function u(e){s("throw",e)}function l(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}}function w(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,o){t[r]=e[r]?function(t){return(n=!n)?{value:_(e[r](t)),done:"return"===r}:o?o(t):t}:o}}function O(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=h(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}function R(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var S=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function C(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&d(t,e,n);return S(t,e),t}function A(e){return e&&e.__esModule?e:{default:e}}function E(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}function k(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n}},function(e,t,n){"use strict";t.__esModule=!0,t.encodeBody=t.decodeBody=t.Format=t.promisify=t.trim=t.arrChooseN=t.randomHexString=t.randomString=t.cheapRandStr=t.dataSizeBytes=t.inspectBody=t.inspectError=t.isErrorInfo=t.inspect=t.now=t.parseQueryString=t.toQueryString=t.arrPopRandomElement=t.defaultPostHeaders=t.defaultGetHeaders=t.nextTick=t.allSame=t.arrEvery=t.arrFilter=t.arrMap=t.safeArrForEach=t.arrForEach=t.forInOwnNonNullProperties=t.valuesArray=t.keysArray=t.arrWithoutValue=t.arrDeleteValue=t.arrIn=t.arrIndexOf=t.arrSubtract=t.arrIntersectOb=t.arrIntersect=t.intersect=t.containsValue=t.inherits=t.prototypicalClone=t.shallowClone=t.isEmptyArg=t.isOnlyPropIn=t.isEmpty=t.isObject=t.ensureArray=t.isArray=t.copy=t.mixin=void 0,t.allToUpperCase=t.allToLowerCase=void 0;var r=n(1),o=r.__importDefault(n(3)),i=r.__importDefault(n(9)),a=r.__importStar(n(6));function s(e){return Math.floor(Math.random()*e.length)}function c(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++){var o=t[r];if(!o)break;var i=Object.prototype.hasOwnProperty;for(var a in o)i&&!i.call(o,a)||(e[a]=o[a])}return e}function u(e){return null==e}function l(e,t){var n=function(){};n.prototype=e;var r=new n;return t&&c(r,t),r}function f(e,n){for(var r=[],o=0;o<e.length;o++){var i=e[o];-1!=t.arrIndexOf(n,i)&&r.push(i)}return r}function d(e,t){for(var n=[],r=0;r<e.length;r++){var o=e[r];o in t&&n.push(o)}return n}function p(e,n){var r=t.arrIndexOf(e,n),o=-1!=r;return o&&e.splice(r,1),o}t.mixin=c,t.copy=function(e){return c({},e)},t.isArray=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)},t.ensureArray=function(e){return u(e)?[]:t.isArray(e)?e:[e]},t.isObject=function(e){return"[object Object]"==Object.prototype.toString.call(e)},t.isEmpty=function(e){for(var t in e)return!1;return!0},t.isOnlyPropIn=function(e,t){for(var n in e)if(n!==t)return!1;return!0},t.isEmptyArg=u,t.shallowClone=function(e){var t=new Object;for(var n in e)t[n]=e[n];return t},t.prototypicalClone=l,t.inherits=o.default.inherits||function(e,t){e.super_=t,e.prototype=l(t.prototype,{constructor:e})},t.containsValue=function(e,t){for(var n in e)if(e[n]==t)return!0;return!1},t.intersect=function(e,n){return t.isArray(n)?f(e,n):d(e,n)},t.arrIntersect=f,t.arrIntersectOb=d,t.arrSubtract=function(e,n){for(var r=[],o=0;o<e.length;o++){var i=e[o];-1==t.arrIndexOf(n,i)&&r.push(i)}return r},t.arrIndexOf=Array.prototype.indexOf?function(e,t,n){return e.indexOf(t,n)}:function(e,t,n){n=n||0;for(var r=e.length;n<r;n++)if(e[n]===t)return n;return-1},t.arrIn=function(e,n){return-1!==t.arrIndexOf(e,n)},t.arrDeleteValue=p,t.arrWithoutValue=function(e,t){var n=e.slice();return p(n,t),n},t.keysArray=function(e,t){var n=[];for(var r in e)t&&!Object.prototype.hasOwnProperty.call(e,r)||n.push(r);return n},t.valuesArray=function(e,t){var n=[];for(var r in e)t&&!Object.prototype.hasOwnProperty.call(e,r)||n.push(e[r]);return n},t.forInOwnNonNullProperties=function(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&e[n]&&t(n)},t.arrForEach=Array.prototype.forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=e.length,r=0;r<n;r++)t(e[r],r,e)},t.safeArrForEach=function(e,n){return t.arrForEach(e.slice(),n)},t.arrMap=Array.prototype.map?function(e,t){return e.map(t)}:function(e,t){for(var n=[],r=e.length,o=0;o<r;o++)n.push(t(e[o],o,e));return n},t.arrFilter=Array.prototype.filter?function(e,t){return e.filter(t)}:function(e,t){for(var n=[],r=e.length,o=0;o<r;o++)t(e[o])&&n.push(e[o]);return n},t.arrEvery=Array.prototype.every?function(e,t){return e.every(t)}:function(e,t){for(var n=e.length,r=0;r<n;r++)if(!t(e[r],r,e))return!1;return!0},t.allSame=function(e,n){if(0===e.length)return!0;var r=e[0][n];return t.arrEvery(e,(function(e){return e[n]===r}))},t.nextTick=o.default.nextTick;var h,g={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function m(e){return e.splice(s(e),1)[0]}t.defaultGetHeaders=function(e){return{accept:g[e||h.json],"X-Ably-Version":i.default.apiVersion,"Ably-Agent":i.default.agent}},t.defaultPostHeaders=function(e){var t;return{accept:t=g[e||h.json],"content-type":t,"X-Ably-Version":i.default.apiVersion,"Ably-Agent":i.default.agent}},t.arrPopRandomElement=m,t.toQueryString=function(e){var t=[];if(e)for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.length?"?"+t.join("&"):""},t.parseQueryString=function(e){for(var t,n=/([^?&=]+)=?([^&]*)/g,r={};t=n.exec(e);)r[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return r},t.now=Date.now||function(){return(new Date).getTime()},t.inspect=o.default.inspect,t.isErrorInfo=function(e){return"ErrorInfo"==e.constructor.name},t.inspectError=function(e){var t,n;return e instanceof Error||"ErrorInfo"===(null===(n=null===(t=e)||void 0===t?void 0:t.constructor)||void 0===n?void 0:n.name)?o.default.inspect(e):e.toString()},t.inspectBody=function(e){return a.isBuffer(e)?e.toString():"string"==typeof e?e:o.default.inspect(e)},t.dataSizeBytes=function(e){if(a.isBuffer(e))return a.byteLength(e);if("string"==typeof e)return o.default.stringByteSize(e);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof e)},t.cheapRandStr=function(){return String(Math.random()).substr(2)},t.randomString=o.default.getRandomValues&&"undefined"!=typeof Uint8Array?function(e){var t=new Uint8Array(e);return o.default.getRandomValues(t),a.base64Encode(t)}:function(e){for(var t=a.base64CharSet,n=Math.round(4*e/3),r="",o=0;o<n;o++)r+=t[s(t)];return r},t.randomHexString=o.default.getRandomValues&&"undefined"!=typeof Uint8Array?function(e){var t=new Uint8Array(e);return o.default.getRandomValues(t),a.hexEncode(t)}:function(e){for(var t=a.hexCharSet,n=2*e,r="",o=0;o<n;o++)r+=t[s(t)];return r},t.arrChooseN=function(e,t){for(var n=Math.min(t,e.length),r=e.slice(),o=[],i=0;i<n;i++)o.push(m(r));return o},t.trim=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},t.promisify=function(e,t,n){return new Promise((function(o,i){e[t].apply(e,r.__spreadArray(r.__spreadArray([],n),[function(e,t){e?i(e):o(t)}]))}))},function(e){e.msgpack="msgpack",e.json="json"}(h=t.Format||(t.Format={})),t.decodeBody=function(e,t){return"msgpack"==t?o.default.msgpack.decode(e):JSON.parse(String(e))},t.encodeBody=function(e,t){return"msgpack"==t?o.default.msgpack.encode(e,!0):JSON.stringify(e)},t.allToLowerCase=function(e){return e.map((function(e){return e&&e.toLowerCase()}))},t.allToUpperCase=function(e){return e.map((function(e){return e&&e.toUpperCase()}))}},function(e,t,n){"use strict";(function(e){t.__esModule=!0;var r=n(1).__importDefault(n(32));"undefined"==typeof Window&&"undefined"==typeof WorkerGlobalScope&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");var o,i=e.navigator&&e.navigator.userAgent.toString(),a={agent:"browser",logTimestamps:!0,userAgent:i,currentUrl:e.location&&e.location.href,noUpgrade:i&&!!i.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:e.WebSocket,xhrSupported:e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:"undefined"!=typeof document,allowComet:(o=e.location,!e.WebSocket||!o||!o.origin||o.origin.indexOf("http")>-1),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:r.default,supportsBinary:!!e.TextDecoder,preferBinary:!1,ArrayBuffer:e.ArrayBuffer,atob:e.atob,nextTick:void 0!==e.setImmediate?e.setImmediate.bind(e):function(e){setTimeout(e,0)},addEventListener:e.addEventListener,inspect:JSON.stringify,stringByteSize:function(t){return e.TextDecoder&&(new e.TextEncoder).encode(t).length||t.length},TextEncoder:e.TextEncoder,TextDecoder:e.TextDecoder,Promise:e.Promise,getRandomValues:function(e){if(void 0!==e)return function(t,n){e.getRandomValues(t),n&&n(null)}}(e.crypto||msCrypto)};t.default=a}).call(this,n(14))},function(e,t,n){var r;e.exports=(r=n(7),function(){if("function"==typeof ArrayBuffer){var e=r.lib.WordArray,t=e.init,n=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,r=[],o=0;o<n;o++)r[o>>>2]|=e[o]<<24-o%4*8;t.call(this,r,n)}else t.apply(this,arguments)};n.prototype=e}}(),r.lib.WordArray)},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1).__importStar(n(2)),o=function(){function e(e,t,n,r){this.message=e,this.code=t,this.statusCode=n,this.cause=r}return e.prototype.toString=function(){var e="["+this.constructor.name;return this.message&&(e+=": "+this.message),this.statusCode&&(e+="; statusCode="+this.statusCode),this.code&&(e+="; code="+this.code),this.cause&&(e+="; cause="+r.inspectError(this.cause)),!this.href||this.message&&this.message.indexOf("help.ably.io")>-1||(e+="; see "+this.href+" "),e+="]"},e.fromValues=function(t){var n=t,o=n.message,i=n.code,a=n.statusCode;if("string"!=typeof o||"number"!=typeof i||"number"!=typeof a)throw new Error("ErrorInfo.fromValues(): invalid values: "+r.inspect(t));var s=Object.assign(new e(o,i,a),t);return s.code&&!s.href&&(s.href="https://help.ably.io/error/"+s.code),s},e}();t.default=o},function(e,t,n){"use strict";t.__esModule=!0,t.typedArrayToBuffer=t.byteLength=t.bufferCompare=t.utf8Decode=t.utf8Encode=t.hexDecode=t.hexEncode=t.base64Decode=t.base64Encode=t.toWordArray=t.toArrayBuffer=t.toBuffer=t.isBuffer=t.hexCharSet=t.base64CharSet=void 0;var r=n(1),o=n(48),i=n(35),a=n(17),s=r.__importDefault(n(4)),c=r.__importDefault(n(3)),u=c.default.ArrayBuffer,l=c.default.atob,f=c.default.TextEncoder,d=c.default.TextDecoder;function p(e){return null!=e&&void 0!==e.sigBytes}function h(e){return null!=e&&e.constructor===u}function g(e){return!!u&&u.isView&&u.isView(e)}function m(e){return h(e)||p(e)||g(e)}function y(e){if(!u)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(h(e))return new Uint8Array(e);if(g(e))return new Uint8Array(e.buffer);if(p(e)){for(var t=new u(e.sigBytes),n=new Uint8Array(t),r=0;r<e.sigBytes;r++)n[r]=e.words[r>>>2]>>>24-r%4*8&255;return n}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")}function v(e){return h(e)?e:y(e).buffer}function _(e){return g(e)&&(e=e.buffer),p(e)?e:s.default.create(e)}t.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t.hexCharSet="0123456789abcdef",t.isBuffer=m,t.toBuffer=y,t.toArrayBuffer=v,t.toWordArray=_,t.base64Encode=function(e){return p(e)?a.stringify(e):function(e){for(var n,r,o,i,a="",s=t.base64CharSet,c=e.byteLength,u=c%3,l=c-u,f=0;f<l;f+=3)n=(258048&(i=e[f]<<16|e[f+1]<<8|e[f+2]))>>12,r=(4032&i)>>6,o=63&i,a+=s[(16515072&i)>>18]+s[n]+s[r]+s[o];return 1==u?(n=(3&(i=e[l]))<<4,a+=s[(252&i)>>2]+s[n]+"=="):2==u&&(n=(1008&(i=e[l]<<8|e[l+1]))>>4,r=(15&i)<<2,a+=s[(64512&i)>>10]+s[n]+s[r]+"="),a}(y(e))},t.base64Decode=function(e){return u&&l?function(e){for(var t=null==l?void 0:l(e),n=t.length,r=new Uint8Array(n),o=0;o<n;o++){var i=t.charCodeAt(o);r[o]=i}return r.buffer}(e):a.parse(e)},t.hexEncode=function(e){return o.stringify(_(e))},t.hexDecode=function(e){var t=o.parse(e);return u?v(t):t},t.utf8Encode=function(e){return f?(new f).encode(e).buffer:i.parse(e)},t.utf8Decode=function(e){if(!m(e))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return d&&!p(e)?(new d).decode(e):(e=_(e),i.stringify(e))},t.bufferCompare=function(e,t){if(!e)return-1;if(!t)return 1;var n=_(e),r=_(t);n.clamp(),r.clamp();var o=n.sigBytes-r.sigBytes;if(0!=o)return o;for(var i=n.words,a=r.words,s=0;s<i.length;s++)if(0!=(o=i[s]-a[s]))return o;return 0},t.byteLength=function(e){return h(e)||g(e)?e.byteLength:p(e)?e.sigBytes:void 0},t.typedArrayToBuffer=function(e){return e.buffer}},function(e,t,n){(function(t){var r;e.exports=(r=r||function(e,r){var o;if("undefined"!=typeof window&&window.crypto&&(o=window.crypto),!o&&"undefined"!=typeof window&&window.msCrypto&&(o=window.msCrypto),!o&&void 0!==t&&t.crypto&&(o=t.crypto),!o)try{o=n(49)}catch(e){}var i=function(){if(o){if("function"==typeof o.getRandomValues)try{return o.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof o.randomBytes)try{return o.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),s={},c=s.lib={},u=c.Base={extend:function(e){var t=a(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=c.WordArray=u.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=t!=r?t:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,o=e.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var a=n[i>>>2]>>>24-i%4*8&255;t[r+i>>>2]|=a<<24-(r+i)%4*8}else for(i=0;i<o;i+=4)t[r+i>>>2]=n[i>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(i());return new l.init(t,e)}}),f=s.enc={},d=f.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new l.init(n,t/2)}},p=f.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new l.init(n,t)}},h=f.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},g=c.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,o=r.words,i=r.sigBytes,a=this.blockSize,s=i/(4*a),c=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,u=e.min(4*c,i);if(c){for(var f=0;f<c;f+=a)this._doProcessBlock(o,f);n=o.splice(0,c),r.sigBytes-=u}return new l.init(n,u)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),m=(c.Hasher=g.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new m.HMAC.init(e,n).finalize(t)}}}),s.algo={});return s}(Math),r)}).call(this,n(14))},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importStar(n(2)),i=r.__importDefault(n(0)),a=r.__importDefault(n(3));function s(e,t,n){try{t.apply(e,n)}catch(e){i.default.logAction(i.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+e+"; stack = "+(e&&e.stack))}}function c(e,t,n){for(var r,i,a,s=0;s<e.length;s++)if(r=e[s],n&&(r=r[n]),o.isArray(r)){for(;-1!==(i=o.arrIndexOf(r,t));)r.splice(i,1);n&&0===r.length&&delete e[s][n]}else if(o.isObject(r))for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&o.isArray(r[a])&&c([r],t,a)}var u=function(){function e(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return e.prototype.on=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(1===t.length){var r=t[0];if("function"!=typeof r)throw new Error("EventListener.on(): Invalid arguments: "+o.inspect(t));this.any.push(r)}if(2===t.length){var i=t[0],a=t[1];if("function"!=typeof a)throw new Error("EventListener.on(): Invalid arguments: "+o.inspect(t));if(o.isEmptyArg(i))this.any.push(a);else if(o.isArray(i))i.forEach((function(t){e.on(t,a)}));else{if("string"!=typeof i)throw new Error("EventListener.on(): Invalid arguments: "+o.inspect(t));var s=this.events[i]||(this.events[i]=[]);s.push(a)}}},e.prototype.off=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(0==n.length||o.isEmptyArg(n[0])&&o.isEmptyArg(n[1]))return this.any=[],this.events=Object.create(null),this.anyOnce=[],void(this.eventsOnce=Object.create(null));var i=n[0],a=n[1],s=null,u=null;if(1!==n.length&&a){if("function"!=typeof a)throw new Error("EventEmitter.off(): invalid arguments:"+o.inspect(n));u=(e=[i,a])[0],s=e[1]}else"function"==typeof i?s=i:u=i;if(s&&o.isEmptyArg(u))c([this.any,this.events,this.anyOnce,this.eventsOnce],s);else if(o.isArray(u))u.forEach((function(e){t.off(e,s)}));else{if("string"!=typeof u)throw new Error("EventEmitter.off(): invalid arguments:"+o.inspect(n));s?c([this.events,this.eventsOnce],s,u):(delete this.events[u],delete this.eventsOnce[u])}},e.prototype.listeners=function(e){if(e){var t=this.events[e]||[];return this.eventsOnce[e]&&Array.prototype.push.apply(t,this.eventsOnce[e]),t.length?t:null}return this.any.length?this.any:null},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r={event:e},i=[];this.anyOnce.length&&(Array.prototype.push.apply(i,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(i,this.any);var a=this.eventsOnce[e];a&&(Array.prototype.push.apply(i,a),delete this.eventsOnce[e]);var c=this.events[e];c&&Array.prototype.push.apply(i,c),o.arrForEach(i,(function(e){s(r,e,t)}))},e.prototype.once=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t.length;if((0===r||1===r&&"function"!=typeof t[0])&&a.default.Promise){var i=t[0];if("string"!=typeof i)throw new Error("EventEmitter.once(): Invalid arguments:"+o.inspect(t));return new a.default.Promise((function(t){e.once(i,t)}))}var s=t[0],c=t[1];if(1===t.length&&"function"==typeof s)this.anyOnce.push(s);else if(o.isEmptyArg(s)){if("function"!=typeof c)throw new Error("EventEmitter.once(): Invalid arguments:"+o.inspect(t));this.anyOnce.push(c)}else if(o.isArray(s)){var u=this,l=function(){var e=Array.prototype.slice.call(arguments);if(o.arrForEach(s,(function(e){u.off(e,l)})),"function"!=typeof c)throw new Error("EventEmitter.once(): Invalid arguments:"+o.inspect(t));c.apply(this,e)};o.arrForEach(s,(function(e){u.on(e,l)}))}else{if("string"!=typeof s)throw new Error("EventEmitter.once(): Invalid arguments:"+o.inspect(t));var f=this.eventsOnce[s]||(this.eventsOnce[s]=[]);if(c){if("function"!=typeof c)throw new Error("EventEmitter.once(): Invalid arguments:"+o.inspect(t));f.push(c)}}},e.prototype.whenState=function(t,n,r){for(var o=this,i=[],c=3;c<arguments.length;c++)i[c-3]=arguments[c];var u={event:t};if("string"!=typeof t||"string"!=typeof n)throw"whenState requires a valid event String argument";if("function"!=typeof r&&a.default.Promise)return new a.default.Promise((function(r){e.prototype.whenState.apply(o,[t,n,r].concat(i))}));t===n?s(u,r,i):this.once(t,r)},e}();t.default=u},function(e,t,n){"use strict";t.__esModule=!0,t.normaliseOptions=t.objectifyOptions=t.getHosts=t.getFallbackHosts=t.environmentFallbackHosts=t.getHttpScheme=t.getPort=t.getHost=void 0;var r=n(1),o=r.__importDefault(n(46)),i=r.__importDefault(n(3)),a=r.__importStar(n(6)),s=r.__importStar(n(2)),c=r.__importDefault(n(0)),u=r.__importDefault(n(5)),l=n(50),f="ably-js/"+l.version;i.default.agent&&(f+=" "+i.default.agent);var d=r.__assign(r.__assign({},o.default),{ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:l.version,apiVersion:"1.2",agent:f,getHost:p,getPort:h,getHttpScheme:g,environmentFallbackHosts:m,getFallbackHosts:y,getHosts:v,checkHost:_,objectifyOptions:b,normaliseOptions:w});function p(e,t,n){return t=n?t==e.restHost&&e.realtimeHost||t||e.realtimeHost:t||e.restHost}function h(e,t){return t||e.tls?e.tlsPort:e.port}function g(e){return e.tls?"https://":"http://"}function m(e){return[e+"-a-fallback.ably-realtime.com",e+"-b-fallback.ably-realtime.com",e+"-c-fallback.ably-realtime.com",e+"-d-fallback.ably-realtime.com",e+"-e-fallback.ably-realtime.com"]}function y(e){var t=e.fallbackHosts,n=void 0!==e.httpMaxRetryCount?e.httpMaxRetryCount:d.httpMaxRetryCount;return t?s.arrChooseN(t,n):[]}function v(e){return[e.restHost].concat(y(e))}function _(e){if("string"!=typeof e)throw new u.default("host must be a string; was a "+typeof e,4e4,400);if(!e.length)throw new u.default("host must not be zero-length",4e4,400)}function b(e){return"string"==typeof e?-1==e.indexOf(":")?{token:e}:{key:e}:e}function w(e){if(e.host&&(c.default.deprecated("host","restHost"),e.restHost=e.host),e.wsHost&&(c.default.deprecated("wsHost","realtimeHost"),e.realtimeHost=e.wsHost),e.queueEvents&&(c.default.deprecated("queueEvents","queueMessages"),e.queueMessages=e.queueEvents),e.fallbackHostsUseDefault){if(e.fallbackHosts){var t="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw c.default.logAction(c.default.LOG_ERROR,"Defaults.normaliseOptions",t),new u.default(t,4e4,400)}if(e.port||e.tlsPort)throw t="fallbackHostsUseDefault cannot be set when port or tlsPort are set",c.default.logAction(c.default.LOG_ERROR,"Defaults.normaliseOptions",t),new u.default(t,4e4,400);e.environment?c.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):c.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),e.fallbackHosts=d.FALLBACK_HOSTS}!0===e.recover&&(c.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),e.recover=function(e,t){t(!0)}),"function"==typeof e.recover&&!0===e.closeOnUnload&&(c.default.logAction(c.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),e.recover=void 0),"closeOnUnload"in e||(e.closeOnUnload=!e.recover),e.transports&&s.arrIn(e.transports,"xhr")&&(c.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),s.arrDeleteValue(e.transports,"xhr"),e.transports.push("xhr_streaming")),"queueMessages"in e||(e.queueMessages=!0);var n=e.environment&&String(e.environment).toLowerCase()||d.ENVIRONMENT,o=!n||"production"===n;e.fallbackHosts||e.restHost||e.realtimeHost||e.port||e.tlsPort||(e.fallbackHosts=o?d.FALLBACK_HOSTS:m(n));var l=e.restHost||(o?d.REST_HOST:n+"-"+d.REST_HOST),f=function(e,t,n){return e.realtimeHost?e.realtimeHost:e.restHost?(c.default.logAction(c.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+e.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+e.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),e.restHost):t?d.REALTIME_HOST:n+"-"+d.REALTIME_HOST}(e,o,n);s.arrForEach((e.fallbackHosts||[]).concat(l,f),_),e.port=e.port||d.PORT,e.tlsPort=e.tlsPort||d.TLS_PORT,"tls"in e||(e.tls=!0);var p=function(e){var t={};for(var n in d.TIMEOUTS)t[n]=e[n]||d.TIMEOUTS[n];return t}(e);if(e.useBinaryProtocol="useBinaryProtocol"in e?i.default.supportsBinary&&e.useBinaryProtocol:i.default.preferBinary,e.clientId&&((e.headers=e.headers||{})["X-Ably-ClientId"]=a.base64Encode(a.utf8Encode(e.clientId))),"idempotentRestPublishing"in e||(e.idempotentRestPublishing=!0),e.promises&&!i.default.Promise&&(c.default.logAction(c.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),e.promises=!1),e.agents)for(var h in e.agents)d.agent+=" "+h+"/"+e.agents[h];return r.__assign(r.__assign({},e),{useBinaryProtocol:"useBinaryProtocol"in e?i.default.supportsBinary&&e.useBinaryProtocol:i.default.preferBinary,realtimeHost:f,restHost:l,maxMessageSize:e.maxMessageSize||d.maxMessageSize,timeouts:p})}t.getHost=p,t.getPort=h,t.getHttpScheme=g,t.environmentFallbackHosts=m,t.getFallbackHosts=y,t.getHosts=v,t.objectifyOptions=b,t.normaliseOptions=w,t.default=d},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importDefault(n(3)),i=r.__importStar(n(2)),a=r.__importDefault(n(0)),s=r.__importDefault(n(9)),c=r.__importDefault(n(21)),u=r.__importDefault(n(52)),l=r.__importDefault(n(26)),f=r.__importDefault(n(23)),d=r.__importDefault(n(39)),p=r.__importDefault(n(5)),h=r.__importDefault(n(59)),g=r.__importDefault(n(22)),m=function(){},y=o.default.msgpack,v=function(){function e(e){if(!e){var t="no options provided";throw a.default.logAction(a.default.LOG_ERROR,"Rest()",t),new Error(t)}var n=s.default.objectifyOptions(e);n.log&&a.default.setLog(n.log.level,n.log.handler),a.default.logAction(a.default.LOG_MICRO,"Rest()","initialized with clientOptions "+i.inspect(e));var r=this.options=s.default.normaliseOptions(n);if(r.key){var o=r.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!o)throw t="invalid key parameter",a.default.logAction(a.default.LOG_ERROR,"Rest()",t),new p.default(t,40400,404);r.keyName=o[1],r.keySecret=o[2]}if("clientId"in r){if("string"!=typeof r.clientId&&null!==r.clientId)throw new p.default("clientId must be either a string or null",40012,400);if("*"===r.clientId)throw new p.default('Can’t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}a.default.logAction(a.default.LOG_MINOR,"Rest()","started; version = "+s.default.version),this.baseUri=this.authority=function(e){return s.default.getHttpScheme(r)+e+":"+s.default.getPort(r,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new l.default,this.auth=new c.default(this,r),this.channels=new _(this),this.push=new u.default(this)}return e.prototype.stats=function(e,t){if(void 0===t)if("function"==typeof e)t=e,e=null;else{if(this.options.promises)return i.promisify(this,"stats",arguments);t=m}var n=i.defaultGetHeaders(),r=this.options.useBinaryProtocol?i.Format.msgpack:i.Format.json,o=this.http.supportsLinkHeaders?void 0:r;this.options.headers&&i.mixin(n,this.options.headers),new f.default(this,"/stats",n,o,(function(e,t,n){for(var r=n?e:JSON.parse(e),o=0;o<r.length;o++)r[o]=h.default.fromValues(r[o]);return r})).get(e,t)},e.prototype.time=function(e,t){var n=this;if(void 0===t)if("function"==typeof e)t=e,e=null;else if(this.options.promises)return i.promisify(this,"time",arguments);var r=t||m,o=i.defaultGetHeaders();this.options.headers&&i.mixin(o,this.options.headers);var a=function(e){return n.authority(e)+"/time"};this.http.do(g.default.Get,this,a,o,null,e,(function(e,t,o,a){if(e)r(e);else{a||(t=JSON.parse(t));var s=t[0];s?(n.serverTimeOffset=s-i.now(),r(null,s)):r(new p.default("Internal error (unexpected result type from GET /time)",5e4,500))}}))},e.prototype.request=function(e,t,n,r,o,a){var s=this.options.useBinaryProtocol,c=s?y.encode:JSON.stringify,u=s?y.decode:JSON.parse,d=s?i.Format.msgpack:i.Format.json,h=this.http.supportsLinkHeaders?void 0:d;n=n||{};var g=e.toLowerCase(),v="get"==g?i.defaultGetHeaders(d):i.defaultPostHeaders(d);if(void 0===a){if(this.options.promises)return i.promisify(this,"request",arguments);a=m}"string"!=typeof r&&(r=c(r)),this.options.headers&&i.mixin(v,this.options.headers),o&&i.mixin(v,o);var _=new f.default(this,t,v,h,(function(e,t,n){return i.ensureArray(n?e:u(e))}),!0);if(!i.arrIn(l.default.methods,g))throw new p.default("Unsupported method "+g,40500,405);i.arrIn(l.default.methodsWithBody,g)?_[g](n,r,a):_[g](n,a)},e.prototype.setLog=function(e){a.default.setLog(e.level,e.handler)},e.Promise=function(t){return(t=s.default.objectifyOptions(t)).promises=!0,new e(t)},e.Callbacks=e,e}(),_=function(){function e(e){this.rest=e,this.all={}}return e.prototype.get=function(e,t){e=String(e);var n=this.all[e];return n?t&&n.setOptions(t):this.all[e]=n=new d.default(this.rest,e,t),n},e.prototype.release=function(e){delete this.all[String(e)]},e}();t.default=v},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importStar(n(2)),i=r.__importDefault(n(10)),a=r.__importDefault(n(8)),s=r.__importDefault(n(0)),c=r.__importDefault(n(60)),u=r.__importDefault(n(43)),l=r.__importDefault(n(9)),f=r.__importDefault(n(5)),d=function(e){function t(t){var n=e.call(this,t)||this;return s.default.logAction(s.default.LOG_MINOR,"Realtime()",""),n.connection=new c.default(n,n.options),n.channels=new p(n),!1!==t.autoConnect&&n.connect(),n}return r.__extends(t,e),t.prototype.connect=function(){s.default.logAction(s.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},t.prototype.close=function(){s.default.logAction(s.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},t.Promise=function(e){return(e=l.default.objectifyOptions(e)).promises=!0,new t(e)},t.Callbacks=t,t}(i.default),p=function(e){function t(t){var n=e.call(this)||this;return n.realtime=t,n.all={},n.inProgress={},t.connection.connectionManager.on("transport.active",(function(){n.onTransportActive()})),n}return r.__extends(t,e),t.prototype.onChannelMessage=function(e){var t=e.channel;if(void 0!==t){var n=this.all[t];n?n.onMessage(e):s.default.logAction(s.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+t)}else s.default.logAction(s.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+e.action)},t.prototype.onTransportActive=function(){for(var e in this.all){var t=this.all[e];"attaching"===t.state||"detaching"===t.state?t.checkPendingState():"suspended"===t.state&&t.attach()}},t.prototype.reattach=function(e){for(var t in this.all){var n=this.all[t];"attached"===n.state&&n.requestState("attaching",e)}},t.prototype.resetAttachedMsgIndicators=function(){for(var e in this.all){var t=this.all[e];"attached"===t.state&&(t._attachedMsgIndicator=!1)}},t.prototype.checkAttachedMsgIndicators=function(e){for(var t in this.all){var n=this.all[t];if("attached"===n.state&&!1===n._attachedMsgIndicator){var r="30s after a resume, found channel which has not received an attached; channelId = "+t+"; connectionId = "+e;s.default.logAction(s.default.LOG_ERROR,"Channels.checkAttachedMsgIndicators()",r),n.requestState("attaching")}}},t.prototype.propogateConnectionInterruption=function(e,t){var n=["attaching","attached","detaching","suspended"],r={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"}[e];for(var i in this.all){var a=this.all[i];o.arrIn(n,a.state)&&a.notifyState(r,t)}},t.prototype.get=function(e,t){e=String(e);var n=this.all[e];if(n){if(t){if(n._shouldReattachToSetOptions(t))throw new f.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);n.setOptions(t)}}else n=this.all[e]=new u.default(this.realtime,e,t);return n},t.prototype.release=function(e){e=String(e);var t=this.all[e];if(t){var n=t.getReleaseErr();if(n)throw n;delete this.all[e],delete this.inProgress[e]}},t.prototype.setInProgress=function(e,t,n){this.inProgress[e.name]=this.inProgress[e.name]||{},this.inProgress[e.name][t]=n,!n&&this.hasNopending()&&this.emit("nopending")},t.prototype.onceNopending=function(e){this.hasNopending()?e():this.once("nopending",e)},t.prototype.hasNopending=function(){return o.arrEvery(o.valuesArray(this.inProgress,!0),(function(e){return!o.containsValue(e,!0)}))},t}(a.default);t.default=d},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importStar(n(2)),i=r.__importDefault(n(5)),a=r.__importDefault(n(13)),s=r.__importDefault(n(15)),c={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17},u=[];Object.keys(c).forEach((function(e){u[c[e]]=e}));var l={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},f=Object.keys(l);function d(e){var t=[];if(e)for(var n=0;n<e.length;n++)t.push(e[n].toString());return"[ "+t.join(", ")+" ]"}l.MODE_ALL=l.PRESENCE|l.PUBLISH|l.SUBSCRIBE|l.PRESENCE_SUBSCRIBE;var p="id channel channelSerial connectionId connectionKey connectionSerial count msgSerial timestamp".split(" "),h=function(){function e(){var e=this;this.hasFlag=function(t){return(e.flags&l[t])>0}}return e.prototype.setFlag=function(e){return this.flags=this.flags|l[e]},e.prototype.getMode=function(){return this.flags&&this.flags&l.MODE_ALL},e.prototype.encodeModesToFlags=function(e){var t=this;e.forEach((function(e){return t.setFlag(e)}))},e.prototype.decodeModesFromFlags=function(){var t=this,n=[];return e.channelModes.forEach((function(e){t.hasFlag(e)&&n.push(e)})),n.length>0?n:void 0},e.fromValues=function(t){return Object.assign(new e,t)},e.Action=c,e.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],e.ActionName=u,e.serialize=o.encodeBody,e.deserialize=function(t,n){var r=o.decodeBody(t,n);return e.fromDeserialized(r)},e.fromDeserialized=function(t){var n=t.error;n&&(t.error=i.default.fromValues(n));var r=t.messages;if(r)for(var o=0;o<r.length;o++)r[o]=a.default.fromValues(r[o]);var c=t.presence;if(c)for(o=0;o<c.length;o++)c[o]=s.default.fromValues(c[o],!0);return Object.assign(new e,t)},e.stringify=function(t){var n,r="[ProtocolMessage";void 0!==t.action&&(r+="; action="+e.ActionName[t.action]||!1);for(var c=0;c<p.length;c++)n=p[c],void 0!==t[n]&&(r+="; "+n+"="+t[n]);if(t.messages&&(r+="; messages="+d(a.default.fromValuesArray(t.messages))),t.presence&&(r+="; presence="+d(s.default.fromValuesArray(t.presence))),t.error&&(r+="; error="+i.default.fromValues(t.error).toString()),t.auth&&t.auth.accessToken&&(r+="; token="+t.auth.accessToken),t.flags&&(r+="; flags="+f.filter(t.hasFlag).join(",")),t.params){var u="";o.forInOwnNonNullProperties(t.params,(function(e){u.length>0&&(u+="; "),u+=e+"="+t.params[e]})),u.length>0&&(r+="; params=["+u+"]")}return r+="]"},e.isDuplicate=function(e,t){if(e&&t&&(e.action===c.MESSAGE||e.action===c.PRESENCE)&&e.action===t.action&&e.channel===t.channel&&e.id===t.id){if(e.action===c.PRESENCE)return!0;if(e.messages.length===t.messages.length){for(var n=0;n<e.messages.length;n++){var r=e.messages[n],o=t.messages[n];if((r.extras&&r.extras.delta&&r.extras.delta.format)!==(o.extras&&o.extras.delta&&o.extras.delta.format))return!1}return!0}}return!1},e}();t.default=h},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importStar(n(6)),i=r.__importDefault(n(0)),a=r.__importDefault(n(20)),s=r.__importDefault(n(5)),c=r.__importStar(n(2));function u(e){if(e&&e.cipher&&!e.cipher.channelCipher){if(!a.default)throw new Error("Encryption not enabled; use ably.encryption.js instead");var t=a.default.getCipher(e.cipher);return{cipher:t.cipherParams,channelCipher:t.cipher}}return e}function l(e){var t=0;return e.name&&(t+=e.name.length),e.clientId&&(t+=e.clientId.length),e.extras&&(t+=JSON.stringify(e.extras).length),e.data&&(t+=c.dataSizeBytes(e.data)),t}var f=function(){function e(){}return e.prototype.toJSON=function(){var e=this.encoding,t=this.data;return t&&o.isBuffer(t)&&(arguments.length>0?(e=e?e+"/base64":"base64",t=o.base64Encode(t)):t=o.toBuffer(t)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:e,data:t}},e.prototype.toString=function(){var e="[Message";return this.name&&(e+="; name="+this.name),this.id&&(e+="; id="+this.id),this.timestamp&&(e+="; timestamp="+this.timestamp),this.clientId&&(e+="; clientId="+this.clientId),this.connectionId&&(e+="; connectionId="+this.connectionId),this.encoding&&(e+="; encoding="+this.encoding),this.extras&&(e+="; extras ="+JSON.stringify(this.extras)),this.data&&("string"==typeof this.data?e+="; data="+this.data:o.isBuffer(this.data)?e+="; data (buffer)="+o.base64Encode(this.data):e+="; data (json)="+JSON.stringify(this.data)),this.extras&&(e+="; extras="+JSON.stringify(this.extras)),e+="]"},e.encrypt=function(e,t,n){var r=e.data,i=e.encoding,a=t.channelCipher;i=i?i+"/":"",o.isBuffer(r)||(r=o.utf8Encode(String(r)),i+="utf-8/"),a.encrypt(r,(function(t,r){t?n(t):(e.data=r,e.encoding=i+"cipher+"+a.algorithm,n(null,e))}))},e.encode=function(t,n,r){var i=t.data;if("string"!=typeof i&&!o.isBuffer(i)&&null!=i){if(!c.isObject(i)&&!c.isArray(i))throw new s.default("Data type is unsupported",40013,400);t.data=JSON.stringify(i),t.encoding=t.encoding?t.encoding+"/json":"json"}null!=n&&n.cipher?e.encrypt(t,n,r):r(null,t)},e.encodeArray=function(t,n,r){for(var o=0,i=0;i<t.length;i++)e.encode(t[i],n,(function(e){e?r(e):++o==t.length&&r(null,t)}))},e.decode=function(e,t){var n=function(e){return e&&e.channelOptions?e:{channelOptions:e,plugins:{},baseEncodedPreviousPayload:void 0}}(t),r=e.data,i=e.encoding;if(i){var a=i.split("/"),c=void 0,u=a.length,l=e.data,f="";try{for(;(c=u)>0;){var d=a[--u].match(/([-\w]+)(\+([\w-]+))?/);if(!d)break;switch(f=d[1]){case"base64":l=o.base64Decode(String(l)),c==a.length&&(r=l);continue;case"utf-8":l=o.utf8Decode(l);continue;case"json":l=JSON.parse(l);continue;case"cipher":if(null!=n.channelOptions&&n.channelOptions.cipher&&n.channelOptions.channelCipher){var p=d[3],h=n.channelOptions.channelCipher;if(p!=h.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");l=h.decrypt(l);continue}throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!n.plugins||!n.plugins.vcdiff)throw new s.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if("undefined"==typeof Uint8Array)throw new s.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var g=n.baseEncodedPreviousPayload;"string"==typeof g&&(g=o.utf8Encode(g)),g=o.toBuffer(g),l=o.toBuffer(l),r=l=o.typedArrayToBuffer(n.plugins.vcdiff.decode(l,g))}catch(e){throw new s.default("Vcdiff delta decode failed with "+e,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(e){var m=e;throw new s.default("Error processing the "+f+" encoding, decoder returned ‘"+m.message+"’",m.code||40013,400)}finally{e.encoding=c<=0?null:a.slice(0,c).join("/"),e.data=l}}n.baseEncodedPreviousPayload=r},e.fromResponseBody=function(t,n,r){r&&(t=c.decodeBody(t,r));for(var o=0;o<t.length;o++){var a=t[o]=e.fromValues(t[o]);try{e.decode(a,n)}catch(e){i.default.logAction(i.default.LOG_ERROR,"Message.fromResponseBody()",e.toString())}}return t},e.fromValues=function(t){return Object.assign(new e,t)},e.fromValuesArray=function(t){for(var n=t.length,r=new Array(n),o=0;o<n;o++)r[o]=e.fromValues(t[o]);return r},e.fromEncoded=function(t,n){var r=e.fromValues(t),o=u(n);try{e.decode(r,o)}catch(e){i.default.logAction(i.default.LOG_ERROR,"Message.fromEncoded()",e.toString())}return r},e.fromEncodedArray=function(t,n){return u(n),t.map((function(t){return e.fromEncoded(t,n)}))},e.getMessagesSize=function(e){for(var t,n=0,r=0;r<e.length;r++)n+=(t=e[r]).size||(t.size=l(t));return n},e.serialize=c.encodeBody,e}();t.default=f},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importDefault(n(0)),i=r.__importStar(n(6)),a=r.__importDefault(n(13)),s=r.__importStar(n(2));function c(e){return u.Actions.indexOf(e)}var u=function(){function e(){}return e.prototype.isSynthesized=function(){return!this.id||!this.connectionId||this.id.substring(this.connectionId.length,0)!==this.connectionId},e.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var e=this.id.split(":");return{connectionId:e[0],msgSerial:parseInt(e[1],10),index:parseInt(e[2],10)}},e.prototype.toJSON=function(){var e=this.data,t=this.encoding;return e&&i.isBuffer(e)&&(arguments.length>0?(t=t?t+"/base64":"base64",e=i.base64Encode(e)):e=i.toBuffer(e)),{clientId:this.clientId,action:c(this.action),data:e,encoding:t}},e.prototype.toString=function(){var e="[PresenceMessage";return e+="; action="+this.action,this.id&&(e+="; id="+this.id),this.timestamp&&(e+="; timestamp="+this.timestamp),this.clientId&&(e+="; clientId="+this.clientId),this.connectionId&&(e+="; connectionId="+this.connectionId),this.encoding&&(e+="; encoding="+this.encoding),this.data&&("string"==typeof this.data?e+="; data="+this.data:i.isBuffer(this.data)?e+="; data (buffer)="+i.base64Encode(this.data):e+="; data (json)="+JSON.stringify(this.data)),e+="]"},e.fromResponseBody=function(t,n,r){var i=[];r&&(t=s.decodeBody(t,r));for(var a=0;a<t.length;a++){var c=i[a]=e.fromValues(t[a],!0);try{e.decode(c,n)}catch(e){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",e.toString())}}return i},e.fromValues=function(t,n){return n&&(t.action=e.Actions[t.action]),Object.assign(new e,t)},e.fromValuesArray=function(t){for(var n=t.length,r=new Array(n),o=0;o<n;o++)r[o]=e.fromValues(t[o]);return r},e.fromEncoded=function(t,n){var r=e.fromValues(t,!0);try{e.decode(r,n)}catch(e){o.default.logAction(o.default.LOG_ERROR,"PresenceMessage.fromEncoded()",e.toString())}return r},e.fromEncodedArray=function(t,n){return t.map((function(t){return e.fromEncoded(t,n)}))},e.Actions=["absent","present","enter","leave","update"],e.encode=a.default.encode,e.decode=a.default.decode,e.getMessagesSize=a.default.getMessagesSize,e}();t.default=u},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importStar(n(2)),i=r.__importDefault(n(12)),a=r.__importDefault(n(38)),s=r.__importDefault(n(0)),c=r.__importDefault(n(9)),u=r.__importDefault(n(25)),l=r.__importDefault(n(21)),f=r.__importDefault(n(5)),d=r.__importDefault(n(24));function p(e){return function(e){return!!e.code&&!l.default.isTokenErr(e)&&(!!o.arrIn([80015,80017,80030],e.code)||e.code>=4e4&&e.code<5e4)}(e)?[i.default.fromValues({action:i.default.Action.ERROR,error:e})]:[i.default.fromValues({action:i.default.Action.DISCONNECTED,error:e})]}var h=function(e){function t(t,n,r){var o=e.call(this,t,n,r,!0)||this;return o.onAuthUpdated=function(e){o.authParams={access_token:e.token}},o.stream=!("stream"in r)||r.stream,o.sendRequest=null,o.recvRequest=null,o.pendingCallback=null,o.pendingItems=null,o}return r.__extends(t,e),t.prototype.connect=function(){var e=this;s.default.logAction(s.default.LOG_MINOR,"CometTransport.connect()","starting"),a.default.prototype.connect.call(this);var t=this.params,n=t.options,r=c.default.getHost(n,t.host),i=c.default.getPort(n),u=n.tls?"https://":"http://";this.baseUri=u+r+":"+i+"/comet/";var l=this.baseUri+"connect";s.default.logAction(s.default.LOG_MINOR,"CometTransport.connect()","uri: "+l),this.auth.getAuthParams((function(t,n){if(t)e.disconnect(t);else if(!e.isDisposed){e.authParams=n;var r=e.params.getConnectParams(n);"stream"in r&&(e.stream=r.stream),s.default.logAction(s.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+o.toQueryString(r));var i=!1,a=e.recvRequest=e.createRequest(l,null,r,null,e.stream?d.default.REQ_RECV_STREAM:d.default.REQ_RECV);a.on("data",(function(t){e.recvRequest&&(i||(i=!0,e.emit("preconnect")),e.onData(t))})),a.on("complete",(function(t){e.recvRequest||(t=t||new f.default("Request cancelled",80003,400)),e.recvRequest=null,i||t||(i=!0,e.emit("preconnect")),e.onActivity(),t?t.code?e.onData(p(t)):e.disconnect(t):o.nextTick((function(){e.recv()}))})),a.exec()}}))},t.prototype.requestClose=function(){s.default.logAction(s.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},t.prototype.requestDisconnect=function(){s.default.logAction(s.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},t.prototype._requestCloseOrDisconnect=function(e){var t=this,n=e?this.closeUri:this.disconnectUri;if(n){var r=this.createRequest(n,null,this.authParams,null,d.default.REQ_SEND);r.on("complete",(function(n){n&&(s.default.logAction(s.default.LOG_ERROR,"CometTransport.request"+(e?"Close()":"Disconnect()"),"request returned err = "+o.inspectError(n)),t.finish("disconnected",n))})),r.exec()}},t.prototype.dispose=function(){var e=this;s.default.logAction(s.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(s.default.logAction(s.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",u.default.disconnected),o.nextTick((function(){e.emit("disposed")})))},t.prototype.onConnect=function(e){if(!this.isDisposed){var t=e.connectionKey;a.default.prototype.onConnect.call(this,e);var n=this.baseUri+t;s.default.logAction(s.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+n+"; connectionKey = "+e.connectionKey),this.sendUri=n+"/send",this.recvUri=n+"/recv",this.closeUri=n+"/close",this.disconnectUri=n+"/disconnect"}},t.prototype.send=function(e){if(this.sendRequest)return this.pendingItems=this.pendingItems||[],void this.pendingItems.push(e);var t=this.pendingItems||[];t.push(e),this.pendingItems=null,this.sendItems(t)},t.prototype.sendAnyPending=function(){var e=this.pendingItems;e&&(this.pendingItems=null,this.sendItems(e))},t.prototype.sendItems=function(e){var t=this,n=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(e),d.default.REQ_SEND);n.on("complete",(function(e,n){e&&s.default.logAction(s.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+o.inspectError(e)),t.sendRequest=null,e?e.code?t.onData(p(e)):t.disconnect(e):(n&&t.onData(n),t.pendingItems&&o.nextTick((function(){t.sendRequest||t.sendAnyPending()})))})),n.exec()},t.prototype.recv=function(){var e=this;if(!this.recvRequest&&this.isConnected){var t=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?d.default.REQ_RECV_STREAM:d.default.REQ_RECV_POLL);t.on("data",(function(t){e.onData(t)})),t.on("complete",(function(t){e.recvRequest=null,e.onActivity(),t?t.code?e.onData(p(t)):e.disconnect(t):o.nextTick((function(){e.recv()}))})),t.exec()}},t.prototype.onData=function(e){try{var t=this.decodeResponse(e);if(t&&t.length)for(var n=0;n<t.length;n++)this.onProtocolMessage(i.default.fromDeserialized(t[n]))}catch(e){s.default.logAction(s.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+e.stack)}},t.prototype.encodeRequest=function(e){return JSON.stringify(e)},t.prototype.decodeResponse=function(e){return"string"==typeof e?JSON.parse(e):e},t}(a.default);t.default=h},function(e,t,n){var r;e.exports=(r=n(7),function(){var e=r,t=e.lib.WordArray;function n(e,n,r){for(var o=[],i=0,a=0;a<n;a++)if(a%4){var s=r[e.charCodeAt(a-1)]<<a%4*2|r[e.charCodeAt(a)]>>>6-a%4*2;o[i>>>2]|=s<<24-i%4*8,i++}return t.create(o,i)}e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.clamp();for(var o=[],i=0;i<n;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<n;s++)o.push(r.charAt(a>>>6*(3-s)&63));var c=r.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(e){var t=e.length,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<r.length;i++)o[r.charCodeAt(i)]=i}var a=r.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return n(e,t,o)}}}(),r.enc.Base64)},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importDefault(n(3)),i=r.__importStar(n(2)),a=r.__importDefault(n(0)),s=r.__importDefault(n(21)),c=r.__importStar(n(6)),u=r.__importDefault(n(22)),l=r.__importDefault(n(5)),f=o.default.msgpack;function d(e,t,n,r,o){e.http.supportsAuthHeaders?e.auth.getAuthHeaders((function(e,a){e?r(e):o(i.mixin(a,t),n)})):e.auth.getAuthParams((function(e,a){e?r(e):o(t,i.mixin(a,n))}))}function p(e){var t=[];if(e)for(var n in e)t.push(n+"="+e[n]);return t.join("&")}function h(e,t){return e+(t?"?":"")+p(t)}var g=function(){function e(){}return e.get=function(t,n,r,o,i,a){e.do(u.default.Get,t,n,null,r,o,i,a)},e.delete=function(t,n,r,o,i,a){e.do(u.default.Delete,t,n,null,r,o,i,a)},e.post=function(t,n,r,o,i,a,s){e.do(u.default.Post,t,n,r,o,i,a,s)},e.patch=function(t,n,r,o,i,a,s){e.do(u.default.Patch,t,n,r,o,i,a,s)},e.put=function(t,n,r,o,i,a,s){e.do(u.default.Put,t,n,r,o,i,a,s)},e.do=function(e,t,n,r,o,u,g,m){a.default.shouldLog(a.default.LOG_MICRO)&&(m=function(e,t,n,r){return function(o,s,u,l,f){o?a.default.logAction(a.default.LOG_MICRO,"Resource."+t+"()","Received Error; "+h(n,r)+"; Error: "+i.inspectError(o)):a.default.logAction(a.default.LOG_MICRO,"Resource."+t+"()","Received; "+h(n,r)+"; Headers: "+p(u)+"; StatusCode: "+f+"; Body: "+(c.isBuffer(s)?s.toString():s)),e&&e(o,s,u,l,f)}}(m,e,n,u)),g&&(m=m&&function(e,t){return function(n,r,o,a,s){if(!n||r){if(!a)try{r=i.decodeBody(r,t)}catch(t){return void e(t)}if(r){var c=r,u=c.statusCode,f=c.response,d=c.headers;if(void 0!==u){if(u<200||u>=300){var p=f&&f.error||n;return p||((p=new Error("Error in unenveloping "+r)).statusCode=u),void e(p,f,d,!0,u)}e(n,f,d,!0,u)}else e(n,r,o,!0,s)}else e(new l.default("unenvelope(): Response body is missing",null))}else e(n)}}(m,g),(u=u||{}).envelope=g),d(t,o,u,m,(function o(c,u){var l;if(a.default.shouldLog(a.default.LOG_MICRO)&&a.default.logAction(a.default.LOG_MICRO,"Resource."+e+"()","Sending; "+h(n,u)),a.default.shouldLog(a.default.LOG_MICRO)){var p=r;if((null===(l=c["content-type"])||void 0===l?void 0:l.indexOf("msgpack"))>0)try{p=f.decode(r)}catch(t){a.default.logAction(a.default.LOG_MICRO,"Resource."+e+"()","Sending MsgPack Decoding Error: "+i.inspectError(t))}a.default.logAction(a.default.LOG_MICRO,"Resource."+e+"()","Sending; "+h(n,u)+"; Body: "+p)}t.http.do(e,t,n,c,r,u,(function(e,n,r,i,a){e&&s.default.isTokenErr(e)?t.auth.authorize(null,null,(function(e){e?m(e):d(t,r,u,m,o)})):m(e,n,r,i,a)}))}))},e}();t.default=g},function(e,t,n){"use strict";(function(e){t.__esModule=!0;var r=n(1),o=r.__importStar(n(2)),i=r.__importDefault(n(8)),a=r.__importDefault(n(5)),s=r.__importDefault(n(0)),c=r.__importDefault(n(9)),u=r.__importStar(n(6)),l=r.__importDefault(n(24));function f(e,t){if(function(e,t){return o.arrIn(o.allToLowerCase(o.keysArray(t)),"x-ably-errorcode")}(0,t))return e.error&&a.default.fromValues(e.error)}var d=function(){},p=0,h={},g=void 0!==e&&e.XDomainRequest;function m(){var e,t;return g&&(e=(t=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/))&&Number(t[1]))&&10===e}var y=function(e){function t(t,n,r,i,a,s,c){var u=e.call(this)||this;return(r=r||{}).rnd=o.cheapRandStr(),m()&&!r.envelope&&(r.envelope="json"),u.uri=t+o.toQueryString(r),u.headers=n||{},u.body=i,u.method=c?c.toUpperCase():o.isEmptyArg(i)?"GET":"POST",u.requestMode=a,u.timeouts=s,u.timedOut=!1,u.requestComplete=!1,u.id=String(++p),h[u.id]=u,u}return r.__extends(t,e),t.createRequest=function(e,n,r,i,a,s,u){var l=s||c.default.TIMEOUTS;return new t(e,n,o.copy(r),i,a,l,u)},t.prototype.complete=function(e,t,n,r,o){this.requestComplete||(this.requestComplete=!0,!e&&t&&this.emit("data",t),this.emit("complete",e,t,n,r,o),this.dispose())},t.prototype.abort=function(){this.dispose()},t.prototype.exec=function(){var e=this,t=this.headers,n=this.requestMode==l.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,r=this.timer=setTimeout((function(){e.timedOut=!0,c.abort()}),n),i=this.method,c=this.xhr=new XMLHttpRequest,d=t.accept,p=this.body,h="text";for(var g in d?0===d.indexOf("application/x-msgpack")&&(h="arraybuffer"):t.accept="application/json",p&&(t["content-type"]||(t["content-type"]="application/json")).indexOf("application/json")>-1&&"string"!=typeof p&&(p=JSON.stringify(p)),c.open(i,this.uri,!0),c.responseType=h,"authorization"in t&&(c.withCredentials=!0),t)c.setRequestHeader(g,t[g]);var m,y,v,_=function(t,n,r,o){var i,c=n+" (event type: "+t.type+")";(null===(i=null==e?void 0:e.xhr)||void 0===i?void 0:i.statusText)&&(c+=", current statusText is "+e.xhr.statusText),s.default.logAction(s.default.LOG_ERROR,"Request.on"+t.type+"()",c),e.complete(new a.default(c,r,o))};c.onerror=function(e){_(e,"XHR error occurred",null,400)},c.onabort=function(t){e.timedOut?_(t,"Request aborted due to request timeout expiring",null,408):_(t,"Request cancelled",null,400)},c.ontimeout=function(e){_(e,"Request timed out",null,408)};var b=0,w=!1,O=function(){var n;try{var r=function(e,t){return e.getResponseHeader&&e.getResponseHeader(t)}(c,"content-type");if(r?r.indexOf("application/json")>=0:"text"==c.responseType){var i="arraybuffer"===c.responseType?u.utf8Decode(c.response):String(c.responseText);n=i.length?JSON.parse(i):i,w=!0}else n=c.response;void 0!==n.response?(y=n.statusCode,v=y<400,t=n.headers,n=n.response):t=function(e){for(var t=o.trim(e.getAllResponseHeaders()).split("\r\n"),n={},r=0;r<t.length;r++){var i=t[r].split(":").map(o.trim);n[i[0].toLowerCase()]=i[1]}return n}(c)}catch(t){return void e.complete(new a.default("Malformed response body from server: "+t.message,null,400))}if(v||o.isArray(n))e.complete(null,n,t,w,y);else{var s=f(n,t);s||(s=new a.default("Error response received from server: "+y+" body was: "+o.inspect(n),null,y)),e.complete(s,n,t,w,y)}};function R(){for(var e,t,n=c.responseText,r=n.length-1;b<r&&(e=n.indexOf("\n",b))>-1;)t=n.slice(b,e),b=e+1,S(t)}var S=function(t){try{t=JSON.parse(t)}catch(t){return void e.complete(new a.default("Malformed response body from server: "+t.message,null,400))}e.emit("data",t)};c.onreadystatechange=function(){var t=c.readyState;t<3||0!==c.status&&(void 0===y&&(1223===(y=c.status)&&(y=204),clearTimeout(r),v=y<400,204!=y?m=e.requestMode==l.default.REQ_RECV_STREAM&&v&&function(e){return e.getResponseHeader&&(e.getResponseHeader("transfer-encoding")||!e.getResponseHeader("content-length"))}(c):e.complete(null,null,null,null,y)),3==t&&m?R():4==t&&(m?(R(),e.streamComplete=!0,o.nextTick((function(){e.complete()}))):O()))},c.send(p)},t.prototype.dispose=function(){var e=this.xhr;if(e){e.onreadystatechange=e.onerror=e.onabort=e.ontimeout=d,this.xhr=null;var t=this.timer;t&&(clearTimeout(t),this.timer=null),this.requestComplete||e.abort()}delete h[this.id]},t}(i.default);t.default=y}).call(this,n(14))},function(e,t,n){"use strict";n.r(t);var r=n(4),o=n.n(r),i=n(17),a=n(27),s=n.n(a),c=n(3),u=n.n(c),l=n(0),f=n.n(l),d=n(6),p=function(){var e;if(u.a.getRandomWordArray)e=u.a.getRandomWordArray;else if("undefined"!=typeof Uint32Array&&u.a.getRandomValues){var t=new Uint32Array(4);e=function(e,n){var r=e/4,o=4==r?t:new Uint32Array(r);u.a.getRandomValues(o,(function(e){n(e,d.toWordArray(o))}))}}else e=function(e,t){f.a.logAction(f.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var n=e/4,r=new Array(n),i=0;i<n;i++)r[i]=Math.floor(4294967296*Math.random())-2147483648;t(null,o.a.create(r))};function n(e){if("aes"===e.algorithm&&"cbc"===e.mode){if(128===e.keyLength||256===e.keyLength)return;throw new Error("Unsupported key length "+e.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function r(e){return e.replace("_","/").replace("-","+")}var a=[o.a.create([269488144,269488144,269488144,269488144],16),o.a.create([16777216],1),o.a.create([33685504],2),o.a.create([50529024],3),o.a.create([67372036],4),o.a.create([84215045,83886080],5),o.a.create([101058054,101056512],6),o.a.create([117901063,117901056],7),o.a.create([134744072,134744072],8),o.a.create([151587081,151587081,150994944],9),o.a.create([168430090,168430090,168427520],10),o.a.create([185273099,185273099,185273088],11),o.a.create([202116108,202116108,202116108],12),o.a.create([218959117,218959117,218959117,218103808],13),o.a.create([235802126,235802126,235802126,235798528],14),o.a.create([252645135,252645135,252645135,252645135],15),o.a.create([269488144,269488144,269488144,269488144],16)];function c(){}function l(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}function p(e,t,n){this.algorithm=e.algorithm+"-"+String(e.keyLength)+"-"+e.mode,this.cjsAlgorithm=e.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=d.toWordArray(e.key),n&&(this.iv=d.toWordArray(n).clone()),this.blockLengthWords=t}return c.CipherParams=l,c.getDefaultParams=function(e){var t;if("function"!=typeof e&&"string"!=typeof e){if(!e.key)throw new Error("Crypto.getDefaultParams: a key is required");t="string"==typeof e.key?Object(i.parse)(r(e.key)):d.toWordArray(e.key);var o=new l;if(o.key=t,o.algorithm=e.algorithm||"aes",o.keyLength=32*t.words.length,o.mode=e.mode||"cbc",e.keyLength&&e.keyLength!==o.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+e.keyLength+" was specified, but the key actually has length "+o.keyLength);return n(o),o}if(f.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),"function"==typeof e)c.generateRandomKey((function(t){e(null,c.getDefaultParams({key:t}))}));else{if("function"!=typeof arguments[1])throw new Error("Invalid arguments for Crypto.getDefaultParams");arguments[1](null,c.getDefaultParams({key:e}))}},c.generateRandomKey=function(t,n){1==arguments.length&&"function"==typeof t&&(n=t,t=void 0),e((t||256)/8,n)},c.getCipher=function(e){var t=e instanceof l?e:c.getDefaultParams(e);return{cipherParams:t,cipher:new p(t,4,e.iv)}},p.prototype.encrypt=function(t,n){f.a.logAction(f.a.LOG_MICRO,"CBCCipher.encrypt()","");var r=(t=d.toWordArray(t)).sigBytes,o=function(e){return e+16&-16}(r),i=this,c=function(){i.getIv((function(e,s){if(e)n(e);else{var c=i.encryptCipher.process(t.concat(a[o-r])),u=s.concat(c);n(null,u)}}))};this.encryptCipher?c():this.iv?(this.encryptCipher=s.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),c()):e(16,(function(e,t){e?n(e):(i.encryptCipher=s.a.algo[i.cjsAlgorithm].createEncryptor(i.key,{iv:t}),i.iv=t,c())}))},p.prototype.decrypt=function(e){f.a.logAction(f.a.LOG_MICRO,"CBCCipher.decrypt()",""),e=d.toWordArray(e);var t=this.blockLengthWords,n=e.words,r=o.a.create(n.slice(0,t)),i=o.a.create(n.slice(t)),a=s.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:r}),c=a.process(i),u=a.finalize();return a.reset(),u&&u.sigBytes&&c.concat(u),c},p.prototype.getIv=function(t){if(this.iv){var n=this.iv;return this.iv=null,void t(null,n)}var r=this;e(16,(function(e,n){e?t(e):t(null,r.encryptCipher.process(n))}))},c}();t.default=p},function(t,n,r){"use strict";n.__esModule=!0;var o,i,a=r(1),s=a.__importDefault(r(0)),c=a.__importDefault(r(3)),u=a.__importStar(r(2)),l=a.__importDefault(r(28)),f=a.__importStar(r(6)),d=a.__importDefault(r(5)),p=a.__importDefault(r(51)),h=r(17),g=r(35),m=a.__importDefault(r(22)),y=Math.pow(2,17);function v(){}function _(){return("000000"+Math.floor(1e16*Math.random())).slice(-16)}function b(e){return!!e.connection}function w(e){return u.isErrorInfo(e)?(e.code||(403===e.statusCode?e.code=40300:(e.code=40170,e.statusCode=401)),e):new d.default(u.inspectError(e),e.code||40170,e.statusCode||401)}function O(e){if(!e)return"";"string"==typeof e&&(e=JSON.parse(e));var t={},n=u.keysArray(e,!0);if(!n)return"";n.sort();for(var r=0;r<n.length;r++)t[n[r]]=e[n[r]].sort();return JSON.stringify(t)}function R(e){if(e.authCallback)s.default.logAction(s.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(e.authUrl)s.default.logAction(s.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(e.key)s.default.logAction(s.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else{if(!e.tokenDetails){var t="authOptions must include valid authentication parameters";throw s.default.logAction(s.default.LOG_ERROR,"Auth()",t),new Error(t)}s.default.logAction(s.default.LOG_MINOR,"Auth()","using token auth with supplied token only")}}c.default.createHmac?(i=function(t){return e.from(t,"ascii").toString("base64")},o=function(e,t){var n=c.default.createHmac("SHA256",t);return n.update(e),n.digest("base64")}):(i=function(e){return h.stringify(g.parse(e))},o=function(e,t){return h.stringify(p.default(e,t))});var S=0,C=function(){function e(e,t){if(this.authOptions={},this.client=e,this.tokenParams=t.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,function(e){return e.useTokenAuth||!function(e){return"useTokenAuth"in e&&!e.useTokenAuth}(e)&&(e.authCallback||e.authUrl||e.token||e.tokenDetails)}(t)){if(t.key&&!o){var n="client-side token request signing not supported";throw s.default.logAction(s.default.LOG_ERROR,"Auth()",n),new Error(n)}(function(e){return!e.key&&!e.authCallback&&!e.authUrl})(t)&&s.default.logAction(s.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(t.defaultTokenParams,t),R(this.authOptions)}else{if(!t.key)throw n="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)",s.default.logAction(s.default.LOG_ERROR,"Auth()",n),new d.default(n,40160,401);s.default.logAction(s.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(t)}}return e.prototype.authorize=function(e,t,n){var r,o=this;if("function"!=typeof e||n?"function"!=typeof t||n?r=t:(n=t,r=null):(n=e,r=e=null),!n&&this.client.options.promises)return u.promisify(this,"authorize",arguments);if(r&&r.key&&this.authOptions.key!==r.key)throw new d.default("Unable to update auth options with incompatible key",40102,401);r&&"force"in r&&(s.default.logAction(s.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),u.isOnlyPropIn(r,"force")&&(r=null)),this._forceNewToken(e,r,(function(e,t){if(e)return o.client.connection&&o.client.connection.connectionManager.actOnErrorFromAuthorize(e),void(null==n||n(e));b(o.client)?o.client.connection.connectionManager.onAuthUpdated(t,n||v):null==n||n(null,t)}))},e.prototype.authorise=function(e,t,n){s.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(e,t,n)},e.prototype._forceNewToken=function(e,t,n){var r=this;this.tokenDetails=null,this._saveTokenOptions(e,t),R(this.authOptions),this._ensureValidAuthCredentials(!0,(function(e,t){delete r.tokenParams.timestamp,delete r.authOptions.queryTime,n(e,t)}))},e.prototype.requestToken=function(e,t,n){var r=this;if("function"!=typeof e||n?"function"!=typeof t||n||(n=t,t=null):(n=e,t=e=null),!n&&this.client.options.promises)return u.promisify(this,"requestToken",arguments);t=t||this.authOptions,e=e||u.copy(this.tokenParams);var o,i=n||v,a=this.client;if(t.authCallback)s.default.logAction(s.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),o=t.authCallback;else if(t.authUrl)s.default.logAction(s.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),o=function(e,n){var o,i=u.mixin({accept:"application/json, text/plain"},t.authHeaders),c=t.authMethod&&"post"===t.authMethod.toLowerCase(),l=t.authUrl.indexOf("?");l>-1&&(o=u.parseQueryString(t.authUrl.slice(l)),t.authUrl=t.authUrl.slice(0,l),c||(t.authParams=u.mixin(o,t.authParams)));var p=u.mixin({},t.authParams||{},e),h=function(e,t,r,o){var i;if(e?s.default.logAction(s.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+u.inspectError(e)):(i=r["content-type"],s.default.logAction(s.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+i+"; body: "+u.inspectBody(t))),e||o)return n(e,t);if(f.isBuffer(t)&&(t=t.toString()),i){var a=i.indexOf("application/json")>-1,c=i.indexOf("text/plain")>-1||i.indexOf("application/jwt")>-1;if(a||c){if(a){if(t.length>y)return void n(new d.default("authUrl response exceeded max permitted length",40170,401));try{t=JSON.parse(t)}catch(e){return void n(new d.default("Unexpected error processing authURL response; err = "+e.message,40170,401))}}n(null,t,i)}else n(new d.default("authUrl responded with unacceptable content-type "+i+", should be either text/plain, application/jwt or application/json",40170,401))}else n(new d.default("authUrl response is missing a content-type header",40170,401))};if(s.default.logAction(s.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+t.authUrl+"; Params: "+JSON.stringify(p)+"; method: "+(c?"POST":"GET")),c){var g=i||{};g["content-type"]="application/x-www-form-urlencoded";var v=u.toQueryString(p).slice(1);r.client.http.doUri(m.default.Post,a,t.authUrl,g,v,o,h)}else r.client.http.doUri(m.default.Get,a,t.authUrl,i||{},null,p,h)};else{if(!t.key){var c="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";return s.default.logAction(s.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),void i(new d.default(c,40171,403))}s.default.logAction(s.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),o=function(e,n){r.createTokenRequest(e,t,n)}}"capability"in e&&(e.capability=O(e.capability));var l=function(e,n){var o="/keys/"+e.keyName+"/requestToken",i=u.defaultPostHeaders();t.requestHeaders&&u.mixin(i,t.requestHeaders),s.default.logAction(s.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+o+"; Token params: "+JSON.stringify(e)),r.client.http.do(m.default.Post,a,(function(e){return a.baseUri(e)+o}),i,JSON.stringify(e),null,n)},p=!1,h=this.client.options.timeouts.realtimeRequestTimeout,g=setTimeout((function(){p=!0;var e="Token request callback timed out after "+h/1e3+" seconds";s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()",e),i(new d.default(e,40170,401))}),h);o(e,(function(e,n,r){if(!p){if(clearTimeout(g),e)return s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+u.inspectError(e)),void i(w(e));if("string"!=typeof n){if("object"!=typeof n){var o="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof n;return s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()",o),void i(new d.default(o,40170,401))}var a=JSON.stringify(n).length;if(a>y&&!t.suppressMaxLengthCheck)i(new d.default("Token request/details object exceeded max permitted stringified size (was "+a+" bytes)",40170,401));else if("issued"in n)i(null,n);else{if(!("keyName"in n))return o="Expected token request callback to call back with a token string, token request object, or token details object",s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()",o),void i(new d.default(o,40170,401));l(n,(function(e,t,n,r){if(e)return s.default.logAction(s.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+u.inspectError(e)),void i(w(e));r||(t=JSON.parse(t)),s.default.logAction(s.default.LOG_MINOR,"Auth.getToken()","token received"),i(null,t)}))}}else 0===n.length?i(new d.default("Token string is empty",40170,401)):n.length>y?i(new d.default("Token string exceeded max permitted length (was "+n.length+" bytes)",40170,401)):"undefined"===n||"null"===n?i(new d.default("Token string was literal null/undefined",40170,401)):"{"!==n[0]||r&&r.indexOf("application/jwt")>-1?i(null,{token:n}):i(new d.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401))}}))},e.prototype.createTokenRequest=function(e,t,n){var r=this;if("function"!=typeof e||n?"function"!=typeof t||n||(n=t,t=null):(n=e,t=e=null),!n&&this.client.options.promises)return u.promisify(this,"createTokenRequest",arguments);t=t||this.authOptions,e=e||u.copy(this.tokenParams);var i=t.key;if(i){var a=i.split(":"),c=a[0],l=a[1];if(l)if(""!==e.clientId){"capability"in e&&(e.capability=O(e.capability));var f,p=u.mixin({keyName:c},e),h=e.clientId||"",g=e.ttl||"",m=e.capability||"";f=function(){var e=p.nonce||(p.nonce=_()),t=p.timestamp,r=p.keyName+"\n"+g+"\n"+m+"\n"+h+"\n"+t+"\n"+e+"\n";p.mac=p.mac||o(r,l),s.default.logAction(s.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),n(null,p)},p.timestamp?f():r.getTimestamp(t&&t.queryTime,(function(e,t){e?n(e):(p.timestamp=t,f())}))}else n(new d.default("clientId can’t be an empty string",40012,400));else n(new d.default("Invalid key specified",40101,403))}else n(new d.default("No key specified",40101,403))},e.prototype.getAuthParams=function(e){"basic"==this.method?e(null,{key:this.key}):this._ensureValidAuthCredentials(!1,(function(t,n){if(t)e(t);else{if(!n)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");e(null,{access_token:n.token})}}))},e.prototype.getAuthHeaders=function(e){"basic"==this.method?e(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,(function(t,n){if(t)e(t);else{if(!n)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");e(null,{authorization:"Bearer "+i(n.token)})}}))},e.prototype.getTimestamp=function(e,t){this.isTimeOffsetSet()||!e&&!this.authOptions.queryTime?t(null,this.getTimestampUsingOffset()):this.client.time(t)},e.prototype.getTimestampUsingOffset=function(){return u.now()+(this.client.serverTimeOffset||0)},e.prototype.isTimeOffsetSet=function(){return null!==this.client.serverTimeOffset},e.prototype._saveBasicOptions=function(e){this.method="basic",this.key=e.key,this.basicKey=i(e.key),this.authOptions=e||{},"clientId"in e&&this._userSetClientId(e.clientId)},e.prototype._saveTokenOptions=function(e,t){this.method="token",e&&(this.tokenParams=e),t&&(t.token&&(t.tokenDetails="string"==typeof t.token?{token:t.token}:t.token),t.tokenDetails&&(this.tokenDetails=t.tokenDetails),"clientId"in t&&this._userSetClientId(t.clientId),this.authOptions=t)},e.prototype._ensureValidAuthCredentials=function(e,t){var n=this,r=this.tokenDetails;if(r){if(this._tokenClientIdMismatch(r.clientId))return void t(new d.default("Mismatch between clientId in token ("+r.clientId+") and current clientId ("+this.clientId+")",40102,403));if(!this.isTimeOffsetSet()||!r.expires||r.expires>=this.getTimestampUsingOffset())return s.default.logAction(s.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+r.expires),void t(null,r);s.default.logAction(s.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=l.default.create())).push(t),null===this.currentTokenRequestId||e){var o=this.currentTokenRequestId=S++;this.requestToken(this.tokenParams,this.authOptions,(function(e,t){if(n.currentTokenRequestId>o)s.default.logAction(s.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");else{n.currentTokenRequestId=null;var r=n.waitingForTokenRequest||v;n.waitingForTokenRequest=null,e?r(e):r(null,n.tokenDetails=t)}}))}},e.prototype._userSetClientId=function(e){if("string"!=typeof e&&null!==e)throw new d.default("clientId must be either a string or null",40012,400);if("*"===e)throw new d.default('Can’t use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var t=this._uncheckedSetClientId(e);if(t)throw t},e.prototype._uncheckedSetClientId=function(e){if(this._tokenClientIdMismatch(e)){var t="Unexpected clientId mismatch: client has "+this.clientId+", requested "+e,n=new d.default(t,40102,401);return s.default.logAction(s.default.LOG_ERROR,"Auth._uncheckedSetClientId()",t),n}return this.clientId=this.tokenParams.clientId=e,null},e.prototype._tokenClientIdMismatch=function(e){return!(!this.clientId||"*"===this.clientId||!e||"*"===e||this.clientId===e)},e.isTokenErr=function(e){return e.code&&e.code>=40140&&e.code<40150},e}();n.default=C},function(e,t,n){"use strict";var r;t.__esModule=!0,function(e){e.Get="get",e.Delete="delete",e.Post="post",e.Put="put",e.Patch="patch"}(r||(r={})),t.default=r},function(e,t,n){"use strict";t.__esModule=!0,t.HttpPaginatedResponse=t.PaginatedResult=void 0;var r=n(1),o=r.__importStar(n(2)),i=r.__importDefault(n(0)),a=r.__importDefault(n(18)),s=function(){function e(e,t,n,r,o,i){this.rest=e,this.path=t,this.headers=n,this.envelope=null!=r?r:null,this.bodyHandler=o,this.useHttpPaginatedResponse=i||!1}return e.prototype.get=function(e,t){var n=this;a.default.get(this.rest,this.path,this.headers,e,this.envelope,(function(e,r,o,i,a){n.handlePage(e,r,o,i,a,t)}))},e.prototype.delete=function(e,t){var n=this;a.default.delete(this.rest,this.path,this.headers,e,this.envelope,(function(e,r,o,i,a){n.handlePage(e,r,o,i,a,t)}))},e.prototype.post=function(e,t,n){var r=this;a.default.post(this.rest,this.path,t,this.headers,e,this.envelope,(function(e,t,o,i,a){n&&r.handlePage(e,t,o,i,a,n)}))},e.prototype.put=function(e,t,n){var r=this;a.default.put(this.rest,this.path,t,this.headers,e,this.envelope,(function(e,t,o,i,a){n&&r.handlePage(e,t,o,i,a,n)}))},e.prototype.patch=function(e,t,n){var r=this;a.default.patch(this.rest,this.path,t,this.headers,e,this.envelope,(function(e,t,o,i,a){n&&r.handlePage(e,t,o,i,a,n)}))},e.prototype.handlePage=function(e,t,n,r,a,s){if(e&&function(e,t,n){return!(n&&(t||"number"==typeof e.code))}(e,t,this.useHttpPaginatedResponse))return i.default.logAction(i.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+o.inspectError(e)),void(null==s||s(e));var l,f,d;try{l=this.bodyHandler(t,n||{},r)}catch(t){return void(null==s||s(e||t))}n&&(f=n.Link||n.link)&&(d=function(e){"string"==typeof e&&(e=e.split(","));for(var t,n={},r=0;r<e.length;r++){var i=e[r].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(i){var a=(t=void 0,(t=i[1].match(/^\.\/(\w+)\?(.*)$/))&&t[2]&&o.parseQueryString(t[2]));a&&(n[i[2]]=a)}}return n}(f)),this.useHttpPaginatedResponse?s(null,new u(this,l,n||{},a,d,e)):s(null,new c(this,l,d))},e}(),c=function(){function e(e,t,n){var r=this;this.resource=e,this.items=t;var i=this;n&&("first"in n&&(this.first=function(e){if(!e&&i.resource.rest.options.promises)return o.promisify(i,"first",[]);i.get(n.first,e)}),"current"in n&&(this.current=function(e){if(!e&&i.resource.rest.options.promises)return o.promisify(i,"current",[]);i.get(n.current,e)}),this.next=function(e){if(!e&&i.resource.rest.options.promises)return o.promisify(i,"next",[]);"next"in n?i.get(n.next,e):e(null)},this.hasNext=function(){return"next"in n},this.isLast=function(){var e;return!(null===(e=r.hasNext)||void 0===e?void 0:e.call(r))})}return e.prototype.get=function(e,t){var n=this.resource;a.default.get(n.rest,n.path,n.headers,e,n.envelope,(function(e,r,o,i,a){n.handlePage(e,r,o,i,a,t)}))},e}();t.PaginatedResult=c;var u=function(e){function t(t,n,r,o,i,a){var s=e.call(this,t,n,i)||this;return s.statusCode=o,s.success=o<300&&o>=200,s.headers=r,s.errorCode=a&&a.code,s.errorMessage=a&&a.message,s}return r.__extends(t,e),t.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},t}(c);t.HttpPaginatedResponse=u,t.default=s},function(e,t,n){"use strict";var r;t.__esModule=!0,function(e){e[e.REQ_SEND=0]="REQ_SEND",e[e.REQ_RECV=1]="REQ_RECV",e[e.REQ_RECV_POLL=2]="REQ_RECV_POLL",e[e.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"}(r||(r={})),t.default=r},function(e,t,n){"use strict";t.__esModule=!0,t.isRetriable=void 0;var r=n(1).__importDefault(n(5)),o={disconnected:r.default.fromValues({statusCode:400,code:80003,message:"Connection to server temporarily unavailable"}),suspended:r.default.fromValues({statusCode:400,code:80002,message:"Connection to server unavailable"}),failed:r.default.fromValues({statusCode:400,code:8e4,message:"Connection failed or disconnected by server"}),closing:r.default.fromValues({statusCode:400,code:80017,message:"Connection closing"}),closed:r.default.fromValues({statusCode:400,code:80017,message:"Connection closed"}),unknownConnectionErr:r.default.fromValues({statusCode:500,code:50002,message:"Internal connection error"}),unknownChannelErr:r.default.fromValues({statusCode:500,code:50001,message:"Internal channel error"})};t.isRetriable=function(e){if(!e.statusCode||!e.code||e.statusCode>=500)return!0;var t=!1;return Object.values(o).forEach((function(n){n.code&&n.code==e.code&&(t=!0)})),t},t.default=o},function(e,t,n){"use strict";var r;t.__esModule=!0;var o=n(1),i=o.__importDefault(n(3)),a=o.__importStar(n(2)),s=o.__importDefault(n(9)),c=o.__importDefault(n(5)),u=o.__importDefault(n(22)),l=o.__importDefault(n(19)),f=o.__importDefault(n(24)),d=o.__importDefault(n(0)),p=n(33);function h(e){var t=e.statusCode;return 408===t&&!e.code||400===t&&!e.code||t>=500&&t<=504}function g(e){var t=e.connection,n=t&&t.connectionManager.host;return n?[n].concat(s.default.getFallbackHosts(e.options)):s.default.getHosts(e.options)}var m=(r=function(){function e(){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=g,i.default.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(e,t,n,r,o,i,a){var s=l.default.createRequest(n,r,o,i,f.default.REQ_SEND,t&&t.options.timeouts,e);return s.once("complete",a),s.exec(),s},this.checkConnectivity=function(e){var t=s.default.internetUpUrl;d.default.logAction(d.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+t),this.doUri(u.default.Get,null,t,null,null,null,(function(t,n){var r,o=!t&&"yes"==(null===(r=n)||void 0===r?void 0:r.replace(/\n/,""));d.default.logAction(d.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+o),e(null,o)}))}):i.default.jsonpSupported&&(this.Request=function(e,t,n,r,o,i,s){var c=p.createRequest(n,r,o,i,f.default.REQ_SEND,t&&t.options.timeouts,e);return c.once("complete",s),a.nextTick((function(){c.exec()})),c},this.checkConnectivity=function(e){var t=this,n=s.default.jsonpInternetUpUrl;if(this.checksInProgress)this.checksInProgress.push(e);else{this.checksInProgress=[e],d.default.logAction(d.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+n);var r=new p.Request("isTheInternetUp",n,null,null,null,f.default.REQ_SEND,s.default.TIMEOUTS);r.once("complete",(function(e,n){var r=!e&&n;d.default.logAction(d.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+r);for(var o=0;o<t.checksInProgress.length;o++)t.checksInProgress[o](null,r);t.checksInProgress=null})),a.nextTick((function(){r.exec()}))}})}return e.prototype.do=function(e,t,n,r,i,s,u){var l=this,f="function"==typeof n?n:function(e){return t.baseUri(e)+n},d=t._currentFallback;if(d){if(d.validUntil>a.now())return this.Request?void this.Request(e,t,f(d.host),r,s,i,(function(a){for(var c=[],f=1;f<arguments.length;f++)c[f-1]=arguments[f];if(a&&h(a))return t._currentFallback=null,void l.do(e,t,n,r,i,s,u);null==u||u.apply(void 0,o.__spreadArray([a],c))})):void(null==u||u(new c.default("Request invoked before assigned to",null,500)));t._currentFallback=null}var p=g(t);if(1!==p.length){var m=function(n,c){var d=n.shift();l.doUri(e,t,f(d),r,i,s,(function(e){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];e&&h(e)&&n.length?m(n,!0):(c&&(t._currentFallback={host:d,validUntil:a.now()+t.options.timeouts.fallbackRetryTimeout}),null==u||u.apply(void 0,o.__spreadArray([e],r)))}))};m(p)}else this.doUri(e,t,f(p[0]),r,i,s,u)},e.prototype.doUri=function(e,t,n,r,o,i,a){this.Request?this.Request(e,t,n,r,i,o,a):a(new c.default("Request invoked before assigned to",null,500))},e}(),r.methods=[u.default.Get,u.default.Delete,u.default.Post,u.default.Put,u.default.Patch],r.methodsWithoutBody=[u.default.Get,u.default.Delete],r.methodsWithBody=[u.default.Post,u.default.Put,u.default.Patch],r);t.default=m},function(e,t,n){var r;e.exports=(r=n(7),n(4),n(55),n(17),n(37),n(36),n(29),n(30),n(31),n(56),n(57),r)},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1).__importDefault(n(0)),o=function(){function e(e){this.members=e||[]}return e.prototype.call=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0,o=this.members;n<o.length;n++){var i=o[n];if(i)try{i.apply(void 0,e)}catch(e){r.default.logAction(r.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+e+"; stack = "+e.stack)}}},e.prototype.push=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.members).push.apply(e,t)},e.create=function(t){var n=new e(t);return Object.assign((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.call.apply(n,e)}),{push:function(e){return n.push(e)}})},e}();t.default=o},function(e,t,n){var r,o,i,a;e.exports=(r=n(7),i=(o=r).lib.Base,a=o.enc.Utf8,void(o.algo.HMAC=i.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=a.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),i=this._iKey=t.clone(),s=o.words,c=i.words,u=0;u<n;u++)s[u]^=1549556828,c[u]^=909522486;o.sigBytes=i.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))},function(e,t,n){var r,o,i,a,s,c,u,l;e.exports=(l=n(7),n(37),n(29),o=(r=l).lib,i=o.Base,a=o.WordArray,s=r.algo,c=s.MD5,u=s.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n,r=this.cfg,o=r.hasher.create(),i=a.create(),s=i.words,c=r.keySize,u=r.iterations;s.length<c;){n&&o.update(n),n=o.update(e).finalize(t),o.reset();for(var l=1;l<u;l++)n=o.finalize(n),o.reset();i.concat(n)}return i.sigBytes=4*c,i}}),r.EvpKDF=function(e,t,n){return u.create(n).compute(e,t)},l.EvpKDF)},function(e,t,n){var r;e.exports=(r=n(7),n(30),void(r.lib.Cipher||function(e){var t=r,n=t.lib,o=n.Base,i=n.WordArray,a=n.BufferedBlockAlgorithm,s=t.enc,c=(s.Utf8,s.Base64),u=t.algo.EvpKDF,l=n.Cipher=a.extend({cfg:o.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?_:y}return function(t){return{encrypt:function(n,r,o){return e(r).encrypt(t,n,r,o)},decrypt:function(n,r,o){return e(r).decrypt(t,n,r,o)}}}}()}),f=(n.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),t.mode={}),d=n.BlockCipherMode=o.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=f.CBC=function(){var t=d.extend();function n(t,n,r){var o,i=this._iv;i?(o=i,this._iv=e):o=this._prevBlock;for(var a=0;a<r;a++)t[n+a]^=o[a]}return t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,o=r.blockSize;n.call(this,e,t,o),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+o)}}),t.Decryptor=t.extend({processBlock:function(e,t){var r=this._cipher,o=r.blockSize,i=e.slice(t,t+o);r.decryptBlock(e,t),n.call(this,e,t,o),this._prevBlock=i}}),t}(),h=(t.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,r=n-e.sigBytes%n,o=r<<24|r<<16|r<<8|r,a=[],s=0;s<r;s+=4)a.push(o);var c=i.create(a,r);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},g=(n.BlockCipher=l.extend({cfg:l.cfg.extend({mode:p,padding:h}),reset:function(){var e;l.reset.call(this);var t=this.cfg,n=t.iv,r=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=r.createEncryptor:(e=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,n&&n.words):(this._mode=e.call(r,this,n&&n.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),n.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),m=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;return(n?i.create([1398893684,1701076831]).concat(n).concat(t):t).toString(c)},parse:function(e){var t,n=c.parse(e),r=n.words;return 1398893684==r[0]&&1701076831==r[1]&&(t=i.create(r.slice(2,4)),r.splice(0,4),n.sigBytes-=16),g.create({ciphertext:n,salt:t})}},y=n.SerializableCipher=o.extend({cfg:o.extend({format:m}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var o=e.createEncryptor(n,r),i=o.finalize(t),a=o.cfg;return g.create({ciphertext:i,key:n,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),v=(t.kdf={}).OpenSSL={execute:function(e,t,n,r){r||(r=i.random(8));var o=u.create({keySize:t+n}).compute(e,r),a=i.create(o.words.slice(t),4*n);return o.sigBytes=4*t,g.create({key:o,iv:a,salt:r})}},_=n.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:v}),encrypt:function(e,t,n,r){var o=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize);r.iv=o.iv;var i=y.encrypt.call(this,e,t,o.key,r);return i.mixIn(o),i},decrypt:function(e,t,n,r){r=this.cfg.extend(r),t=this._parse(t,r.format);var o=r.kdf.execute(n,e.keySize,e.ivSize,t.salt);return r.iv=o.iv,y.decrypt.call(this,e,t,o.key,r)}})}()))},function(e,t,n){"use strict";function r(e,t,n){for(var r=0,o=n.length;r<o;r++){var i=n.charCodeAt(r);if(i<128)e.setUint8(t++,i>>>0&127|0);else if(i<2048)e.setUint8(t++,i>>>6&31|192),e.setUint8(t++,i>>>0&63|128);else if(i<65536)e.setUint8(t++,i>>>12&15|224),e.setUint8(t++,i>>>6&63|128),e.setUint8(t++,i>>>0&63|128);else{if(!(i<1114112))throw new Error("bad codepoint "+i);e.setUint8(t++,i>>>18&7|240),e.setUint8(t++,i>>>12&63|128),e.setUint8(t++,i>>>6&63|128),e.setUint8(t++,i>>>0&63|128)}}}function o(e,t,n){for(var r="",o=t,i=t+n;o<i;o++){var a=e.getUint8(o);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));r+=String.fromCharCode((7&a)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0)}else r+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0);else r+=String.fromCharCode((15&a)<<6|63&e.getUint8(++o));else r+=String.fromCharCode(a)}return r}function i(e){for(var t=0,n=0,r=e.length;n<r;n++){var o=e.charCodeAt(n);if(o<128)t+=1;else if(o<2048)t+=2;else if(o<65536)t+=3;else{if(!(o<1114112))throw new Error("bad codepoint "+o);t+=4}}return t}t.__esModule=!0;var a=4294967296,s=1/a,c=function(e,t){var n=this;this.map=function(e){for(var t={},r=0;r<e;r++)t[n.parse()]=n.parse();return t},this.bin=function(e){var t=new ArrayBuffer(e);return new Uint8Array(t).set(new Uint8Array(n.view.buffer,n.offset,e),0),n.offset+=e,t},this.buf=this.bin,this.str=function(e){var t=o(n.view,n.offset,e);return n.offset+=e,t},this.array=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=n.parse();return t},this.ext=function(e){return n.offset+=e,{type:n.view.getInt8(n.offset),data:n.buf(e)}},this.parse=function(){var e,t,r=n.view.getUint8(n.offset);if(0==(128&r))return n.offset++,r;if(128==(240&r))return t=15&r,n.offset++,n.map(t);if(144==(240&r))return t=15&r,n.offset++,n.array(t);if(160==(224&r))return t=31&r,n.offset++,n.str(t);if(224==(224&r))return e=n.view.getInt8(n.offset),n.offset++,e;switch(r){case 192:return n.offset++,null;case 193:return void n.offset++;case 194:return n.offset++,!1;case 195:return n.offset++,!0;case 196:return t=n.view.getUint8(n.offset+1),n.offset+=2,n.bin(t);case 197:return t=n.view.getUint16(n.offset+1),n.offset+=3,n.bin(t);case 198:return t=n.view.getUint32(n.offset+1),n.offset+=5,n.bin(t);case 199:return t=n.view.getUint8(n.offset+1),n.offset+=2,n.ext(t);case 200:return t=n.view.getUint16(n.offset+1),n.offset+=3,n.ext(t);case 201:return t=n.view.getUint32(n.offset+1),n.offset+=5,n.ext(t);case 202:return e=n.view.getFloat32(n.offset+1),n.offset+=5,e;case 203:return e=n.view.getFloat64(n.offset+1),n.offset+=9,e;case 204:return e=n.view.getUint8(n.offset+1),n.offset+=2,e;case 205:return e=n.view.getUint16(n.offset+1),n.offset+=3,e;case 206:return e=n.view.getUint32(n.offset+1),n.offset+=5,e;case 207:return e=function(e,t){return t=t||0,e.getUint32(t)*a+e.getUint32(t+4)}(n.view,n.offset+1),n.offset+=9,e;case 208:return e=n.view.getInt8(n.offset+1),n.offset+=2,e;case 209:return e=n.view.getInt16(n.offset+1),n.offset+=3,e;case 210:return e=n.view.getInt32(n.offset+1),n.offset+=5,e;case 211:return e=function(e,t){return t=t||0,e.getInt32(t)*a+e.getUint32(t+4)}(n.view,n.offset+1),n.offset+=9,e;case 212:return t=1,n.offset++,n.ext(t);case 213:return t=2,n.offset++,n.ext(t);case 214:return t=4,n.offset++,n.ext(t);case 215:return t=8,n.offset++,n.ext(t);case 216:return t=16,n.offset++,n.ext(t);case 217:return t=n.view.getUint8(n.offset+1),n.offset+=2,n.str(t);case 218:return t=n.view.getUint16(n.offset+1),n.offset+=3,n.str(t);case 219:return t=n.view.getUint32(n.offset+1),n.offset+=5,n.str(t);case 220:return t=n.view.getUint16(n.offset+1),n.offset+=3,n.array(t);case 221:return t=n.view.getUint32(n.offset+1),n.offset+=5,n.array(t);case 222:return t=n.view.getUint16(n.offset+1),n.offset+=3,n.map(t);case 223:return t=n.view.getUint32(n.offset+1),n.offset+=5,n.map(t)}throw new Error("Unknown type 0x"+r.toString(16))},this.offset=t||0,this.view=e};function u(e,t){return Object.keys(e).filter((function(n){var r=e[n];return!(t&&null==r||"function"==typeof r&&!r.toJSON)}))}function l(e,t,n,o){var a=typeof e;if("string"==typeof e){var c=i(e);if(c<32)return t.setUint8(n,160|c),r(t,n+1,e),1+c;if(c<256)return t.setUint8(n,217),t.setUint8(n+1,c),r(t,n+2,e),2+c;if(c<65536)return t.setUint8(n,218),t.setUint16(n+1,c),r(t,n+3,e),3+c;if(c<4294967296)return t.setUint8(n,219),t.setUint32(n+1,c),r(t,n+5,e),5+c}if(ArrayBuffer.isView&&ArrayBuffer.isView(e)&&(e=e.buffer),e instanceof ArrayBuffer){var f=e.byteLength;if(f<256)return t.setUint8(n,196),t.setUint8(n+1,f),new Uint8Array(t.buffer).set(new Uint8Array(e),n+2),2+f;if(f<65536)return t.setUint8(n,197),t.setUint16(n+1,f),new Uint8Array(t.buffer).set(new Uint8Array(e),n+3),3+f;if(f<4294967296)return t.setUint8(n,198),t.setUint32(n+1,f),new Uint8Array(t.buffer).set(new Uint8Array(e),n+5),5+f}if("number"==typeof e){if(Math.floor(e)!==e)return t.setUint8(n,203),t.setFloat64(n+1,e),9;if(e>=0){if(e<128)return t.setUint8(n,e),1;if(e<256)return t.setUint8(n,204),t.setUint8(n+1,e),2;if(e<65536)return t.setUint8(n,205),t.setUint16(n+1,e),3;if(e<4294967296)return t.setUint8(n,206),t.setUint32(n+1,e),5;if(e<0x10000000000000000)return t.setUint8(n,207),function(e,t,n){n<0x10000000000000000?(e.setUint32(t,Math.floor(n*s)),e.setInt32(t+4,-1&n)):(e.setUint32(t,4294967295),e.setUint32(t+4,4294967295))}(t,n+1,e),9;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(n,e),1;if(e>=-128)return t.setUint8(n,208),t.setInt8(n+1,e),2;if(e>=-32768)return t.setUint8(n,209),t.setInt16(n+1,e),3;if(e>=-2147483648)return t.setUint8(n,210),t.setInt32(n+1,e),5;if(e>=-0x8000000000000000)return t.setUint8(n,211),function(e,t,n){n<0x8000000000000000?(e.setInt32(t,Math.floor(n*s)),e.setInt32(t+4,-1&n)):(e.setUint32(t,2147483647),e.setUint32(t+4,2147483647))}(t,n+1,e),9;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if("undefined"===a)return o?0:(t.setUint8(n,212),t.setUint8(n+1,0),t.setUint8(n+2,0),3);if(null===e)return o?0:(t.setUint8(n,192),1);if("boolean"===a)return t.setUint8(n,e?195:194),1;if("function"==typeof e.toJSON)return l(e.toJSON(),t,n,o);if("object"===a){var d,p=0,h=void 0,g=Array.isArray(e);if((d=g?e.length:(h=u(e,o)).length)<16?(t.setUint8(n,d|(g?144:128)),p=1):d<65536?(t.setUint8(n,g?220:222),t.setUint16(n+1,d),p=3):d<4294967296&&(t.setUint8(n,g?221:223),t.setUint32(n+1,d),p=5),g)for(var m=0;m<d;m++)p+=l(e[m],t,n+p,o);else if(h)for(m=0;m<d;m++){var y=h[m];p+=l(y,t,n+p),p+=l(e[y],t,n+p,o)}return p}if("function"===a)return 0;throw new Error("Unknown type "+a)}function f(e,t){var n=typeof e;if("string"===n){var r=i(e);if(r<32)return 1+r;if(r<256)return 2+r;if(r<65536)return 3+r;if(r<4294967296)return 5+r}if(ArrayBuffer.isView&&ArrayBuffer.isView(e)&&(e=e.buffer),e instanceof ArrayBuffer){var o=e.byteLength;if(o<256)return 2+o;if(o<65536)return 3+o;if(o<4294967296)return 5+o}if("number"==typeof e){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;if(e<0x10000000000000000)return 9;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;if(e>=-0x8000000000000000)return 9;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if("boolean"===n)return 1;if(null===e)return t?0:1;if(void 0===e)return t?0:3;if("function"==typeof e.toJSON)return f(e.toJSON(),t);if("object"===n){var a,s=0;if(Array.isArray(e)){a=e.length;for(var c=0;c<a;c++)s+=f(e[c],t)}else{var l=u(e,t);for(a=l.length,c=0;c<a;c++){var d=l[c];s+=f(d)+f(e[d],t)}}if(a<16)return 1+s;if(a<65536)return 3+s;if(a<4294967296)return 5+s;throw new Error("Array or object too long 0x"+a.toString(16))}if("function"===n)return 0;throw new Error("Unknown type "+n)}t.default={encode:function(e,t){var n=f(e,t);if(0!==n){var r=new ArrayBuffer(n);return l(e,new DataView(r),0,t),r}},decode:function(e){var t=new DataView(e),n=new c(t),r=n.parse();if(n.offset!==e.byteLength)throw new Error(e.byteLength-n.offset+" trailing bytes");return r},inspect:function(e){if(void 0===e)return"undefined";var t,n;if(e instanceof ArrayBuffer?(n="ArrayBuffer",t=new DataView(e)):e instanceof DataView&&(n="DataView",t=e),!t)return JSON.stringify(e);for(var r=[],o=0;o<e.byteLength;o++){if(o>20){r.push("...");break}var i=t.getUint8(o).toString(16);1===i.length&&(i="0"+i),r.push(i)}return"<"+n+" "+r.join(" ")+">"},utf8Write:r,utf8Read:o,utf8ByteCount:i}},function(e,t,n){"use strict";(function(e){t.__esModule=!0,t.Request=t.createRequest=void 0;var r=n(1),o=r.__importStar(n(2)),i=r.__importDefault(n(16)),a=r.__importDefault(n(3)),s=r.__importDefault(n(8)),c=r.__importDefault(n(5)),u=r.__importDefault(n(9)),l=r.__importDefault(n(0)),f=r.__importDefault(n(24)),d=function(){},p=e._ablyjs_jsonp={};p._=function(e){return p["_"+e]||d};var h=1,g=null,m="jsonp";function y(e,t,n,r,i,a,s){return a=a||u.default.TIMEOUTS,new _(void 0,e,t,o.copy(n),r,i,a,s)}a.default.jsonpSupported&&(g=document.getElementsByTagName("head")[0]),t.createRequest=y;var v=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.shortName=m,r.stream=!1,o}return r.__extends(t,e),t.isAvailable=function(){return a.default.jsonpSupported&&a.default.allowComet},t.tryConnect=function(e,n,r,o){var i=new t(e,n,r),a=function(e){o({event:this.event,error:e})};i.on(["failed","disconnected"],a),i.on("preconnect",(function(){l.default.logAction(l.default.LOG_MINOR,"JSONPTransport.tryConnect()","viable transport "+i),i.off(["failed","disconnected"],a),o(null,i)})),i.connect()},t.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},t.prototype.createRequest=function(e,t,n,r,o,i,a){return y(e,t,n,r,o,i=(null==this?void 0:this.timeouts)||i||u.default.TIMEOUTS,a)},t}(i.default),_=function(e){function t(t,n,r,i,a,s,c,u){var l=e.call(this)||this;return void 0===t&&(t=h++),l.id=t,l.uri=n,l.params=i||{},l.params.rnd=o.cheapRandStr(),r&&(r["X-Ably-Version"]&&(l.params.v=r["X-Ably-Version"]),r["X-Ably-Lib"]&&(l.params.lib=r["X-Ably-Lib"])),l.body=a,l.method=u,l.requestMode=s,l.timeouts=c,l.requestComplete=!1,l}return r.__extends(t,e),t.prototype.exec=function(){var e=this,t=this.id,n=this.body,r=this.method,i=this.uri,a=this.params;a.callback="_ablyjs_jsonp._("+t+")",a.envelope="jsonp",n&&(a.body=n),r&&"get"!==r&&(a.method=r);var s=this.script=document.createElement("script"),u=i+o.toQueryString(a);s.src=u,s.src.split("/").slice(-1)[0]!==u.split("/").slice(-1)[0]&&l.default.logAction(l.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),s.async=!0,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(t){e.complete(new c.default("JSONP script error (event: "+o.inspect(t)+")",null,400))},p["_"+t]=function(t){if(t.statusCode){var n=t.response;if(204==t.statusCode)e.complete(null,null,null,t.statusCode);else if(n)if(t.statusCode<400||o.isArray(n))e.complete(null,n,t.headers,t.statusCode);else{var r=n.error||new c.default("Error response received from server",null,t.statusCode);e.complete(r)}else e.complete(new c.default("Invalid server response: no envelope detected",null,500))}else e.complete(null,t)};var d=this.requestMode==f.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),d),g.insertBefore(s,g.firstChild)},t.prototype.complete=function(e,t,n,r){if(n=n||{},!this.requestComplete){this.requestComplete=!0;var o=void 0;t&&(o="string"==typeof t?"text/plain":"application/json",n["content-type"]=o,this.emit("data",t)),this.emit("complete",e,t,n,!0,r),this.dispose()}},t.prototype.abort=function(){this.dispose()},t.prototype.dispose=function(){var e=this.timer;e&&(clearTimeout(e),this.timer=null);var t=this.script;t.parentNode&&t.parentNode.removeChild(t),delete p[this.id],this.emit("disposed")},t}(s.default);t.Request=_,t.default=function(t){return e.JSONPTransport=v,v.isAvailable()&&(t.supportedTransports.jsonp=v),v}}).call(this,n(14))},function(e,t,n){"use strict";(function(e){t.__esModule=!0,t.TransportParams=void 0;var r=n(1),o=r.__importDefault(n(12)),i=r.__importStar(n(2)),a=r.__importStar(n(61)),s=r.__importDefault(n(9)),c=r.__importDefault(n(3)),u=r.__importDefault(n(8)),l=r.__importDefault(n(41)),f=r.__importDefault(n(0)),d=r.__importDefault(n(42)),p=r.__importStar(n(25)),h=r.__importDefault(n(5)),g=r.__importDefault(n(21)),m=r.__importDefault(n(13)),y=r.__importDefault(n(28)),v=r.__importStar(n(62)),_=r.__importDefault(n(66)),b=r.__importDefault(n(63)),w=r.__importDefault(n(64)),O=!(void 0===v||!v.get),R=!(void 0===v||!v.getSession),S=o.default.Action,C=function(){},A=s.default.transportPreferenceOrder,E=A[A.length-1],k="ably-transport-preference",T="ably-connection-recovery",M=function(){function e(e,t,n,r){this.options=e,this.host=t,this.mode=n,this.connectionKey=r,this.format=e.useBinaryProtocol?i.Format.msgpack:i.Format.json,this.connectionSerial=void 0,this.timeSerial=void 0}return e.prototype.getConnectParams=function(e){var t=e?i.copy(e):{},n=this.options;switch(this.mode){case"upgrade":t.upgrade=this.connectionKey;break;case"resume":t.resume=this.connectionKey,void 0!==this.timeSerial?t.timeSerial=this.timeSerial:void 0!==this.connectionSerial&&(t.connectionSerial=this.connectionSerial);break;case"recover":var r=n.recover.split(":");if(r){t.recover=r[0];var o=r[1];isNaN(Number(o))?t.timeSerial=o:t.connectionSerial=o}}return void 0!==n.clientId&&(t.clientId=n.clientId),!1===n.echoMessages&&(t.echo="false"),void 0!==this.format&&(t.format=this.format),void 0!==this.stream&&(t.stream=this.stream),void 0!==this.heartbeats&&(t.heartbeats=this.heartbeats),t.v=s.default.apiVersion,t.agent=encodeURIComponent(s.default.agent),void 0!==n.transportParams&&i.mixin(t,n.transportParams),t},e.prototype.toString=function(){var e="[mode="+this.mode;return this.host&&(e+=",host="+this.host),this.connectionKey&&(e+=",connectionKey="+this.connectionKey),void 0!==this.connectionSerial&&(e+=",connectionSerial="+this.connectionSerial),this.timeSerial&&(e+=",timeSerial="+this.timeSerial),this.format&&(e+=",format="+this.format),e+="]"},e}();t.TransportParams=M;var I=function(t){function n(e,r){var o=t.call(this)||this;o.realtime=e,o.options=r;var a=r.timeouts,u=a.preferenceConnectTimeout+a.realtimeRequestTimeout;if(o.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:u,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:a.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:a.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:a.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},o.state=o.states.initialized,o.errorReason=null,o.queuedMessages=new l.default,o.msgSerial=0,o.connectionDetails=void 0,o.connectionId=void 0,o.connectionKey=void 0,o.timeSerial=void 0,o.connectionSerial=void 0,o.connectionStateTtl=a.connectionStateTtl,o.maxIdleInterval=null,o.transports=i.intersect(r.transports||s.default.defaultTransports,n.supportedTransports),o.baseTransport=i.intersect(s.default.baseTransportOrder,o.transports)[0],o.upgradeTransports=i.intersect(o.transports,s.default.upgradeTransports),o.transportPreference=null,o.httpHosts=s.default.getHosts(r),o.activeProtocol=null,o.proposedTransports=[],o.pendingTransports=[],o.host=null,o.lastAutoReconnectAttempt=null,o.lastActivity=null,o.mostRecentMsg=null,o.forceFallbackHost=!1,o.connectCounter=0,f.default.logAction(f.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),f.default.logAction(f.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(r.transports||s.default.defaultTransports)+"]"),f.default.logAction(f.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+o.transports+"]"),f.default.logAction(f.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+o.httpHosts+"]"),!o.transports.length){var d="no requested transports available";throw f.default.logAction(f.default.LOG_ERROR,"realtime.ConnectionManager()",d),new Error(d)}var p=c.default.addEventListener;return p&&(R&&"function"==typeof r.recover&&p("beforeunload",o.persistConnection.bind(o)),!0===r.closeOnUnload&&p("beforeunload",(function(){f.default.logAction(f.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),o.requestState({state:"closing"})})),p("online",(function(){o.state!=o.states.disconnected&&o.state!=o.states.suspended||(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager caught browser ‘online’ event","reattempting connection"),o.requestState({state:"connecting"}))})),p("offline",(function(){o.state==o.states.connected&&(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager caught browser ‘offline’ event","disconnecting active transport"),o.disconnectAllTransports())}))),o}return r.__extends(n,t),n.prototype.createTransportParams=function(e,t){var n=new M(this.options,e,t,this.connectionKey);return this.timeSerial?n.timeSerial=String(this.timeSerial):void 0!==this.connectionSerial&&(n.connectionSerial=this.connectionSerial),n},n.prototype.getTransportParams=function(e){var t=this;!function(e){if(t.connectionKey)e("resume");else if("string"!=typeof t.options.recover){var n,r=t.options.recover,o=R&&(null===(n=null==v?void 0:v.getSession)||void 0===n?void 0:n.call(v,T));if(o&&"function"==typeof r)return f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),void r(o,(function(n){n?(t.options.recover=o.recoveryKey,e("recover")):e("clean")}));e("clean")}else e("recover")}((function(n){var r=t.createTransportParams(null,n);if("recover"===n){f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+t.options.recover);var o=t.options.recover.split(":");o&&o[2]&&(t.msgSerial=Number(o[2]))}else f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+r.toString());e(r)}))},n.prototype.tryATransport=function(e,t,r){var o,i,a=this;f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+t),null===(i=(o=n.supportedTransports[t]).tryConnect)||void 0===i||i.call(o,this,this.realtime.auth,e,(function(n,o){var i=a.state;return i==a.states.closing||i==a.states.closed||i==a.states.failed?(o&&(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+i.state+" while we were attempting the transport; closing "+o),o.close()),void r(!0)):n?(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+t+" "+n.event+", err: "+n.error.toString()),void(!g.default.isTokenErr(n.error)||a.errorReason&&g.default.isTokenErr(a.errorReason)?"failed"===n.event?(a.notifyState({state:"failed",error:n.error}),r(!0)):"disconnected"===n.event&&(p.isRetriable(n.error)?r(!1):(a.notifyState({state:a.states.connecting.failState,error:n.error}),r(!0))):(a.errorReason=n.error,a.realtime.auth._forceNewToken(null,null,(function(n){n?a.actOnErrorFromAuthorize(n):a.tryATransport(e,t,r)}))))):(f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+t+"; setting pending"),a.setTransportPending(o,e),void r(null,o))}))},n.prototype.setTransportPending=function(e,t){var n=this,r=t.mode;f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+e+"; mode = "+r),i.arrDeleteValue(this.proposedTransports,e),this.pendingTransports.push(e),e.once("connected",(function(o,a,s,c){"upgrade"==r&&n.activeProtocol?e.shortName!==E&&i.arrIn(n.getUpgradePossibilities(),E)?setTimeout((function(){n.scheduleTransportActivation(o,e,a,s,c)}),n.options.timeouts.parallelUpgradeDelay):n.scheduleTransportActivation(o,e,a,s,c):(n.activateTransport(o,e,a,s,c),i.nextTick((function(){n.connectImpl(t)}))),"recover"===r&&n.options.recover&&(n.options.recover=null,n.unpersistConnection())}));var o=this;e.on(["disconnected","closed","failed"],(function(t){o.deactivateTransport(e,this.event,t)})),this.emit("transport.pending",e)},n.prototype.scheduleTransportActivation=function(e,t,n,r,o){var a,s,c=this,u=this.activeProtocol&&this.activeProtocol.getTransport(),l=function(){t.disconnect(),i.arrDeleteValue(c.pendingTransports,t)};return this.state!==this.states.connected&&this.state!==this.states.connecting?(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+t.shortName),void l()):!u||(a=t,s=u,i.arrIndexOf(A,a.shortName)>i.arrIndexOf(A,s.shortName))?(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+t),void this.realtime.channels.onceNopending((function(i){var a;if(i)f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unable to activate transport; transport = "+t+"; err = "+i);else{if(!t.isConnected)return f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+t.shortName+"is no longer connected; abandoning upgrade"),void l();if(c.state===c.states.connected)f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),c.state=c.states.synchronizing,a=c.activeProtocol;else if(c.state!==c.states.connecting)return f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+c.state.state+(c.state===c.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+t.shortName),void l();var s=n!==c.connectionId,u=s?o:c;s&&f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Upgrade resulted in new connectionId; resetting library connection position from "+(c.timeSerial||c.connectionSerial)+" to "+(u.timeSerial||u.connectionSerial)+"; upgrade error was "+e),f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+t),c.sync(t,u,(function(n,o,i){if(n)c.state===c.states.synchronizing&&(f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.scheduleTransportActivation()","Unexpected error attempting to sync transport; transport = "+t+"; err = "+n),c.disconnectAllTransports());else{var s=function(){f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+t),c.activateTransport(e,t,o,r,i),c.state===c.states.synchronizing?(f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+t),c.state=c.states.connected):f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+c.state.state+", so leaving unchanged"),c.state.sendEvents&&c.sendQueuedMessages()};a?a.onceIdle(s):s()}}))}}))):(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+t.shortName+" is no better than current active transport "+u.shortName+" - abandoning upgrade"),void l())},n.prototype.activateTransport=function(e,t,n,r,o){var s=this;f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+t),e&&f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+e),n&&f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+n),r&&f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(r)),o&&f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.activateTransport()","serial =  "+(o.timeSerial||o.connectionSerial)),this.persistTransportPreference(t);var c=this.state,u=this.states.connected.state;if(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+c.state),c.state==this.states.closing.state||c.state==this.states.closed.state||c.state==this.states.failed.state)return f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),t.disconnect(),!1;if(i.arrDeleteValue(this.pendingTransports,t),!t.isConnected)return f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+t+" since it appears to no longer be connected"),!1;var l=this.activeProtocol;this.activeProtocol=new a.default(t),this.host=t.params.host;var p=r.connectionKey;if(p&&this.connectionKey!=p&&this.setConnection(n,r,o,!!e),this.onConnectionDetailsUpdate(r,t),i.nextTick((function(){t.on("connected",(function(e,n,r){s.onConnectionDetailsUpdate(r,t),s.emit("update",new d.default(u,u,null,e))}))})),c.state===this.states.connected.state?e&&(this.errorReason=this.realtime.connection.errorReason=e,this.emit("update",new d.default(u,u,null,e))):(this.notifyState({state:"connected",error:e}),this.errorReason=this.realtime.connection.errorReason=e||null),this.emit("transport.active",t),l)if(l.messageQueue.count()>0&&f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+l.transport.shortName+", new one is "+t.shortName+") finishing with "+l.messageQueue.count()+" messages still pending"),l.transport===t){var h="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+t.shortName+"; stack = "+(new Error).stack;f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.activateTransport()",h)}else l.finish();return i.safeArrForEach(this.pendingTransports,(function(e){if(e===t){var n="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+t.shortName+"; stack = "+(new Error).stack;f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.activateTransport()",n),i.arrDeleteValue(s.pendingTransports,t)}else e.disconnect()})),i.safeArrForEach(this.proposedTransports,(function(e){e===t?(f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+t.shortName+"; stack = "+(new Error).stack),i.arrDeleteValue(s.proposedTransports,t)):e.dispose()})),!0},n.prototype.deactivateTransport=function(e,t,n){var r=this.activeProtocol,o=r&&r.getTransport()===e,a=i.arrDeleteValue(this.pendingTransports,e),s=i.arrDeleteValue(this.proposedTransports,e),c=this.noTransportsScheduledForActivation();if(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+e),f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+t+(o?"; was active":a?"; was pending":s?"; was proposed":"")+(c?"":"; another transport is scheduled for activation")),n&&n.message&&f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+n.message),o&&(f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(r.getPendingMessages()),i.nextTick((function(){r.clearPendingMessages()})),this.activeProtocol=this.host=null,clearTimeout(this.channelResumeCheckTimer)),this.emit("transport.inactive",e),o&&c||o&&"failed"===t||"closed"===t||null===r&&a&&0===this.pendingTransports.length){if("disconnected"===t&&n&&n.statusCode>500&&this.httpHosts.length>1)return this.unpersistTransportPreference(),this.forceFallbackHost=!0,void this.notifyState({state:t,error:n,retryImmediately:!0});var u="failed"===t&&g.default.isTokenErr(n)?"disconnected":t;this.notifyState({state:u,error:n})}else o&&"disconnected"===t&&this.state!==this.states.synchronizing&&(f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:n}))},n.prototype.noTransportsScheduledForActivation=function(){return i.isEmpty(this.pendingTransports)||this.pendingTransports.every((function(e){return!e.isConnected}))},n.prototype.sync=function(e,t,n){var r=setTimeout((function(){e.off("sync"),n(new h.default("Timeout waiting for sync response",5e4,500))}),this.options.timeouts.realtimeRequestTimeout),i=o.default.fromValues({action:S.SYNC,connectionKey:this.connectionKey});t.timeSerial?i.timeSerial=t.timeSerial:void 0!==t.connectionSerial&&(i.connectionSerial=t.connectionSerial),e.send(i),e.once("sync",(function(e,t){clearTimeout(r),n(null,e,t)}))},n.prototype.setConnection=function(e,t,n,r){var o=this,a=this.connectionId,s=a&&a!==e;(s||!a&&r)&&(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0),this.connectionId!==e?(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),i.nextTick((function(){o.realtime.channels.reattach()}))):this.options.checkChannelsOnResume&&(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.setConnection()","Same connectionId; checkChannelsOnResume is enabled"),clearTimeout(this.channelResumeCheckTimer),this.realtime.channels.resetAttachedMsgIndicators(),this.channelResumeCheckTimer=setTimeout((function(){o.realtime.channels.checkAttachedMsgIndicators(e)}),3e4)),this.realtime.connection.id=this.connectionId=e,this.realtime.connection.key=this.connectionKey=t.connectionKey;var c=s||!a;this.setConnectionSerial(n,c)},n.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.clearConnectionSerial(),this.msgSerial=0,this.unpersistConnection()},n.prototype.setConnectionSerial=function(e,t){var n=e.timeSerial,r=e.connectionSerial;if(f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.setConnectionSerial()","Updating connection serial; serial = "+r+"; timeSerial = "+n+"; force = "+t+"; previous = "+this.connectionSerial),void 0!==n)return n<=this.timeSerial&&!t?(f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with timeSerial "+n+", but current timeSerial is "+this.timeSerial+"; assuming message is a duplicate and discarding it"),!0):(this.realtime.connection.timeSerial=this.timeSerial=n,void this.setRecoveryKey());if(void 0!==r){if(r<=this.connectionSerial&&!t)return f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.setConnectionSerial()","received message with connectionSerial "+r+", but current connectionSerial is "+this.connectionSerial+"; assuming message is a duplicate and discarding it"),!0;this.realtime.connection.serial=this.connectionSerial=r,this.setRecoveryKey()}},n.prototype.clearConnectionSerial=function(){this.realtime.connection.serial=this.connectionSerial=void 0,this.realtime.connection.timeSerial=this.timeSerial=void 0,this.clearRecoveryKey()},n.prototype.setRecoveryKey=function(){this.realtime.connection.recoveryKey=this.connectionKey+":"+(this.timeSerial||this.connectionSerial)+":"+this.msgSerial},n.prototype.clearRecoveryKey=function(){this.realtime.connection.recoveryKey=null},n.prototype.checkConnectionStateFreshness=function(){if(this.lastActivity&&this.connectionId){var e=i.now()-this.lastActivity;e>this.connectionStateTtl+this.maxIdleInterval&&(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+e+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended",this.states.connecting.queueEvents=!1)}},n.prototype.persistConnection=function(){if(R){var t=this.realtime.connection.recoveryKey;t&&(n={recoveryKey:t,disconnectedAt:i.now(),location:e.location,clientId:this.realtime.auth.clientId},R&&(null===(r=null==v?void 0:v.setSession)||void 0===r||r.call(v,T,n)))}var n,r},n.prototype.unpersistConnection=function(){var e;R&&(null===(e=null==v?void 0:v.removeSession)||void 0===e||e.call(v,T))},n.prototype.getError=function(){return this.errorReason||this.getStateError()},n.prototype.getStateError=function(){return p.default[this.state.state]},n.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},n.prototype.enactStateChange=function(e){var t="failed"===e.current?f.default.LOG_ERROR:f.default.LOG_MAJOR;f.default.logAction(t,"Connection state",e.current+(e.reason?"; reason: "+e.reason:"")),f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+e.current+"; reason = "+(e.reason&&e.reason.message));var n=this.state=this.states[e.current];e.reason&&(this.errorReason=e.reason,this.realtime.connection.errorReason=e.reason),(n.terminal||"suspended"===n.state)&&this.clearConnection(),this.emit("connectionstate",e)},n.prototype.startTransitionTimer=function(e){var t=this;f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+e.state),this.transitionTimer&&(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout((function(){t.transitionTimer&&(t.transitionTimer=null,f.default.logAction(f.default.LOG_MINOR,"ConnectionManager "+e.state+" timer expired","requesting new state: "+e.failState),t.notifyState({state:e.failState}))}),e.retryDelay)},n.prototype.cancelTransitionTimer=function(){f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},n.prototype.startSuspendTimer=function(){var e=this;this.suspendTimer||(this.suspendTimer=setTimeout((function(){e.suspendTimer&&(e.suspendTimer=null,f.default.logAction(f.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),e.states.connecting.failState="suspended",e.states.connecting.queueEvents=!1,e.notifyState({state:"suspended"}))}),this.connectionStateTtl))},n.prototype.checkSuspendTimer=function(e){"disconnected"!==e&&"suspended"!==e&&"connecting"!==e&&this.cancelSuspendTimer()},n.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.states.connecting.queueEvents=!0,this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},n.prototype.startRetryTimer=function(e){var t=this;this.retryTimer=setTimeout((function(){f.default.logAction(f.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),t.retryTimer=null,t.requestState({state:"connecting"})}),e)},n.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},n.prototype.notifyState=function(e){var t=this,n=e.state,r="disconnected"===n&&(this.state===this.states.connected||this.state===this.states.synchronizing||e.retryImmediately||this.state===this.states.connecting&&e.error&&g.default.isTokenErr(e.error)&&!(this.errorReason&&g.default.isTokenErr(this.errorReason)));if(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+n+(r?"; will retry connection immediately":"")),n!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(e.state),!this.state.terminal)){var o=this.states[e.state],a=new d.default(this.state.state,o.state,o.retryDelay,e.error||p.default[o.state]);if(r){var s=function(){t.state===t.states.disconnected&&(t.lastAutoReconnectAttempt=i.now(),t.requestState({state:"connecting"}))},c=this.lastAutoReconnectAttempt&&i.now()-this.lastAutoReconnectAttempt+1;c&&c<1e3?(f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+c+"ms ago, waiting another "+(1e3-c)+"ms before trying again"),setTimeout(s,1e3-c)):i.nextTick(s)}else"disconnected"!==n&&"suspended"!==n||this.startRetryTimer(o.retryDelay);("disconnected"===n&&!r||"suspended"===n||o.terminal)&&i.nextTick((function(){t.disconnectAllTransports()})),"connected"!=n||this.activeProtocol||f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(a),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(n,a.reason),this.failQueuedMessages(a.reason))}},n.prototype.requestState=function(e){var t=this,n=e.state;if(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+n+"; current state: "+this.state.state),n!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(n),!("connecting"==n&&"connected"==this.state.state||"closing"==n&&"closed"==this.state.state))){var r=this.states[n],o=new d.default(this.state.state,r.state,null,e.error||p.default[r.state]);this.enactStateChange(o),"connecting"==n&&i.nextTick((function(){t.startConnect()})),"closing"==n&&this.closeImpl()}},n.prototype.startConnect=function(){var e=this;if(this.state===this.states.connecting){var t=this.realtime.auth,n=++this.connectCounter,r=function(){e.checkConnectionStateFreshness(),e.getTransportParams((function(t){n===e.connectCounter&&e.connectImpl(t,n)}))};if(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),"basic"===t.method)r();else{var o=function(t){n===e.connectCounter&&(t?e.actOnErrorFromAuthorize(t):r())};this.errorReason&&g.default.isTokenErr(this.errorReason)?t._forceNewToken(null,null,o):t._ensureValidAuthCredentials(!1,o)}}else f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state)},n.prototype.connectImpl=function(e,t){var n=this.state.state;n!==this.states.connecting.state&&n!==this.states.connected.state?f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+n):this.pendingTransports.length?f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):n==this.states.connected.state?this.upgradeIfNeeded(e):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(e):this.connectBase(e,t)},n.prototype.connectPreference=function(e){var t=this,n=this.getTransportPreference(),r=!1;i.arrIn(this.transports,n)||(this.unpersistTransportPreference(),this.connectImpl(e)),f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+n);var o=setTimeout((function(){r=!0,t.state.state!==t.states.connected.state&&(f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+n+" failed; clearing preference and trying from scratch"),t.disconnectAllTransports(),t.unpersistTransportPreference()),t.connectImpl(e)}),this.options.timeouts.preferenceConnectTimeout);e.host=this.httpHosts[0],this.tryATransport(e,n,(function(n,a){clearTimeout(o),r&&a?(a.off(),a.disconnect(),i.arrDeleteValue(t.pendingTransports,a)):a||n||(t.unpersistTransportPreference(),t.connectImpl(e))}))},n.prototype.connectBase=function(e,t){var n=this,r=function(e){n.notifyState({state:n.states.connecting.failState,error:e})},o=this.httpHosts.slice(),a=function(e,r){t===n.connectCounter&&(r||e||c())};f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var s=o.shift();if(s){e.host=s;var c=function(){o.length?n.realtime.http.checkConnectivity?n.realtime.http.checkConnectivity((function(s,c){t===n.connectCounter&&(s?r(s):c?(e.host=i.arrPopRandomElement(o),n.tryATransport(e,n.baseTransport,a)):r(new h.default("Unable to connect (network unreachable)",80003,404)))})):r(new h.default("Internal error: Http.checkConnectivity not set",null,500)):r(new h.default("Unable to connect (and no more fallback hosts to try)",80003,404))};if(this.forceFallbackHost&&o.length)return this.forceFallbackHost=!1,void c();this.tryATransport(e,this.baseTransport,a)}else r(new h.default("Unable to connect (no available host)",80003,404))},n.prototype.getUpgradePossibilities=function(){var e=this.activeProtocol.getTransport().shortName,t=i.arrIndexOf(this.upgradeTransports,e);return this.upgradeTransports.slice(t+1)},n.prototype.upgradeIfNeeded=function(e){var t=this,n=this.getUpgradePossibilities();f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+i.inspect(n)),n.length&&i.arrForEach(n,(function(n){var r=t.createTransportParams(e.host,"upgrade");t.tryATransport(r,n,C)}))},n.prototype.closeImpl=function(){f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),i.safeArrForEach(this.pendingTransports,(function(e){f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+e),e&&e.close()})),i.safeArrForEach(this.proposedTransports,(function(e){f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+e),e&&e.dispose()})),this.activeProtocol&&(f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},n.prototype.onAuthUpdated=function(e,t){var n,r=this;switch(this.state.state){case"connected":if(f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var a=this.activeProtocol.getTransport().params;i.nextTick((function(){"connected"===r.state.state&&r.upgradeIfNeeded(a)}))}var s=null===(n=this.activeProtocol)||void 0===n?void 0:n.getTransport();s&&s.onAuthUpdated&&s.onAuthUpdated(e);var c=o.default.fromValues({action:S.AUTH,auth:{accessToken:e.token}});this.send(c);var u=function(){r.off(l),t(null,e)},l=function(e){"failed"===e.current&&(r.off(u),r.off(l),t(e.reason||r.getStateError()))};this.once("connectiondetails",u),this.on("connectionstate",l);break;case"connecting":f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var d=function(n){switch(n.current){case"connected":r.off(d),t(null,e);break;case"failed":case"closed":case"suspended":r.off(d),t(n.reason||r.getStateError())}};this.on("connectionstate",d),"connecting"===this.state.state?this.startConnect():this.requestState({state:"connecting"})}},n.prototype.disconnectAllTransports=function(e){f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(e?" except the active transport":"")),this.connectCounter++,i.safeArrForEach(this.pendingTransports,(function(e){f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+e),e&&e.disconnect()})),this.pendingTransports=[],i.safeArrForEach(this.proposedTransports,(function(e){f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+e),e&&e.dispose()})),this.proposedTransports=[],this.activeProtocol&&!e&&(f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},n.prototype.send=function(e,t,n){n=n||C;var r=this.state;if(r.sendEvents)return f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.send()","sending event"),void this.sendImpl(new a.PendingMessage(e,n));if(!(t&&r.queueEvents||r.forceQueueEvents)){var i="rejecting event, queueEvent was "+t+", state was "+r.state;return f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.send()",i),void n(this.errorReason||new h.default(i,9e4,400))}f.default.shouldLog(f.default.LOG_MICRO)&&f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+o.default.stringify(e)),this.queue(e,n)},n.prototype.sendImpl=function(e){var t=e.message;e.ackRequired&&!e.sendAttempted&&(t.msgSerial=this.msgSerial++,this.setRecoveryKey());try{this.activeProtocol.send(e)}catch(e){f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+e.stack)}},n.prototype.queue=function(e,t){f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var n=this.queuedMessages.last(),r=this.options.maxMessageSize;n&&!n.sendAttempted&&function(e,t,n){var r;if(e.channel!==t.channel)return!1;if((r=e.action)!==S.PRESENCE&&r!==S.MESSAGE)return!1;if(r!==t.action)return!1;var o=r===S.PRESENCE?"presence":"messages",a=e[o].concat(t[o]);return!(m.default.getMessagesSize(a)>n||!i.allSame(a,"clientId")||!i.arrEvery(a,(function(e){return!e.id}))||(e[o]=a,0))}(n.message,e,r)?(n.merged||(n.callback=y.default.create([n.callback]),n.merged=!0),n.callback.push(t)):this.queuedMessages.push(new a.PendingMessage(e,t))},n.prototype.sendQueuedMessages=function(){var e;for(f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");e=this.queuedMessages.shift();)this.sendImpl(e)},n.prototype.queuePendingMessages=function(e){e&&e.length&&(f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+e.length+" pending messages"),this.queuedMessages.prepend(e))},n.prototype.failQueuedMessages=function(e){var t=this.queuedMessages.count();t>0&&(f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+t+" queued messages, err = "+i.inspectError(e)),this.queuedMessages.completeAllMessages(e))},n.prototype.onChannelMessage=function(e,t){var n=this.activeProtocol&&t===this.activeProtocol.getTransport(),r=i.arrIn(this.pendingTransports,t)&&this.state==this.states.synchronizing,a=e.action===S.MESSAGE||e.action===S.PRESENCE;if(n||r){if(a){if(this.setConnectionSerial(e))return;if(o.default.isDuplicate(e,this.mostRecentMsg))return void f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.onChannelMessage()","received message with different connectionSerial, but same message id as a previous; discarding; id = "+e.id);this.mostRecentMsg=e}this.realtime.channels.onChannelMessage(e)}else i.arrIndexOf([S.ACK,S.NACK,S.ERROR],e.action)>-1?this.realtime.channels.onChannelMessage(e):f.default.logAction(f.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(e)+"on defunct transport; discarding")},n.prototype.ping=function(e,t){var n=this;if(e){f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+e);var r=i.now(),o=i.cheapRandStr(),a=function(n){if(n===o){e.off("heartbeat",a),clearTimeout(s);var c=i.now()-r;t(null,c)}},s=setTimeout((function(){e.off("heartbeat",a),t(new h.default("Timeout waiting for heartbeat response",5e4,500))}),this.options.timeouts.realtimeRequestTimeout);return e.on("heartbeat",a),void e.ping(o)}if("connected"===this.state.state){var c=!1,u=function(){c||(c=!0,i.nextTick((function(){n.ping(null,t)})))};this.on("transport.active",u),this.ping(this.activeProtocol.getTransport(),(function(e,r){n.off("transport.active",u),c||(c=!0,t(e,r))}))}else t(new h.default("Unable to ping service; not connected",4e4,400))},n.prototype.abort=function(e){this.activeProtocol.getTransport().fail(e)},n.prototype.registerProposedTransport=function(e){this.proposedTransports.push(e)},n.prototype.getTransportPreference=function(){var e;return this.transportPreference||O&&(null===(e=v.get)||void 0===e?void 0:e.call(v,k))},n.prototype.persistTransportPreference=function(e){var t;i.arrIn(s.default.upgradeTransports,e.shortName)&&(this.transportPreference=e.shortName,O&&(null===(t=v.set)||void 0===t||t.call(v,k,e.shortName)))},n.prototype.unpersistTransportPreference=function(){var e;this.transportPreference=null,O&&(null===(e=v.remove)||void 0===e||e.call(v,k))},n.prototype.actOnErrorFromAuthorize=function(e){if(40171===e.code)this.notifyState({state:"failed",error:e});else if(e.statusCode===w.default.Forbidden){var t="Client configured authentication provider returned 403; failing the connection";f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",t),this.notifyState({state:"failed",error:new h.default(t,80019,403,e)})}else t="Client configured authentication provider request failed",f.default.logAction(f.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",t),this.notifyState({state:this.state.failState,error:new h.default(t,80019,401,e)})},n.prototype.onConnectionDetailsUpdate=function(e,t){if(e){this.connectionDetails=e,e.maxMessageSize&&(this.options.maxMessageSize=e.maxMessageSize);var n=e.clientId;if(n){var r=this.realtime.auth._uncheckedSetClientId(n);if(r)return f.default.logAction(f.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",r.message),void t.fail(r)}var o=e.connectionStateTtl;o&&(this.connectionStateTtl=o),this.maxIdleInterval=e.maxIdleInterval,this.emit("connectiondetails",e)}},n.supportedTransports={},n}(u.default);b.default(I),i.arrForEach(_.default,(function(e){e(I)})),t.default=I}).call(this,n(14))},function(e,t,n){e.exports=n(7).enc.Utf8},function(e,t,n){var r;e.exports=(r=n(7),function(e){var t=r,n=t.lib,o=n.WordArray,i=n.Hasher,a=t.algo,s=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,o=0;o<64;)t(r)&&(o<8&&(s[o]=n(e.pow(r,.5))),c[o]=n(e.pow(r,1/3)),o++),r++}();var u=[],l=a.SHA256=i.extend({_doReset:function(){this._hash=new o.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],l=n[5],f=n[6],d=n[7],p=0;p<64;p++){if(p<16)u[p]=0|e[t+p];else{var h=u[p-15],g=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,m=u[p-2],y=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[p]=g+u[p-7]+y+u[p-16]}var v=r&o^r&i^o&i,_=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),b=d+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&l^~s&f)+c[p]+u[p];d=f,f=l,l=s,s=a+b|0,a=i,i=o,o=r,r=b+(_+v)|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0,n[5]=n[5]+l|0,n[6]=n[6]+f|0,n[7]=n[7]+d|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=e.floor(r/4294967296),n[15+(o+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(l),t.HmacSHA256=i._createHmacHelper(l)}(Math),r.SHA256)},function(e,t,n){var r,o,i,a,s,c,u,l;e.exports=(l=n(7),o=(r=l).lib,i=o.WordArray,a=o.Hasher,s=r.algo,c=[],u=s.SHA1=a.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],u=0;u<80;u++){if(u<16)c[u]=0|e[t+u];else{var l=c[u-3]^c[u-8]^c[u-14]^c[u-16];c[u]=l<<1|l>>>31}var f=(r<<5|r>>>27)+s+c[u];f+=u<20?1518500249+(o&i|~o&a):u<40?1859775393+(o^i^a):u<60?(o&i|o&a|i&a)-1894007588:(o^i^a)-899497514,s=a,a=i,i=o<<30|o>>>2,o=r,r=f}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),r.SHA1=a._createHelper(u),r.HmacSHA1=a._createHmacHelper(u),l.SHA1)},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importDefault(n(12)),i=r.__importStar(n(2)),a=r.__importDefault(n(8)),s=r.__importDefault(n(0)),c=r.__importDefault(n(25)),u=r.__importDefault(n(5)),l=o.default.Action,f=o.default.fromValues({action:l.CLOSE}),d=o.default.fromValues({action:l.DISCONNECT}),p=function(e){function t(t,n,r,o){var i=e.call(this)||this;return o&&(r.format=void 0,r.heartbeats=!0),i.connectionManager=t,t.registerProposedTransport(i),i.auth=n,i.params=r,i.timeouts=r.options.timeouts,i.format=r.format,i.isConnected=!1,i.isFinished=!1,i.isDisposed=!1,i.maxIdleInterval=null,i.idleTimer=null,i.lastActivity=null,i}return r.__extends(t,e),t.prototype.connect=function(){},t.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",c.default.closed)},t.prototype.disconnect=function(e){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",e||c.default.disconnected)},t.prototype.fail=function(e){this.isConnected&&this.requestDisconnect(),this.finish("failed",e||c.default.failed)},t.prototype.finish=function(e,t){var n;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout(null!==(n=this.idleTimer)&&void 0!==n?n:void 0),this.idleTimer=null,this.emit(e,t),this.dispose())},t.prototype.onProtocolMessage=function(e){switch(s.default.shouldLog(s.default.LOG_MICRO)&&s.default.logAction(s.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+o.default.stringify(e)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),e.action){case l.HEARTBEAT:s.default.logAction(s.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",e.id);break;case l.CONNECTED:this.onConnect(e),this.emit("connected",e.error,e.connectionId,e.connectionDetails,e);break;case l.CLOSED:this.onClose(e);break;case l.DISCONNECTED:this.onDisconnect(e);break;case l.ACK:this.emit("ack",e.msgSerial,e.count);break;case l.NACK:this.emit("nack",e.msgSerial,e.count,e.error);break;case l.SYNC:if(void 0!==e.connectionId){this.emit("sync",e.connectionId,e);break}this.connectionManager.onChannelMessage(e,this);break;case l.AUTH:this.auth.authorize((function(e){e&&s.default.logAction(s.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+i.inspectError(e))}));break;case l.ERROR:if(s.default.logAction(s.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+i.inspect(e.error)+(e.channel?", channel: "+e.channel:"")),void 0===e.channel){this.onFatalError(e);break}this.connectionManager.onChannelMessage(e,this);break;default:this.connectionManager.onChannelMessage(e,this)}},t.prototype.onConnect=function(e){if(this.isConnected=!0,!e.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var t=e.connectionDetails.maxIdleInterval;t&&(this.maxIdleInterval=t+this.timeouts.realtimeRequestTimeout,this.onActivity())},t.prototype.onDisconnect=function(e){var t=e&&e.error;s.default.logAction(s.default.LOG_MINOR,"Transport.onDisconnect()","err = "+i.inspectError(t)),this.finish("disconnected",t)},t.prototype.onFatalError=function(e){var t=e&&e.error;s.default.logAction(s.default.LOG_MINOR,"Transport.onFatalError()","err = "+i.inspectError(t)),this.finish("failed",t)},t.prototype.onClose=function(e){var t=e&&e.error;s.default.logAction(s.default.LOG_MINOR,"Transport.onClose()","err = "+i.inspectError(t)),this.finish("closed",t)},t.prototype.requestClose=function(){s.default.logAction(s.default.LOG_MINOR,"Transport.requestClose()",""),this.send(f)},t.prototype.requestDisconnect=function(){s.default.logAction(s.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(d)},t.prototype.ping=function(e){var t={action:o.default.Action.HEARTBEAT};e&&(t.id=e),this.send(o.default.fromValues(t))},t.prototype.dispose=function(){s.default.logAction(s.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},t.prototype.onActivity=function(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=i.now(),this.setIdleTimer(this.maxIdleInterval+100))},t.prototype.setIdleTimer=function(e){var t=this;this.idleTimer||(this.idleTimer=setTimeout((function(){t.onIdleTimerExpire()}),e))},t.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var e=i.now()-this.lastActivity,t=this.maxIdleInterval-e;if(t<=0){var n="No activity seen from realtime in "+e+"ms; assuming connection has dropped";s.default.logAction(s.default.LOG_ERROR,"Transport.onIdleTimerExpire()",n),this.disconnect(new u.default(n,80003,408))}else this.setIdleTimer(t+100)},t}(a.default);t.default=p},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importStar(n(2)),i=r.__importDefault(n(8)),a=r.__importDefault(n(0)),s=r.__importDefault(n(40)),c=r.__importDefault(n(20)),u=r.__importDefault(n(13)),l=r.__importDefault(n(5)),f=r.__importDefault(n(23)),d=r.__importDefault(n(18));function p(){}function h(e){return o.arrEvery(e,(function(e){return!e.id}))}function g(e){var t=e||{};if(t.cipher){if(!c.default)throw new Error("Encryption not enabled; use ably.encryption.js instead");var n=c.default.getCipher(t.cipher);t.cipher=n.cipherParams,t.channelCipher=n.cipher}else"cipher"in t&&(t.cipher=void 0,t.channelCipher=null);return t}var m=function(e){function t(t,n,r){var o=e.call(this)||this;return a.default.logAction(a.default.LOG_MINOR,"Channel()","started; name = "+n),o.rest=t,o.name=n,o.basePath="/channels/"+encodeURIComponent(n),o.presence=new s.default(o),o.channelOptions=g(r),o}return r.__extends(t,e),t.prototype.setOptions=function(e){this.channelOptions=g(e)},t.prototype.history=function(e,t){if(a.default.logAction(a.default.LOG_MICRO,"Channel.history()","channel = "+this.name),void 0===t)if("function"==typeof e)t=e,e=null;else{if(this.rest.options.promises)return o.promisify(this,"history",arguments);t=p}this._history(e,t)},t.prototype._history=function(e,t){var n=this.rest,r=n.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,i=this.rest.http.supportsLinkHeaders?void 0:r,a=o.defaultGetHeaders(r);n.options.headers&&o.mixin(a,n.options.headers);var s=this.channelOptions;new f.default(n,this.basePath+"/messages",a,i,(function(e,t,n){return u.default.fromResponseBody(e,s,n?void 0:r)})).get(e,t)},t.prototype.publish=function(){var e,t,n=this,r=arguments.length,i=arguments[0],a=arguments[1],s=arguments[r-1];if("function"!=typeof s){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);s=p}if("string"==typeof i||null===i)e=[u.default.fromValues({name:i,data:a})],t=arguments[2];else if(o.isObject(i))e=[u.default.fromValues(i)],t=arguments[1];else{if(!o.isArray(i))throw new l.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);e=u.default.fromValuesArray(i),t=arguments[1]}"object"==typeof t&&t||(t={});var c=this.rest,f=c.options,d=f.useBinaryProtocol?o.Format.msgpack:o.Format.json,g=c.options.idempotentRestPublishing,m=o.defaultPostHeaders(d);if(f.headers&&o.mixin(m,f.headers),g&&h(e)){var y=o.randomString(9);o.arrForEach(e,(function(e,t){e.id=y+":"+t.toString()}))}u.default.encodeArray(e,this.channelOptions,(function(r){if(r)s(r);else{var o=u.default.getMessagesSize(e),i=f.maxMessageSize;o>i?s(new l.default("Maximum size of messages that can be published at once exceeded ( was "+o+" bytes; limit is "+i+" bytes)",40009,400)):n._publish(u.default.serialize(e,d),m,t,s)}}))},t.prototype._publish=function(e,t,n,r){d.default.post(this.rest,this.basePath+"/messages",e,t,n,null,r)},t}(i.default);t.default=m},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importStar(n(2)),i=r.__importDefault(n(8)),a=r.__importDefault(n(0)),s=r.__importDefault(n(23)),c=r.__importDefault(n(15));function u(){}var l=function(e){function t(t){var n=e.call(this)||this;return n.channel=t,n.basePath=t.basePath+"/presence",n}return r.__extends(t,e),t.prototype.get=function(e,t){if(a.default.logAction(a.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),void 0===t)if("function"==typeof e)t=e,e=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"get",arguments);t=u}var n=this.channel.rest,r=n.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,i=this.channel.rest.http.supportsLinkHeaders?void 0:r,l=o.defaultGetHeaders(r);n.options.headers&&o.mixin(l,n.options.headers);var f=this.channel.channelOptions;new s.default(n,this.basePath,l,i,(function(e,t,n){return c.default.fromResponseBody(e,f,n?void 0:r)})).get(e,t)},t.prototype.history=function(e,t){a.default.logAction(a.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(e,t)},t.prototype._history=function(e,t){if(void 0===t)if("function"==typeof e)t=e,e=null;else{if(this.channel.rest.options.promises)return o.promisify(this,"_history",arguments);t=u}var n=this.channel.rest,r=n.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,i=this.channel.rest.http.supportsLinkHeaders?void 0:r,a=o.defaultGetHeaders(r);n.options.headers&&o.mixin(a,n.options.headers);var l=this.channel.channelOptions;new s.default(n,this.basePath+"/history",a,i,(function(e,t,n){return c.default.fromResponseBody(e,l,n?void 0:r)})).get(e,t)},t}(i.default);t.default=l},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importDefault(n(8)),i=r.__importDefault(n(0)),a=function(e){function t(){var t=e.call(this)||this;return t.messages=[],t}return r.__extends(t,e),t.prototype.count=function(){return this.messages.length},t.prototype.push=function(e){this.messages.push(e)},t.prototype.shift=function(){return this.messages.shift()},t.prototype.last=function(){return this.messages[this.messages.length-1]},t.prototype.copyAll=function(){return this.messages.slice()},t.prototype.append=function(e){this.messages.push.apply(this.messages,e)},t.prototype.prepend=function(e){this.messages.unshift.apply(this.messages,e)},t.prototype.completeMessages=function(e,t,n){i.default.logAction(i.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+e+"; count = "+t),n=n||null;var r=this.messages;if(0===r.length)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var o=r[0];if(o){var a=o.message.msgSerial,s=e+t;if(s>a)for(var c=0,u=r.splice(0,s-a);c<u.length;c++)u[c].callback(n);0==r.length&&this.emit("idle")}},t.prototype.completeAllMessages=function(e){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,e)},t.prototype.clear=function(){i.default.logAction(i.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},t}(o.default);t.default=a},function(e,t,n){"use strict";t.__esModule=!0;var r=function(e,t,n,r){this.previous=e,this.current=t,n&&(this.retryIn=n),r&&(this.reason=r)};t.default=r},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importDefault(n(12)),i=r.__importDefault(n(8)),a=r.__importStar(n(2)),s=r.__importDefault(n(39)),c=r.__importDefault(n(0)),u=r.__importDefault(n(65)),l=r.__importDefault(n(13)),f=r.__importDefault(n(44)),d=r.__importDefault(n(5)),p=r.__importDefault(n(15)),h=r.__importDefault(n(25)),g=o.default.Action,m=function(){},y="statechange",v="sync";function _(e){if(e&&"params"in e&&!a.isObject(e.params))return new d.default("options.params must be an object",4e4,400);if(e&&"modes"in e){if(!a.isArray(e.modes))return new d.default("options.modes must be an array",4e4,400);for(var t=0;t<e.modes.length;t++){var n=e.modes[t];if(!n||"string"!=typeof n||!a.arrIn(o.default.channelModes,String.prototype.toUpperCase.call(n)))return new d.default("Invalid channel mode: "+n,4e4,400)}}}var b=function(e){function t(t,n,r){var o=e.call(this,t,n,r)||this;return o.history=function(e,t){if(c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),void 0===t)if("function"==typeof e)t=e,e=null;else{if(this.rest.options.promises)return a.promisify(this,"history",arguments);t=m}if(e&&e.untilAttach){if("attached"!==this.state)return void t(new d.default("option untilAttach requires the channel to be attached",4e4,400));if(!this.properties.attachSerial)return void t(new d.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));delete e.untilAttach,e.from_serial=this.properties.attachSerial}s.default.prototype._history.call(this,e,t)},o.whenState=function(e,t){return i.default.prototype.whenState.call(o,e,o.state,t)},c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel()","started; name = "+n),o.realtime=t,o.presence=new u.default(o),o.connectionManager=t.connection.connectionManager,o.state="initialized",o.subscriptions=new i.default,o.syncChannelSerial=void 0,o.properties={attachSerial:void 0},o.setOptions(r),o.errorReason=null,o._requestedFlags=null,o._mode=null,o._attachedMsgIndicator=!1,o._attachResume=!1,o._decodingContext={channelOptions:o.channelOptions,plugins:t.options.plugins||{},baseEncodedPreviousPayload:void 0},o._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},o._allChannelChanges=new i.default,o}return r.__extends(t,e),t.invalidStateError=function(e){return{statusCode:400,code:90001,message:"Channel operation failed as channel state is "+e}},t.processListenerArgs=function(e){return"function"==typeof(e=Array.prototype.slice.call(e))[0]&&e.unshift(null),null==e[e.length-1]&&e.pop(),e},t.prototype.setOptions=function(e,t){if(!t&&this.rest.options.promises)return a.promisify(this,"setOptions",arguments);var n=t||function(e){e&&c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+e.toString())},r=_(e);r?n(r):(s.default.prototype.setOptions.call(this,e),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(e)?(this.attachImpl(),this._allChannelChanges.once((function(e){switch(this.event){case"update":case"attached":return void(null==n||n(null));default:return void(null==n||n(e.reason))}}))):n())},t.prototype._shouldReattachToSetOptions=function(e){return("attached"===this.state||"attaching"===this.state)&&(e.params||e.modes)},t.prototype.publish=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=t[0],o=t.length,i=t[o-1];if("function"!=typeof i){if(this.realtime.options.promises)return a.promisify(this,"publish",arguments);i=m,++o}if(this.connectionManager.activeState()){if(2==o)if(a.isObject(r))r=[l.default.fromValues(r)];else{if(!a.isArray(r))throw new d.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);r=l.default.fromValuesArray(r)}else r=[l.default.fromValues({name:t[0],data:t[1]})];var s=this.realtime.options.maxMessageSize;l.default.encodeArray(r,this.channelOptions,(function(t){if(t)i(t);else{var n=l.default.getMessagesSize(r);n>s?i(new d.default("Maximum size of messages that can be published at once exceeded ( was "+n+" bytes; limit is "+s+" bytes)",40009,400)):e.__publish(r,i)}}))}else i(this.connectionManager.getError())},t.prototype.__publish=function(e,n){c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+e.length);var r=this.state;switch(r){case"failed":case"suspended":n(d.default.fromValues(t.invalidStateError(r)));break;default:c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+r);var i=new o.default;i.action=g.MESSAGE,i.channel=this.name,i.messages=e,this.sendMessage(i,n)}},t.prototype.onEvent=function(e){c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var t=this.subscriptions,n=0;n<e.length;n++){var r=e[n];t.emit(r.name,r)}},t.prototype.attach=function(e,t){var n;if("function"==typeof e?(t=e,n=null):n=e,!t){if(this.realtime.options.promises)return a.promisify(this,"attach",arguments);t=function(e){e&&c.default.logAction(c.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+e.toString())}}if(n)c.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=n;else if("attached"===this.state)return void t();this._attach(!1,null,t)},t.prototype._attach=function(e,t,n){n||(n=function(e){e&&c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+e.toString())});var r=this.connectionManager;r.activeState()?(("attaching"!==this.state||e)&&this.requestState("attaching",t),this.once((function(e){switch(this.event){case"attached":null==n||n();break;case"detached":case"suspended":case"failed":null==n||n(e.reason||r.getError()||new d.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":null==n||n(new d.default("Attach request superseded by a subsequent detach request",9e4,409))}}))):n(r.getError())},t.prototype.attachImpl=function(){c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message"),this.setInProgress(y,!0);var e=o.default.fromValues({action:g.ATTACH,channel:this.name,params:this.channelOptions.params});this._requestedFlags?e.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&e.encodeModesToFlags(a.allToUpperCase(this.channelOptions.modes)),this._attachResume&&e.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(e.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(e,m)},t.prototype.detach=function(e){if(!e){if(this.realtime.options.promises)return a.promisify(this,"detach",arguments);e=m}var t=this.connectionManager;if(t.activeState())switch(this.state){case"suspended":this.notifyState("detached"),e();break;case"detached":e();break;case"failed":e(new d.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once((function(n){switch(this.event){case"detached":e();break;case"attached":case"suspended":case"failed":e(n.reason||t.getError()||new d.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":e(new d.default("Detach request superseded by a subsequent attach request",9e4,409))}}))}else e(t.getError())},t.prototype.detachImpl=function(e){this.connectionManager.mostRecentMsg&&this.connectionManager.mostRecentMsg.channel===this.name&&(this.connectionManager.mostRecentMsg=null),c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message"),this.setInProgress(y,!0);var t=o.default.fromValues({action:g.DETACH,channel:this.name});this.sendMessage(t,e||m)},t.prototype.subscribe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=t.processListenerArgs(e),o=r[0],i=r[1],s=r[2];return!s&&this.realtime.options.promises?a.promisify(this,"subscribe",[o,i]):"failed"!==this.state?(this.subscriptions.on(o,i),this.attach(s||m)):void(null==s||s(d.default.fromValues(t.invalidStateError("failed"))))},t.prototype.unsubscribe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=t.processListenerArgs(e),o=r[0],i=r[1];this.subscriptions.off(o,i)},t.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new d.default("Unable to sync to channel; not attached",4e4)}var e=this.connectionManager;if(!e.activeState())throw e.getError();var t=o.default.fromValues({action:g.SYNC,channel:this.name});this.syncChannelSerial&&(t.channelSerial=this.syncChannelSerial),e.send(t)},t.prototype.sendMessage=function(e,t){this.connectionManager.send(e,this.realtime.options.queueMessages,t)},t.prototype.sendPresence=function(e,t){var n=o.default.fromValues({action:g.PRESENCE,channel:this.name,presence:a.isArray(e)?p.default.fromValuesArray(e):[p.default.fromValues(e)]});this.sendMessage(n,t)},t.prototype.onMessage=function(e){var t,n=!1;switch(e.action){case g.ATTACHED:this._attachedMsgIndicator=!0,this.properties.attachSerial=e.channelSerial,this._mode=e.getMode(),this.params=e.params||{};var r=e.decodeModesFromFlags();this.modes=r&&a.allToLowerCase(r)||void 0;var o=e.hasFlag("RESUMED"),i=e.hasFlag("HAS_PRESENCE");if("attached"===this.state){this.setInProgress(y,!1),o||this.presence.onAttached(i);var s=new f.default(this.state,this.state,o,e.error);this._allChannelChanges.emit("update",s),o&&!this.channelOptions.updateOnAttached||this.emit("update",s)}else"detaching"===this.state?this.checkPendingState():this.notifyState("attached",e.error,o,i);break;case g.DETACHED:var u=e.error?d.default.fromValues(e.error):new d.default("Channel detached",90001,404);"detaching"===this.state?this.notifyState("detached",u):"attaching"===this.state?this.notifyState("suspended",u):this.requestState("attaching",u);break;case g.SYNC:if(n=!0,t=this.syncChannelSerial=e.channelSerial,!e.presence)break;case g.PRESENCE:for(var m=e.presence,v=e.id,_=e.connectionId,b=e.timestamp,w=this.channelOptions,O=void 0,R=0;R<m.length;R++)try{O=m[R],p.default.decode(O,w),O.connectionId||(O.connectionId=_),O.timestamp||(O.timestamp=b),O.id||(O.id=v+":"+R)}catch(e){c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.onMessage()",e.toString())}this.presence.setPresence(m,n,t);break;case g.MESSAGE:if("attached"!==this.state)return void c.default.logAction(c.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+e.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');var S=e.messages,C=S[0],A=S[S.length-1];if(v=e.id,_=e.connectionId,b=e.timestamp,C.extras&&C.extras.delta&&C.extras.delta.from!==this._lastPayload.messageId){var E='Delta message decode failure - previous message not available for message "'+e.id+'" on this channel "'+this.name+'".';c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.onMessage()",E),this._startDecodeFailureRecovery(new d.default(E,40018,400));break}for(R=0;R<S.length;R++){E=S[R];try{l.default.decode(E,this._decodingContext)}catch(e){switch(c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.onMessage()",e.toString()),e.code){case 40018:return void this._startDecodeFailureRecovery(e);case 40019:case 40021:return void this.notifyState("failed",e)}}E.connectionId||(E.connectionId=_),E.timestamp||(E.timestamp=b),E.id||(E.id=v+":"+R)}this._lastPayload.messageId=A.id,this._lastPayload.protocolMessageChannelSerial=e.channelSerial,this.onEvent(S);break;case g.ERROR:var k=e.error;k&&80016==k.code?this.checkPendingState():this.notifyState("failed",d.default.fromValues(k));break;default:c.default.logAction(c.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+e.action+")"),this.connectionManager.abort(h.default.unknownChannelErr)}},t.prototype._startDecodeFailureRecovery=function(e){var t=this;this._lastPayload.decodeFailureRecoveryInProgress||(c.default.logAction(c.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,e,(function(){t._lastPayload.decodeFailureRecoveryInProgress=!1})))},t.prototype.onAttached=function(){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},t.prototype.notifyState=function(e,t,n,r){if(c.default.logAction(c.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+e),this.clearStateTimer(),e!==this.state){this.presence.actOnChannelState(e,r,t),"suspended"===e&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),t&&(this.errorReason=t);var o=new f.default(this.state,e,n,t),i="failed"===e?c.default.LOG_ERROR:c.default.LOG_MAJOR;c.default.logAction(i,'Channel state for channel "'+this.name+'"',e+(t?"; reason: "+t:"")),"attached"===e?(this.onAttached(),this.setInProgress(v,r),this.setInProgress(y,!1)):"detached"!==e&&"failed"!==e&&"suspended"!==e||(this.setInProgress(y,!1),this.setInProgress(v,!1)),"attached"===e?this._attachResume=!0:"detaching"!==e&&"failed"!==e||(this._attachResume=!1),this.state=e,this._allChannelChanges.emit(e,o),this.emit(e,o)}},t.prototype.requestState=function(e,t){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+e),this.notifyState(e,t),this.checkPendingState()},t.prototype.checkPendingState=function(){var e=this.connectionManager.state;if(e.sendEvents||e.forceQueueEvents)switch(c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync()}else c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state)},t.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":var e=new d.default("Channel attach timed out",90007,408);this.notifyState("suspended",e);break;case"detaching":e=new d.default("Channel detach timed out",90007,408),this.notifyState("attached",e);break;default:this.checkPendingState()}},t.prototype.startStateTimerIfNotRunning=function(){var e=this;this.stateTimer||(this.stateTimer=setTimeout((function(){c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),e.stateTimer=null,e.timeoutPendingState()}),this.realtime.options.timeouts.realtimeRequestTimeout))},t.prototype.clearStateTimer=function(){var e=this.stateTimer;e&&(clearTimeout(e),this.stateTimer=null)},t.prototype.startRetryTimer=function(){var e=this;this.retryTimer||(this.retryTimer=setTimeout((function(){"suspended"===e.state&&e.connectionManager.state.sendEvents&&(e.retryTimer=null,c.default.logAction(c.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),e.requestState("attaching"))}),this.realtime.options.timeouts.channelRetryTimeout))},t.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},t.prototype.setInProgress=function(e,t){this.rest.channels.setInProgress(this,e,t)},t.prototype.getReleaseErr=function(){var e=this.state;return"initialized"===e||"detached"===e||"failed"===e?null:new d.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+e,90001,400)},t.progressOps={statechange:y,sync:v},t}(s.default);t.default=b},function(e,t,n){"use strict";t.__esModule=!0;var r=function(e,t,n,r){this.previous=e,this.current=t,"attached"===t&&(this.resumed=n),r&&(this.reason=r)};t.default=r},function(e,t,n){"use strict";n.r(t);var r=n(10),o=n.n(r),i=n(11),a=n.n(i),s=n(2),c=n(6),u=n(20),l=n(9),f=n.n(l),d=n(26),p=n.n(d),h=n(13),g=n.n(h),m=n(15),y=n.n(m),v=n(18),_=n.n(v),b=n(12),w=n.n(b),O=n(34),R=n.n(O),S=n(32),C=n.n(S);o.a.Utils=s,o.a.BufferUtils=c,o.a.Crypto=u.default,o.a.Defaults=f.a,o.a.Http=p.a,o.a.Resource=_.a,o.a.Message=g.a,o.a.PresenceMessage=y.a,a.a.Utils=s,a.a.BufferUtils=c,a.a.Crypto=u.default,a.a.Defaults=f.a,a.a.Http=p.a,a.a.Message=g.a,a.a.PresenceMessage=y.a,a.a.ProtocolMessage=w.a,a.a.ConnectionManager=R.a,t.default={Rest:o(),Realtime:a(),msgpack:C()}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importDefault(n(3)),i=r.__importDefault(n(47)),a={internetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],baseTransportOrder:[i.default.XhrPolling,i.default.XhrStreaming,i.default.JsonP,i.default.WebSocket],transportPreferenceOrder:[i.default.JsonP,i.default.XhrPolling,i.default.XhrStreaming,i.default.WebSocket],upgradeTransports:[i.default.XhrStreaming,i.default.WebSocket]};o.default.noUpgrade&&(a.upgradeTransports=[]),t.default=a},function(e,t,n){"use strict";var r;t.__esModule=!0,function(e){e.WebSocket="web_socket",e.Comet="comet",e.XhrStreaming="xhr_streaming",e.XhrPolling="xhr_polling",e.JsonP="jsonp"}(r||(r={})),t.default=r},function(e,t,n){e.exports=n(7).enc.Hex},function(e,t){},function(e){e.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.22","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./browser/static/ably-node.js","typings":"./ably.d.ts","react-native":{"./browser/static/ably-node.js":"./browser/static/ably-reactnative.js"},"browser":{"./browser/static/ably-node.js":"./browser/static/ably-commonjs.js"},"files":["ably.d.ts","browser/static/**","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.2","ws":"^5.1"},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@types/crypto-js":"^4.0.1","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","async":"ably-forks/async#requirejs","aws-sdk":"^2.1075.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"~2.7","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.4.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.10.0","prettier":"^2.5.1","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tslib":"^2.3.1","typescript":"^4.2.4","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"browser/static"},"main":"ably"},"scripts":{"grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","concat":"grunt concat","build":"grunt build:all","build:node":"grunt build:node","build:browser":"grunt build:browser","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore common browser nodejs test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","format:check":"prettier --check --ignore-path .gitignore common browser nodejs test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer browser/static/ably.min.js","sourcemap:noencryption":"source-map-explorer browser/static/ably.noencryption.min.js"}}')},function(e,t,n){var r;e.exports=(r=n(7),n(36),n(29),r.HmacSHA256)},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importStar(n(2)),i=r.__importDefault(n(53)),a=r.__importDefault(n(18)),s=r.__importDefault(n(23)),c=r.__importDefault(n(5)),u=r.__importDefault(n(54)),l=function(){},f=function(e){this.rest=e,this.admin=new d(e)},d=function(){function e(e){this.rest=e,this.deviceRegistrations=new p(e),this.channelSubscriptions=new h(e)}return e.prototype.publish=function(e,t,n){var r=this.rest,i=r.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,s=o.defaultPostHeaders(i),c={},u=o.mixin({recipient:e},t);if("function"!=typeof n){if(this.rest.options.promises)return o.promisify(this,"publish",arguments);n=l}r.options.headers&&o.mixin(s,r.options.headers),r.options.pushFullWait&&o.mixin(c,{fullWait:"true"});var f=o.encodeBody(u,i);a.default.post(r,"/push/publish",f,s,c,null,(function(e){return n(e)}))},e}(),p=function(){function e(e){this.rest=e}return e.prototype.save=function(e,t){var n=this.rest,r=i.default.fromValues(e),s=n.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,c=o.defaultPostHeaders(s),u={};if("function"!=typeof t){if(this.rest.options.promises)return o.promisify(this,"save",arguments);t=l}n.options.headers&&o.mixin(c,n.options.headers),n.options.pushFullWait&&o.mixin(u,{fullWait:"true"});var f=o.encodeBody(r,s);a.default.put(n,"/push/deviceRegistrations/"+encodeURIComponent(e.id),f,c,u,null,(function(e,n,r,o){t(e,e?void 0:i.default.fromResponseBody(n,o?void 0:s))}))},e.prototype.get=function(e,t){var n=this.rest,r=n.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,s=o.defaultGetHeaders(r),u=e.id||e;if("function"!=typeof t){if(this.rest.options.promises)return o.promisify(this,"get",arguments);t=l}"string"==typeof u&&u.length?(n.options.headers&&o.mixin(s,n.options.headers),a.default.get(n,"/push/deviceRegistrations/"+encodeURIComponent(u),s,{},null,(function(e,n,o,a){t(e,e?void 0:i.default.fromResponseBody(n,a?void 0:r))}))):t(new c.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400))},e.prototype.list=function(e,t){var n=this.rest,r=n.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,a=this.rest.http.supportsLinkHeaders?void 0:r,c=o.defaultGetHeaders(r);if("function"!=typeof t){if(this.rest.options.promises)return o.promisify(this,"list",arguments);t=l}n.options.headers&&o.mixin(c,n.options.headers),new s.default(n,"/push/deviceRegistrations",c,a,(function(e,t,n){return i.default.fromResponseBody(e,n?void 0:r)})).get(e,t)},e.prototype.remove=function(e,t){var n=this.rest,r=n.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,i=o.defaultGetHeaders(r),s={},u=e.id||e;if("function"!=typeof t){if(this.rest.options.promises)return o.promisify(this,"remove",arguments);t=l}"string"==typeof u&&u.length?(n.options.headers&&o.mixin(i,n.options.headers),n.options.pushFullWait&&o.mixin(s,{fullWait:"true"}),a.default.delete(n,"/push/deviceRegistrations/"+encodeURIComponent(u),i,s,null,(function(e){return t(e)}))):t(new c.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400))},e.prototype.removeWhere=function(e,t){var n=this.rest,r=n.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,i=o.defaultGetHeaders(r);if("function"!=typeof t){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);t=l}n.options.headers&&o.mixin(i,n.options.headers),n.options.pushFullWait&&o.mixin(e,{fullWait:"true"}),a.default.delete(n,"/push/deviceRegistrations",i,e,null,(function(e){return t(e)}))},e}(),h=function(){function e(t){this.remove=e.prototype.removeWhere,this.rest=t}return e.prototype.save=function(e,t){var n=this.rest,r=u.default.fromValues(e),i=n.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,s=o.defaultPostHeaders(i),c={};if("function"!=typeof t){if(this.rest.options.promises)return o.promisify(this,"save",arguments);t=l}n.options.headers&&o.mixin(s,n.options.headers),n.options.pushFullWait&&o.mixin(c,{fullWait:"true"});var f=o.encodeBody(r,i);a.default.post(n,"/push/channelSubscriptions",f,s,c,null,(function(e,n,r,o){t(e,!e&&u.default.fromResponseBody(n,o?void 0:i))}))},e.prototype.list=function(e,t){var n=this.rest,r=n.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,i=this.rest.http.supportsLinkHeaders?void 0:r,a=o.defaultGetHeaders(r);if("function"!=typeof t){if(this.rest.options.promises)return o.promisify(this,"list",arguments);t=l}n.options.headers&&o.mixin(a,n.options.headers),new s.default(n,"/push/channelSubscriptions",a,i,(function(e,t,n){return u.default.fromResponseBody(e,n?void 0:r)})).get(e,t)},e.prototype.removeWhere=function(e,t){var n=this.rest,r=n.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,i=o.defaultGetHeaders(r);if("function"!=typeof t){if(this.rest.options.promises)return o.promisify(this,"removeWhere",arguments);t=l}n.options.headers&&o.mixin(i,n.options.headers),n.options.pushFullWait&&o.mixin(e,{fullWait:"true"}),a.default.delete(n,"/push/channelSubscriptions",i,e,null,(function(e){return t(e)}))},e.prototype.listChannels=function(e,t){var n=this.rest,r=n.options.useBinaryProtocol?o.Format.msgpack:o.Format.json,i=this.rest.http.supportsLinkHeaders?void 0:r,a=o.defaultGetHeaders(r);if("function"!=typeof t){if(this.rest.options.promises)return o.promisify(this,"listChannels",arguments);t=l}n.options.headers&&o.mixin(a,n.options.headers),n.options.pushFullWait&&o.mixin(e,{fullWait:"true"}),new s.default(n,"/push/channels",a,i,(function(e,t,n){for(var i=!n&&r?o.decodeBody(e,r):e,a=0;a<i.length;a++)i[a]=String(i[a]);return i})).get(e,t)},e}();t.default=f},function(e,t,n){"use strict";t.__esModule=!0;var r,o,i=n(1),a=i.__importStar(n(2)),s=i.__importDefault(n(5));!function(e){e.Phone="phone",e.Tablet="tablet",e.Desktop="desktop",e.TV="tv",e.Watch="watch",e.Car="car",e.Embedded="embedded",e.Other="other"}(r||(r={})),function(e){e.Android="android",e.IOS="ios",e.Browser="browser"}(o||(o={}));var c=function(){function e(){}return e.prototype.toJSON=function(){var e,t,n;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:null===(e=this.push)||void 0===e?void 0:e.recipient,state:null===(t=this.push)||void 0===t?void 0:t.state,error:null===(n=this.push)||void 0===n?void 0:n.error}}},e.prototype.toString=function(){var e,t,n,r,o="[DeviceDetails";return this.id&&(o+="; id="+this.id),this.platform&&(o+="; platform="+this.platform),this.formFactor&&(o+="; formFactor="+this.formFactor),this.clientId&&(o+="; clientId="+this.clientId),this.metadata&&(o+="; metadata="+this.metadata),this.deviceIdentityToken&&(o+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),(null===(e=this.push)||void 0===e?void 0:e.recipient)&&(o+="; push.recipient="+JSON.stringify(this.push.recipient)),(null===(t=this.push)||void 0===t?void 0:t.state)&&(o+="; push.state="+this.push.state),(null===(n=this.push)||void 0===n?void 0:n.error)&&(o+="; push.error="+JSON.stringify(this.push.error)),(null===(r=this.push)||void 0===r?void 0:r.metadata)&&(o+="; push.metadata="+this.push.metadata),o+="]"},e.fromResponseBody=function(t,n){return n&&(t=a.decodeBody(t,n)),a.isArray(t)?e.fromValuesArray(t):e.fromValues(t)},e.fromValues=function(t){return t.error=t.error&&s.default.fromValues(t.error),Object.assign(new e,t)},e.fromValuesArray=function(t){for(var n=t.length,r=new Array(n),o=0;o<n;o++)r[o]=e.fromValues(t[o]);return r},e.toRequestBody=a.encodeBody,e}();t.default=c},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1).__importStar(n(2)),o=function(){function e(){}return e.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},e.prototype.toString=function(){var e="[PushChannelSubscription";return this.channel&&(e+="; channel="+this.channel),this.deviceId&&(e+="; deviceId="+this.deviceId),this.clientId&&(e+="; clientId="+this.clientId),e+="]"},e.fromResponseBody=function(t,n){return n&&(t=r.decodeBody(t,n)),r.isArray(t)?e.fromValuesArray(t):e.fromValues(t)},e.fromValues=function(t){return Object.assign(new e,t)},e.fromValuesArray=function(t){for(var n=t.length,r=new Array(n),o=0;o<n;o++)r[o]=e.fromValues(t[o]);return r},e.toRequestBody=r.encodeBody,e}();t.default=o},function(e,t,n){var r;e.exports=(r=n(7),function(){var e=r,t=e.lib.WordArray,n=e.enc;function o(e){return e<<8&4278255360|e>>>8&16711935}n.Utf16=n.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o+=2){var i=t[o>>>2]>>>16-o%4*8&65535;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var n=e.length,r=[],o=0;o<n;o++)r[o>>>1]|=e.charCodeAt(o)<<16-o%2*16;return t.create(r,2*n)}},n.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i+=2){var a=o(t[i>>>2]>>>16-i%4*8&65535);r.push(String.fromCharCode(a))}return r.join("")},parse:function(e){for(var n=e.length,r=[],i=0;i<n;i++)r[i>>>1]|=o(e.charCodeAt(i)<<16-i%2*16);return t.create(r,2*n)}}}(),r.enc.Utf16)},function(e,t,n){var r,o,i,a;e.exports=(a=n(7),n(31),o=(r=a).lib.CipherParams,i=r.enc.Hex,r.format.Hex={stringify:function(e){return e.ciphertext.toString(i)},parse:function(e){var t=i.parse(e);return o.create({ciphertext:t})}},a.format.Hex)},function(e,t,n){var r;e.exports=(r=n(7),n(17),n(58),n(30),n(31),function(){var e=r,t=e.lib.BlockCipher,n=e.algo,o=[],i=[],a=[],s=[],c=[],u=[],l=[],f=[],d=[],p=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,r=0;for(t=0;t<256;t++){var h=r^r<<1^r<<2^r<<3^r<<4;h=h>>>8^255&h^99,o[n]=h,i[h]=n;var g=e[n],m=e[g],y=e[m],v=257*e[h]^16843008*h;a[n]=v<<24|v>>>8,s[n]=v<<16|v>>>16,c[n]=v<<8|v>>>24,u[n]=v,v=16843009*y^65537*m^257*g^16843008*n,l[h]=v<<24|v>>>8,f[h]=v<<16|v>>>16,d[h]=v<<8|v>>>24,p[h]=v,n?(n=g^e[e[e[y^g]]],r^=e[e[r]]):n=r=1}}();var h=[0,1,2,4,8,16,32,64,128,27,54],g=n.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,r=4*((this._nRounds=n+6)+1),i=this._keySchedule=[],a=0;a<r;a++)a<n?i[a]=t[a]:(u=i[a-1],a%n?n>6&&a%n==4&&(u=o[u>>>24]<<24|o[u>>>16&255]<<16|o[u>>>8&255]<<8|o[255&u]):(u=o[(u=u<<8|u>>>24)>>>24]<<24|o[u>>>16&255]<<16|o[u>>>8&255]<<8|o[255&u],u^=h[a/n|0]<<24),i[a]=i[a-n]^u);for(var s=this._invKeySchedule=[],c=0;c<r;c++){if(a=r-c,c%4)var u=i[a];else u=i[a-4];s[c]=c<4||a<=4?u:l[o[u>>>24]]^f[o[u>>>16&255]]^d[o[u>>>8&255]]^p[o[255&u]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,c,u,o)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,f,d,p,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,o,i,a,s){for(var c=this._nRounds,u=e[t]^n[0],l=e[t+1]^n[1],f=e[t+2]^n[2],d=e[t+3]^n[3],p=4,h=1;h<c;h++){var g=r[u>>>24]^o[l>>>16&255]^i[f>>>8&255]^a[255&d]^n[p++],m=r[l>>>24]^o[f>>>16&255]^i[d>>>8&255]^a[255&u]^n[p++],y=r[f>>>24]^o[d>>>16&255]^i[u>>>8&255]^a[255&l]^n[p++],v=r[d>>>24]^o[u>>>16&255]^i[l>>>8&255]^a[255&f]^n[p++];u=g,l=m,f=y,d=v}g=(s[u>>>24]<<24|s[l>>>16&255]<<16|s[f>>>8&255]<<8|s[255&d])^n[p++],m=(s[l>>>24]<<24|s[f>>>16&255]<<16|s[d>>>8&255]<<8|s[255&u])^n[p++],y=(s[f>>>24]<<24|s[d>>>16&255]<<16|s[u>>>8&255]<<8|s[255&l])^n[p++],v=(s[d>>>24]<<24|s[u>>>16&255]<<16|s[l>>>8&255]<<8|s[255&f])^n[p++],e[t]=g,e[t+1]=m,e[t+2]=y,e[t+3]=v},keySize:8});e.AES=t._createHelper(g)}(),r.AES)},function(e,t,n){var r;e.exports=(r=n(7),function(e){var t=r,n=t.lib,o=n.WordArray,i=n.Hasher,a=t.algo,s=[];!function(){for(var t=0;t<64;t++)s[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=a.MD5=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,o=e[r];e[r]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,a=e[t+0],c=e[t+1],p=e[t+2],h=e[t+3],g=e[t+4],m=e[t+5],y=e[t+6],v=e[t+7],_=e[t+8],b=e[t+9],w=e[t+10],O=e[t+11],R=e[t+12],S=e[t+13],C=e[t+14],A=e[t+15],E=i[0],k=i[1],T=i[2],M=i[3];E=u(E,k,T,M,a,7,s[0]),M=u(M,E,k,T,c,12,s[1]),T=u(T,M,E,k,p,17,s[2]),k=u(k,T,M,E,h,22,s[3]),E=u(E,k,T,M,g,7,s[4]),M=u(M,E,k,T,m,12,s[5]),T=u(T,M,E,k,y,17,s[6]),k=u(k,T,M,E,v,22,s[7]),E=u(E,k,T,M,_,7,s[8]),M=u(M,E,k,T,b,12,s[9]),T=u(T,M,E,k,w,17,s[10]),k=u(k,T,M,E,O,22,s[11]),E=u(E,k,T,M,R,7,s[12]),M=u(M,E,k,T,S,12,s[13]),T=u(T,M,E,k,C,17,s[14]),E=l(E,k=u(k,T,M,E,A,22,s[15]),T,M,c,5,s[16]),M=l(M,E,k,T,y,9,s[17]),T=l(T,M,E,k,O,14,s[18]),k=l(k,T,M,E,a,20,s[19]),E=l(E,k,T,M,m,5,s[20]),M=l(M,E,k,T,w,9,s[21]),T=l(T,M,E,k,A,14,s[22]),k=l(k,T,M,E,g,20,s[23]),E=l(E,k,T,M,b,5,s[24]),M=l(M,E,k,T,C,9,s[25]),T=l(T,M,E,k,h,14,s[26]),k=l(k,T,M,E,_,20,s[27]),E=l(E,k,T,M,S,5,s[28]),M=l(M,E,k,T,p,9,s[29]),T=l(T,M,E,k,v,14,s[30]),E=f(E,k=l(k,T,M,E,R,20,s[31]),T,M,m,4,s[32]),M=f(M,E,k,T,_,11,s[33]),T=f(T,M,E,k,O,16,s[34]),k=f(k,T,M,E,C,23,s[35]),E=f(E,k,T,M,c,4,s[36]),M=f(M,E,k,T,g,11,s[37]),T=f(T,M,E,k,v,16,s[38]),k=f(k,T,M,E,w,23,s[39]),E=f(E,k,T,M,S,4,s[40]),M=f(M,E,k,T,a,11,s[41]),T=f(T,M,E,k,h,16,s[42]),k=f(k,T,M,E,y,23,s[43]),E=f(E,k,T,M,b,4,s[44]),M=f(M,E,k,T,R,11,s[45]),T=f(T,M,E,k,A,16,s[46]),E=d(E,k=f(k,T,M,E,p,23,s[47]),T,M,a,6,s[48]),M=d(M,E,k,T,v,10,s[49]),T=d(T,M,E,k,C,15,s[50]),k=d(k,T,M,E,m,21,s[51]),E=d(E,k,T,M,R,6,s[52]),M=d(M,E,k,T,h,10,s[53]),T=d(T,M,E,k,w,15,s[54]),k=d(k,T,M,E,c,21,s[55]),E=d(E,k,T,M,_,6,s[56]),M=d(M,E,k,T,A,10,s[57]),T=d(T,M,E,k,y,15,s[58]),k=d(k,T,M,E,S,21,s[59]),E=d(E,k,T,M,g,6,s[60]),M=d(M,E,k,T,O,10,s[61]),T=d(T,M,E,k,p,15,s[62]),k=d(k,T,M,E,b,21,s[63]),i[0]=i[0]+E|0,i[1]=i[1]+k|0,i[2]=i[2]+T|0,i[3]=i[3]+M|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;n[o>>>5]|=128<<24-o%32;var i=e.floor(r/4294967296),a=r;n[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(o+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(n.length+1),this._process();for(var s=this._hash,c=s.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return s},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,n,r,o,i,a){var s=e+(t&n|~t&r)+o+a;return(s<<i|s>>>32-i)+t}function l(e,t,n,r,o,i,a){var s=e+(t&r|n&~r)+o+a;return(s<<i|s>>>32-i)+t}function f(e,t,n,r,o,i,a){var s=e+(t^n^r)+o+a;return(s<<i|s>>>32-i)+t}function d(e,t,n,r,o,i,a){var s=e+(n^(t|~r))+o+a;return(s<<i|s>>>32-i)+t}t.MD5=i._createHelper(c),t.HmacMD5=i._createHmacHelper(c)}(Math),r.MD5)},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importStar(n(2)),i=function(e){this.count=e&&e.count||0,this.data=e&&e.data||0,this.uncompressedData=e&&e.uncompressedData||0,this.failed=e&&e.failed||0,this.refused=e&&e.refused||0},a=function(e){function t(t){var n=e.call(this,t)||this;return t&&t.category&&(n.category={},o.forInOwnNonNullProperties(t.category,(function(e){n.category[e]=new i(t.category[e])}))),n}return r.__extends(t,e),t}(i),s=function(e){this.peak=e&&e.peak||0,this.min=e&&e.min||0,this.mean=e&&e.mean||0,this.opened=e&&e.opened||0,this.refused=e&&e.refused||0},c=function(e){this.succeeded=e&&e.succeeded||0,this.failed=e&&e.failed||0,this.refused=e&&e.refused||0},u=function(e){this.plain=new s(e&&e.plain),this.tls=new s(e&&e.tls),this.all=new s(e&&e.all)},l=function(e){this.messages=new a(e&&e.messages),this.presence=new a(e&&e.presence),this.all=new a(e&&e.all)},f=function(e){this.realtime=new l(e&&e.realtime),this.rest=new l(e&&e.rest),this.webhook=new l(e&&e.webhook),this.sharedQueue=new l(e&&e.sharedQueue),this.externalQueue=new l(e&&e.externalQueue),this.httpEvent=new l(e&&e.httpEvent),this.push=new l(e&&e.push),this.all=new l(e&&e.all)},d=function(e){this.all=new l(e&&e.all),this.inbound=new f(e&&e.inbound),this.outbound=new f(e&&e.outbound)},p=function(e){this.all=new l(e&&e.all),this.producerPaid=new d(e&&e.producerPaid),this.consumerPaid=new d(e&&e.consumerPaid)},h=function(e){this.messages=e&&e.messages||0;var t=e&&e.notifications;this.notifications={invalid:t&&t.invalid||0,attempted:t&&t.attempted||0,successful:t&&t.successful||0,failed:t&&t.failed||0},this.directPublishes=e&&e.directPublishes||0},g=function(e){this.succeeded=e&&e.succeeded||0,this.skipped=e&&e.skipped||0,this.failed=e&&e.failed||0},m=function(e){var t=this;this.delta=void 0,e&&e.delta&&(this.delta={},o.forInOwnNonNullProperties(e.delta,(function(n){t.delta[n]=new g(e.delta[n])})))},y=function(e){function t(t){var n=e.call(this,t)||this;return n.persisted=new l(t&&t.persisted),n.connections=new u(t&&t.connections),n.channels=new s(t&&t.channels),n.apiRequests=new c(t&&t.apiRequests),n.tokenRequests=new c(t&&t.tokenRequests),n.xchgProducer=new p(t&&t.xchgProducer),n.xchgConsumer=new p(t&&t.xchgConsumer),n.push=new h(t&&t.pushStats),n.processed=new m(t&&t.processed),n.inProgress=t&&t.inProgress||void 0,n.unit=t&&t.unit||void 0,n.intervalId=t&&t.intervalId||void 0,n}return r.__extends(t,e),t.fromValues=function(e){return new t(e)},t}(d);t.default=y},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importStar(n(2)),i=r.__importDefault(n(8)),a=r.__importDefault(n(34)),s=r.__importDefault(n(0)),c=r.__importDefault(n(42));function u(){}var l=function(e){function t(t,n){var r=e.call(this)||this;return r.whenState=function(e,t){return i.default.prototype.whenState.call(r,e,r.state,t,new c.default(void 0,e))},r.ably=t,r.connectionManager=new a.default(t,n),r.state=r.connectionManager.state.state,r.key=void 0,r.id=void 0,r.serial=void 0,r.timeSerial=void 0,r.recoveryKey=void 0,r.errorReason=null,r.connectionManager.on("connectionstate",(function(e){var t=r.state=e.current;o.nextTick((function(){r.emit(t,e)}))})),r.connectionManager.on("update",(function(e){o.nextTick((function(){r.emit("update",e)}))})),r}return r.__extends(t,e),t.prototype.connect=function(){s.default.logAction(s.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},t.prototype.ping=function(e){if(s.default.logAction(s.default.LOG_MINOR,"Connection.ping()",""),!e){if(this.ably.options.promises)return o.promisify(this,"ping",arguments);e=u}this.connectionManager.ping(null,e)},t.prototype.close=function(){s.default.logAction(s.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},t}(i.default);t.default=l},function(e,t,n){"use strict";t.__esModule=!0,t.PendingMessage=void 0;var r=n(1),o=r.__importDefault(n(12)),i=r.__importStar(n(2)),a=r.__importDefault(n(8)),s=r.__importDefault(n(0)),c=r.__importDefault(n(41)),u=r.__importDefault(n(5)),l=o.default.Action,f=function(e,t){this.message=e,this.callback=t,this.merged=!1;var n=e.action;this.sendAttempted=!1,this.ackRequired=n==l.MESSAGE||n==l.PRESENCE};t.PendingMessage=f;var d=function(e){function t(t){var n=e.call(this)||this;return n.transport=t,n.messageQueue=new c.default,t.on("ack",(function(e,t){n.onAck(e,t)})),t.on("nack",(function(e,t,r){n.onNack(e,t,r)})),n}return r.__extends(t,e),t.prototype.onAck=function(e,t){s.default.logAction(s.default.LOG_MICRO,"Protocol.onAck()","serial = "+e+"; count = "+t),this.messageQueue.completeMessages(e,t)},t.prototype.onNack=function(e,t,n){s.default.logAction(s.default.LOG_ERROR,"Protocol.onNack()","serial = "+e+"; count = "+t+"; err = "+i.inspectError(n)),n||(n=new u.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(e,t,n)},t.prototype.onceIdle=function(e){var t=this.messageQueue;0!==t.count()?t.once("idle",e):e()},t.prototype.send=function(e){e.ackRequired&&this.messageQueue.push(e),s.default.shouldLog(s.default.LOG_MICRO)&&s.default.logAction(s.default.LOG_MICRO,"Protocol.send()","sending msg; "+o.default.stringify(e.message)),e.sendAttempted=!0,this.transport.send(e.message)},t.prototype.getTransport=function(){return this.transport},t.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},t.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},t.prototype.finish=function(){var e=this.transport;this.onceIdle((function(){e.disconnect()}))},t}(a.default);t.default=d},function(e,t,n){"use strict";(function(e){t.__esModule=!0,t.removeSession=t.getSession=t.setSession=t.remove=t.get=t.set=void 0;var r,o,i,a,s,c,u,l,f=n(1).__importStar(n(2)),d="ablyjs-storage-test";try{e.sessionStorage.setItem(d,d),e.sessionStorage.removeItem(d),r=!0}catch(e){r=!1}try{e.localStorage.setItem(d,d),e.localStorage.removeItem(d),o=!0}catch(e){o=!1}function p(t){return t?e.sessionStorage:e.localStorage}function h(e,t,n,r){var o={value:t};return n&&(o.expires=f.now()+n),p(r).setItem(e,JSON.stringify(o))}function g(e,t){var n=p(t).getItem(e);if(!n)return null;var r=JSON.parse(n);return r.expires&&r.expires<f.now()?(p(t).removeItem(e),null):r.value}function m(e,t){return p(t).removeItem(e)}t.set=i,t.get=a,t.remove=s,t.setSession=c,t.getSession=u,t.removeSession=l,o&&(t.set=i=function(e,t,n){return h(e,t,n,!1)},t.get=a=function(e){return g(e,!1)},t.remove=s=function(e){return m(e,!1)}),r&&(t.setSession=c=function(e,t,n){return h(e,t,n,!0)},t.getSession=u=function(e){return g(e,!0)},t.removeSession=l=function(e){return m(e,!0)})}).call(this,n(14))},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importDefault(n(3)),i=r.__importStar(n(2)),a=r.__importDefault(n(38)),s=r.__importDefault(n(9)),c=r.__importDefault(n(0)),u=r.__importDefault(n(12)),l=r.__importDefault(n(5)),f=o.default.WebSocket,d="web_socket",p=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.shortName=d,r.heartbeats=o.default.useProtocolHeartbeats,i.wsHost=s.default.getHost(r.options,r.host,!0),i}return r.__extends(t,e),t.isAvailable=function(){return!!f},t.tryConnect=function(e,n,r,o){var i=new t(e,n,r),a=function(e){o({event:this.event,error:e})};i.on(["failed","disconnected"],a),i.on("wsopen",(function(){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.tryConnect()","viable transport "+i),i.off(["failed","disconnected"],a),o(null,i)})),i.connect()},t.prototype.createWebSocket=function(e,t){var n=0;if(t)for(var r in t)e+=(n++?"&":"?")+r+"="+t[r];return this.uri=e,new f(e)},t.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},t.prototype.connect=function(){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),a.default.prototype.connect.call(this);var e=this,t=this.params,n=t.options,r=(n.tls?"wss://":"ws://")+this.wsHost+":"+s.default.getPort(n)+"/";c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+r),this.auth.getAuthParams((function(n,i){if(!e.isDisposed){var a="";for(var s in i)a+=" "+s+": "+i[s]+";";if(c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+a+" err: "+n),n)e.disconnect(n);else{var u=t.getConnectParams(i);try{var l=e.wsConnection=e.createWebSocket(r,u);l.binaryType=o.default.binaryType,l.onopen=function(){e.onWsOpen()},l.onclose=function(t){e.onWsClose(t)},l.onmessage=function(t){e.onWsData(t.data)},l.onerror=function(t){e.onWsError(t)},l.on&&l.on("ping",(function(){e.onActivity()}))}catch(t){c.default.logAction(c.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(t.stack||t.message)),e.disconnect(t)}}}}))},t.prototype.send=function(e){var t=this.wsConnection;if(t)try{t.send(u.default.serialize(e,this.params.format))}catch(e){var n="Exception from ws connection when trying to send: "+i.inspectError(e);c.default.logAction(c.default.LOG_ERROR,"WebSocketTransport.send()",n),this.finish("disconnected",new l.default(n,5e4,500))}else c.default.logAction(c.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection")},t.prototype.onWsData=function(e){c.default.logAction(c.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+e.length+"; type = "+typeof e);try{this.onProtocolMessage(u.default.deserialize(e,this.format))}catch(e){c.default.logAction(c.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+e.stack)}},t.prototype.onWsOpen=function(){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("wsopen")},t.prototype.onWsClose=function(e){var t,n;if("object"==typeof e?(n=e.code,t=e.wasClean||1e3===n):t=1e3==(n=e),delete this.wsConnection,t){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var r=new l.default("Websocket closed",80003,400);this.finish("disconnected",r)}else{var o="Unclean disconnection of WebSocket ; code = "+n;r=new l.default(o,80003,400),c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.onWsClose()",o),this.finish("disconnected",r)}this.emit("disposed")},t.prototype.onWsError=function(e){var t=this;c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+e.message),i.nextTick((function(){t.disconnect(Error(e.message))}))},t.prototype.dispose=function(){c.default.logAction(c.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var e=this.wsConnection;e&&(e.onmessage=function(){},delete this.wsConnection,i.nextTick((function(){if(c.default.logAction(c.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!e)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");e.close()})))},t}(a.default);t.default=function(e){return p.isAvailable()&&(e.supportedTransports.web_socket=p),p}},function(e,t,n){"use strict";var r;t.__esModule=!0,t.isSuccessCode=void 0,function(e){e[e.Success=200]="Success",e[e.NoContent=204]="NoContent",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.Forbidden=403]="Forbidden",e[e.RequestTimeout=408]="RequestTimeout",e[e.InternalServerError=500]="InternalServerError"}(r||(r={})),t.isSuccessCode=function(e){return e>=r.Success&&e<r.BadRequest},t.default=r},function(e,t,n){"use strict";t.__esModule=!0;var r=n(1),o=r.__importStar(n(2)),i=r.__importDefault(n(40)),a=r.__importDefault(n(8)),s=r.__importDefault(n(0)),c=r.__importDefault(n(15)),u=r.__importDefault(n(5)),l=r.__importDefault(n(43)),f=r.__importDefault(n(28)),d=r.__importDefault(n(44)),p=function(){};function h(e){return e.clientId+":"+e.connectionId}function g(e){var t=e.channel.realtime,n=t.auth.clientId;return(!n||"*"===n)&&"connected"===t.connection.state}function m(e,t,n){switch(e.state){case"attached":case"suspended":n();break;case"initialized":case"detached":case"detaching":case"attaching":e.attach((function(e){e?t(e):n()}));break;default:t(u.default.fromValues(l.default.invalidStateError(e.state)))}}function y(e,t){if(e.isSynthesized()||t.isSynthesized())return e.timestamp>t.timestamp;var n=e.parseId(),r=t.parseId();return n.msgSerial===r.msgSerial?n.index>r.index:n.msgSerial>r.msgSerial}var v=function(e){function t(t){var n=e.call(this,t)||this;return n.channel=t,n.syncComplete=!1,n.members=new _(n),n._myMembers=new _(n),n.subscriptions=new a.default,n.pendingPresence=[],n}return r.__extends(t,e),t.prototype.enter=function(e,t){if(g(this))throw new u.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,e,"enter",t)},t.prototype.update=function(e,t){if(g(this))throw new u.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,e,"update",t)},t.prototype.enterClient=function(e,t,n){return this._enterOrUpdateClient(e,t,"enter",n)},t.prototype.updateClient=function(e,t,n){return this._enterOrUpdateClient(e,t,"update",n)},t.prototype._enterOrUpdateClient=function(e,t,n,r){var i=this;if(!r)if("function"==typeof t)r=t,t=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"_enterOrUpdateClient",[e,t,n]);r=p}var a=this.channel;if(a.connectionManager.activeState()){s.default.logAction(s.default.LOG_MICRO,"RealtimePresence."+n+"Client()","channel = "+a.name+", client = "+(e||"(implicit) "+this.channel.realtime.auth.clientId));var l=c.default.fromValues({action:n,data:t});e&&(l.clientId=e),c.default.encode(l,a.channelOptions,(function(e){if(e)r(e);else switch(a.state){case"attached":a.sendPresence(l,r);break;case"initialized":case"detached":a.attach();case"attaching":i.pendingPresence.push({presence:l,callback:r});break;default:(e=new u.default("Unable to "+n+" presence channel while in "+a.state+" state",90001)).code=90001,r(e)}}))}else r(a.connectionManager.getError())},t.prototype.leave=function(e,t){if(g(this))throw new u.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,e,t)},t.prototype.leaveClient=function(e,t,n){if(!n)if("function"==typeof t)n=t,t=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"leaveClient",[e,t]);n=p}var r=this.channel;if(r.connectionManager.activeState()){s.default.logAction(s.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+e);var i=c.default.fromValues({action:"leave",data:t});switch(e&&(i.clientId=e),r.state){case"attached":r.sendPresence(i,n);break;case"attaching":this.pendingPresence.push({presence:i,callback:n});break;case"initialized":case"failed":var a=new u.default("Unable to leave presence channel (incompatible state)",90001);null==n||n(a);break;default:null==n||n(l.default.invalidStateError(r.state))}}else null==n||n(r.connectionManager.getError())},t.prototype.get=function(e,t){var n=this,r=Array.prototype.slice.call(arguments);1==r.length&&"function"==typeof r[0]&&r.unshift(null),e=r[0],t=r[1];var i=!e||!("waitForSync"in e)||e.waitForSync;if(!t){if(this.channel.realtime.options.promises)return o.promisify(this,"get",r);t=p}function a(n){t(null,e?n.list(e):n.values())}"suspended"!==this.channel.state?m(this.channel,t,(function(){var e=n.members;i?e.waitSync((function(){a(e)})):a(e)})):i?t(u.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):a(this.members)},t.prototype.history=function(e,t){if(s.default.logAction(s.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),void 0===t)if("function"==typeof e)t=e,e=null;else{if(this.channel.realtime.options.promises)return o.promisify(this,"history",arguments);t=p}e&&e.untilAttach&&("attached"===this.channel.state?(delete e.untilAttach,e.from_serial=this.channel.properties.attachSerial):t(new u.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),i.default.prototype._history.call(this,e,t)},t.prototype.setPresence=function(e,t,n){var r,o;s.default.logAction(s.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+e.length+" participants; syncChannelSerial = "+n);var i=this.members,a=this._myMembers,u=[],f=this.channel.connectionManager.connectionId;t&&(this.members.startSync(),n&&(o=n.match(/^[\w-]+:(.*)$/))&&(r=o[1]));for(var d=0;d<e.length;d++)switch((p=c.default.fromValues(e[d])).action){case"leave":i.remove(p)&&u.push(p),p.connectionId!==f||p.isSynthesized()||a.remove(p);break;case"enter":case"present":case"update":i.put(p)&&u.push(p),p.connectionId===f&&a.put(p)}for(t&&!r&&(i.endSync(),this._ensureMyMembersPresent(),this.channel.setInProgress(l.default.progressOps.sync,!1),this.channel.syncChannelSerial=null),d=0;d<u.length;d++){var p=u[d];this.subscriptions.emit(p.action,p)}},t.prototype.onAttached=function(e){s.default.logAction(s.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+e),e?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear(),this._ensureMyMembersPresent());var t=this.pendingPresence,n=t.length;if(n){this.pendingPresence=[];var r=[],o=f.default.create();s.default.logAction(s.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+n+" queued presence messages");for(var i=0;i<n;i++){var a=t[i];r.push(a.presence),o.push(a.callback)}this.channel.sendPresence(r,o)}},t.prototype.actOnChannelState=function(e,t,n){switch(e){case"attached":this.onAttached(t);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(n)}},t.prototype.failPendingPresence=function(e){if(this.pendingPresence.length){s.default.logAction(s.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+o.inspectError(e));for(var t=0;t<this.pendingPresence.length;t++)try{this.pendingPresence[t].callback(e)}catch(e){}this.pendingPresence=[]}},t.prototype._clearMyMembers=function(){this._myMembers.clear()},t.prototype._ensureMyMembersPresent=function(){var e=this,t=this.members,n=this._myMembers,r=function(t){if(t){var n="Presence auto-re-enter failed: "+t.toString(),r=new u.default(n,91004,400);s.default.logAction(s.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",n);var o=new d.default(e.channel.state,e.channel.state,!0,r);e.channel.emit("update",o)}};for(var o in n.map)if(!(o in t.map)){var i=n.map[o];s.default.logAction(s.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+i.clientId+'" into the presence set'),this._enterOrUpdateClient(i.clientId,i.data,"enter",r),delete n.map[o]}},t.prototype._synthesizeLeaves=function(e){var t=this.subscriptions;o.arrForEach(e,(function(e){var n=c.default.fromValues({action:"leave",connectionId:e.connectionId,clientId:e.clientId,data:e.data,encoding:e.encoding,timestamp:o.now()});t.emit("leave",n)}))},t.prototype.on=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,e)},t.prototype.off=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,e)},t.prototype.subscribe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=l.default.processListenerArgs(e),r=n[0],i=n[1],a=n[2],s=this.channel;if(!a){if(this.channel.realtime.options.promises)return o.promisify(this,"subscribe",[r,i]);a=p}"failed"!==s.state?(this.subscriptions.on(r,i),s.attach(a)):a(u.default.fromValues(l.default.invalidStateError("failed")))},t.prototype.unsubscribe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=l.default.processListenerArgs(e),r=n[0],o=n[1];this.subscriptions.off(r,o)},t}(i.default),_=function(e){function t(t){var n=e.call(this)||this;return n.presence=t,n.map={},n.syncInProgress=!1,n.residualMembers=null,n}return r.__extends(t,e),t.prototype.get=function(e){return this.map[e]},t.prototype.getClient=function(e){var t=this.map,n=[];for(var r in t){var o=t[r];o.clientId==e&&"absent"!=o.action&&n.push(o)}return n},t.prototype.list=function(e){var t=this.map,n=e&&e.clientId,r=e&&e.connectionId,o=[];for(var i in t){var a=t[i];"absent"!==a.action&&(n&&n!=a.clientId||r&&r!=a.connectionId||o.push(a))}return o},t.prototype.put=function(e){"enter"!==e.action&&"update"!==e.action||((e=c.default.fromValues(e)).action="present");var t=this.map,n=h(e);this.residualMembers&&delete this.residualMembers[n];var r=t[n];return!(r&&!y(e,r)||(t[n]=e,0))},t.prototype.values=function(){var e=this.map,t=[];for(var n in e){var r=e[n];"absent"!=r.action&&t.push(r)}return t},t.prototype.remove=function(e){var t=this.map,n=h(e),r=t[n];return!(r&&!y(e,r)||(this.syncInProgress?((e=c.default.fromValues(e)).action="absent",t[n]=e):delete t[n],0))},t.prototype.startSync=function(){var e=this.map,t=this.syncInProgress;s.default.logAction(s.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+t),this.syncInProgress||(this.residualMembers=o.copy(e),this.setInProgress(!0))},t.prototype.endSync=function(){var e=this.map,t=this.syncInProgress;if(s.default.logAction(s.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+t),t){for(var n in e)"absent"===e[n].action&&delete e[n];for(var r in this.presence._synthesizeLeaves(o.valuesArray(this.residualMembers)),this.residualMembers)delete e[r];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},t.prototype.waitSync=function(e){var t=this.syncInProgress;s.default.logAction(s.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+t),t?this.once("sync",e):e()},t.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},t.prototype.setInProgress=function(e){s.default.logAction(s.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+e),this.syncInProgress=e,this.presence.syncComplete=!e},t}(a.default);t.default=v},function(e,t,n){"use strict";n.r(t);var r=n(33),o=n.n(r),i=n(2),a=n(0),s=n.n(a),c=n(3),u=n.n(c),l=n(16),f=n.n(l),d=n(19),p=n.n(d),h=function(e){var t="xhr_polling";function n(e,n,r){r.stream=!1,f.a.call(this,e,n,r),this.shortName=t}return i.inherits(n,f.a),n.isAvailable=function(){return u.a.xhrSupported&&u.a.allowComet},n.tryConnect=function(e,t,r,o){var i=new n(e,t,r),a=function(e){o({event:this.event,error:e})};i.on(["failed","disconnected"],a),i.on("preconnect",(function(){s.a.logAction(s.a.LOG_MINOR,"XHRPollingTransport.tryConnect()","viable transport "+i),i.off(["failed","disconnected"],a),o(null,i)})),i.connect()},n.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},n.prototype.createRequest=function(e,t,n,r,o){return p.a.createRequest(e,t,n,r,o,this.timeouts)},void 0!==e&&n.isAvailable()&&(e.supportedTransports[t]=n),n},g=function(e){var t="xhr_streaming";function n(e,n,r){f.a.call(this,e,n,r),this.shortName=t}return i.inherits(n,f.a),n.isAvailable=function(){return u.a.xhrSupported&&u.a.streamingSupported&&u.a.allowComet},n.tryConnect=function(e,t,r,o){var i=new n(e,t,r),a=function(e){o({event:this.event,error:e})};i.on(["failed","disconnected"],a),i.on("preconnect",(function(){s.a.logAction(s.a.LOG_MINOR,"XHRStreamingTransport.tryConnect()","viable transport "+i),i.off(["failed","disconnected"],a),o(null,i)})),i.connect()},n.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},n.prototype.createRequest=function(e,t,n,r,o){return p.a.createRequest(e,t,n,r,o,this.timeouts)},void 0!==e&&n.isAvailable()&&(e.supportedTransports[t]=n),n};t.default=[o.a,h,g]}]).default},"object"==typeof n&&"object"==typeof t?t.exports=o():"object"==typeof n?n.Ably=o():r.Ably=o()}).call(this)}).call(this,e("buffer").Buffer)},{buffer:4}],2:[function(e,t,n){"use strict";function r(e){return"string"==typeof e&&(e=-1==e.indexOf(":")?{token:e}:{key:e}),e.promises=!0,e}var o=e("./browser/static/ably-node"),i=function(e){return new o.Rest(r(e))};Object.assign(i,o.Rest);var a=function(e){return new o.Realtime(r(e))};Object.assign(a,o.Realtime),t.exports={Rest:i,Realtime:a}},{"./browser/static/ably-node":1}],3:[function(e,t,n){"use strict";n.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},n.toByteArray=function(e){var t,n,r=u(e),a=r[0],s=r[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,a,s)),l=0,f=s>0?a-4:a;for(n=0;n<f;n+=4)t=o[e.charCodeAt(n)]<<18|o[e.charCodeAt(n+1)]<<12|o[e.charCodeAt(n+2)]<<6|o[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===s&&(t=o[e.charCodeAt(n)]<<2|o[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===s&&(t=o[e.charCodeAt(n)]<<10|o[e.charCodeAt(n+1)]<<4|o[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},n.fromByteArray=function(e){for(var t,n=e.length,o=n%3,i=[],a=16383,s=0,c=n-o;s<c;s+=a)i.push(l(e,s,s+a>c?c:s+a));1===o?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===o&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return i.join("")};for(var r=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=a.length;s<c;++s)r[s]=a[s],o[a.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var o,i,a=[],s=t;s<n;s+=3)o=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(r[(i=o)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return a.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},{}],4:[function(e,t,n){(function(t){(function(){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
"use strict";var t=e("base64-js"),r=e("ieee754");n.Buffer=a,n.SlowBuffer=function(e){+e!=e&&(e=0);return a.alloc(+e)},n.INSPECT_MAX_BYTES=50;var o=2147483647;function i(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return t.__proto__=a.prototype,t}function a(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return u(e)}return s(e,t,n)}function s(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!a.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|d(e,t),r=i(n),o=r.write(e,t);o!==n&&(r=r.slice(0,o));return r}(e,t);if(ArrayBuffer.isView(e))return l(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return function(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n);return r.__proto__=a.prototype,r}(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return a.from(r,t,n);var o=function(e){if(a.isBuffer(e)){var t=0|f(e.length),n=i(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||q(e.length)?i(0):l(e);if("Buffer"===e.type&&Array.isArray(e.data))return l(e.data)}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return c(e),i(e<0?0:0|f(e))}function l(e){for(var t=e.length<0?0:0|f(e.length),n=i(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function f(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function d(e,t){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return N(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return j(e).length;default:if(o)return r?-1:N(e).length;t=(""+t).toLowerCase(),o=!0}}function p(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return k(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return E(this,t,n);case"base64":return R(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function h(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),q(n=+n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=a.from(t,r)),a.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,o){var i,a=1,s=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,s/=2,c/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(o){var l=-1;for(i=n;i<s;i++)if(u(e,i)===u(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===c)return l*a}else-1!==l&&(i-=i-l),l=-1}else for(n+c>s&&(n=s-c),i=n;i>=0;i--){for(var f=!0,d=0;d<c;d++)if(u(e,i+d)!==u(t,d)){f=!1;break}if(f)return i}return-1}function y(e,t,n,r){n=Number(n)||0;var o=e.length-n;r?(r=Number(r))>o&&(r=o):r=o;var i=t.length;r>i/2&&(r=i/2);for(var a=0;a<r;++a){var s=parseInt(t.substr(2*a,2),16);if(q(s))return a;e[n+a]=s}return a}function v(e,t,n,r){return B(N(t,e.length-n),e,n,r)}function _(e,t,n,r){return B(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n,r){return _(e,t,n,r)}function w(e,t,n,r){return B(j(t),e,n,r)}function O(e,t,n,r){return B(function(e,t){for(var n,r,o,i=[],a=0;a<e.length&&!((t-=2)<0);++a)r=(n=e.charCodeAt(a))>>8,o=n%256,i.push(o),i.push(r);return i}(t,e.length-n),e,n,r)}function R(e,n,r){return 0===n&&r===e.length?t.fromByteArray(e):t.fromByteArray(e.slice(n,r))}function S(e,t,n){n=Math.min(e.length,n);for(var r=[],o=t;o<n;){var i,a,s,c,u=e[o],l=null,f=u>239?4:u>223?3:u>191?2:1;if(o+f<=n)switch(f){case 1:u<128&&(l=u);break;case 2:128==(192&(i=e[o+1]))&&(c=(31&u)<<6|63&i)>127&&(l=c);break;case 3:i=e[o+1],a=e[o+2],128==(192&i)&&128==(192&a)&&(c=(15&u)<<12|(63&i)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:i=e[o+1],a=e[o+2],s=e[o+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&(c=(15&u)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),o+=f}return function(e){var t=e.length;if(t<=C)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=C));return n}(r)}n.kMaxLength=o,a.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),a.poolSize=8192,a.from=function(e,t,n){return s(e,t,n)},a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,a.alloc=function(e,t,n){return function(e,t,n){return c(e),e<=0?i(e):void 0!==t?"string"==typeof n?i(e).fill(t,n):i(e).fill(t):i(e)}(e,t,n)},a.allocUnsafe=function(e){return u(e)},a.allocUnsafeSlow=function(e){return u(e)},a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if(G(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=a.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var i=e[n];if(G(i,Uint8Array)&&(i=a.from(i)),!a.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(r,o),o+=i.length}return r},a.byteLength=d,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)h(this,t,t+1);return this},a.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)h(this,t,t+3),h(this,t+1,t+2);return this},a.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)h(this,t,t+7),h(this,t+1,t+6),h(this,t+2,t+5),h(this,t+3,t+4);return this},a.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?S(this,0,e):p.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(e){if(!a.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},a.prototype.compare=function(e,t,n,r,o){if(G(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&t>=n)return 0;if(r>=o)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),c=Math.min(i,s),u=this.slice(r,o),l=e.slice(t,n),f=0;f<c;++f)if(u[f]!==l[f]){i=u[f],s=l[f];break}return i<s?-1:s<i?1:0},a.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},a.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return y(this,e,t,n);case"utf8":case"utf-8":return v(this,e,t,n);case"ascii":return _(this,e,t,n);case"latin1":case"binary":return b(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var C=4096;function A(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(127&e[o]);return r}function E(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(e[o]);return r}function k(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=t;i<n;++i)o+=U(e[i]);return o}function T(e,t,n){for(var r=e.slice(t,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function M(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,n,r,o,i){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function P(e,t,n,r,o,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function x(e,t,n,o,i){return t=+t,n>>>=0,i||P(e,0,n,4),r.write(e,t,n,o,23,4),n+4}function L(e,t,n,o,i){return t=+t,n>>>=0,i||P(e,0,n,8),r.write(e,t,n,o,52,8),n+8}a.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return r.__proto__=a.prototype,r},a.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r},a.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);for(var r=this[e+--t],o=1;t>0&&(o*=256);)r+=this[e+--t]*o;return r},a.prototype.readUInt8=function(e,t){return e>>>=0,t||M(e,1,this.length),this[e]},a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||M(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||M(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||M(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*t)),r},a.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);for(var r=t,o=1,i=this[e+--r];r>0&&(o*=256);)i+=this[e+--r]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},a.prototype.readInt8=function(e,t){return e>>>=0,t||M(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||M(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(e,t){e>>>=0,t||M(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readFloatLE=function(e,t){return e>>>=0,t||M(e,4,this.length),r.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||M(e,4,this.length),r.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||M(e,8,this.length),r.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||M(e,8,this.length),r.read(this,e,!1,52,8)},a.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||I(this,e,t,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[t]=255&e;++i<n&&(o*=256);)this[t+i]=e/o&255;return t+n},a.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||I(this,e,t,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+n},a.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var o=Math.pow(2,8*n-1);I(this,e,t,n,o-1,-o)}var i=0,a=1,s=0;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+n},a.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var o=Math.pow(2,8*n-1);I(this,e,t,n,o-1,-o)}var i=n-1,a=1,s=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeFloatLE=function(e,t,n){return x(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return x(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return L(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return L(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,r){if(!a.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var o=r-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,r);else if(this===e&&n<t&&t<r)for(var i=o-1;i>=0;--i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,r),t);return o},a.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var o=e.charCodeAt(0);("utf8"===r&&o<128||"latin1"===r)&&(e=o)}}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=a.isBuffer(e)?e:a.from(e,r),c=s.length;if(0===c)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=s[i%c]}return this};var D=/[^+/0-9A-Za-z-_]/g;function U(e){return e<16?"0"+e.toString(16):e.toString(16)}function N(e,t){var n;t=t||1/0;for(var r=e.length,o=null,i=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function j(e){return t.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function B(e,t,n,r){for(var o=0;o<r&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function q(e){return e!=e}}).call(this)}).call(this,e("buffer").Buffer)},{"base64-js":3,buffer:4,ieee754:5}],5:[function(e,t,n){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
n.read=function(e,t,n,r,o){var i,a,s=8*o-r-1,c=(1<<s)-1,u=c>>1,l=-7,f=n?o-1:0,d=n?-1:1,p=e[t+f];for(f+=d,i=p&(1<<-l)-1,p>>=-l,l+=s;l>0;i=256*i+e[t+f],f+=d,l-=8);for(a=i&(1<<-l)-1,i>>=-l,l+=r;l>0;a=256*a+e[t+f],f+=d,l-=8);if(0===i)i=1-u;else{if(i===c)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),i-=u}return(p?-1:1)*a*Math.pow(2,i-r)},n.write=function(e,t,n,r,o,i){var a,s,c,u=8*i-o-1,l=(1<<u)-1,f=l>>1,d=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,h=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+f>=1?d/c:d*Math.pow(2,1-f))*c>=2&&(a++,c/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(t*c-1)*Math.pow(2,o),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,o),a=0));o>=8;e[n+p]=255&s,p+=h,s/=256,o-=8);for(a=a<<o|s,u+=o;u>0;e[n+p]=255&a,p+=h,a/=256,u-=8);e[n+p-h]|=128*g}},{}],6:[function(e,t,n){var r,o,i=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function c(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{o="function"==typeof clearTimeout?clearTimeout:s}catch(e){o=s}}();var u,l=[],f=!1,d=-1;function p(){f&&u&&(f=!1,u.length?l=u.concat(l):d=-1,l.length&&h())}function h(){if(!f){var e=c(p);f=!0;for(var t=l.length;t;){for(u=l,l=[];++d<t;)u&&u[d].run();d=-1,t=l.length}u=null,f=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===s||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new g(e,t)),1!==l.length||f||c(h)},g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],7:[function(e,t,n){(function(e){(function(){
/**
 * @license React
 * react.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";"production"!==e.env.NODE_ENV&&function(){"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),h=Symbol.for("react.offscreen"),g=Symbol.iterator;function m(e){if(null===e||"object"!=typeof e)return null;var t=g&&e[g]||e["@@iterator"];return"function"==typeof t?t:null}var y={current:null},v={transition:null},_={current:null,isBatchingLegacy:!1,didScheduleLegacyUpdate:!1},b={current:null},w={},O=null;function R(e){O=e}w.setExtraStackFrame=function(e){O=e},w.getCurrentStack=null,w.getStackAddendum=function(){var e="";O&&(e+=O);var t=w.getCurrentStack;return t&&(e+=t()||""),e};var S={ReactCurrentDispatcher:y,ReactCurrentBatchConfig:v,ReactCurrentOwner:b};function C(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];E("warn",e,n)}function A(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];E("error",e,n)}function E(e,t,n){var r=S.ReactDebugCurrentFrame.getStackAddendum();""!==r&&(t+="%s",n=n.concat([r]));var o=n.map((function(e){return String(e)}));o.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,o)}S.ReactDebugCurrentFrame=w,S.ReactCurrentActQueue=_;var k={};function T(e,t){var n=e.constructor,r=n&&(n.displayName||n.name)||"ReactClass",o=r+"."+t;k[o]||(A("Can't call %s on a component that is not yet mounted. This is a no-op, but it might indicate a bug in your application. Instead, assign to `this.state` directly or define a `state = {};` class property with the desired state in the %s component.",t,r),k[o]=!0)}var M={isMounted:function(e){return!1},enqueueForceUpdate:function(e,t,n){T(e,"forceUpdate")},enqueueReplaceState:function(e,t,n,r){T(e,"replaceState")},enqueueSetState:function(e,t,n,r){T(e,"setState")}},I=Object.assign,P={};function x(e,t,n){this.props=e,this.context=t,this.refs=P,this.updater=n||M}Object.freeze(P),x.prototype.isReactComponent={},x.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw new Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},x.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};var L={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."]},D=function(e,t){Object.defineProperty(x.prototype,e,{get:function(){C("%s(...) is deprecated in plain JavaScript React classes. %s",t[0],t[1])}})};for(var U in L)L.hasOwnProperty(U)&&D(U,L[U]);function N(){}function j(e,t,n){this.props=e,this.context=t,this.refs=P,this.updater=n||M}N.prototype=x.prototype;var B=j.prototype=new N;B.constructor=j,I(B,x.prototype),B.isPureReactComponent=!0;var G=Array.isArray;function q(e){return G(e)}function H(e){return""+e}function F(e){if(function(e){try{return H(e),!1}catch(e){return!0}}(e))return A("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",function(e){return"function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object"}(e)),H(e)}function V(e){return e.displayName||"Context"}function z(e){if(null==e)return null;if("number"==typeof e.tag&&A("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),"function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case o:return"Fragment";case r:return"Portal";case a:return"Profiler";case i:return"StrictMode";case l:return"Suspense";case f:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case c:return V(e)+".Consumer";case s:return V(e._context)+".Provider";case u:return function(e,t,n){var r=e.displayName;if(r)return r;var o=t.displayName||t.name||"";return""!==o?n+"("+o+")":n}(e,e.render,"ForwardRef");case d:var t=e.displayName||null;return null!==t?t:z(e.type)||"Memo";case p:var n=e,h=n._payload,g=n._init;try{return z(g(h))}catch(e){return null}}return null}var W,$,J,K=Object.prototype.hasOwnProperty,Q={key:!0,ref:!0,__self:!0,__source:!0};function X(e){if(K.call(e,"ref")){var t=Object.getOwnPropertyDescriptor(e,"ref").get;if(t&&t.isReactWarning)return!1}return void 0!==e.ref}function Y(e){if(K.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}function Z(e,t){var n=function(){W||(W=!0,A("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};n.isReactWarning=!0,Object.defineProperty(e,"key",{get:n,configurable:!0})}function ee(e,t){var n=function(){$||($=!0,A("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};n.isReactWarning=!0,Object.defineProperty(e,"ref",{get:n,configurable:!0})}function te(e){if("string"==typeof e.ref&&b.current&&e.__self&&b.current.stateNode!==e.__self){var t=z(b.current.type);J[t]||(A('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',t,e.ref),J[t]=!0)}}J={};var ne=function(t,n,r,o,i,a,s){var c={$$typeof:e,type:t,key:n,ref:r,props:s,_owner:a,_store:{}};return Object.defineProperty(c._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(c,"_self",{configurable:!1,enumerable:!1,writable:!1,value:o}),Object.defineProperty(c,"_source",{configurable:!1,enumerable:!1,writable:!1,value:i}),Object.freeze&&(Object.freeze(c.props),Object.freeze(c)),c};function re(e,t,n){var r,o={},i=null,a=null,s=null,c=null;if(null!=t)for(r in X(t)&&(a=t.ref,te(t)),Y(t)&&(F(t.key),i=""+t.key),s=void 0===t.__self?null:t.__self,c=void 0===t.__source?null:t.__source,t)K.call(t,r)&&!Q.hasOwnProperty(r)&&(o[r]=t[r]);var u=arguments.length-2;if(1===u)o.children=n;else if(u>1){for(var l=Array(u),f=0;f<u;f++)l[f]=arguments[f+2];Object.freeze&&Object.freeze(l),o.children=l}if(e&&e.defaultProps){var d=e.defaultProps;for(r in d)void 0===o[r]&&(o[r]=d[r])}if(i||a){var p="function"==typeof e?e.displayName||e.name||"Unknown":e;i&&Z(o,p),a&&ee(o,p)}return ne(e,i,a,s,c,b.current,o)}function oe(e,t,n){if(null==e)throw new Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r,o,i=I({},e.props),a=e.key,s=e.ref,c=e._self,u=e._source,l=e._owner;if(null!=t)for(r in X(t)&&(s=t.ref,l=b.current),Y(t)&&(F(t.key),a=""+t.key),e.type&&e.type.defaultProps&&(o=e.type.defaultProps),t)K.call(t,r)&&!Q.hasOwnProperty(r)&&(void 0===t[r]&&void 0!==o?i[r]=o[r]:i[r]=t[r]);var f=arguments.length-2;if(1===f)i.children=n;else if(f>1){for(var d=Array(f),p=0;p<f;p++)d[p]=arguments[p+2];i.children=d}return ne(e.type,a,s,c,u,l,i)}function ie(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var ae=!1,se=/\/+/g;function ce(e){return e.replace(se,"$&/")}function ue(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(F(e.key),n=""+e.key,r={"=":"=0",":":"=2"},"$"+n.replace(/[=:]/g,(function(e){return r[e]}))):t.toString(36);var n,r}function le(t,n,o,i,a){var s=typeof t;"undefined"!==s&&"boolean"!==s||(t=null);var c,u,l,f=!1;if(null===t)f=!0;else switch(s){case"string":case"number":f=!0;break;case"object":switch(t.$$typeof){case e:case r:f=!0}}if(f){var d=t,p=a(d),h=""===i?"."+ue(d,0):i;if(q(p)){var g="";null!=h&&(g=ce(h)+"/"),le(p,n,g,"",(function(e){return e}))}else null!=p&&(ie(p)&&(!p.key||d&&d.key===p.key||F(p.key),c=p,u=o+(!p.key||d&&d.key===p.key?"":ce(""+p.key)+"/")+h,p=ne(c.type,u,c.ref,c._self,c._source,c._owner,c.props)),n.push(p));return 1}var y=0,v=""===i?".":i+":";if(q(t))for(var _=0;_<t.length;_++)y+=le(l=t[_],n,o,v+ue(l,_),a);else{var b=m(t);if("function"==typeof b){var w=t;b===w.entries&&(ae||C("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),ae=!0);for(var O,R=b.call(w),S=0;!(O=R.next()).done;)y+=le(l=O.value,n,o,v+ue(l,S++),a)}else if("object"===s){var A=String(t);throw new Error("Objects are not valid as a React child (found: "+("[object Object]"===A?"object with keys {"+Object.keys(t).join(", ")+"}":A)+"). If you meant to render a collection of children, use an array instead.")}}return y}function fe(e,t,n){if(null==e)return e;var r=[],o=0;return le(e,r,"","",(function(e){return t.call(n,e,o++)})),r}var de;function pe(e){if(-1===e._status){var t=(0,e._result)();if(t.then((function(t){if(0===e._status||-1===e._status){var n=e;n._status=1,n._result=t}}),(function(t){if(0===e._status||-1===e._status){var n=e;n._status=2,n._result=t}})),-1===e._status){var n=e;n._status=0,n._result=t}}if(1===e._status){var r=e._result;return void 0===r&&A("lazy: Expected the result of a dynamic import() call. Instead received: %s\n\nYour code should look like: \n  const MyComponent = lazy(() => import('./MyComponent'))\n\nDid you accidentally put curly braces around the import?",r),"default"in r||A("lazy: Expected the result of a dynamic import() call. Instead received: %s\n\nYour code should look like: \n  const MyComponent = lazy(() => import('./MyComponent'))",r),r.default}throw e._result}function he(e){return"string"==typeof e||"function"==typeof e||(e===o||e===a||e===i||e===l||e===f||e===h||"object"==typeof e&&null!==e&&(e.$$typeof===p||e.$$typeof===d||e.$$typeof===s||e.$$typeof===c||e.$$typeof===u||e.$$typeof===de||void 0!==e.getModuleId))}function ge(){var e=y.current;return null===e&&A("Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem."),e}de=Symbol.for("react.module.reference");var me,ye,ve,_e,be,we,Oe,Re=0;function Se(){}Se.__reactDisabledLog=!0;var Ce,Ae=S.ReactCurrentDispatcher;function Ee(e,t,n){if(void 0===Ce)try{throw Error()}catch(e){var r=e.stack.trim().match(/\n( *(at )?)/);Ce=r&&r[1]||""}return"\n"+Ce+e}var ke,Te=!1,Me="function"==typeof WeakMap?WeakMap:Map;function Ie(e,t){if(!e||Te)return"";var n,r=ke.get(e);if(void 0!==r)return r;Te=!0;var o,i=Error.prepareStackTrace;Error.prepareStackTrace=void 0,o=Ae.current,Ae.current=null,function(){if(0===Re){me=console.log,ye=console.info,ve=console.warn,_e=console.error,be=console.group,we=console.groupCollapsed,Oe=console.groupEnd;var e={configurable:!0,enumerable:!0,value:Se,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}Re++}();try{if(t){var a=function(){throw Error()};if(Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(a,[])}catch(e){n=e}Reflect.construct(e,[],a)}else{try{a.call()}catch(e){n=e}e.call(a.prototype)}}else{try{throw Error()}catch(e){n=e}e()}}catch(t){if(t&&n&&"string"==typeof t.stack){for(var s=t.stack.split("\n"),c=n.stack.split("\n"),u=s.length-1,l=c.length-1;u>=1&&l>=0&&s[u]!==c[l];)l--;for(;u>=1&&l>=0;u--,l--)if(s[u]!==c[l]){if(1!==u||1!==l)do{if(u--,--l<0||s[u]!==c[l]){var f="\n"+s[u].replace(" at new "," at ");return e.displayName&&f.includes("<anonymous>")&&(f=f.replace("<anonymous>",e.displayName)),"function"==typeof e&&ke.set(e,f),f}}while(u>=1&&l>=0);break}}}finally{Te=!1,Ae.current=o,function(){if(0==--Re){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:I({},e,{value:me}),info:I({},e,{value:ye}),warn:I({},e,{value:ve}),error:I({},e,{value:_e}),group:I({},e,{value:be}),groupCollapsed:I({},e,{value:we}),groupEnd:I({},e,{value:Oe})})}Re<0&&A("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=i}var d=e?e.displayName||e.name:"",p=d?Ee(d):"";return"function"==typeof e&&ke.set(e,p),p}function Pe(e,t,n){if(null==e)return"";if("function"==typeof e)return Ie(e,function(e){var t=e.prototype;return!(!t||!t.isReactComponent)}(e));if("string"==typeof e)return Ee(e);switch(e){case l:return Ee("Suspense");case f:return Ee("SuspenseList")}if("object"==typeof e)switch(e.$$typeof){case u:return Ie(e.render,!1);case d:return Pe(e.type,t,n);case p:var r=e,o=r._payload,i=r._init;try{return Pe(i(o),t,n)}catch(e){}}return""}ke=new Me;var xe,Le={},De=S.ReactDebugCurrentFrame;function Ue(e){if(e){var t=e._owner,n=Pe(e.type,e._source,t?t.type:null);De.setExtraStackFrame(n)}else De.setExtraStackFrame(null)}function Ne(e){if(e){var t=e._owner;R(Pe(e.type,e._source,t?t.type:null))}else R(null)}function je(){if(b.current){var e=z(b.current.type);if(e)return"\n\nCheck the render method of `"+e+"`."}return""}function Be(e){return null!=e&&void 0!==(t=e.__source)?"\n\nCheck your code at "+t.fileName.replace(/^.*[\\\/]/,"")+":"+t.lineNumber+".":"";var t}xe=!1;var Ge={};function qe(e,t){if(e._store&&!e._store.validated&&null==e.key){e._store.validated=!0;var n=function(e){var t=je();if(!t){var n="string"==typeof e?e:e.displayName||e.name;n&&(t="\n\nCheck the top-level render call using <"+n+">.")}return t}(t);if(!Ge[n]){Ge[n]=!0;var r="";e&&e._owner&&e._owner!==b.current&&(r=" It was passed a child from "+z(e._owner.type)+"."),Ne(e),A('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',n,r),Ne(null)}}}function He(e,t){if("object"==typeof e)if(q(e))for(var n=0;n<e.length;n++){var r=e[n];ie(r)&&qe(r,t)}else if(ie(e))e._store&&(e._store.validated=!0);else if(e){var o=m(e);if("function"==typeof o&&o!==e.entries)for(var i,a=o.call(e);!(i=a.next()).done;)ie(i.value)&&qe(i.value,t)}}function Fe(e){var t,n=e.type;if(null!=n&&"string"!=typeof n){if("function"==typeof n)t=n.propTypes;else{if("object"!=typeof n||n.$$typeof!==u&&n.$$typeof!==d)return;t=n.propTypes}if(t){var r=z(n);!function(e,t,n,r,o){var i=Function.call.bind(K);for(var a in e)if(i(e,a)){var s=void 0;try{if("function"!=typeof e[a]){var c=Error((r||"React class")+": "+n+" type `"+a+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[a]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw c.name="Invariant Violation",c}s=e[a](t,a,r,n,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(e){s=e}!s||s instanceof Error||(Ue(o),A("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",r||"React class",n,a,typeof s),Ue(null)),s instanceof Error&&!(s.message in Le)&&(Le[s.message]=!0,Ue(o),A("Failed %s type: %s",n,s.message),Ue(null))}}(t,e.props,"prop",r,e)}else if(void 0!==n.PropTypes&&!xe){xe=!0,A("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",z(n)||"Unknown")}"function"!=typeof n.getDefaultProps||n.getDefaultProps.isReactClassApproved||A("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Ve(e){for(var t=Object.keys(e.props),n=0;n<t.length;n++){var r=t[n];if("children"!==r&&"key"!==r){Ne(e),A("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",r),Ne(null);break}}null!==e.ref&&(Ne(e),A("Invalid attribute `ref` supplied to `React.Fragment`."),Ne(null))}function ze(t,n,r){var i=he(t);if(!i){var a="";(void 0===t||"object"==typeof t&&null!==t&&0===Object.keys(t).length)&&(a+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var s,c=Be(n);a+=c||je(),null===t?s="null":q(t)?s="array":void 0!==t&&t.$$typeof===e?(s="<"+(z(t.type)||"Unknown")+" />",a=" Did you accidentally export a JSX literal instead of a component?"):s=typeof t,A("React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",s,a)}var u=re.apply(this,arguments);if(null==u)return u;if(i)for(var l=2;l<arguments.length;l++)He(arguments[l],t);return t===o?Ve(u):Fe(u),u}var We=!1;var $e=!1,Je=null;var Ke=0,Qe=!1;function Xe(e){e!==Ke-1&&A("You seem to have overlapping act() calls, this is not supported. Be sure to await previous act() calls before making a new one. "),Ke=e}function Ye(e,n,r){var o=_.current;if(null!==o)try{et(o),function(e){if(null===Je)try{var n=("require"+Math.random()).slice(0,7),r=t&&t[n];Je=r.call(t,"timers").setImmediate}catch(e){Je=function(e){!1===$e&&($e=!0,"undefined"==typeof MessageChannel&&A("This browser does not have a MessageChannel implementation, so enqueuing tasks via await act(async () => ...) will fail. Please file an issue at https://github.com/facebook/react/issues if you encounter this warning."));var t=new MessageChannel;t.port1.onmessage=e,t.port2.postMessage(void 0)}}Je(e)}((function(){0===o.length?(_.current=null,n(e)):Ye(e,n,r)}))}catch(e){r(e)}else n(e)}var Ze=!1;function et(e){if(!Ze){Ze=!0;var t=0;try{for(;t<e.length;t++){var n=e[t];do{n=n(!0)}while(null!==n)}e.length=0}catch(n){throw e=e.slice(t+1),n}finally{Ze=!1}}}var tt=ze,nt=function(e,t,n){for(var r=oe.apply(this,arguments),o=2;o<arguments.length;o++)He(arguments[o],r.type);return Fe(r),r},rt=function(e){var t=ze.bind(null,e);return t.type=e,We||(We=!0,C("React.createFactory() is deprecated and will be removed in a future major release. Consider using JSX or use React.createElement() directly instead.")),Object.defineProperty(t,"type",{enumerable:!1,get:function(){return C("Factory.type is deprecated. Access the class directly before passing it to createFactory."),Object.defineProperty(this,"type",{value:e}),e}}),t},ot={map:fe,forEach:function(e,t,n){fe(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return fe(e,(function(){t++})),t},toArray:function(e){return fe(e,(function(e){return e}))||[]},only:function(e){if(!ie(e))throw new Error("React.Children.only expected to receive a single React element child.");return e}};n.Children=ot,n.Component=x,n.Fragment=o,n.Profiler=a,n.PureComponent=j,n.StrictMode=i,n.Suspense=l,n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=S,n.cloneElement=nt,n.createContext=function(e){var t={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null};t.Provider={$$typeof:s,_context:t};var n=!1,r=!1,o=!1,i={$$typeof:c,_context:t};return Object.defineProperties(i,{Provider:{get:function(){return r||(r=!0,A("Rendering <Context.Consumer.Provider> is not supported and will be removed in a future major release. Did you mean to render <Context.Provider> instead?")),t.Provider},set:function(e){t.Provider=e}},_currentValue:{get:function(){return t._currentValue},set:function(e){t._currentValue=e}},_currentValue2:{get:function(){return t._currentValue2},set:function(e){t._currentValue2=e}},_threadCount:{get:function(){return t._threadCount},set:function(e){t._threadCount=e}},Consumer:{get:function(){return n||(n=!0,A("Rendering <Context.Consumer.Consumer> is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?")),t.Consumer}},displayName:{get:function(){return t.displayName},set:function(e){o||(C("Setting `displayName` on Context.Consumer has no effect. You should set it directly on the context with Context.displayName = '%s'.",e),o=!0)}}}),t.Consumer=i,t._currentRenderer=null,t._currentRenderer2=null,t},n.createElement=tt,n.createFactory=rt,n.createRef=function(){var e={current:null};return Object.seal(e),e},n.forwardRef=function(e){null!=e&&e.$$typeof===d?A("forwardRef requires a render function but received a `memo` component. Instead of forwardRef(memo(...)), use memo(forwardRef(...))."):"function"!=typeof e?A("forwardRef requires a render function but was given %s.",null===e?"null":typeof e):0!==e.length&&2!==e.length&&A("forwardRef render functions accept exactly two parameters: props and ref. %s",1===e.length?"Did you forget to use the ref parameter?":"Any additional parameter will be undefined."),null!=e&&(null==e.defaultProps&&null==e.propTypes||A("forwardRef render functions do not support propTypes or defaultProps. Did you accidentally pass a React component?"));var t,n={$$typeof:u,render:e};return Object.defineProperty(n,"displayName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(n){t=n,e.name||e.displayName||(e.displayName=n)}}),n},n.isValidElement=ie,n.lazy=function(e){var t,n,r={$$typeof:p,_payload:{_status:-1,_result:e},_init:pe};return Object.defineProperties(r,{defaultProps:{configurable:!0,get:function(){return t},set:function(e){A("React.lazy(...): It is not supported to assign `defaultProps` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),t=e,Object.defineProperty(r,"defaultProps",{enumerable:!0})}},propTypes:{configurable:!0,get:function(){return n},set:function(e){A("React.lazy(...): It is not supported to assign `propTypes` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),n=e,Object.defineProperty(r,"propTypes",{enumerable:!0})}}}),r},n.memo=function(e,t){he(e)||A("memo: The first argument must be a component. Instead received: %s",null===e?"null":typeof e);var n,r={$$typeof:d,type:e,compare:void 0===t?null:t};return Object.defineProperty(r,"displayName",{enumerable:!1,configurable:!0,get:function(){return n},set:function(t){n=t,e.name||e.displayName||(e.displayName=t)}}),r},n.startTransition=function(e,t){var n=v.transition;v.transition={};var r=v.transition;v.transition._updatedFibers=new Set;try{e()}finally{if(v.transition=n,null===n&&r._updatedFibers)r._updatedFibers.size>10&&C("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),r._updatedFibers.clear()}},n.unstable_act=function(e){var t=Ke;Ke++,null===_.current&&(_.current=[]);var n,r=_.isBatchingLegacy;try{if(_.isBatchingLegacy=!0,n=e(),!r&&_.didScheduleLegacyUpdate){var o=_.current;null!==o&&(_.didScheduleLegacyUpdate=!1,et(o))}}catch(e){throw Xe(t),e}finally{_.isBatchingLegacy=r}if(null!==n&&"object"==typeof n&&"function"==typeof n.then){var i=n,a=!1,s={then:function(e,n){a=!0,i.then((function(r){Xe(t),0===Ke?Ye(r,e,n):e(r)}),(function(e){Xe(t),n(e)}))}};return Qe||"undefined"==typeof Promise||Promise.resolve().then((function(){})).then((function(){a||(Qe=!0,A("You called act(async () => ...) without await. This could lead to unexpected testing behaviour, interleaving multiple act calls and mixing their scopes. You should - await act(async () => ...);"))})),s}var c=n;if(Xe(t),0===Ke){var u=_.current;return null!==u&&(et(u),_.current=null),{then:function(e,t){null===_.current?(_.current=[],Ye(c,e,t)):e(c)}}}return{then:function(e,t){e(c)}}},n.useCallback=function(e,t){return ge().useCallback(e,t)},n.useContext=function(e){var t=ge();if(void 0!==e._context){var n=e._context;n.Consumer===e?A("Calling useContext(Context.Consumer) is not supported, may cause bugs, and will be removed in a future major release. Did you mean to call useContext(Context) instead?"):n.Provider===e&&A("Calling useContext(Context.Provider) is not supported. Did you mean to call useContext(Context) instead?")}return t.useContext(e)},n.useDebugValue=function(e,t){return ge().useDebugValue(e,t)},n.useDeferredValue=function(e){return ge().useDeferredValue(e)},n.useEffect=function(e,t){return ge().useEffect(e,t)},n.useId=function(){return ge().useId()},n.useImperativeHandle=function(e,t,n){return ge().useImperativeHandle(e,t,n)},n.useInsertionEffect=function(e,t){return ge().useInsertionEffect(e,t)},n.useLayoutEffect=function(e,t){return ge().useLayoutEffect(e,t)},n.useMemo=function(e,t){return ge().useMemo(e,t)},n.useReducer=function(e,t,n){return ge().useReducer(e,t,n)},n.useRef=function(e){return ge().useRef(e)},n.useState=function(e){return ge().useState(e)},n.useSyncExternalStore=function(e,t,n){return ge().useSyncExternalStore(e,t,n)},n.useTransition=function(){return ge().useTransition()},n.version="18.1.0","undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()}).call(this)}).call(this,e("_process"))},{_process:6}],8:[function(e,t,n){
/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
"use strict";var r=Symbol.for("react.element"),o=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),u=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),h=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,y={};function v(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||g}function _(){}function b(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||g}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},_.prototype=v.prototype;var w=b.prototype=new _;w.constructor=b,m(w,v.prototype),w.isPureReactComponent=!0;var O=Array.isArray,R=Object.prototype.hasOwnProperty,S={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,n){var o,i={},a=null,s=null;if(null!=t)for(o in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)R.call(t,o)&&!C.hasOwnProperty(o)&&(i[o]=t[o]);var c=arguments.length-2;if(1===c)i.children=n;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];i.children=u}if(e&&e.defaultProps)for(o in c=e.defaultProps)void 0===i[o]&&(i[o]=c[o]);return{$$typeof:r,type:e,key:a,ref:s,props:i,_owner:S.current}}function E(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}var k=/\/+/g;function T(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function M(e,t,n,i,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c=!1;if(null===e)c=!0;else switch(s){case"string":case"number":c=!0;break;case"object":switch(e.$$typeof){case r:case o:c=!0}}if(c)return a=a(c=e),e=""===i?"."+T(c,0):i,O(a)?(n="",null!=e&&(n=e.replace(k,"$&/")+"/"),M(a,t,n,"",(function(e){return e}))):null!=a&&(E(a)&&(a=function(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,n+(!a.key||c&&c.key===a.key?"":(""+a.key).replace(k,"$&/")+"/")+e)),t.push(a)),1;if(c=0,i=""===i?".":i+":",O(e))for(var u=0;u<e.length;u++){var l=i+T(s=e[u],u);c+=M(s,t,n,l,a)}else if(l=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=h&&e[h]||e["@@iterator"])?e:null}(e),"function"==typeof l)for(e=l.call(e),u=0;!(s=e.next()).done;)c+=M(s=s.value,t,n,l=i+T(s,u++),a);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return c}function I(e,t,n){if(null==e)return e;var r=[],o=0;return M(e,r,"","",(function(e){return t.call(n,e,o++)})),r}function P(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var x={current:null},L={transition:null},D={ReactCurrentDispatcher:x,ReactCurrentBatchConfig:L,ReactCurrentOwner:S};n.Children={map:I,forEach:function(e,t,n){I(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return I(e,(function(){t++})),t},toArray:function(e){return I(e,(function(e){return e}))||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},n.Component=v,n.Fragment=i,n.Profiler=s,n.PureComponent=b,n.StrictMode=a,n.Suspense=f,n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D,n.cloneElement=function(e,t,n){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=m({},e.props),i=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=S.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)R.call(t,u)&&!C.hasOwnProperty(u)&&(o[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)o.children=n;else if(1<u){c=Array(u);for(var l=0;l<u;l++)c[l]=arguments[l+2];o.children=c}return{$$typeof:r,type:e.type,key:i,ref:a,props:o,_owner:s}},n.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:c,_context:e},e.Consumer=e},n.createElement=A,n.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},n.createRef=function(){return{current:null}},n.forwardRef=function(e){return{$$typeof:l,render:e}},n.isValidElement=E,n.lazy=function(e){return{$$typeof:p,_payload:{_status:-1,_result:e},_init:P}},n.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},n.startTransition=function(e){var t=L.transition;L.transition={};try{e()}finally{L.transition=t}},n.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},n.useCallback=function(e,t){return x.current.useCallback(e,t)},n.useContext=function(e){return x.current.useContext(e)},n.useDebugValue=function(){},n.useDeferredValue=function(e){return x.current.useDeferredValue(e)},n.useEffect=function(e,t){return x.current.useEffect(e,t)},n.useId=function(){return x.current.useId()},n.useImperativeHandle=function(e,t,n){return x.current.useImperativeHandle(e,t,n)},n.useInsertionEffect=function(e,t){return x.current.useInsertionEffect(e,t)},n.useLayoutEffect=function(e,t){return x.current.useLayoutEffect(e,t)},n.useMemo=function(e,t){return x.current.useMemo(e,t)},n.useReducer=function(e,t,n){return x.current.useReducer(e,t,n)},n.useRef=function(e){return x.current.useRef(e)},n.useState=function(e){return x.current.useState(e)},n.useSyncExternalStore=function(e,t,n){return x.current.useSyncExternalStore(e,t,n)},n.useTransition=function(){return x.current.useTransition()},n.version="18.1.0"},{}],9:[function(e,t,n){(function(n){(function(){"use strict";"production"===n.env.NODE_ENV?t.exports=e("./cjs/react.production.min.js"):t.exports=e("./cjs/react.development.js")}).call(this)}).call(this,e("_process"))},{"./cjs/react.development.js":7,"./cjs/react.production.min.js":8,_process:6}],10:[function(e,t,n){"use strict";var r=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const i=o(e("react"));n.default=e=>{var{config:t}=e,n=r(e,["config"]);return i.default.createElement("iframe",Object.assign({src:`https://theconvo.space/embed/c/${t.commentId}`,style:{backgroundColor:"transparent",border:"none"}},n))}},{react:9}],11:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__rest||function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n};Object.defineProperty(n,"__esModule",{value:!0});const s=i(e("react"));n.default=e=>{var{embedConfig:t}=e,n=a(e,["embedConfig"]);const[r,o]=(0,s.useState)("");return(0,s.useEffect)((()=>{const e=new URLSearchParams(Object.assign({},t));o(e.toString())}),[n]),s.default.createElement("iframe",Object.assign({src:`https://theconvo.space/embed/dt?${r}`,style:{backgroundColor:"transparent",border:"none"},width:"500px",height:"300px"},n))}},{react:9}],12:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.CommentEmbed=n.ConvoEmbed=void 0;var o=e("./ConvoEmbed");Object.defineProperty(n,"ConvoEmbed",{enumerable:!0,get:function(){return r(o).default}});var i=e("./CommentEmbed");Object.defineProperty(n,"CommentEmbed",{enumerable:!0,get:function(){return r(i).default}})},{"./CommentEmbed":10,"./ConvoEmbed":11}],13:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.subscribe=void 0;var o=e("./subscribe");Object.defineProperty(n,"subscribe",{enumerable:!0,get:function(){return r(o).default}})},{"./subscribe":14}],14:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const o=e("react"),i=r(e("ably/promises"));n.default=(e,t,n)=>{const r=new i.default.Realtime.Promise({authUrl:`https://theconvo.space/api/getAblyAuth?apikey=${e}`}),a=r.channels.get(t);return(0,o.useEffect)((()=>(a.subscribe(n),()=>{a.unsubscribe()}))),[a,r]}},{"ably/promises":2,react:9}],15:[function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),o(e("./hooks"),n),o(e("./components"),n)},{"./components":12,"./hooks":13}]},{},[15])(15)}));